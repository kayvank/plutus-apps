<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">{- HLINT ignore &quot;Use head&quot; -}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Integration.Scenario.API.Shelley.TransactionsNew</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Scenario.API.Shelley.TransactionsNew.html#spec"><span class="hs-identifier">spec</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Derivation</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">XPub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">xpubPublicKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Address.Script</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">KeyHash</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">KeyRole</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Script</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">keyHashFromBytes</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">toScriptHash</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">CardanoEra</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">InAnyCardanoEra</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier">Cardano.Crypto.DSIGN.Class</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier">rawDeserialiseVerKeyDSIGN</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Mnemonic</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">SomeMnemonic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">mnemonicToText</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Api.Types</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">AddressAmount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiAnyCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiAssetMintBurn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiCoinSelection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">withdrawals</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiConstructTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiDecodedTransaction</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiDeregisterPool</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiEra</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiExternalCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiNetworkInformation</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiPolicyId</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiPolicyKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiRegisterPool</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiSerialisedTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiStakePool</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTokenAmountFingerprint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTokens</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTransaction</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxInputGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxOutputGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiWallet</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiWalletInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiWalletOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DecodeAddress</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DecodeStakeAddress</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">EncodeAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">EncodeStakeAddress</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ResourceContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">WalletStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">fromApiEra</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">HardDerivation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">PaymentAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Role</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">WalletKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">hex</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Icarus</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">IcarusKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">EpochNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">NonWalletCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">PoolId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">PoolOwner</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier">SlotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">StakePoolMetadataHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">StakePoolMetadataUrl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">decodePoolIdBech32</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Address</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Address</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Coin</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Hash</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Hash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.RewardAccount</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">RewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenBundle</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">AssetId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenPolicy</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TokenName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TokenPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">mkTokenFingerprint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">mkTokenName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenQuantity</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TokenQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Direction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">SealedTx</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">TxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">TxMetadataValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TxScriptValidity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TxStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">cardanoTxIdeallyNoLaterThan</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">getSealedTxBody</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">sealedTxFromCardanoBody</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Transaction</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">AnyScript</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ValidityIntervalExplicit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Unsafe</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">unsafeFromHex</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">unsafeMkMnemonic</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Arrow</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">second</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">foldM_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM_</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier">Control.Monad.IO.Unlift</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">MonadIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier">MonadUnliftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">Control.Monad.Trans.Resource</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">runResourceT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">toJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-operator">(.=)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL.Lens</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">mkPercentage</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Ratio</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(%)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">Data.Text.Class</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">toText</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Numeric.Natural</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Natural</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../hspec/html/src"><span class="hs-identifier">Test.Hspec</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier">SpecWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier">describe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier">pendingWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations/html/src"><span class="hs-identifier">shouldContain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations/html/src"><span class="hs-identifier">shouldNotContain</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">Test.Hspec.Expectations.Lifted</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">shouldBe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">shouldNotBe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">shouldNotSatisfy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">shouldSatisfy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier">Test.Hspec.Extra</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier">it</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html"><span class="hs-identifier">Test.Integration.Framework.DSL</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier">Context</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Headers"><span class="hs-identifier">Headers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier">Payload</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#arbitraryStake"><span class="hs-identifier">arbitraryStake</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#delegating"><span class="hs-identifier">delegating</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#emptyIcarusWallet"><span class="hs-identifier">emptyIcarusWallet</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#emptyRandomWallet"><span class="hs-identifier">emptyRandomWallet</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier">emptyWallet</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier">eventually</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier">expectErrorMessage</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier">expectField</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectListField"><span class="hs-identifier">expectListField</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectListSize"><span class="hs-identifier">expectListSize</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier">expectResponseCode</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier">expectSuccess</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixtureMultiAssetWallet"><span class="hs-identifier">fixtureMultiAssetWallet</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixturePassphrase"><span class="hs-identifier">fixturePassphrase</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier">fixtureWallet</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier">fixtureWalletWith</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixtureWalletWithMnemonics"><span class="hs-identifier">fixtureWalletWithMnemonics</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier">getFromResponse</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#getSomeVerificationKey"><span class="hs-identifier">getSomeVerificationKey</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#json"><span class="hs-identifier">json</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier">listAddresses</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier">minUTxOValue</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#notDelegating"><span class="hs-identifier">notDelegating</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#pickAnAsset"><span class="hs-identifier">pickAnAsset</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier">request</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier">rewardWallet</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier">selectCoins</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier">signTx</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier">submitTxWithWid</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier">unsafeRequest</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier">verify</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#waitForNextEpoch"><span class="hs-identifier">waitForNextEpoch</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#waitForTxImmutability"><span class="hs-identifier">waitForTxImmutability</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#walletId"><span class="hs-identifier">walletId</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#.%3E"><span class="hs-operator">(.&gt;)</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html"><span class="hs-identifier">Test.Integration.Framework.TestData</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403AssetNameTooLong"><span class="hs-identifier">errMsg403AssetNameTooLong</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403Collateral"><span class="hs-identifier">errMsg403Collateral</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403CreatedWrongPolicyScriptTemplatePolicyId"><span class="hs-identifier">errMsg403CreatedWrongPolicyScriptTemplatePolicyId</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403CreatedWrongPolicyScriptTemplateTx"><span class="hs-identifier">errMsg403CreatedWrongPolicyScriptTemplateTx</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403Fee"><span class="hs-identifier">errMsg403Fee</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403ForeignTransaction"><span class="hs-identifier">errMsg403ForeignTransaction</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidConstructTx"><span class="hs-identifier">errMsg403InvalidConstructTx</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidValidityBounds"><span class="hs-identifier">errMsg403InvalidValidityBounds</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403MinUTxOValue"><span class="hs-identifier">errMsg403MinUTxOValue</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403MintOrBurnAssetQuantityOutOfBounds"><span class="hs-identifier">errMsg403MintOrBurnAssetQuantityOutOfBounds</span></a></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403MissingWitsInTransaction"><span class="hs-identifier">errMsg403MissingWitsInTransaction</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403MultiaccountTransaction"><span class="hs-identifier">errMsg403MultiaccountTransaction</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403MultidelegationTransaction"><span class="hs-identifier">errMsg403MultidelegationTransaction</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403NonNullReward"><span class="hs-identifier">errMsg403NonNullReward</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403NotDelegating"><span class="hs-identifier">errMsg403NotDelegating</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403NotEnoughMoney"><span class="hs-identifier">errMsg403NotEnoughMoney</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403ValidityIntervalNotInsideScriptTimelock"><span class="hs-identifier">errMsg403ValidityIntervalNotInsideScriptTimelock</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg404NoSuchPool"><span class="hs-identifier">errMsg404NoSuchPool</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg404NoWallet"><span class="hs-identifier">errMsg404NoWallet</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">UnliftIO.Exception</span></a></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../unliftio/html/src"><span class="hs-identifier">fromEither</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-225"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">Cardano.Api.Shelley</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cardano</span></span><span>
</span><span id="line-226"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier">Cardano.Ledger.Alonzo.Tx</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Alonzo</span></span><span>
</span><span id="line-227"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Crypto</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-228"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Keys</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span>
</span><span id="line-229"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Api.Link</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Link</span></span><span>
</span><span id="line-230"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Shelley</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shelley</span></span><span>
</span><span id="line-231"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenMap</span></span><span>
</span><span id="line-232"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-233"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-234"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-235"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-236"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-237"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-238"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier">Network.HTTP.Types.Status</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-239"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Test.Integration.Plutus.html"><span class="hs-identifier">Test.Integration.Plutus</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PlutusScenario</span></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="annot"><a href="Test.Integration.Scenario.API.Shelley.TransactionsNew.html#spec"><span class="hs-identifier hs-type">spec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682951404"><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeStakeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">EncodeStakeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">EncodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-248"></span><span id="spec"><span class="annot"><span class="annottext">spec :: SpecWith Context
</span><a href="Test.Integration.Scenario.API.Shelley.TransactionsNew.html#spec"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NEW_SHELLEY_TRANSACTIONS&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_01a - Empty payload is not allowed&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951403"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951403"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>        </span><span id="local-6989586621682951402"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951402"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951403"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951401"><span class="annot"><span class="annottext">emptyPayload :: Payload
</span><a href="#local-6989586621682951401"><span class="hs-identifier hs-var hs-var">emptyPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{}|]</span></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>        </span><span id="local-6989586621682951398"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951398"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951403"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-254"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951402"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951401"><span class="hs-identifier hs-var">emptyPayload</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951398"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-256"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-257"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidConstructTx"><span class="hs-identifier hs-var">errMsg403InvalidConstructTx</span></a></span><span>
</span><span id="line-258"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_01b - \
        \Validity interval only is not allowed&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682951393"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951393"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>        </span><span id="local-6989586621682951392"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951392"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951393"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951391"><span class="annot"><span class="annottext">validityInterval :: Payload
</span><a href="#local-6989586621682951391"><span class="hs-identifier hs-var hs-var">validityInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;validity_interval&quot;:
                    { &quot;invalid_before&quot;:
                        { &quot;quantity&quot;: 10
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                    , &quot;invalid_hereafter&quot;:
                        { &quot;quantity&quot;: 50
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                    }
                }|]</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span>        </span><span id="local-6989586621682951387"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951387"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951393"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951392"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951391"><span class="hs-identifier hs-var">validityInterval</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951387"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-281"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-282"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidConstructTx"><span class="hs-identifier hs-var">errMsg403InvalidConstructTx</span></a></span><span>
</span><span id="line-283"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_01c - No payload is bad request&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951386"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951386"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621682951385"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951385"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951386"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621682951384"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951384"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951386"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-289"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951385"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951384"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-291"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-292"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_02a - Only metadata&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951381"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>        </span><span id="local-6989586621682951380"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951379"><span class="annot"><span class="annottext">metadata :: Payload
</span><a href="#local-6989586621682951379"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{ &quot;metadata&quot;: { &quot;1&quot;: { &quot;string&quot;: &quot;hello&quot; } } }|]</span></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>        </span><span id="local-6989586621682951378"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951379"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-301"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-302"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951376"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; (Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
(Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951374"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; (Maybe ApiBase64 -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951373"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951372"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951370"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682951370"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951369"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951368"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951367"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682951367"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951366"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951378"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span id="local-6989586621682951365"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951365"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951367"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-comment">-- Check for the presence of metadata on signed transaction</span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951364"><span class="annot"><span class="annottext">getMetadata :: InAnyCardanoEra Tx -&gt; Maybe (Map Word64 TxMetadataValue)
</span><a href="#local-6989586621682951364"><span class="hs-identifier hs-var hs-var">getMetadata</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">InAnyCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951362"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682951362"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; TxBody era
forall era. Tx era -&gt; TxBody era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.getTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682951362"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
-&gt; (TxBody era -&gt; Maybe (Map Word64 TxMetadataValue))
-&gt; Maybe (Map Word64 TxMetadataValue)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span>
</span><span id="line-312"></span><span>                </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxBody</span></a></span><span> </span><span id="local-6989586621682951359"><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682951359"><span class="hs-identifier hs-var">bodyContent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>                    </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era -&gt; TxMetadataInEra era
forall build era. TxBodyContent build era -&gt; TxMetadataInEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">Cardano.txMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682951359"><span class="hs-identifier hs-var">bodyContent</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra era
-&gt; (TxMetadataInEra era -&gt; Maybe (Map Word64 TxMetadataValue))
-&gt; Maybe (Map Word64 TxMetadataValue)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-314"></span><span>                        </span><span class="annot"><span class="annottext">TxMetadataInEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxMetadataNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-315"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (Map Word64 TxMetadataValue)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-316"></span><span>                        </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxMetadataInEra</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxMetadata</span></a></span><span> </span><span id="local-6989586621682951354"><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951354"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>                            </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; Maybe (Map Word64 TxMetadataValue)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951354"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951353"><span class="annot"><span class="annottext">era :: AnyCardanoEra
</span><a href="#local-6989586621682951353"><span class="hs-identifier hs-var hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; AnyCardanoEra
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">fromApiEra</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; AnyCardanoEra) -&gt; ApiEra -&gt; AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951351"><span class="annot"><span class="annottext">tx :: InAnyCardanoEra Tx
</span><a href="#local-6989586621682951351"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra -&gt; SealedTx -&gt; InAnyCardanoEra Tx
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">cardanoTxIdeallyNoLaterThan</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682951353"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">(SealedTx -&gt; InAnyCardanoEra Tx) -&gt; SealedTx -&gt; InAnyCardanoEra Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; SealedTx
forall a. ApiT a -&gt; a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951365"><span class="hs-identifier hs-var">signedTx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
    -&gt; ApiSerialisedTransaction
    -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction
   -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiSerialisedTransaction
-&gt; Const (ApiT SealedTx) ApiSerialisedTransaction
</span><a href="#local-6989586621682951349"><span class="hs-var">#transaction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx -&gt; Maybe (Map Word64 TxMetadataValue)
</span><a href="#local-6989586621682951364"><span class="hs-identifier hs-var">getMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx
</span><a href="#local-6989586621682951351"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-322"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Map Word64 TxMetadataValue)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ResourceT IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx doesn't include metadata&quot;</span></span><span>
</span><span id="line-323"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682951347"><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951347"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Map Word64 TxMetadataValue -&gt; Maybe TxMetadataValue
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951347"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>                </span><span class="annot"><span class="annottext">Maybe TxMetadataValue
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ResourceT IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx doesn't include metadata&quot;</span></span><span>
</span><span id="line-325"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxMetaText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hello&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ResourceT IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ResourceT IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx metadata incorrect&quot;</span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951344"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682951344"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682951343"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951365"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951342"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682951342"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951344"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951340"><span class="annot"><span class="annottext">expMetadata :: ApiT TxMetadata
</span><a href="#local-6989586621682951340"><span class="hs-identifier hs-var hs-var">expMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-332"></span><span>                </span><span class="annot"><span class="annottext">TxMetadata -&gt; ApiT TxMetadata
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; TxMetadata
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">TxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Word64, TxMetadataValue)] -&gt; Map Word64 TxMetadataValue
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text -&gt; TxMetadataValue
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">TxMetaText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hello&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621682951337"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951337"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951342"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-335"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951337"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span>
</span><span id="line-336"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-337"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiTxMetadata
-&gt; (ApiTxMetadata -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((ApiTxMetadata -&gt; f ApiTxMetadata)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiTxMetadata
</span><a href="#local-6989586621682951335"><span class="hs-var">#metadata</span></a></span><span>
</span><span id="line-338"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiTxMetadata -&gt; ApiTxMetadata -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT TxMetadata -&gt; Maybe (ApiT TxMetadata)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TxMetadata
</span><a href="#local-6989586621682951340"><span class="hs-identifier hs-var">expMetadata</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-342"></span><span>        </span><span id="local-6989586621682951333"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951333"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951365"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951333"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-346"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-comment">-- Make sure only fee is deducted from fixtureWallet</span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is as expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-350"></span><span>            </span><span id="local-6989586621682951332"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951332"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951381"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-351"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951380"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-352"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951332"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-353"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-354"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-355"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951330"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951329"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951328"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682951327"><span class="hs-identifier hs-var">oneMillionAda</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951370"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_02b - Only metadata, untyped&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-360"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682951326"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span>        </span><span id="local-6989586621682951325"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951325"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951324"><span class="annot"><span class="annottext">metadata :: Payload
</span><a href="#local-6989586621682951324"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{ &quot;metadata&quot;: { &quot;1&quot;: &quot;hello&quot;  } }|]</span></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>        </span><span id="local-6989586621682951323"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951323"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-366"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951325"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951324"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-367"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951323"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-368"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-369"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951322"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; (Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
(Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951321"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; (Maybe ApiBase64 -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951320"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951319"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951318"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682951318"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951317"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951316"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951323"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951315"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682951315"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951314"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951323"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span id="local-6989586621682951313"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951313"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951325"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951315"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>        </span><span class="hs-comment">-- Check for the presence of metadata on signed transaction</span><span>
</span><span id="line-378"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951312"><span class="annot"><span class="annottext">getMetadata :: InAnyCardanoEra Tx -&gt; Maybe (Map Word64 TxMetadataValue)
</span><a href="#local-6989586621682951312"><span class="hs-identifier hs-var hs-var">getMetadata</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">InAnyCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951311"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682951311"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; TxBody era
forall era. Tx era -&gt; TxBody era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.getTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621682951311"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
-&gt; (TxBody era -&gt; Maybe (Map Word64 TxMetadataValue))
-&gt; Maybe (Map Word64 TxMetadataValue)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span>
</span><span id="line-379"></span><span>                </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxBody</span></a></span><span> </span><span id="local-6989586621682951310"><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682951310"><span class="hs-identifier hs-var">bodyContent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>                    </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era -&gt; TxMetadataInEra era
forall build era. TxBodyContent build era -&gt; TxMetadataInEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var hs-var">Cardano.txMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx era
</span><a href="#local-6989586621682951310"><span class="hs-identifier hs-var">bodyContent</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra era
-&gt; (TxMetadataInEra era -&gt; Maybe (Map Word64 TxMetadataValue))
-&gt; Maybe (Map Word64 TxMetadataValue)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-381"></span><span>                        </span><span class="annot"><span class="annottext">TxMetadataInEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxMetadataNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (Map Word64 TxMetadataValue)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-383"></span><span>                        </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxMetadataInEra</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxMetadata</span></a></span><span> </span><span id="local-6989586621682951309"><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951309"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-384"></span><span>                            </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; Maybe (Map Word64 TxMetadataValue)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951309"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951308"><span class="annot"><span class="annottext">era :: AnyCardanoEra
</span><a href="#local-6989586621682951308"><span class="hs-identifier hs-var hs-var">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; AnyCardanoEra
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">fromApiEra</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; AnyCardanoEra) -&gt; ApiEra -&gt; AnyCardanoEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-387"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951307"><span class="annot"><span class="annottext">tx :: InAnyCardanoEra Tx
</span><a href="#local-6989586621682951307"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra -&gt; SealedTx -&gt; InAnyCardanoEra Tx
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">cardanoTxIdeallyNoLaterThan</span></a></span><span> </span><span class="annot"><span class="annottext">AnyCardanoEra
</span><a href="#local-6989586621682951308"><span class="hs-identifier hs-var">era</span></a></span><span> </span><span class="annot"><span class="annottext">(SealedTx -&gt; InAnyCardanoEra Tx) -&gt; SealedTx -&gt; InAnyCardanoEra Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; SealedTx
forall a. ApiT a -&gt; a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951313"><span class="hs-identifier hs-var">signedTx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
    -&gt; ApiSerialisedTransaction
    -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction
   -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiSerialisedTransaction
-&gt; Const (ApiT SealedTx) ApiSerialisedTransaction
</span><a href="#local-6989586621682951306"><span class="hs-var">#transaction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx -&gt; Maybe (Map Word64 TxMetadataValue)
</span><a href="#local-6989586621682951312"><span class="hs-identifier hs-var">getMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">InAnyCardanoEra Tx
</span><a href="#local-6989586621682951307"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-389"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Map Word64 TxMetadataValue)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ResourceT IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx doesn't include metadata&quot;</span></span><span>
</span><span id="line-390"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682951305"><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951305"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Map Word64 TxMetadataValue -&gt; Maybe TxMetadataValue
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue
</span><a href="#local-6989586621682951305"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>                </span><span class="annot"><span class="annottext">Maybe TxMetadataValue
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ResourceT IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx doesn't include metadata&quot;</span></span><span>
</span><span id="line-392"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.TxMetaText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hello&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ResourceT IO ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxMetadataValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ResourceT IO ()
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx metadata incorrect&quot;</span></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951304"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682951304"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682951303"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951313"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951302"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682951302"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951304"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951301"><span class="annot"><span class="annottext">expMetadata :: ApiT TxMetadata
</span><a href="#local-6989586621682951301"><span class="hs-identifier hs-var hs-var">expMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadata -&gt; ApiT TxMetadata
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; TxMetadata
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">TxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Word64, TxMetadataValue)] -&gt; Map Word64 TxMetadataValue
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text -&gt; TxMetadataValue
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">TxMetaText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hello&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>        </span><span id="local-6989586621682951300"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951300"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-400"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951325"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951302"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951300"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span>
</span><span id="line-402"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-403"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiTxMetadata
-&gt; (ApiTxMetadata -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((ApiTxMetadata -&gt; f ApiTxMetadata)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiTxMetadata
</span><a href="#local-6989586621682951299"><span class="hs-var">#metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiTxMetadata -&gt; ApiTxMetadata -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT TxMetadata -&gt; Maybe (ApiT TxMetadata)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TxMetadata
</span><a href="#local-6989586621682951301"><span class="hs-identifier hs-var">expMetadata</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-407"></span><span>        </span><span id="local-6989586621682951298"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951298"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951325"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951313"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951298"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-409"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-410"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-411"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>        </span><span class="hs-comment">-- Make sure only fee is deducted from fixtureWallet</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is as expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>            </span><span id="local-6989586621682951297"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951297"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951326"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-416"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951325"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951297"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-418"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-419"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-420"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951296"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951295"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951294"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682951327"><span class="hs-identifier hs-var">oneMillionAda</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951318"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_03a - Withdrawal from self, 0 rewards&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951293"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-425"></span><span>        </span><span id="local-6989586621682951292"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951292"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951291"><span class="annot"><span class="annottext">initialBalance :: Natural
</span><a href="#local-6989586621682951291"><span class="hs-identifier hs-var hs-var">initialBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951292"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; ApiWallet -&gt; Const Natural ApiWallet)
-&gt; Natural
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
   -&gt; ApiWallet -&gt; Const Natural ApiWallet)
(ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; ApiWallet -&gt; Const Natural ApiWallet
</span><a href="#local-6989586621682951290"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
 -&gt; ApiWallet -&gt; Const Natural ApiWallet)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; ApiWallet
-&gt; Const Natural ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural
    -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural
 -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance
</span><a href="#local-6989586621682951289"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural
  -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural
    -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; ApiWalletBalance
-&gt; Const Natural ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; Const Natural Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural
   -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; Const Natural Natural)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Const Natural (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951288"><span class="hs-var">#getQuantity</span></a></span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951287"><span class="annot"><span class="annottext">withdrawal :: Payload
</span><a href="#local-6989586621682951287"><span class="hs-identifier hs-var hs-var">withdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{ &quot;withdrawal&quot;: &quot;self&quot; }|]</span></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>        </span><span id="local-6989586621682951286"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951286"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-430"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951292"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951287"><span class="hs-identifier hs-var">withdrawal</span></a></span><span>
</span><span id="line-431"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951286"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-432"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-433"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951285"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; (Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
(Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951284"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Maybe ApiBase64 -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951283"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionWithdrawal n]
     -&gt; f [ApiCoinSelectionWithdrawal n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionWithdrawal n]
 -&gt; f [ApiCoinSelectionWithdrawal n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951282"><span class="hs-var">#withdrawals</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool)
-&gt; [ApiCoinSelectionWithdrawal n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-436"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951279"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682951279"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951278"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951277"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951286"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951276"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682951276"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951275"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951286"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span>        </span><span id="local-6989586621682951274"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951274"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951292"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951276"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951273"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682951273"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682951272"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951274"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951271"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682951271"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951273"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>        </span><span id="local-6989586621682951270"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951270"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-445"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951292"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951271"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951270"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span>
</span><span id="line-447"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-448"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n] -&gt; f [ApiWithdrawalGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682951269"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n] -&gt; [ApiWithdrawalGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-452"></span><span>        </span><span id="local-6989586621682951268"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951268"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951292"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951274"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-453"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951268"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-454"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-455"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-456"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-comment">-- Make sure wallet balance is decreased by fee, since rewards = 0</span><span>
</span><span id="line-459"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is decreased by fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>            </span><span id="local-6989586621682951267"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951267"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951293"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-461"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951292"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-462"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951267"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-463"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-464"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-465"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951266"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951265"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951264"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951291"><span class="hs-identifier hs-var">initialBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951279"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-468"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951263"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;reward&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951262"><span class="hs-var">#reward</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951261"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_03a - Withdrawal from self&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951260"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682951259"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951259"><span class="hs-identifier hs-var">wa</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mnemonic 24
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951258"><span class="annot"><span class="annottext">withdrawal :: Payload
</span><a href="#local-6989586621682951258"><span class="hs-identifier hs-var hs-var">withdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{ &quot;withdrawal&quot;: &quot;self&quot; }|]</span></span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951257"><span class="annot"><span class="annottext">withdrawalAmt :: Natural
</span><a href="#local-6989586621682951257"><span class="hs-identifier hs-var hs-var">withdrawalAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1_000_000_000_000</span></span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951256"><span class="annot"><span class="annottext">rewardInitialBalance :: Natural
</span><a href="#local-6989586621682951256"><span class="hs-identifier hs-var hs-var">rewardInitialBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">100_000_000_000</span></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>        </span><span id="local-6989586621682951255"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951255"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-479"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951259"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951258"><span class="hs-identifier hs-var">withdrawal</span></a></span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951255"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-481"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-482"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951254"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; (Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
(Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951253"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Maybe ApiBase64 -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951252"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951251"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951250"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionWithdrawal n]
     -&gt; f [ApiCoinSelectionWithdrawal n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionWithdrawal n]
 -&gt; f [ApiCoinSelectionWithdrawal n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951249"><span class="hs-var">#withdrawals</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool)
-&gt; [ApiCoinSelectionWithdrawal n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951248"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682951248"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951247"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951246"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951255"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-488"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951245"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682951245"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951244"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951255"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span>        </span><span id="local-6989586621682951243"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951243"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951259"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951245"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951242"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682951242"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682951241"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951243"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951240"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682951240"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951242"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951239"><span class="annot"><span class="annottext">withdrawalWith :: ResourceContext -&gt; [ApiWithdrawalGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951239"><span class="hs-identifier hs-var hs-var">withdrawalWith</span></a></span></span><span> </span><span id="local-6989586621682951238"><span class="annot"><span class="annottext">ResourceContext
</span><a href="#local-6989586621682951238"><span class="hs-identifier hs-var">ownership</span></a></span></span><span> </span><span id="local-6989586621682951237"><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682951237"><span class="hs-identifier hs-var">wdrls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682951237"><span class="hs-identifier hs-var">wdrls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-495"></span><span>                </span><span class="hs-special">[</span><span id="local-6989586621682951236"><span class="annot"><span class="annottext">ApiWithdrawalGeneral n
</span><a href="#local-6989586621682951236"><span class="hs-identifier hs-var">wdrl</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-496"></span><span>                    </span><span class="annot"><span class="annottext">ApiWithdrawalGeneral n
</span><a href="#local-6989586621682951236"><span class="hs-identifier hs-var">wdrl</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWithdrawalGeneral n
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; Const
          (Quantity &quot;lovelace&quot; Natural) (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWithdrawalGeneral n
    -&gt; Const (Quantity &quot;lovelace&quot; Natural) (ApiWithdrawalGeneral n))
-&gt; Quantity &quot;lovelace&quot; Natural
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;amount&quot;
  ((Quantity &quot;lovelace&quot; Natural
    -&gt; Const
         (Quantity &quot;lovelace&quot; Natural) (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWithdrawalGeneral n
   -&gt; Const (Quantity &quot;lovelace&quot; Natural) (ApiWithdrawalGeneral n))
(Quantity &quot;lovelace&quot; Natural
 -&gt; Const
      (Quantity &quot;lovelace&quot; Natural) (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWithdrawalGeneral n
-&gt; Const (Quantity &quot;lovelace&quot; Natural) (ApiWithdrawalGeneral n)
</span><a href="#local-6989586621682951235"><span class="hs-var">#amount</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951257"><span class="hs-identifier hs-var">withdrawalAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-497"></span><span>                    </span><span class="annot"><span class="annottext">ApiWithdrawalGeneral n
</span><a href="#local-6989586621682951236"><span class="hs-identifier hs-var">wdrl</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWithdrawalGeneral n
-&gt; ((ResourceContext -&gt; Const ResourceContext ResourceContext)
    -&gt; ApiWithdrawalGeneral n
    -&gt; Const ResourceContext (ApiWithdrawalGeneral n))
-&gt; ResourceContext
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;context&quot;
  ((ResourceContext -&gt; Const ResourceContext ResourceContext)
   -&gt; ApiWithdrawalGeneral n
   -&gt; Const ResourceContext (ApiWithdrawalGeneral n))
(ResourceContext -&gt; Const ResourceContext ResourceContext)
-&gt; ApiWithdrawalGeneral n
-&gt; Const ResourceContext (ApiWithdrawalGeneral n)
</span><a href="#local-6989586621682951232"><span class="hs-var">#context</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext -&gt; ResourceContext -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="#local-6989586621682951238"><span class="hs-identifier hs-var">ownership</span></a></span><span>
</span><span id="line-498"></span><span>                </span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span>        </span><span id="local-6989586621682951231"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951231"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-501"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951259"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951240"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951231"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span>
</span><span id="line-503"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-504"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n] -&gt; f [ApiWithdrawalGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682951230"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceContext -&gt; [ApiWithdrawalGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951239"><span class="hs-identifier hs-var">withdrawalWith</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Our</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-508"></span><span>        </span><span id="local-6989586621682951228"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951228"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951259"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951243"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-509"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951228"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-510"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-511"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-512"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-comment">-- Make sure wallet balance is increased by withdrawalAmt - fee</span><span>
</span><span id="line-515"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is increased by withdrawalAmt - fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-516"></span><span>            </span><span id="local-6989586621682951227"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951227"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-517"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951259"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-518"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951227"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-519"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-520"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-521"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951226"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951225"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951224"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951256"><span class="hs-identifier hs-var">rewardInitialBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951257"><span class="hs-identifier hs-var">withdrawalAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951248"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Reward balance is 0&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>            </span><span id="local-6989586621682951222"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951222"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-527"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951259"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-528"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951222"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-529"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-530"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-531"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951221"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;reward&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951220"><span class="hs-var">#reward</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951219"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>        </span><span id="local-6989586621682951218"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951218"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-536"></span><span>        </span><span id="local-6989586621682951217"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951217"><span class="hs-identifier hs-var">rDecodedTx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951260"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-537"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951218"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951240"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951217"><span class="hs-identifier hs-var">rDecodedTx'</span></a></span><span>
</span><span id="line-539"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-540"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n] -&gt; f [ApiWithdrawalGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682951216"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceContext -&gt; [ApiWithdrawalGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951239"><span class="hs-identifier hs-var">withdrawalWith</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceContext
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">External</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_03b - Withdrawal from external wallet&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951214"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; IO ()
String -&gt; IO ()
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">pendingWith</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ADP-1189: Issues with withdrawals from external wallets&quot;</span></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682951213"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951213"><span class="hs-identifier hs-var">wr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951212"><span class="annot"><span class="annottext">Mnemonic 24
</span><a href="#local-6989586621682951212"><span class="hs-identifier hs-var">mw</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-548"></span><span>        </span><span id="local-6989586621682951211"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951211"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-549"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951210"><span class="annot"><span class="annottext">withdrawal :: Payload
</span><a href="#local-6989586621682951210"><span class="hs-identifier hs-var hs-var">withdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{ &quot;withdrawal&quot;: #{mnemonicToText mw} }|]</span></span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951209"><span class="annot"><span class="annottext">withdrawalAmt :: Natural
</span><a href="#local-6989586621682951209"><span class="hs-identifier hs-var hs-var">withdrawalAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1000000000000</span></span><span>
</span><span id="line-551"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951208"><span class="annot"><span class="annottext">rewardInitialBalance :: Natural
</span><a href="#local-6989586621682951208"><span class="hs-identifier hs-var hs-var">rewardInitialBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">100_000_000_000</span></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>        </span><span id="local-6989586621682951207"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951207"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-554"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951211"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951210"><span class="hs-identifier hs-var">withdrawal</span></a></span><span>
</span><span id="line-555"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951207"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-556"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-557"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951206"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; (Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
(Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951205"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Maybe ApiBase64 -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951204"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951203"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951202"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionWithdrawal n]
     -&gt; f [ApiCoinSelectionWithdrawal n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionWithdrawal n]
 -&gt; f [ApiCoinSelectionWithdrawal n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951201"><span class="hs-var">#withdrawals</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool)
-&gt; [ApiCoinSelectionWithdrawal n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951200"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682951200"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951199"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951198"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951207"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951197"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682951197"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951196"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951207"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span>        </span><span id="local-6989586621682951195"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951195"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951211"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951197"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span>        </span><span id="local-6989586621682951194"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951194"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951211"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951195"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-568"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951194"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-569"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-570"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-571"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-comment">-- Make sure wallet balance is increased by withdrawalAmt - fee</span><span>
</span><span id="line-574"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is increased by withdrawalAmt - fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>            </span><span id="local-6989586621682951193"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951193"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-576"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951211"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-577"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951193"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-578"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-579"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-580"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951192"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951191"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951190"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951208"><span class="hs-identifier hs-var">rewardInitialBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951209"><span class="hs-identifier hs-var">withdrawalAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951200"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-583"></span><span>
</span><span id="line-584"></span><span>        </span><span class="hs-comment">-- Check that reward account is 0 on external rewardWallet,</span><span>
</span><span id="line-585"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Reward wallet balance is zero&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>            </span><span id="local-6989586621682951189"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951189"><span class="hs-identifier hs-var">rWr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951214"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-587"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951213"><span class="hs-identifier hs-var">wr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-588"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951189"><span class="hs-identifier hs-var">rWr</span></a></span><span>
</span><span id="line-589"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-590"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-591"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951188"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951187"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951186"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951208"><span class="hs-identifier hs-var">rewardInitialBalance</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04a - Single Output Transaction with decode transaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951185"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951184"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682951184"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>        </span><span id="local-6989586621682951182"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951184"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-599"></span><span>        </span><span id="local-6989586621682951181"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951181"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-600"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951180"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682951180"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>        </span><span id="local-6989586621682951179"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951179"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951181"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951180"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>        </span><span id="local-6989586621682951177"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951177"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-605"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951179"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-606"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951177"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-607"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-608"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-609"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951176"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951175"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951174"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951173"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951172"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951171"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951170"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951169"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-614"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951168"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682951168"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951167"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951166"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951177"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951165"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682951165"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951164"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951177"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-616"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951163"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682951163"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951165"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951162"><span class="annot"><span class="annottext">sharedExpectationsBetweenWallets :: [(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682951162"><span class="hs-identifier hs-var hs-var">sharedExpectationsBetweenWallets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-618"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-619"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682951161"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiDecodedTransaction n
-&gt; f (ApiDecodedTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951160"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951168"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n] -&gt; f [ApiWithdrawalGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682951159"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n] -&gt; [ApiWithdrawalGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateral&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682951158"><span class="hs-var">#collateral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiTxMetadata
-&gt; (ApiTxMetadata -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((ApiTxMetadata -&gt; f ApiTxMetadata)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiTxMetadata
</span><a href="#local-6989586621682951157"><span class="hs-var">#metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiTxMetadata -&gt; ApiTxMetadata -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiDecodedTransaction n) (Maybe (ApiT TxScriptValidity))
-&gt; (Maybe (ApiT TxScriptValidity) -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidity&quot;
  ((Maybe (ApiT TxScriptValidity)
    -&gt; f (Maybe (ApiT TxScriptValidity)))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal'
  (ApiDecodedTransaction n) (Maybe (ApiT TxScriptValidity))
</span><a href="#local-6989586621682951156"><span class="hs-var">#scriptValidity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxScriptValidity)
-&gt; Maybe (ApiT TxScriptValidity) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity))
-&gt; ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity -&gt; ApiT TxScriptValidity
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TxScriptValid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-625"></span><span>
</span><span id="line-626"></span><span>        </span><span class="hs-comment">-- After constructing tx the cbor is as expected, both wallets share common information</span><span>
</span><span id="line-627"></span><span>        </span><span class="hs-comment">-- source wallet sees inputs as his, target wallet sees them as external</span><span>
</span><span id="line-628"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951154"><span class="annot"><span class="annottext">isInpOurs :: ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682951154"><span class="hs-identifier hs-var hs-var">isInpOurs</span></a></span></span><span> </span><span id="local-6989586621682951153"><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682951153"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682951153"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-629"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ExternalInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TxIn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-630"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">WalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletInput n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-631"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951150"><span class="annot"><span class="annottext">areOurs :: [ApiTxInputGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951150"><span class="hs-identifier hs-var hs-var">areOurs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n -&gt; Bool) -&gt; [ApiTxInputGeneral n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682951154"><span class="hs-identifier hs-var">isInpOurs</span></a></span><span>
</span><span id="line-632"></span><span>        </span><span id="local-6989586621682951148"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682951148"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951181"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-633"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951147"><span class="annot"><span class="annottext">addrIx :: Int
</span><a href="#local-6989586621682951147"><span class="hs-identifier hs-var hs-var">addrIx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-634"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951146"><span class="annot"><span class="annottext">addrDest :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682951146"><span class="hs-identifier hs-var hs-var">addrDest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682951148"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682951147"><span class="hs-identifier hs-var">addrIx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682951144"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-635"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951143"><span class="annot"><span class="annottext">expectedTxOutTarget :: ApiTxOutputGeneral n
</span><a href="#local-6989586621682951143"><span class="hs-identifier hs-var hs-var">expectedTxOutTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
ApiWalletOutput n -&gt; ApiTxOutputGeneral n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletOutput n -&gt; ApiTxOutputGeneral n)
-&gt; ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput :: forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiWalletOutput n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWalletOutput</span></a></span><span>
</span><span id="line-636"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiWalletOutput :: (ApiT Address, Proxy n)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682951146"><span class="hs-identifier hs-var">addrDest</span></a></span><span>
</span><span id="line-637"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiWalletOutput :: Quantity &quot;lovelace&quot; Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951180"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-638"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletOutput :: ApiT TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span>
</span><span id="line-639"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiWalletOutput :: NonEmpty (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiT DerivationIndex] -&gt; NonEmpty (ApiT DerivationIndex)
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-640"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485500</span></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485463</span></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DerivationIndex) -&gt; Word32 -&gt; DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682951147"><span class="hs-identifier hs-var">addrIx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-646"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951133"><span class="annot"><span class="annottext">isOutOurs :: ApiTxOutputGeneral n -&gt; Bool
</span><a href="#local-6989586621682951133"><span class="hs-identifier hs-var hs-var">isOutOurs</span></a></span></span><span> </span><span id="local-6989586621682951132"><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951132"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951132"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-648"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-649"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ExternalOutput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutput n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-650"></span><span>
</span><span id="line-651"></span><span>        </span><span id="local-6989586621682951130"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951130"><span class="hs-identifier hs-var">rDecodedTxSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-652"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951163"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-653"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951130"><span class="hs-identifier hs-var">rDecodedTxSource</span></a></span><span> </span><span class="annot"><span class="annottext">([(Status, Either RequestException (ApiDecodedTransaction n))
  -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-654"></span><span>            </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682951162"><span class="hs-identifier hs-var">sharedExpectationsBetweenWallets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-655"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682951129"><span class="hs-var">#inputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; ([ApiTxInputGeneral n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; Bool
forall (n :: NetworkDiscriminant). [ApiTxInputGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951150"><span class="hs-identifier hs-var">areOurs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682951128"><span class="hs-var">#outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n] -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; [a] -&gt; [a] -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldNotContain`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951143"><span class="hs-identifier hs-var">expectedTxOutTarget</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>            </span><span class="hs-comment">-- Check that the change output is there:</span><span>
</span><span id="line-659"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682951127"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ())
-&gt; ([ApiTxOutputGeneral n] -&gt; Int)
-&gt; [ApiTxOutputGeneral n]
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiTxOutputGeneral n] -&gt; Int)
-&gt; ([ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n])
-&gt; [ApiTxOutputGeneral n]
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxOutputGeneral n -&gt; Bool)
-&gt; [ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxOutputGeneral n -&gt; Bool
</span><a href="#local-6989586621682951133"><span class="hs-identifier hs-var">isOutOurs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span>        </span><span id="local-6989586621682951125"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951125"><span class="hs-identifier hs-var">rDecodedTxTarget</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-663"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951181"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951163"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-664"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951125"><span class="hs-identifier hs-var">rDecodedTxTarget</span></a></span><span> </span><span class="annot"><span class="annottext">([(Status, Either RequestException (ApiDecodedTransaction n))
  -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-665"></span><span>            </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682951162"><span class="hs-identifier hs-var">sharedExpectationsBetweenWallets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-666"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682951124"><span class="hs-var">#inputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; ([ApiTxInputGeneral n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; Bool
forall (n :: NetworkDiscriminant). [ApiTxInputGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951150"><span class="hs-identifier hs-var">areOurs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682951123"><span class="hs-var">#outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n] -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; [a] -&gt; [a] -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldContain`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951143"><span class="hs-identifier hs-var">expectedTxOutTarget</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951122"><span class="annot"><span class="annottext">filterInitialAmt :: [ApiWalletInput n] -&gt; [ApiWalletInput n]
</span><a href="#local-6989586621682951122"><span class="hs-identifier hs-var hs-var">filterInitialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-671"></span><span>                </span><span class="annot"><span class="annottext">(ApiWalletInput n -&gt; Bool)
-&gt; [ApiWalletInput n] -&gt; [ApiWalletInput n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletInput n -&gt; Bool)
 -&gt; [ApiWalletInput n] -&gt; [ApiWalletInput n])
-&gt; (ApiWalletInput n -&gt; Bool)
-&gt; [ApiWalletInput n]
-&gt; [ApiWalletInput n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951120"><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682951120"><span class="hs-identifier hs-var">amt'</span></a></span></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-672"></span><span>                    </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682951120"><span class="hs-identifier hs-var">amt'</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951184"><span class="hs-identifier hs-var">initialAmt</span></a></span><span>
</span><span id="line-673"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951119"><span class="annot"><span class="annottext">coinSelInputs :: [ApiWalletInput n]
</span><a href="#local-6989586621682951119"><span class="hs-identifier hs-var hs-var">coinSelInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; [ApiWalletInput n]
</span><a href="#local-6989586621682951122"><span class="hs-identifier hs-var">filterInitialAmt</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiWalletInput n] -&gt; [ApiWalletInput n])
-&gt; [ApiWalletInput n] -&gt; [ApiWalletInput n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-674"></span><span>                </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; [ApiWalletInput n]
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951118"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951117"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951177"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-675"></span><span>        </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n]
</span><a href="#local-6989586621682951119"><span class="hs-identifier hs-var">coinSelInputs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951116"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682951116"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951115"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951177"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-678"></span><span>
</span><span id="line-679"></span><span>        </span><span id="local-6989586621682951114"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951114"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951116"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>        </span><span id="local-6989586621682951113"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951113"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951114"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951113"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-683"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-684"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-685"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Target wallet balance is decreased by amt + fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>            </span><span id="local-6989586621682951112"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951112"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-689"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951181"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-690"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951112"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-691"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-692"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-693"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951111"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951110"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951109"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-694"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951180"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Source wallet balance is decreased by (amt + expectedFee)&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-698"></span><span>            </span><span id="local-6989586621682951108"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951108"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-699"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-700"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951108"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-701"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-702"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-703"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951107"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951106"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951105"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-704"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951184"><span class="hs-identifier hs-var">initialAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951180"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951168"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-comment">-- After signing tx the cbor is as before modulo added wtinesses,</span><span>
</span><span id="line-708"></span><span>        </span><span class="hs-comment">-- and in line what was there after construction. Also as we tx was</span><span>
</span><span id="line-709"></span><span>        </span><span class="hs-comment">-- accommodated in ledger output change in amount for target wallet</span><span>
</span><span id="line-710"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951104"><span class="annot"><span class="annottext">expectedTxOutTarget' :: ApiTxOutputGeneral n
</span><a href="#local-6989586621682951104"><span class="hs-identifier hs-var hs-var">expectedTxOutTarget'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
ApiWalletOutput n -&gt; ApiTxOutputGeneral n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletOutput n -&gt; ApiTxOutputGeneral n)
-&gt; ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput :: forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiWalletOutput n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWalletOutput</span></a></span><span>
</span><span id="line-711"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiWalletOutput :: (ApiT Address, Proxy n)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682951146"><span class="hs-identifier hs-var">addrDest</span></a></span><span>
</span><span id="line-712"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiWalletOutput :: Quantity &quot;lovelace&quot; Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951180"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-713"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletOutput :: ApiT TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span>
</span><span id="line-714"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiWalletOutput :: NonEmpty (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiT DerivationIndex] -&gt; NonEmpty (ApiT DerivationIndex)
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-715"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485500</span></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485463</span></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DerivationIndex) -&gt; Word32 -&gt; DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682951147"><span class="hs-identifier hs-var">addrIx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-721"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-722"></span><span>        </span><span id="local-6989586621682951103"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682951103"><span class="hs-identifier hs-var">addrsSourceAll</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-723"></span><span>        </span><span class="hs-comment">--we expect change address here with x=0 as this wallet does not participated in outcoming tx before this one</span><span>
</span><span id="line-724"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951102"><span class="annot"><span class="annottext">derPath :: NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682951102"><span class="hs-identifier hs-var hs-var">derPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiT DerivationIndex] -&gt; NonEmpty (ApiT DerivationIndex)
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-725"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485500</span></span><span class="hs-special">)</span><span>
</span><span id="line-726"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485463</span></span><span class="hs-special">)</span><span>
</span><span id="line-727"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-731"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951101"><span class="annot"><span class="annottext">ApiAddress n
</span><a href="#local-6989586621682951101"><span class="hs-identifier hs-var">addrSourceChange</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ApiAddress n]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-732"></span><span>                </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; Bool) -&gt; [ApiAddress n] -&gt; [ApiAddress n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiT AddressState
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621682951099"><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682951099"><span class="hs-identifier hs-var">derPath'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682951102"><span class="hs-identifier hs-var">derPath</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682951099"><span class="hs-identifier hs-var">derPath'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682951103"><span class="hs-identifier hs-var">addrsSourceAll</span></a></span><span>
</span><span id="line-733"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951098"><span class="annot"><span class="annottext">addrSrc :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682951098"><span class="hs-identifier hs-var hs-var">addrSrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">ApiAddress n
</span><a href="#local-6989586621682951101"><span class="hs-identifier hs-var">addrSourceChange</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682951097"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951096"><span class="annot"><span class="annottext">expectedTxOutSource :: ApiTxOutputGeneral n
</span><a href="#local-6989586621682951096"><span class="hs-identifier hs-var hs-var">expectedTxOutSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
ApiWalletOutput n -&gt; ApiTxOutputGeneral n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletOutput n -&gt; ApiTxOutputGeneral n)
-&gt; ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput :: forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiWalletOutput n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWalletOutput</span></a></span><span>
</span><span id="line-735"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiWalletOutput :: (ApiT Address, Proxy n)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682951098"><span class="hs-identifier hs-var">addrSrc</span></a></span><span>
</span><span id="line-736"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiWalletOutput :: Quantity &quot;lovelace&quot; Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951184"><span class="hs-identifier hs-var">initialAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951180"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951168"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletOutput :: ApiT TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span>
</span><span id="line-738"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiWalletOutput :: NonEmpty (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682951102"><span class="hs-identifier hs-var">derPath</span></a></span><span>
</span><span id="line-739"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-740"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951095"><span class="annot"><span class="annottext">txCbor' :: ApiT SealedTx
</span><a href="#local-6989586621682951095"><span class="hs-identifier hs-var hs-var">txCbor'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682951094"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951114"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951093"><span class="annot"><span class="annottext">decodePayload' :: Payload
</span><a href="#local-6989586621682951093"><span class="hs-identifier hs-var hs-var">decodePayload'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951095"><span class="hs-identifier hs-var">txCbor'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>        </span><span id="local-6989586621682951092"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951092"><span class="hs-identifier hs-var">rDecodedTxSource'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-743"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951182"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951093"><span class="hs-identifier hs-var">decodePayload'</span></a></span><span>
</span><span id="line-744"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951092"><span class="hs-identifier hs-var">rDecodedTxSource'</span></a></span><span> </span><span class="annot"><span class="annottext">([(Status, Either RequestException (ApiDecodedTransaction n))
  -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-745"></span><span>            </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682951162"><span class="hs-identifier hs-var">sharedExpectationsBetweenWallets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-746"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682951091"><span class="hs-var">#inputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; ([ApiTxInputGeneral n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; Bool
forall (n :: NetworkDiscriminant). [ApiTxInputGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951150"><span class="hs-identifier hs-var">areOurs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- the input is not anymore belonging to wallet</span><span>
</span><span id="line-747"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682951090"><span class="hs-var">#outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n] -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; [a] -&gt; [a] -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldNotContain`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951104"><span class="hs-identifier hs-var">expectedTxOutTarget'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682951089"><span class="hs-var">#outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n] -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; [a] -&gt; [a] -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldContain`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951096"><span class="hs-identifier hs-var">expectedTxOutSource</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span>        </span><span id="local-6989586621682951088"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951088"><span class="hs-identifier hs-var">rDecodedTxTarget'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951185"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-752"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951181"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951093"><span class="hs-identifier hs-var">decodePayload'</span></a></span><span>
</span><span id="line-753"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951088"><span class="hs-identifier hs-var">rDecodedTxTarget'</span></a></span><span> </span><span class="annot"><span class="annottext">([(Status, Either RequestException (ApiDecodedTransaction n))
  -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-754"></span><span>            </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682951162"><span class="hs-identifier hs-var">sharedExpectationsBetweenWallets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-755"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682951087"><span class="hs-var">#inputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; ([ApiTxInputGeneral n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; Bool
forall (n :: NetworkDiscriminant). [ApiTxInputGeneral n] -&gt; Bool
</span><a href="#local-6989586621682951150"><span class="hs-identifier hs-var">areOurs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682951086"><span class="hs-var">#outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n] -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; [a] -&gt; [a] -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldContain`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951104"><span class="hs-identifier hs-var">expectedTxOutTarget'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682951085"><span class="hs-var">#outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n] -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; [a] -&gt; [a] -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldNotContain`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682951096"><span class="hs-identifier hs-var">expectedTxOutSource</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04ab - Constructed inputs = Decoded inputs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951084"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951084"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>        </span><span id="local-6989586621682951083"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951083"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-762"></span><span>        </span><span id="local-6989586621682951082"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951082"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-763"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951081"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682951081"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951084"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>        </span><span id="local-6989586621682951080"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951080"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951084"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951082"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951081"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span>        </span><span id="local-6989586621682951079"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951079"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-767"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951083"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951080"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-768"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951079"><span class="hs-identifier hs-var">rTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951078"><span class="annot"><span class="annottext">expectedInputs :: [ApiWalletInput n]
</span><a href="#local-6989586621682951078"><span class="hs-identifier hs-var hs-var">expectedInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; [ApiWalletInput n]
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951077"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951076"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951079"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-771"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951075"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682951075"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951074"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951079"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-772"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951073"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682951073"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951075"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span>        </span><span id="local-6989586621682951072"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951072"><span class="hs-identifier hs-var">rDecodedTxSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-775"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951083"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951073"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-776"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951071"><span class="annot"><span class="annottext">decodedInputs :: [ApiTxInputGeneral n]
</span><a href="#local-6989586621682951071"><span class="hs-identifier hs-var hs-var">decodedInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [ApiTxInputGeneral n]
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Lens' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682951070"><span class="hs-var">#inputs</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682951072"><span class="hs-identifier hs-var">rDecodedTxSource</span></a></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>        </span><span class="annot"><span class="annottext">ApiWalletInput n -&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant).
ApiWalletInput n -&gt; ApiTxInputGeneral n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletInput n -&gt; ApiTxInputGeneral n)
-&gt; [ApiWalletInput n] -&gt; [ApiTxInputGeneral n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n]
</span><a href="#local-6989586621682951078"><span class="hs-identifier hs-var">expectedInputs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n] -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n]
</span><a href="#local-6989586621682951071"><span class="hs-identifier hs-var">decodedInputs</span></a></span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04b - Cannot spend less than minUTxOValue&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951068"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951068"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-781"></span><span>        </span><span id="local-6989586621682951067"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951067"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951068"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-782"></span><span>        </span><span id="local-6989586621682951066"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951066"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951068"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-783"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951065"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682951065"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951068"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span>        </span><span id="local-6989586621682951064"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951064"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951068"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951066"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951065"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>        </span><span id="local-6989586621682951063"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951063"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951068"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-788"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951067"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951064"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-789"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951063"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-790"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-791"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MinUTxOValue"><span class="hs-identifier hs-var">errMsg403MinUTxOValue</span></a></span><span>
</span><span id="line-792"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04c - Can't cover fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951062"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951062"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-795"></span><span>        </span><span id="local-6989586621682951061"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951061"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951062"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951062"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-796"></span><span>        </span><span id="local-6989586621682951060"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951060"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951062"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-797"></span><span>
</span><span id="line-798"></span><span>        </span><span id="local-6989586621682951059"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951059"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951062"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951060"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951062"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span>        </span><span id="local-6989586621682951058"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951058"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951062"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-801"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951061"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951059"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-802"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951058"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-803"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-804"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403Fee"><span class="hs-identifier hs-var">errMsg403Fee</span></a></span><span>
</span><span id="line-805"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04d - Not enough money&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951057"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951057"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951056"><span class="annot"><span class="annottext">minUTxOValue' :: Natural
</span><a href="#local-6989586621682951056"><span class="hs-identifier hs-var hs-var">minUTxOValue'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951057"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682951055"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951055"><span class="hs-identifier hs-var">srcAmt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682951054"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951054"><span class="hs-identifier hs-var">reqAmt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951056"><span class="hs-identifier hs-var">minUTxOValue'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951056"><span class="hs-identifier hs-var">minUTxOValue'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>        </span><span id="local-6989586621682951053"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951053"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951057"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951055"><span class="hs-identifier hs-var">srcAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-811"></span><span>        </span><span id="local-6989586621682951052"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951052"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951057"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-812"></span><span>
</span><span id="line-813"></span><span>        </span><span id="local-6989586621682951051"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951051"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951057"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951052"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951054"><span class="hs-identifier hs-var">reqAmt</span></a></span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span>        </span><span id="local-6989586621682951050"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951050"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951057"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-816"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951053"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951051"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-817"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951050"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-818"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-819"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403NotEnoughMoney"><span class="hs-identifier hs-var">errMsg403NotEnoughMoney</span></a></span><span>
</span><span id="line-820"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04d - Not enough money emptyWallet&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951049"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951049"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-823"></span><span>        </span><span id="local-6989586621682951048"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951048"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951049"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-824"></span><span>        </span><span id="local-6989586621682951047"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951047"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951049"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span>        </span><span id="local-6989586621682951046"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951046"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951049"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951047"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951049"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span>        </span><span id="local-6989586621682951045"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951045"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951049"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-829"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951048"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951046"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-830"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951045"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-831"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-832"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403NotEnoughMoney"><span class="hs-identifier hs-var">errMsg403NotEnoughMoney</span></a></span><span>
</span><span id="line-833"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04e- Multiple Output Tx to single wallet&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951044"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-836"></span><span>        </span><span id="local-6989586621682951043"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951043"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-837"></span><span>        </span><span id="local-6989586621682951042"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951042"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-838"></span><span>        </span><span id="local-6989586621682951041"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682951041"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951042"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-839"></span><span>        </span><span id="local-6989586621682951040"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951040"><span class="hs-identifier hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiWallet Natural
-&gt; (Status, Either RequestException ApiWallet) -&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951039"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951038"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951037"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet) -&gt; Natural)
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
-&gt; ResourceT IO Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-840"></span><span>                          </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951043"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951036"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682951036"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-843"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951035"><span class="annot"><span class="annottext">destination1 :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682951035"><span class="hs-identifier hs-var hs-var">destination1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682951041"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682951034"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-844"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951033"><span class="annot"><span class="annottext">destination2 :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682951033"><span class="hs-identifier hs-var hs-var">destination2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682951041"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682951032"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-845"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951031"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682951031"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination1},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                },
                {
                    &quot;address&quot;: #{destination2},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span>        </span><span id="local-6989586621682951028"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951028"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-863"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951043"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682951031"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-864"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951028"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-865"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-866"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-867"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951027"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951026"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951025"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951024"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951023"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682951022"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951021"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951020"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951019"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682951019"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682951018"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951017"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951028"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-874"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951016"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682951016"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682951015"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682951028"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span>        </span><span id="local-6989586621682951014"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951014"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951043"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682951016"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span>        </span><span id="local-6989586621682951013"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951013"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951043"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682951014"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-879"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682951013"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-880"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-881"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-882"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Target wallet balance is increased by 2*amt&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-885"></span><span>            </span><span id="local-6989586621682951012"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951012"><span class="hs-identifier hs-var">rWb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-886"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951042"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-887"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951012"><span class="hs-identifier hs-var">rWb</span></a></span><span>
</span><span id="line-888"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-889"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-890"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951011"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951010"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951009"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951036"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-892"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-893"></span><span>
</span><span id="line-894"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Source wallet balance is decreased by (2*amt + expectedFee)&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-895"></span><span>            </span><span id="local-6989586621682951008"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951008"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951044"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-896"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951043"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-897"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682951008"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-898"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-899"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-900"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682951007"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682951006"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682951005"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951040"><span class="hs-identifier hs-var">initialAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951036"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951019"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-902"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_04a - Single Output Transaction with submitWithWid&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682951004"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951003"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682951003"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span>        </span><span id="local-6989586621682951002"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951002"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951003"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-908"></span><span>        </span><span id="local-6989586621682951001"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951001"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-909"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682951000"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682951000"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>        </span><span id="local-6989586621682950999"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950999"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951001"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951000"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span>        </span><span id="local-6989586621682950998"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950998"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-914"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951002"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950999"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-915"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950998"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-916"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-917"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-918"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950997"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950996"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950995"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950994"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-920"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950993"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950992"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950991"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682950991"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950990"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950989"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950998"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950988"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950988"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950987"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950998"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span>        </span><span id="local-6989586621682950986"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950986"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951002"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950988"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-927"></span><span>
</span><span id="line-928"></span><span>        </span><span id="local-6989586621682950985"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950985"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951002"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950986"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-929"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950985"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-930"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-931"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-932"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-933"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950984"><span class="annot"><span class="annottext">txid :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950984"><span class="hs-identifier hs-var hs-var">txid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
(ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;))) -&gt; ApiTxId -&gt; f ApiTxId
</span><a href="#local-6989586621682950983"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950985"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950982"><span class="annot"><span class="annottext">queryTx :: (Method, Text)
</span><a href="#local-6989586621682950982"><span class="hs-identifier hs-var hs-var">queryTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951002"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950984"><span class="hs-identifier hs-var">txid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-936"></span><span>        </span><span id="local-6989586621682950979"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950979"><span class="hs-identifier hs-var">rGetTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950982"><span class="hs-identifier hs-var">queryTx</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-937"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950979"><span class="hs-identifier hs-var">rGetTx</span></a></span><span>
</span><span id="line-938"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-939"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950977"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950976"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-940"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Source wallet balance is decreased by amt + fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-943"></span><span>            </span><span id="local-6989586621682950974"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950974"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-944"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951002"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-945"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950974"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-946"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-947"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-948"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950973"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950972"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950971"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-949"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951003"><span class="hs-identifier hs-var">initialAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951000"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950991"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;transaction is eventually in ledger after submitting&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-953"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950970"><span class="annot"><span class="annottext">queryTx' :: (Method, Text)
</span><a href="#local-6989586621682950970"><span class="hs-identifier hs-var hs-var">queryTx'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951002"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950984"><span class="hs-identifier hs-var">txid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>            </span><span id="local-6989586621682950969"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950969"><span class="hs-identifier hs-var">rSrc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950970"><span class="hs-identifier hs-var">queryTx'</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-955"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950969"><span class="hs-identifier hs-var">rSrc</span></a></span><span>
</span><span id="line-956"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-957"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950968"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950967"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Target wallet balance is amt&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-961"></span><span>            </span><span id="local-6989586621682950965"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950965"><span class="hs-identifier hs-var">rWr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682951004"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-962"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682951001"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-963"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950965"><span class="hs-identifier hs-var">rWr</span></a></span><span>
</span><span id="line-964"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-965"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-966"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950964"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950963"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950962"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-967"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682951000"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_ASSETS_CREATE_01a - Multi-asset tx with Ada&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950961"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-971"></span><span>        </span><span id="local-6989586621682950960"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950960"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureMultiAssetWallet"><span class="hs-identifier hs-var">fixtureMultiAssetWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-972"></span><span>        </span><span id="local-6989586621682950959"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950959"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-973"></span><span>        </span><span id="local-6989586621682950958"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950958"><span class="hs-identifier hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiWallet Natural
-&gt; (Status, Either RequestException ApiWallet) -&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950957"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950956"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950955"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet) -&gt; Natural)
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
-&gt; ResourceT IO Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-974"></span><span>                          </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950960"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-975"></span><span>
</span><span id="line-976"></span><span>        </span><span class="hs-comment">-- pick out an asset to send</span><span>
</span><span id="line-977"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950954"><span class="annot"><span class="annottext">assetsSrc :: TokenMap
</span><a href="#local-6989586621682950954"><span class="hs-identifier hs-var hs-var">assetsSrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950960"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
(ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; Const TokenMap ApiWallet
</span><a href="#local-6989586621682950953"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWallet
-&gt; Const TokenMap ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance
</span><a href="#local-6989586621682950952"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; Const TokenMap ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap)
</span><a href="#local-6989586621682950951"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-978"></span><span>        </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950954"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-979"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950950"><span class="annot"><span class="annottext">val :: ((Text, Text), Natural)
</span><a href="#local-6989586621682950950"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ((Text, Text), Natural) -&gt; ((Text, Text), Natural)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ((Text, Text), Natural)
</span><a href="Test.Integration.Framework.DSL.html#pickAnAsset"><span class="hs-identifier hs-var">pickAnAsset</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950954"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span>        </span><span class="hs-comment">-- create payload</span><span>
</span><span id="line-982"></span><span>        </span><span id="local-6989586621682950948"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950948"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950959"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-983"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950947"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950947"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950948"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950946"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-984"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950945"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682950945"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-985"></span><span>        </span><span id="local-6989586621682950944"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950944"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; ResourceT IO Payload
forall (l :: NetworkDiscriminant) (m :: * -&gt; *).
(DecodeAddress l, DecodeStakeAddress l, EncodeAddress l,
 MonadUnliftIO m) =&gt;
(ApiT Address, Proxy l)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; m Payload
</span><a href="#local-6989586621682950943"><span class="hs-identifier hs-var">mkTxPayloadMA</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682950947"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950945"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((Text, Text), Natural)
</span><a href="#local-6989586621682950950"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span>        </span><span class="hs-comment">--construct transaction</span><span>
</span><span id="line-988"></span><span>        </span><span id="local-6989586621682950942"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950942"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-989"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950960"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950944"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-990"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950942"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-991"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-992"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-993"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950941"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950940"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950939"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950938"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950937"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950936"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950935"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950934"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-998"></span><span>
</span><span id="line-999"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950933"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682950933"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950932"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950931"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950942"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1000"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950930"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950930"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950929"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950942"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1001"></span><span>
</span><span id="line-1002"></span><span>        </span><span id="local-6989586621682950928"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950928"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950960"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950930"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span>        </span><span id="local-6989586621682950927"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950927"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950960"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950928"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1005"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950927"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1006"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1007"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1008"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Target wallet balance is increased by amt and assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1011"></span><span>            </span><span id="local-6989586621682950926"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950926"><span class="hs-identifier hs-var">rWb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1012"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950959"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1013"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950926"><span class="hs-identifier hs-var">rWb</span></a></span><span>
</span><span id="line-1014"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1015"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-1016"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950925"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950924"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950923"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1017"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950945"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1018"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950922"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682950921"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682950920"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1019"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950919"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682950918"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682950917"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1020"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Source wallet balance is decreased by (amt + expectedFee)&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1023"></span><span>            </span><span id="local-6989586621682950916"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950916"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950961"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1024"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950960"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1025"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950916"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-1026"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1027"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-1028"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950915"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950914"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950913"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1029"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950958"><span class="hs-identifier hs-var">initialAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950945"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950933"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_ASSETS_CREATE_01b - Multi-asset tx with not enough Ada&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950912"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1033"></span><span>        </span><span id="local-6989586621682950911"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950911"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureMultiAssetWallet"><span class="hs-identifier hs-var">fixtureMultiAssetWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1034"></span><span>        </span><span id="local-6989586621682950910"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950910"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1035"></span><span>        </span><span id="local-6989586621682950909"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950909"><span class="hs-identifier hs-var">ra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950911"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1036"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682950908"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950908"><span class="hs-identifier hs-var">wal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950909"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-1037"></span><span>
</span><span id="line-1038"></span><span>        </span><span class="hs-comment">-- pick out an asset to send</span><span>
</span><span id="line-1039"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950907"><span class="annot"><span class="annottext">assetsSrc :: TokenMap
</span><a href="#local-6989586621682950907"><span class="hs-identifier hs-var hs-var">assetsSrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950908"><span class="hs-identifier hs-var">wal</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
(ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; Const TokenMap ApiWallet
</span><a href="#local-6989586621682950906"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWallet
-&gt; Const TokenMap ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance
</span><a href="#local-6989586621682950905"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; Const TokenMap ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap)
</span><a href="#local-6989586621682950904"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1040"></span><span>        </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950907"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1041"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950903"><span class="annot"><span class="annottext">val :: ((Text, Text), Natural)
</span><a href="#local-6989586621682950903"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ((Text, Text), Natural) -&gt; ((Text, Text), Natural)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ((Text, Text), Natural)
</span><a href="Test.Integration.Framework.DSL.html#pickAnAsset"><span class="hs-identifier hs-var">pickAnAsset</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950907"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>        </span><span class="hs-comment">-- create payload</span><span>
</span><span id="line-1044"></span><span>        </span><span id="local-6989586621682950902"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950902"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950910"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-1045"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950901"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950901"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950902"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950900"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-1046"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950899"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682950899"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>        </span><span id="local-6989586621682950898"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950898"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; ResourceT IO Payload
forall (l :: NetworkDiscriminant) (m :: * -&gt; *).
(DecodeAddress l, DecodeStakeAddress l, EncodeAddress l,
 MonadUnliftIO m) =&gt;
(ApiT Address, Proxy l)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; m Payload
</span><a href="#local-6989586621682950943"><span class="hs-identifier hs-var">mkTxPayloadMA</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682950901"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950899"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((Text, Text), Natural)
</span><a href="#local-6989586621682950903"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>        </span><span class="hs-comment">--construct transaction</span><span>
</span><span id="line-1050"></span><span>        </span><span id="local-6989586621682950897"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950897"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950912"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1051"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950911"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950898"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1052"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950897"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1053"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-1054"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MinUTxOValue"><span class="hs-identifier hs-var">errMsg403MinUTxOValue</span></a></span><span>
</span><span id="line-1055"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1056"></span><span>
</span><span id="line-1057"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_ASSETS_CREATE_01c - Multi-asset tx without Ada&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950896"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1058"></span><span>        </span><span id="local-6989586621682950895"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureMultiAssetWallet"><span class="hs-identifier hs-var">fixtureMultiAssetWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1059"></span><span>        </span><span id="local-6989586621682950894"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950894"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1060"></span><span>        </span><span id="local-6989586621682950893"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950893"><span class="hs-identifier hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiWallet Natural
-&gt; (Status, Either RequestException ApiWallet) -&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950892"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950891"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950890"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet) -&gt; Natural)
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
-&gt; ResourceT IO Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-1061"></span><span>                          </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span>        </span><span class="hs-comment">-- pick out an asset to send</span><span>
</span><span id="line-1064"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950889"><span class="annot"><span class="annottext">assetsSrc :: TokenMap
</span><a href="#local-6989586621682950889"><span class="hs-identifier hs-var hs-var">assetsSrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
(ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; Const TokenMap ApiWallet
</span><a href="#local-6989586621682950888"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWallet
-&gt; Const TokenMap ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance
</span><a href="#local-6989586621682950887"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; Const TokenMap ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap)
</span><a href="#local-6989586621682950886"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1065"></span><span>        </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950889"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1066"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950885"><span class="annot"><span class="annottext">val :: ((Text, Text), Natural)
</span><a href="#local-6989586621682950885"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ((Text, Text), Natural) -&gt; ((Text, Text), Natural)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ((Text, Text), Natural)
</span><a href="Test.Integration.Framework.DSL.html#pickAnAsset"><span class="hs-identifier hs-var">pickAnAsset</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950889"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span>
</span><span id="line-1067"></span><span>
</span><span id="line-1068"></span><span>        </span><span class="hs-comment">-- create payload</span><span>
</span><span id="line-1069"></span><span>        </span><span id="local-6989586621682950884"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950884"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950894"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-1070"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950883"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950883"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950884"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950882"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-1071"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950881"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682950881"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1072"></span><span>        </span><span id="local-6989586621682950880"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950880"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; ResourceT IO Payload
forall (l :: NetworkDiscriminant) (m :: * -&gt; *).
(DecodeAddress l, DecodeStakeAddress l, EncodeAddress l,
 MonadUnliftIO m) =&gt;
(ApiT Address, Proxy l)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; m Payload
</span><a href="#local-6989586621682950943"><span class="hs-identifier hs-var">mkTxPayloadMA</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682950883"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950881"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((Text, Text), Natural)
</span><a href="#local-6989586621682950885"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1073"></span><span>
</span><span id="line-1074"></span><span>        </span><span class="hs-comment">--construct transaction</span><span>
</span><span id="line-1075"></span><span>        </span><span id="local-6989586621682950879"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950879"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1076"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950880"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1077"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950879"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1078"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1079"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1080"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950878"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950877"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1081"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950876"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950875"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1082"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950874"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950873"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1083"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950872"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950871"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1084"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1085"></span><span>
</span><span id="line-1086"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950870"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682950870"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950869"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950868"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950879"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1087"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950867"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950867"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950866"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950879"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1088"></span><span>
</span><span id="line-1089"></span><span>        </span><span id="local-6989586621682950865"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950865"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950867"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span>        </span><span id="local-6989586621682950864"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950864"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950865"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1092"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950864"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1093"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1094"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1095"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1096"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950863"><span class="annot"><span class="annottext">txId :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950863"><span class="hs-identifier hs-var hs-var">txId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
(ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;))) -&gt; ApiTxId -&gt; f ApiTxId
</span><a href="#local-6989586621682950862"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950864"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span>        </span><span id="local-6989586621682950861"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950861"><span class="hs-identifier hs-var">outTxAmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Natural -&gt; ResourceT IO Natural
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Transactions is in ledger&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO Natural -&gt; ResourceT IO Natural)
-&gt; IO Natural -&gt; ResourceT IO Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1099"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950860"><span class="annot"><span class="annottext">linkSrc :: (Method, Text)
</span><a href="#local-6989586621682950860"><span class="hs-identifier hs-var hs-var">linkSrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiT (Hash &quot;Tx&quot;) -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950863"><span class="hs-identifier hs-var">txId</span></a></span><span>
</span><span id="line-1100"></span><span>            </span><span id="local-6989586621682950859"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950859"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950860"><span class="hs-identifier hs-var">linkSrc</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1101"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950859"><span class="hs-identifier hs-var">r1</span></a></span><span>
</span><span id="line-1102"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-1103"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950858"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950857"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1104"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950856"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950855"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1105"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1106"></span><span>            </span><span class="annot"><span class="annottext">Natural -&gt; IO Natural
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; IO Natural) -&gt; Natural -&gt; IO Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (ApiTransaction n) Natural
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;amount&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950854"><span class="hs-var">#amount</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950853"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950859"><span class="hs-identifier hs-var">r1</span></a></span><span>
</span><span id="line-1107"></span><span>
</span><span id="line-1108"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950852"><span class="annot"><span class="annottext">inTxAmt :: Natural
</span><a href="#local-6989586621682950852"><span class="hs-identifier hs-var hs-var">inTxAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950861"><span class="hs-identifier hs-var">outTxAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950870"><span class="hs-identifier hs-var">expectedFee</span></a></span><span>
</span><span id="line-1109"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Target wallet balance is increased by inTxAmt and assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1110"></span><span>            </span><span id="local-6989586621682950851"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950851"><span class="hs-identifier hs-var">rWb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1111"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950894"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1112"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950851"><span class="hs-identifier hs-var">rWb</span></a></span><span>
</span><span id="line-1113"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1114"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-1115"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950850"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950849"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950848"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1116"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950852"><span class="hs-identifier hs-var">inTxAmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950847"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682950846"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682950845"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950844"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682950843"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682950842"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1119"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Source wallet balance is decreased by outTxAmt&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1122"></span><span>            </span><span id="local-6989586621682950841"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950841"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950896"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1123"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950895"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1124"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950841"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-1125"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1126"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-1127"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950840"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950839"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950838"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950893"><span class="hs-identifier hs-var">initialAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950861"><span class="hs-identifier hs-var">outTxAmt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1130"></span><span>
</span><span id="line-1131"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_ASSETS_CREATE_01d - Multi-asset tx with not enough assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950837"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950837"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1132"></span><span>        </span><span id="local-6989586621682950836"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950836"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureMultiAssetWallet"><span class="hs-identifier hs-var">fixtureMultiAssetWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950837"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1133"></span><span>        </span><span id="local-6989586621682950835"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950835"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950837"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1134"></span><span>        </span><span id="local-6989586621682950834"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950834"><span class="hs-identifier hs-var">ra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950837"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950836"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1135"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682950833"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950833"><span class="hs-identifier hs-var">wal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950834"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950832"><span class="annot"><span class="annottext">minUTxOValue' :: Natural
</span><a href="#local-6989586621682950832"><span class="hs-identifier hs-var hs-var">minUTxOValue'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950837"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span>        </span><span class="hs-comment">-- pick out an asset to send</span><span>
</span><span id="line-1140"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950831"><span class="annot"><span class="annottext">assetsSrc :: TokenMap
</span><a href="#local-6989586621682950831"><span class="hs-identifier hs-var hs-var">assetsSrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950833"><span class="hs-identifier hs-var">wal</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; TokenMap
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
(ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; Const TokenMap ApiWallet
</span><a href="#local-6989586621682950830"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; Const TokenMap ApiWallet)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWallet
-&gt; Const TokenMap ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance
</span><a href="#local-6989586621682950829"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; Const TokenMap ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; Const TokenMap TokenMap)
    -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
-&gt; (TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; Const TokenMap ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; Const TokenMap TokenMap)
   -&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap))
(TokenMap -&gt; Const TokenMap TokenMap)
-&gt; ApiT TokenMap -&gt; Const TokenMap (ApiT TokenMap)
</span><a href="#local-6989586621682950828"><span class="hs-var">#getApiT</span></a></span><span>
</span><span id="line-1141"></span><span>        </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950831"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-1142"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950827"><span class="annot"><span class="annottext">val :: ((Text, Text), Natural)
</span><a href="#local-6989586621682950827"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950832"><span class="hs-identifier hs-var">minUTxOValue'</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950832"><span class="hs-identifier hs-var">minUTxOValue'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ((Text, Text), Natural) -&gt; ((Text, Text), Natural)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ((Text, Text), Natural)
</span><a href="Test.Integration.Framework.DSL.html#pickAnAsset"><span class="hs-identifier hs-var">pickAnAsset</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682950831"><span class="hs-identifier hs-var">assetsSrc</span></a></span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span>        </span><span class="hs-comment">-- create payload</span><span>
</span><span id="line-1145"></span><span>        </span><span id="local-6989586621682950826"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950826"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950837"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950835"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-1146"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950825"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950825"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950826"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950824"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-1147"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950823"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682950823"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1148"></span><span>        </span><span id="local-6989586621682950822"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950822"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; ResourceT IO Payload
forall (l :: NetworkDiscriminant) (m :: * -&gt; *).
(DecodeAddress l, DecodeStakeAddress l, EncodeAddress l,
 MonadUnliftIO m) =&gt;
(ApiT Address, Proxy l)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; m Payload
</span><a href="#local-6989586621682950943"><span class="hs-identifier hs-var">mkTxPayloadMA</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682950825"><span class="hs-identifier hs-var">destination</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950823"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((Text, Text), Natural)
</span><a href="#local-6989586621682950827"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1149"></span><span>
</span><span id="line-1150"></span><span>        </span><span class="hs-comment">--construct transaction</span><span>
</span><span id="line-1151"></span><span>        </span><span id="local-6989586621682950821"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950821"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950837"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1152"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950836"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950822"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1153"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950821"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1154"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-1155"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403NotEnoughMoney"><span class="hs-identifier hs-var">errMsg403NotEnoughMoney</span></a></span><span>
</span><span id="line-1156"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_VALIDITY_INTERVAL_01a - \
        \Validity interval with second&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1160"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950820"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span>        </span><span id="local-6989586621682950819"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950819"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1163"></span><span>        </span><span id="local-6989586621682950818"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950818"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1164"></span><span>        </span><span id="local-6989586621682950817"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950817"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950818"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-1165"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950816"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950816"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950817"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950815"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-1166"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950814"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682950814"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950813"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950813"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                }],
                &quot;validity_interval&quot;: {
                    &quot;invalid_hereafter&quot;: {
                        &quot;quantity&quot;: 50,
                        &quot;unit&quot;: &quot;second&quot;
                    }
                  }
                }|]</span></span><span>
</span><span id="line-1183"></span><span>
</span><span id="line-1184"></span><span>        </span><span id="local-6989586621682950812"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950812"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1185"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950819"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950813"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1186"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950812"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1187"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1188"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1189"></span><span>
</span><span id="line-1190"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950811"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950811"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950810"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950812"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span>        </span><span id="local-6989586621682950809"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950809"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950819"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950811"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1193"></span><span>
</span><span id="line-1194"></span><span>        </span><span id="local-6989586621682950808"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950808"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950820"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950819"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950809"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1195"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950808"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1196"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1197"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1198"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_VALIDITY_INTERVAL_01b - \
        \Validity interval with slot&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1202"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950807"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span>        </span><span id="local-6989586621682950806"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950806"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1205"></span><span>
</span><span id="line-1206"></span><span>        </span><span id="local-6989586621682950805"><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950805"><span class="hs-identifier hs-var">rSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiNetworkInformation)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiNetworkInformation</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1207"></span><span>            </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getNetworkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1208"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; [(Status, Either RequestException ApiNetworkInformation)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950805"><span class="hs-identifier hs-var">rSlot</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1209"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950803"><span class="annot"><span class="annottext">sl :: SlotNo
</span><a href="#local-6989586621682950803"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiNetworkInformation SlotNo
-&gt; (Status, Either RequestException ApiNetworkInformation)
-&gt; SlotNo
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span>
</span><span id="line-1210"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;nodeTip&quot;
  ((ApiBlockReference -&gt; f ApiBlockReference)
   -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
(ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation
</span><a href="#local-6989586621682950802"><span class="hs-var">#nodeTip</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiBlockReference -&gt; f ApiBlockReference)
 -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
-&gt; ((SlotNo -&gt; f SlotNo)
    -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiNetworkInformation
-&gt; f ApiNetworkInformation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;absoluteSlotNumber&quot;
  ((ApiT SlotNo -&gt; f (ApiT SlotNo))
   -&gt; ApiBlockReference -&gt; f ApiBlockReference)
(ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; ApiBlockReference -&gt; f ApiBlockReference
</span><a href="#local-6989586621682950801"><span class="hs-var">#absoluteSlotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT SlotNo -&gt; f (ApiT SlotNo))
 -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiBlockReference
-&gt; f ApiBlockReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
(SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo)
</span><a href="#local-6989586621682950800"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950805"><span class="hs-identifier hs-var">rSlot</span></a></span><span>
</span><span id="line-1211"></span><span>
</span><span id="line-1212"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950799"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950799"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;withdrawal&quot;: &quot;self&quot;
                , &quot;validity_interval&quot;:
                    { &quot;invalid_before&quot;:
                        { &quot;quantity&quot;: 0
                        , &quot;unit&quot;: &quot;slot&quot;
                        }
                    , &quot;invalid_hereafter&quot;:
                        { &quot;quantity&quot;: #{sl + 10}
                        , &quot;unit&quot;: &quot;slot&quot;
                        }
                    }
                }|]</span></span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span>        </span><span id="local-6989586621682950798"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950798"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1227"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950806"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950799"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1228"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950798"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1229"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1230"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1231"></span><span>
</span><span id="line-1232"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span> </span><span id="local-6989586621682950796"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682950796"><span class="hs-identifier hs-var">toSlot</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621682950803"><span class="hs-identifier hs-var">sl</span></a></span><span>
</span><span id="line-1233"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950795"><span class="annot"><span class="annottext">validityInterval :: ValidityIntervalExplicit
</span><a href="#local-6989586621682950795"><span class="hs-identifier hs-var hs-var">validityInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1234"></span><span>                </span><span class="annot"><span class="annottext">Quantity &quot;slot&quot; Word64
-&gt; Quantity &quot;slot&quot; Word64 -&gt; ValidityIntervalExplicit
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ValidityIntervalExplicit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Quantity &quot;slot&quot; Word64
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Quantity &quot;slot&quot; Word64
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Quantity &quot;slot&quot; Word64)
-&gt; Word64 -&gt; Quantity &quot;slot&quot; Word64
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682950796"><span class="hs-identifier hs-var">toSlot</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span>
</span><span id="line-1236"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950793"><span class="annot"><span class="annottext">rTxCBOR :: ApiT SealedTx
</span><a href="#local-6989586621682950793"><span class="hs-identifier hs-var hs-var">rTxCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950792"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950798"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1237"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950791"><span class="annot"><span class="annottext">decodePayload1 :: Payload
</span><a href="#local-6989586621682950791"><span class="hs-identifier hs-var hs-var">decodePayload1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950793"><span class="hs-identifier hs-var">rTxCBOR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span>        </span><span id="local-6989586621682950790"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950790"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1239"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950806"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950791"><span class="hs-identifier hs-var">decodePayload1</span></a></span><span>
</span><span id="line-1240"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950790"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span><span>
</span><span id="line-1241"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1242"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiDecodedTransaction n) (Maybe ValidityIntervalExplicit)
-&gt; (Maybe ValidityIntervalExplicit -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;validityInterval&quot;
  ((Maybe ValidityIntervalExplicit
    -&gt; f (Maybe ValidityIntervalExplicit))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal'
  (ApiDecodedTransaction n) (Maybe ValidityIntervalExplicit)
</span><a href="#local-6989586621682950789"><span class="hs-var">#validityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
-&gt; Maybe ValidityIntervalExplicit -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityIntervalExplicit -&gt; Maybe ValidityIntervalExplicit
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityIntervalExplicit
</span><a href="#local-6989586621682950795"><span class="hs-identifier hs-var">validityInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1243"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950788"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950788"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950787"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950798"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1246"></span><span>
</span><span id="line-1247"></span><span>        </span><span id="local-6989586621682950786"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950786"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950806"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950788"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1248"></span><span>
</span><span id="line-1249"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950785"><span class="annot"><span class="annottext">decodePayload2 :: Payload
</span><a href="#local-6989586621682950785"><span class="hs-identifier hs-var hs-var">decodePayload2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950786"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1250"></span><span>        </span><span id="local-6989586621682950784"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950784"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1251"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950806"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950785"><span class="hs-identifier hs-var">decodePayload2</span></a></span><span>
</span><span id="line-1252"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950784"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span><span>
</span><span id="line-1253"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1254"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiDecodedTransaction n) (Maybe ValidityIntervalExplicit)
-&gt; (Maybe ValidityIntervalExplicit -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;validityInterval&quot;
  ((Maybe ValidityIntervalExplicit
    -&gt; f (Maybe ValidityIntervalExplicit))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal'
  (ApiDecodedTransaction n) (Maybe ValidityIntervalExplicit)
</span><a href="#local-6989586621682950783"><span class="hs-var">#validityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ValidityIntervalExplicit
-&gt; Maybe ValidityIntervalExplicit -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityIntervalExplicit -&gt; Maybe ValidityIntervalExplicit
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityIntervalExplicit
</span><a href="#local-6989586621682950795"><span class="hs-identifier hs-var">validityInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1256"></span><span>
</span><span id="line-1257"></span><span>        </span><span id="local-6989586621682950782"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950782"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950807"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950806"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950786"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1258"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950782"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1259"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1260"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1261"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1262"></span><span>
</span><span id="line-1263"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_DECODE_01a - \
        \multiple-output transaction with all covering inputs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1265"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950781"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950781"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span>        </span><span class="hs-comment">-- constructing source wallet</span><span>
</span><span id="line-1268"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950780"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950780"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950781"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1269"></span><span>        </span><span id="local-6989586621682950779"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950779"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950781"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950780"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1270"></span><span>
</span><span id="line-1271"></span><span>        </span><span class="hs-comment">-- The normal tx was created for some wallets and they are different than the wa.</span><span>
</span><span id="line-1272"></span><span>        </span><span class="hs-comment">-- The transaction involves four outputs with the amounts :</span><span>
</span><span id="line-1273"></span><span>        </span><span class="hs-comment">-- 999978</span><span>
</span><span id="line-1274"></span><span>        </span><span class="hs-comment">-- 999978</span><span>
</span><span id="line-1275"></span><span>        </span><span class="hs-comment">-- 49998927722</span><span>
</span><span id="line-1276"></span><span>        </span><span class="hs-comment">-- 49998927722</span><span>
</span><span id="line-1277"></span><span>        </span><span class="hs-comment">-- incurs the fee of</span><span>
</span><span id="line-1278"></span><span>        </span><span class="hs-comment">-- 144600</span><span>
</span><span id="line-1279"></span><span>        </span><span class="hs-comment">-- and involves one external input</span><span>
</span><span id="line-1280"></span><span>        </span><span class="hs-comment">-- 100000000000</span><span>
</span><span id="line-1281"></span><span>        </span><span class="hs-comment">-- no metadata, no collaterals, no withdrawals</span><span>
</span><span id="line-1282"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950778"><span class="annot"><span class="annottext">serializedTxHex :: Text
</span><a href="#local-6989586621682950778"><span class="hs-identifier hs-var hs-var">serializedTxHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1283"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;84a600818258200eaa33be8780935ca5a7c1e628a2d54402446f96236c\
                \a8f1770e07fa22ba8648000d80018482583901a65f0e7aea387adbc109\
                \123a571cfd8d0d139739d359caaf966aa5b9a062de6ec013404d4f9909\
                \877d452fc57dfe4f8b67f94e0ea1e8a0ba1a000f422a82583901ac9a56\
                \280ec283eb7e12146726bfe68dcd69c7a85123ce2f7a10e7afa062de6e\
                \c013404d4f9909877d452fc57dfe4f8b67f94e0ea1e8a0ba1a000f422a\
                \825839011a2f2f103b895dbe7388acc9cc10f90dc4ada53f46c841d2ac\
                \44630789fc61d21ddfcbd4d43652bf05c40c346fa794871423b65052d7\
                \614c1b0000000ba42b176a82583901c59701fee28ad31559870ecd6ea9\
                \2b143b1ce1b68ccb62f8e8437b3089fc61d21ddfcbd4d43652bf05c40c\
                \346fa794871423b65052d7614c1b0000000ba42b176a021a000234d803\
                \198ceb0e80a0f5f6&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1295"></span><span>
</span><span id="line-1296"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950777"><span class="annot"><span class="annottext">theTxHash :: Hash tag
</span><a href="#local-6989586621682950777"><span class="hs-identifier hs-var hs-var">theTxHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Hash tag
forall (tag :: Symbol). Method -&gt; Hash tag
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Hash</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;\SO\170\&amp;3\190\135\128\147\\\165\167\193\230(\162\213D\STXDo\150#l\168\241w\SO\a\250\&quot;\186\134H&quot;</span></span><span>
</span><span id="line-1297"></span><span>
</span><span id="line-1298"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950775"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682950775"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{serializedTxHex}
          }|]</span></span><span>
</span><span id="line-1301"></span><span>        </span><span id="local-6989586621682950774"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950774"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950781"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1302"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950779"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950775"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-1303"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950774"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1304"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1305"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682950773"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiDecodedTransaction n
-&gt; f (ApiDecodedTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950772"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">144600</span></span><span class="hs-special">)</span><span>
</span><span id="line-1306"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n] -&gt; f [ApiWithdrawalGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682950771"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n] -&gt; [ApiWithdrawalGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1307"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateral&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682950770"><span class="hs-var">#collateral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1308"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiTxMetadata
-&gt; (ApiTxMetadata -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((ApiTxMetadata -&gt; f ApiTxMetadata)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiTxMetadata
</span><a href="#local-6989586621682950769"><span class="hs-var">#metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiTxMetadata -&gt; ApiTxMetadata -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682950768"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-1310"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiT TxIn -&gt; ApiTxInputGeneral n
forall (n :: NetworkDiscriminant). ApiT TxIn -&gt; ApiTxInputGeneral n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ExternalInput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; ApiT TxIn
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash &quot;Tx&quot; -&gt; Word32 -&gt; TxIn
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Hash &quot;Tx&quot;
forall (tag :: Symbol). Hash tag
</span><a href="#local-6989586621682950777"><span class="hs-identifier hs-var">theTxHash</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1311"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1312"></span><span>
</span><span id="line-1313"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_DECODE_02 - \
        \transaction with minting/burning assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1315"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950766"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950766"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span>        </span><span class="hs-comment">-- constructing wallet</span><span>
</span><span id="line-1318"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950765"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950765"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950766"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1319"></span><span>        </span><span id="local-6989586621682950764"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950764"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950766"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950765"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1320"></span><span>
</span><span id="line-1321"></span><span>        </span><span class="hs-comment">-- constructing minting asset tx in cardano-cli</span><span>
</span><span id="line-1322"></span><span>        </span><span class="hs-comment">--- $ cardano-cli transaction build-raw --fee 202725 \</span><span>
</span><span id="line-1323"></span><span>        </span><span class="hs-comment">--- &gt; --tx-in 637255c96ff39303573047ba4a53064c18fbdf8ce8cee71431e8cd5333e4bdfd#0 \</span><span>
</span><span id="line-1324"></span><span>        </span><span class="hs-comment">--- &gt; --tx-out=&quot;addr1zyqmnmwuh85e0fxaggl6ac2hfeqncg76gsr0ld8qdjd84af5rh7cflza8t3m5wlaj45sg53nvtwpc73mqk90ghv7vv7srr0dle+4623486815&quot; \</span><span>
</span><span id="line-1325"></span><span>        </span><span class="hs-comment">--- &gt; --tx-out=&quot;addr1y9qthemrg5kczwfjjnahwt65elhrl95e9hcgufnajtp6wfgph8kaew0fj7jd6s3l4ms4wnjp8s3a53qxl76wqmy60t6ssqcamq+1500000+50000 919e8a1922aaa764b1d66407c6f62244e77081215f385b60a6209149.4861707079436f696e&quot; \</span><span>
</span><span id="line-1326"></span><span>        </span><span class="hs-comment">--- &gt; --mint=&quot;50000 919e8a1922aaa764b1d66407c6f62244e77081215f385b60a6209149.4861707079436f696e&quot; \</span><span>
</span><span id="line-1327"></span><span>        </span><span class="hs-comment">--- &gt; --metadata-json-file metadata.json \</span><span>
</span><span id="line-1328"></span><span>        </span><span class="hs-comment">--- &gt; --mint-script-file policy.script \</span><span>
</span><span id="line-1329"></span><span>        </span><span class="hs-comment">--- &gt; --alonzo-era</span><span>
</span><span id="line-1330"></span><span>        </span><span class="hs-comment">--- &gt; --out-file &quot;txMint&quot;</span><span>
</span><span id="line-1331"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950763"><span class="annot"><span class="annottext">cborHexWithMinting :: Text
</span><a href="#local-6989586621682950763"><span class="hs-identifier hs-var hs-var">cborHexWithMinting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1332"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;86a70081825820637255c96ff39303573047ba4a53064c18fbdf8ce8cee714\
                \31e8cd5333e4bdfd000d8001828258391101b9eddcb9e997a4dd423faee157\
                \4e413c23da4406ffb4e06c9a7af5341dfd84fc5d3ae3ba3bfd956904523362\
                \dc1c7a3b058af45d9e633d1b000000011394cf5f8258392140bbe763452d81\
                \393294fb772f54cfee3f96992df08e267d92c3a72501b9eddcb9e997a4dd42\
                \3faee1574e413c23da4406ffb4e06c9a7af5821a0016e360a1581c919e8a19\
                \22aaa764b1d66407c6f62244e77081215f385b60a6209149a1494861707079\
                \436f696e19c350021a000317e50e8009a1581c919e8a1922aaa764b1d66407\
                \c6f62244e77081215f385b60a6209149a1494861707079436f696e19c35007\
                \5820a377b9f8fcbffce4e869c7d02e2052fda1646b59ec534e6fc39de9b505\
                \d565e99f82008201818200581c69303ce3536df260efddbc949ccb94e69933\
                \02b10b778d8b4d98bfb5ff8080f5d90103a100a11902d1a178386565316365\
                \39643735363066343861346261333836373033376462656332643866656437\
                \3736643934646436623030613335333039303733a160a265696d6167657369\
                \7066733a2f2f58585858595959595a5a5a5a646e616d656a54657374204e46\
                \542023&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1348"></span><span>
</span><span id="line-1349"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950762"><span class="annot"><span class="annottext">cborHexMint :: Text
</span><a href="#local-6989586621682950762"><span class="hs-identifier hs-var hs-var">cborHexMint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621682950761"><span class="hs-identifier hs-var">fromTextEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950763"><span class="hs-identifier hs-var">cborHexWithMinting</span></a></span><span>
</span><span id="line-1350"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950760"><span class="annot"><span class="annottext">decodeMintPayload :: Payload
</span><a href="#local-6989586621682950760"><span class="hs-identifier hs-var hs-var">decodeMintPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{cborHexMint}
          }|]</span></span><span>
</span><span id="line-1353"></span><span>
</span><span id="line-1354"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950759"><span class="annot"><span class="annottext">tokenPolicyId' :: TokenPolicyId
</span><a href="#local-6989586621682950759"><span class="hs-identifier hs-var hs-var">tokenPolicyId'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1355"></span><span>                </span><span class="annot"><span class="annottext">Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId)
-&gt; Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Hash &quot;TokenPolicy&quot;
forall (tag :: Symbol). Method -&gt; Hash tag
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Hash</span></a></span><span>
</span><span id="line-1356"></span><span>                </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;\145\158\138\EM\&quot;\170\167d\177\214d\a\198\246\&quot;D\231p\129!_8[`\166 \145I&quot;</span></span><span>
</span><span id="line-1357"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950757"><span class="annot"><span class="annottext">tokenName' :: TokenName
</span><a href="#local-6989586621682950757"><span class="hs-identifier hs-var hs-var">tokenName'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;HappyCoin&quot;</span></span><span>
</span><span id="line-1358"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950755"><span class="annot"><span class="annottext">policyWithHash :: (Method, Text)
</span><a href="#local-6989586621682950755"><span class="hs-identifier hs-var hs-var">policyWithHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; Maybe Bool -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; Maybe Bool -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getPolicyKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950764"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1359"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950753"><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682950753"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1360"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text) -&gt; Payload -&gt; ResourceT IO (Status, ApiPolicyKey)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950766"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950755"><span class="hs-identifier hs-var">policyWithHash</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1361"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682950752"><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682950752"><span class="hs-identifier hs-var">externalPolicyKeyHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KeyRole, Method) -&gt; Maybe KeyHash
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">keyHashFromBytes</span></a></span><span>
</span><span id="line-1362"></span><span>               </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">KeyRole
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Policy</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1363"></span><span>                 </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;i0&lt;\227Sm\242`\239\221\188\148\156\203\148\230\153\&amp;3\STX\177\vw\141\139M\152\191\181&quot;</span></span><span>
</span><span id="line-1364"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-1365"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950750"><span class="annot"><span class="annottext">scriptUsed :: Script KeyHash
</span><a href="#local-6989586621682950750"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Script KeyHash] -&gt; Script KeyHash
forall elem. [Script elem] -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireAllOf</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireSignatureOf</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682950752"><span class="hs-identifier hs-var">externalPolicyKeyHash</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950747"><span class="annot"><span class="annottext">apiTokenAmountFingerprint :: ApiTokenAmountFingerprint
</span><a href="#local-6989586621682950747"><span class="hs-identifier hs-var hs-var">apiTokenAmountFingerprint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTokenAmountFingerprint :: ApiT TokenName
-&gt; Natural -&gt; ApiT TokenFingerprint -&gt; ApiTokenAmountFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTokenAmountFingerprint</span></a></span><span>
</span><span id="line-1368"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assetName:ApiTokenAmountFingerprint :: ApiT TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; ApiT TokenName
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682950757"><span class="hs-identifier hs-var">tokenName'</span></a></span><span>
</span><span id="line-1369"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:quantity:ApiTokenAmountFingerprint :: Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">quantity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">50_000</span></span><span>
</span><span id="line-1370"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fingerprint:ApiTokenAmountFingerprint :: ApiT TokenFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">fingerprint</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1371"></span><span>                    </span><span class="annot"><span class="annottext">TokenFingerprint -&gt; ApiT TokenFingerprint
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenFingerprint -&gt; ApiT TokenFingerprint)
-&gt; TokenFingerprint -&gt; ApiT TokenFingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; TokenFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682950759"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682950757"><span class="hs-identifier hs-var">tokenName'</span></a></span><span>
</span><span id="line-1372"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1373"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950742"><span class="annot"><span class="annottext">apiTokens :: ApiTokens
</span><a href="#local-6989586621682950742"><span class="hs-identifier hs-var hs-var">apiTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTokens :: ApiT TokenPolicyId
-&gt; ApiT AnyScript
-&gt; NonEmpty ApiTokenAmountFingerprint
-&gt; ApiTokens
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTokens</span></a></span><span>
</span><span id="line-1374"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:policyId:ApiTokens :: ApiT TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; ApiT TokenPolicyId
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682950759"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span>
</span><span id="line-1375"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:policyScript:ApiTokens :: ApiT AnyScript
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">policyScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyScript -&gt; ApiT AnyScript
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script KeyHash -&gt; AnyScript
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">NativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">Script KeyHash
</span><a href="#local-6989586621682950750"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1376"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiTokens :: NonEmpty ApiTokenAmountFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiTokenAmountFingerprint] -&gt; NonEmpty ApiTokenAmountFingerprint
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTokenAmountFingerprint
</span><a href="#local-6989586621682950747"><span class="hs-identifier hs-var">apiTokenAmountFingerprint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1377"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950736"><span class="annot"><span class="annottext">activeAssetsInfo :: ApiAssetMintBurn
</span><a href="#local-6989586621682950736"><span class="hs-identifier hs-var hs-var">activeAssetsInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-1380"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTokens
</span><a href="#local-6989586621682950742"><span class="hs-identifier hs-var">apiTokens</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1381"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Maybe ApiPolicyKey
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682950753"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span><span>
</span><span id="line-1382"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1383"></span><span>                    </span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex))
-&gt; ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-1384"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1385"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950731"><span class="annot"><span class="annottext">inactiveAssetsInfo :: ApiAssetMintBurn
</span><a href="#local-6989586621682950731"><span class="hs-identifier hs-var hs-var">inactiveAssetsInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-1386"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1387"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiPolicyKey
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1388"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1389"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1390"></span><span>        </span><span id="local-6989586621682950730"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950730"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950766"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1391"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950764"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950760"><span class="hs-identifier hs-var">decodeMintPayload</span></a></span><span>
</span><span id="line-1392"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950730"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1393"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1394"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682950729"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiDecodedTransaction n
-&gt; f (ApiDecodedTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950728"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">202_725</span></span><span class="hs-special">)</span><span>
</span><span id="line-1395"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mint&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682950727"><span class="hs-var">#mint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682950736"><span class="hs-identifier hs-var">activeAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1396"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;burn&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682950726"><span class="hs-var">#burn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682950731"><span class="hs-identifier hs-var">inactiveAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1397"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1398"></span><span>
</span><span id="line-1399"></span><span>        </span><span class="hs-comment">-- constructing burning asset tx in cardano-cli</span><span>
</span><span id="line-1400"></span><span>        </span><span class="hs-comment">--- $ cardano-cli transaction build-raw --fee  202725 \</span><span>
</span><span id="line-1401"></span><span>        </span><span class="hs-comment">--- &gt; --tx-in 72ca58d82fb9e89f91bdd546c3d84bcce92825ec1c49d2c3a180ecc8ab128a52#1 \</span><span>
</span><span id="line-1402"></span><span>        </span><span class="hs-comment">--- &gt; --tx-out=&quot;addr1zyqmnmwuh85e0fxaggl6ac2hfeqncg76gsr0ld8qdjd84af5rh7cflza8t3m5wlaj45sg53nvtwpc73mqk90ghv7vv7srr0dle+4623486815&quot; \</span><span>
</span><span id="line-1403"></span><span>        </span><span class="hs-comment">--- &gt; --mint=&quot;-50000 919e8a1922aaa764b1d66407c6f62244e77081215f385b60a6209149.HappyCoin&quot; \</span><span>
</span><span id="line-1404"></span><span>        </span><span class="hs-comment">--- &gt; --mint-script-file policy.script \</span><span>
</span><span id="line-1405"></span><span>        </span><span class="hs-comment">--- &gt; --out-file &quot;txBurn&quot; \</span><span>
</span><span id="line-1406"></span><span>        </span><span class="hs-comment">--- &gt; --alonzo-era</span><span>
</span><span id="line-1407"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950725"><span class="annot"><span class="annottext">cborHexWithBurning :: Text
</span><a href="#local-6989586621682950725"><span class="hs-identifier hs-var hs-var">cborHexWithBurning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1408"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;86a6008182582072ca58d82fb9e89f91bdd546c3d84bcce92825ec1c49d2c3\
                \a180ecc8ab128a52010d8001818258391101b9eddcb9e997a4dd423faee157\
                \4e413c23da4406ffb4e06c9a7af5341dfd84fc5d3ae3ba3bfd956904523362\
                \dc1c7a3b058af45d9e633d1b000000011394cf5f021a000317e50e8009a158\
                \1c919e8a1922aaa764b1d66407c6f62244e77081215f385b60a6209149a149\
                \4861707079436f696e39c34f9f82008201818200581c69303ce3536df260ef\
                \ddbc949ccb94e6993302b10b778d8b4d98bfb5ff8080f5f6&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950724"><span class="annot"><span class="annottext">cborHexBurn :: Text
</span><a href="#local-6989586621682950724"><span class="hs-identifier hs-var hs-var">cborHexBurn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621682950761"><span class="hs-identifier hs-var">fromTextEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950725"><span class="hs-identifier hs-var">cborHexWithBurning</span></a></span><span>
</span><span id="line-1417"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950723"><span class="annot"><span class="annottext">decodeBurnPayload :: Payload
</span><a href="#local-6989586621682950723"><span class="hs-identifier hs-var hs-var">decodeBurnPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{cborHexBurn}
          }|]</span></span><span>
</span><span id="line-1420"></span><span>
</span><span id="line-1421"></span><span>        </span><span id="local-6989586621682950722"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950722"><span class="hs-identifier hs-var">rTx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950766"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1422"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950764"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950723"><span class="hs-identifier hs-var">decodeBurnPayload</span></a></span><span>
</span><span id="line-1423"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950722"><span class="hs-identifier hs-var">rTx'</span></a></span><span>
</span><span id="line-1424"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1425"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682950721"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiDecodedTransaction n
-&gt; f (ApiDecodedTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950720"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">202_725</span></span><span class="hs-special">)</span><span>
</span><span id="line-1426"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mint&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682950719"><span class="hs-var">#mint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682950731"><span class="hs-identifier hs-var">inactiveAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1427"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;burn&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682950718"><span class="hs-var">#burn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682950736"><span class="hs-identifier hs-var">activeAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1429"></span><span>
</span><span id="line-1430"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_DECODE_03 - \
        \transaction with external delegation certificates&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1432"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950717"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950717"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1433"></span><span>
</span><span id="line-1434"></span><span>        </span><span class="hs-comment">-- constructing source wallet</span><span>
</span><span id="line-1435"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950716"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950716"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950717"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1436"></span><span>        </span><span id="local-6989586621682950715"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950715"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950717"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950716"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1437"></span><span>
</span><span id="line-1438"></span><span>        </span><span class="hs-comment">-- tx within some wallet, so other that wallet wa, that contains</span><span>
</span><span id="line-1439"></span><span>        </span><span class="hs-comment">-- registration of reward account and joining to some pool using this</span><span>
</span><span id="line-1440"></span><span>        </span><span class="hs-comment">-- reward account</span><span>
</span><span id="line-1441"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950714"><span class="annot"><span class="annottext">serializedTxHexJoin :: Text
</span><a href="#local-6989586621682950714"><span class="hs-identifier hs-var hs-var">serializedTxHexJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1442"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;84a700818258200eaa33be8780935ca5a7c1e628a2d54402446f96236ca8f1\
                \770e07fa22ba8648060d800181825839011a2f2f103b895dbe7388acc9cc10\
                \f90dc4ada53f46c841d2ac44630789fc61d21ddfcbd4d43652bf05c40c346f\
                \a794871423b65052d7614c1b0000001748656dc8021a000237f803198d1904\
                \8282008200581c89fc61d21ddfcbd4d43652bf05c40c346fa794871423b650\
                \52d7614c83028200581c89fc61d21ddfcbd4d43652bf05c40c346fa7948714\
                \23b65052d7614c581cec28f33dcbe6d6400a1e5e339bd0647c0973ca6c0cf9\
                \c2bbe6838dc60e80a10082825820a922e88e8148f1bb9b9578e2640704ae86\
                \99bdd17bb9c26ed35881343c15ec485840995587f2e29c72c7ed2eb6e2381b\
                \e4745503d7d2ba8de30c6cf176f82fb9074854c39ab85cb7d8e1dcdf9fb990\
                \07de2b044ba7a05ea7712b7084b4d352aa8502825820a1a07799ec226d8f2b\
                \ea80dc1a4fdb25e1b2cb0dbd312a1b004b0401e901225358403ad81b75a057\
                \c419d48e1840bdeba8338206cf3df799d04328c4208b4d7a87248e604a7844\
                \7c2a7acfa4488f3df5c92b01535f756e6ae6e1f23ddb9f438de10ef5f6&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950713"><span class="annot"><span class="annottext">rewardAccount' :: ApiT RewardAccount
</span><a href="#local-6989586621682950713"><span class="hs-identifier hs-var hs-var">rewardAccount'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; ApiT RewardAccount
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; ApiT RewardAccount)
-&gt; RewardAccount -&gt; ApiT RewardAccount
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Method -&gt; RewardAccount
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">RewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;\137\252a\210\GS\223\203\212\212\&amp;6R\191\ENQ\196\f4o\167\148\135\DC4#\182PR\215aL&quot;</span></span><span>
</span><span id="line-1458"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950711"><span class="annot"><span class="annottext">pool' :: ApiT PoolId
</span><a href="#local-6989586621682950711"><span class="hs-identifier hs-var hs-var">pool'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(PoolId -&gt; ApiT PoolId) -&gt; PoolId -&gt; ApiT PoolId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Method -&gt; PoolId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">PoolId</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;\236(\243=\203\230\214@\n\RS^3\155\208d|\ts\202l\f\249\194\187\230\131\141\198&quot;</span></span><span>
</span><span id="line-1459"></span><span>
</span><span id="line-1460"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950709"><span class="annot"><span class="annottext">certsJoin :: [ApiAnyCertificate n]
</span><a href="#local-6989586621682950709"><span class="hs-identifier hs-var hs-var">certsJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1461"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiExternalCertificate n -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">RegisterRewardAccountExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT RewardAccount
</span><a href="#local-6989586621682950713"><span class="hs-identifier hs-var">rewardAccount'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiExternalCertificate n -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n)
-&gt; ApiT PoolId -&gt; ApiExternalCertificate n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n)
-&gt; ApiT PoolId -&gt; ApiExternalCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">JoinPoolExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT RewardAccount
</span><a href="#local-6989586621682950713"><span class="hs-identifier hs-var">rewardAccount'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950711"><span class="hs-identifier hs-var">pool'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1463"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950704"><span class="annot"><span class="annottext">decodePayloadJoin :: Payload
</span><a href="#local-6989586621682950704"><span class="hs-identifier hs-var hs-var">decodePayloadJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{serializedTxHexJoin}
          }|]</span></span><span>
</span><span id="line-1468"></span><span>        </span><span id="local-6989586621682950703"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950703"><span class="hs-identifier hs-var">rTxJoin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950717"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1469"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950715"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950704"><span class="hs-identifier hs-var">decodePayloadJoin</span></a></span><span>
</span><span id="line-1470"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950703"><span class="hs-identifier hs-var">rTxJoin</span></a></span><span>
</span><span id="line-1471"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1472"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950702"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; [ApiAnyCertificate n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAnyCertificate n]
forall (n :: NetworkDiscriminant). [ApiAnyCertificate n]
</span><a href="#local-6989586621682950709"><span class="hs-identifier hs-var">certsJoin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1474"></span><span>
</span><span id="line-1475"></span><span>        </span><span class="hs-comment">-- tx within other wallet than wa, containing quitting the pool</span><span>
</span><span id="line-1476"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950701"><span class="annot"><span class="annottext">serializedTxHexQuit :: Text
</span><a href="#local-6989586621682950701"><span class="hs-identifier hs-var hs-var">serializedTxHexQuit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1477"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;84a700818258200eaa33be8780935ca5a7c1e628a2d54402446f96236ca8f1\
                \770e07fa22ba8648000d800181825839012c6f08b29f901657f4daf134a36a\
                \64b7b53977eb00866aadf6b8fb4d89fc61d21ddfcbd4d43652bf05c40c346f\
                \a794871423b65052d7614c1b0000001748840b48021a00021ef803198f0304\
                \8182018200581c89fc61d21ddfcbd4d43652bf05c40c346fa794871423b650\
                \52d7614c0e80a10082825820a1a07799ec226d8f2bea80dc1a4fdb25e1b2cb\
                \0dbd312a1b004b0401e901225358408fec23c16be743ee592a948a4a1c9d9a\
                \4529a868d3217386985c30c6d1797c50c4928b6c3aea2825fc0677ea9550ef\
                \e2270447514f1f6e189b73a0234029a802825820c15b990344122b12494a5e\
                \dd1020d9eb32e34b0f82691f8e31645ddab712ff2b58402504005e990a2a6e\
                \db71e6bb1dee0c59e9328e5d698a97139567db4b7754d960ddcb738b852746\
                \c9571d7175c9263a12e40139c93929ef6ba11c1815f792b40cf5f6&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950700"><span class="annot"><span class="annottext">certsQuit :: [ApiAnyCertificate n]
</span><a href="#local-6989586621682950700"><span class="hs-identifier hs-var hs-var">certsQuit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1491"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ApiExternalCertificate n -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiExternalCertificate n -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DelegationCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
forall (n :: NetworkDiscriminant).
(ApiT RewardAccount, Proxy n) -&gt; ApiExternalCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">QuitPoolExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT RewardAccount
</span><a href="#local-6989586621682950713"><span class="hs-identifier hs-var">rewardAccount'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1492"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1493"></span><span>
</span><span id="line-1494"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950698"><span class="annot"><span class="annottext">decodePayloadQuit :: Payload
</span><a href="#local-6989586621682950698"><span class="hs-identifier hs-var hs-var">decodePayloadQuit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{serializedTxHexQuit}
          }|]</span></span><span>
</span><span id="line-1497"></span><span>        </span><span id="local-6989586621682950697"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950697"><span class="hs-identifier hs-var">rTxQuit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950717"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1498"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950715"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950698"><span class="hs-identifier hs-var">decodePayloadQuit</span></a></span><span>
</span><span id="line-1499"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950697"><span class="hs-identifier hs-var">rTxQuit</span></a></span><span>
</span><span id="line-1500"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1501"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950696"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; [ApiAnyCertificate n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAnyCertificate n]
forall (n :: NetworkDiscriminant). [ApiAnyCertificate n]
</span><a href="#local-6989586621682950700"><span class="hs-identifier hs-var">certsQuit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1502"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_DECODE_04 - \
        \transaction with mir certificate&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1506"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950695"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950695"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1507"></span><span>
</span><span id="line-1508"></span><span>        </span><span class="hs-comment">-- constructing source wallet</span><span>
</span><span id="line-1509"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950694"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950694"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950695"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1510"></span><span>        </span><span id="local-6989586621682950693"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950693"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950695"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950694"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span>        </span><span class="hs-comment">-- this is tx integration cluster sends when setting up, ie. a lot of MIRs</span><span>
</span><span id="line-1513"></span><span>        </span><span class="hs-comment">-- and reward account registrations</span><span>
</span><span id="line-1514"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950692"><span class="annot"><span class="annottext">cborHex :: Text
</span><a href="#local-6989586621682950692"><span class="hs-identifier hs-var hs-var">cborHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1515"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;83a50081825820e6f53fa3a753f637c62ee198421bbaef604faee230fe4262\
                \340eedf13a8d0bba00018182581d61161a20f92ea667c30de21e49f01cc4ba\
                \7aadaa9b685a3dab7d4b040a1a000f4240021b00038d7ea3678c40031a3b9a\
                \c9ff049f82008200581cfb3c13a29d3798f1b77b47f2ddb31c19326b87ed6f\
                \71fb9a27133ad582068200a18200581cfb3c13a29d3798f1b77b47f2ddb31c\
                \19326b87ed6f71fb9a27133ad51b000000e8d4a5100082008200581ceb220e\
                \40c3ca1de87c448972443020d8fa08d111a699a4d7b51ba4bc82068200a182\
                \00581ceb220e40c3ca1de87c448972443020d8fa08d111a699a4d7b51ba4bc\
                \1b000000e8d4a5100082008200581cc72a6827138da1341c9ea1e55a04bd10\
                \96824f0c66a0ec282d5daad382068200a18200581cc72a6827138da1341c9e\
                \a1e55a04bd1096824f0c66a0ec282d5daad31b000000e8d4a5100082008200\
                \581c3b525e261b6434b75f949404fbc5b3ef4acf686a31af9facea74687082\
                \068200a18200581c3b525e261b6434b75f949404fbc5b3ef4acf686a31af9f\
                \acea7468701b000000e8d4a5100082008200581c8bf7bb98dd01953c5754fc\
                \f49460aaaa3368faf9476267411a38d33c82068200a18200581c8bf7bb98dd\
                \01953c5754fcf49460aaaa3368faf9476267411a38d33c1b000000e8d4a510\
                \0082008200581c917d3b19a2c9fe13ca2dea4c9b1555257af2f185b58ad483\
                \7e801c1782068200a18200581c917d3b19a2c9fe13ca2dea4c9b1555257af2\
                \f185b58ad4837e801c171b000000e8d4a5100082008200581c37457aadf2fa\
                \6292ebca8460e01ff4e813a495466512b930eb564ec782068200a18200581c\
                \37457aadf2fa6292ebca8460e01ff4e813a495466512b930eb564ec71b0000\
                \00e8d4a5100082008200581cc1e7e3ea91ee7a92f0b33afceab00a41c7039b\
                \f083636689d2de1f0482068200a18200581cc1e7e3ea91ee7a92f0b33afcea\
                \b00a41c7039bf083636689d2de1f041b000000e8d4a5100082008200581c8a\
                \dbd72dd6b5b46b27df79b1f8bcbcf0ac780d515f5b57cb08a2c9a782068200\
                \a18200581c8adbd72dd6b5b46b27df79b1f8bcbcf0ac780d515f5b57cb08a2\
                \c9a71b000000e8d4a5100082008200581c9c19c3caa333ee30c6d5d9f0ddd0\
                \1ad09258a47dec0380519bcae7ac82068200a18200581c9c19c3caa333ee30\
                \c6d5d9f0ddd01ad09258a47dec0380519bcae7ac1b000000e8d4a510008200\
                \8200581c6433cd346858f15142171023c633ae0646bdc0470de5ae6f110bdf\
                \0682068200a18200581c6433cd346858f15142171023c633ae0646bdc0470d\
                \e5ae6f110bdf061b000000e8d4a5100082008200581c63ec6f04e6fa18e830\
                \05a02bc57d72f7afa3a04523d016010076b40a82068200a18200581c63ec6f\
                \04e6fa18e83005a02bc57d72f7afa3a04523d016010076b40a1b000000e8d4\
                \a5100082008200581c990d9d698730cbc4c09f95be75f54e47c524c3e7ad48\
                \4de626ef321482068200a18200581c990d9d698730cbc4c09f95be75f54e47\
                \c524c3e7ad484de626ef32141b000000e8d4a5100082008200581ccc8116d5\
                \0326ea87caa3e46597b54e56725ff1fe39d1bc08361bc20682068200a18200\
                \581ccc8116d50326ea87caa3e46597b54e56725ff1fe39d1bc08361bc2061b\
                \000000e8d4a5100082008200581c246a121534ab486f4e47618cb192568b77\
                \a491cf4db613a80ced4d7682068200a18200581c246a121534ab486f4e4761\
                \8cb192568b77a491cf4db613a80ced4d761b000000e8d4a510008200820058\
                \1c36cf17310d216fc7a2ac6122088766bbc5761129b1155d495bf8112b8206\
                \8200a18200581c36cf17310d216fc7a2ac6122088766bbc5761129b1155d49\
                \5bf8112b1b000000e8d4a5100082008200581c1bb104a403de68b0c03438a1\
                \0d9142a595f4a9ff8162b195493bf55082068200a18200581c1bb104a403de\
                \68b0c03438a10d9142a595f4a9ff8162b195493bf5501b000000e8d4a51000\
                \82008200581cc2a47d500058e60176c437fc61be7d0cd07f0d8c871abe6d00\
                \2636a182068200a18200581cc2a47d500058e60176c437fc61be7d0cd07f0d\
                \8c871abe6d002636a11b000000e8d4a5100082008200581ce8b783e08083c2\
                \3c2682afcd4b7a5cb0851239e5f9c04beb2455979582068200a18200581ce8\
                \b783e08083c23c2682afcd4b7a5cb0851239e5f9c04beb245597951b000000\
                \e8d4a5100082008200581cedf156a660897651bd753aefa7af7f81d6d83dfc\
                \9bcdc4afbd36fad382068200a18200581cedf156a660897651bd753aefa7af\
                \7f81d6d83dfc9bcdc4afbd36fad31b000000e8d4a5100082008200581c30c6\
                \00d4fcf006fc2067721c55fc7d3a696b93a4f382aaad75e3516682068200a1\
                \8200581c30c600d4fcf006fc2067721c55fc7d3a696b93a4f382aaad75e351\
                \661b000000e8d4a5100082008200581cc7d5e024d22767a891e02834b27588\
                \5e06ed04869747cff43cec91e082068200a18200581cc7d5e024d22767a891\
                \e02834b275885e06ed04869747cff43cec91e01b000000e8d4a51000ff9fff\
                \f6&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950691"><span class="annot"><span class="annottext">cborHexMIR :: Text
</span><a href="#local-6989586621682950691"><span class="hs-identifier hs-var hs-var">cborHexMIR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621682950761"><span class="hs-identifier hs-var">fromTextEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950692"><span class="hs-identifier hs-var">cborHex</span></a></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950690"><span class="annot"><span class="annottext">containMIR :: t (ApiAnyCertificate n) -&gt; Bool
</span><a href="#local-6989586621682950690"><span class="hs-identifier hs-var hs-var">containMIR</span></a></span></span><span> </span><span id="local-6989586621682950689"><span class="annot"><span class="annottext">t (ApiAnyCertificate n)
</span><a href="#local-6989586621682950689"><span class="hs-identifier hs-var">certs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT NonWalletCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiT NonWalletCertificate -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">OtherCertificate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonWalletCertificate -&gt; ApiT NonWalletCertificate
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">NonWalletCertificate
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">MIRCertificate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAnyCertificate n -&gt; t (ApiAnyCertificate n) -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">t (ApiAnyCertificate n)
</span><a href="#local-6989586621682950689"><span class="hs-identifier hs-var">certs</span></a></span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950685"><span class="annot"><span class="annottext">decodePayloadJoin :: Payload
</span><a href="#local-6989586621682950685"><span class="hs-identifier hs-var hs-var">decodePayloadJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{cborHexMIR}
          }|]</span></span><span>
</span><span id="line-1584"></span><span>        </span><span id="local-6989586621682950684"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950684"><span class="hs-identifier hs-var">rTxJoin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950695"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1585"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950693"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950685"><span class="hs-identifier hs-var">decodePayloadJoin</span></a></span><span>
</span><span id="line-1586"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950684"><span class="hs-identifier hs-var">rTxJoin</span></a></span><span>
</span><span id="line-1587"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1588"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950683"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; ([ApiAnyCertificate n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; Bool
forall (t :: * -&gt; *) (n :: NetworkDiscriminant).
Foldable t =&gt;
t (ApiAnyCertificate n) -&gt; Bool
</span><a href="#local-6989586621682950690"><span class="hs-identifier hs-var">containMIR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1589"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1590"></span><span>
</span><span id="line-1591"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_DECODE_05 - \
        \transaction with pool registration and deregistration certificates&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1593"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950682"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950682"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1594"></span><span>
</span><span id="line-1595"></span><span>        </span><span class="hs-comment">-- constructing source wallet</span><span>
</span><span id="line-1596"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950681"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950681"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950682"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1597"></span><span>        </span><span id="local-6989586621682950680"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950680"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950682"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950681"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1598"></span><span>
</span><span id="line-1599"></span><span>        </span><span class="hs-comment">-- this is tx integration cluster sends when registering one of 4 pools</span><span>
</span><span id="line-1600"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950679"><span class="annot"><span class="annottext">cborHex :: Text
</span><a href="#local-6989586621682950679"><span class="hs-identifier hs-var hs-var">cborHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1601"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;83a50081825820fe13857230b6db7f4d30acb043c6cd0c36595657ef79212f\
                \6b4e0cc5d5af1c8b000181825839019ae3b4936cb9e6e6e4fb854d17ed867c\
                \e10f3acdc19cdab52ab4a6de124827f09f6d5029a46b7d09854ac6a9ab16f3\
                \a991c3e2b19ac029511b000000e8d4a51000021b00038c95d0122dc0031901\
                \90048482008200581c124827f09f6d5029a46b7d09854ac6a9ab16f3a991c3\
                \e2b19ac029518a03581cbb114cb37d75fa05260328c235a3dae295a33d0ba6\
                \74a5eb1e3e568e5820ff097f7a12be27b1c4445b43a2d2279cc714a3c47f47\
                \7a6eac3fc0ea54032ab21b000000e8d4a5100000d81e82010a581de1124827\
                \f09f6d5029a46b7d09854ac6a9ab16f3a991c3e2b19ac0295181581c124827\
                \f09f6d5029a46b7d09854ac6a9ab16f3a991c3e2b19ac02951808278246874\
                \74703a2f2f6c6f63616c686f73743a34343130372f6d657461646174612e6a\
                \736f6e5820f1941b06d889a1a9bd8a7dd72d2160aa294d81a4494f99353c6b\
                \bb120746808983028200581c124827f09f6d5029a46b7d09854ac6a9ab16f3\
                \a991c3e2b19ac02951581cbb114cb37d75fa05260328c235a3dae295a33d0b\
                \a674a5eb1e3e568e8304581cbb114cb37d75fa05260328c235a3dae295a33d\
                \0ba674a5eb1e3e568e1a000f42409ffff6&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1617"></span><span>
</span><span id="line-1618"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950678"><span class="annot"><span class="annottext">cborHexPool :: Text
</span><a href="#local-6989586621682950678"><span class="hs-identifier hs-var hs-var">cborHexPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="#local-6989586621682950761"><span class="hs-identifier hs-var">fromTextEnvelope</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950679"><span class="hs-identifier hs-var">cborHex</span></a></span><span>
</span><span id="line-1619"></span><span>
</span><span id="line-1620"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682950677"><span class="annot"><span class="annottext">Percentage
</span><a href="#local-6989586621682950677"><span class="hs-identifier hs-var">percentage</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Either MkPercentageError Percentage
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkPercentage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">%</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-1621"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950676"><span class="annot"><span class="annottext">poolId' :: PoolId
</span><a href="#local-6989586621682950676"><span class="hs-identifier hs-var hs-var">poolId'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; PoolId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">PoolId</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;\187\DC1L\179}u\250\ENQ&amp;\ETX(\194\&amp;5\163\218\226\149\163=\v\166t\165\235\RS&gt;V\142&quot;</span></span><span>
</span><span id="line-1622"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950675"><span class="annot"><span class="annottext">containRegPool :: [ApiAnyCertificate n] -&gt; Bool
</span><a href="#local-6989586621682950675"><span class="hs-identifier hs-var hs-var">containRegPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAnyCertificate n -&gt; [ApiAnyCertificate n] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">elem</span></a></span><span>
</span><span id="line-1623"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiRegisterPool -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiRegisterPool -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">StakePoolRegister</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRegisterPool :: ApiT PoolId
-&gt; [ApiT PoolOwner]
-&gt; Quantity &quot;percent&quot; Percentage
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Maybe (ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash)
-&gt; ApiRegisterPool
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiRegisterPool</span></a></span><span>
</span><span id="line-1624"></span><span>                 </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:poolId:ApiRegisterPool :: ApiT PoolId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">poolId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682950676"><span class="hs-identifier hs-var">poolId'</span></a></span><span>
</span><span id="line-1625"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:poolOwners:ApiRegisterPool :: [ApiT PoolOwner]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">poolOwners</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PoolOwner -&gt; ApiT PoolOwner
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method -&gt; PoolOwner
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">PoolOwner</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;\DC2H'\240\159mP)\164k}\t\133J\198\169\171\SYN\243\169\145\195\226\177\154\192)Q&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1626"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:poolMargin:ApiRegisterPool :: Quantity &quot;percent&quot; Percentage
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">poolMargin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Percentage -&gt; Quantity &quot;percent&quot; Percentage
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Percentage
</span><a href="#local-6989586621682950677"><span class="hs-identifier hs-var">percentage</span></a></span><span>
</span><span id="line-1627"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:poolCost:ApiRegisterPool :: Quantity &quot;lovelace&quot; Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">poolCost</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1628"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:poolPledge:ApiRegisterPool :: Quantity &quot;lovelace&quot; Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">poolPledge</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1000000000000</span></span><span>
</span><span id="line-1629"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:poolMetadata:ApiRegisterPool :: Maybe (ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">poolMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1630"></span><span>                         </span><span class="annot"><span class="annottext">(ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash)
-&gt; Maybe (ApiT StakePoolMetadataUrl, ApiT StakePoolMetadataHash)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakePoolMetadataUrl -&gt; ApiT StakePoolMetadataUrl
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; StakePoolMetadataUrl
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">StakePoolMetadataUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;http://localhost:44107/metadata.json&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span>                              </span><span class="hs-special">,</span><span class="annot"><span class="annottext">StakePoolMetadataHash -&gt; ApiT StakePoolMetadataHash
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method -&gt; StakePoolMetadataHash
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">StakePoolMetadataHash</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;\241\148\ESC\ACK\216\137\161\169\189\138}\215-!`\170)M\129\164IO\153\&amp;5&lt;k\187\DC2\aF\128\137&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1632"></span><span>                 </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1633"></span><span>
</span><span id="line-1634"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950663"><span class="annot"><span class="annottext">containDeregPool :: [ApiAnyCertificate n] -&gt; Bool
</span><a href="#local-6989586621682950663"><span class="hs-identifier hs-var hs-var">containDeregPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAnyCertificate n -&gt; [ApiAnyCertificate n] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">elem</span></a></span><span>
</span><span id="line-1635"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiDeregisterPool -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiDeregisterPool -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">StakePoolDeregister</span></a></span><span> </span><span class="annot"><span class="annottext">ApiDeregisterPool :: ApiT PoolId -&gt; ApiT EpochNo -&gt; ApiDeregisterPool
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDeregisterPool</span></a></span><span>
</span><span id="line-1636"></span><span>                 </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:poolId:ApiDeregisterPool :: ApiT PoolId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">poolId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PoolId -&gt; ApiT PoolId
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682950676"><span class="hs-identifier hs-var">poolId'</span></a></span><span>
</span><span id="line-1637"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:retirementEpoch:ApiDeregisterPool :: ApiT EpochNo
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">retirementEpoch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; ApiT EpochNo
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word31 -&gt; EpochNo
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">EpochNo</span></a></span><span> </span><span class="annot"><span class="annottext">Word31
</span><span class="hs-number">1000000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1638"></span><span>                 </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950657"><span class="annot"><span class="annottext">decodePayloadJoin :: Payload
</span><a href="#local-6989586621682950657"><span class="hs-identifier hs-var hs-var">decodePayloadJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{cborHexPool}
          }|]</span></span><span>
</span><span id="line-1643"></span><span>        </span><span id="local-6989586621682950656"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950656"><span class="hs-identifier hs-var">rTxJoin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950682"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1644"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950680"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950657"><span class="hs-identifier hs-var">decodePayloadJoin</span></a></span><span>
</span><span id="line-1645"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950656"><span class="hs-identifier hs-var">rTxJoin</span></a></span><span>
</span><span id="line-1646"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1647"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950655"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; ([ApiAnyCertificate n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; Bool
forall (n :: NetworkDiscriminant). [ApiAnyCertificate n] -&gt; Bool
</span><a href="#local-6989586621682950675"><span class="hs-identifier hs-var">containRegPool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950654"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; ([ApiAnyCertificate n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; Bool
forall (n :: NetworkDiscriminant). [ApiAnyCertificate n] -&gt; Bool
</span><a href="#local-6989586621682950663"><span class="hs-identifier hs-var">containDeregPool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1649"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1650"></span><span>
</span><span id="line-1651"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_01d - single-output transaction with missing covering inputs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950653"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950653"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1652"></span><span>
</span><span id="line-1653"></span><span>        </span><span class="hs-comment">-- constructing source wallet</span><span>
</span><span id="line-1654"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950652"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950652"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">110_000_000_000</span></span><span>
</span><span id="line-1655"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950651"><span class="annot"><span class="annottext">inpAmt :: Natural
</span><a href="#local-6989586621682950651"><span class="hs-identifier hs-var hs-var">inpAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950653"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1656"></span><span>        </span><span id="local-6989586621682950650"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950650"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950653"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950652"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1657"></span><span>
</span><span id="line-1658"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950649"><span class="annot"><span class="annottext">serializedTx :: Text
</span><a href="#local-6989586621682950649"><span class="hs-identifier hs-var hs-var">serializedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1659"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;84a600818258200eaa33be8780935ca5a7c1e628a2d54402446f96236ca8f1\
                \770e07fa22ba86480d0d800182825839010acce4f85ade867308f048fe4516\
                \c0383b38cc04602ea6f7a6a1e75f29450899547b0e4bb194132452d45fea30\
                \212aebeafc69bca8744ea61a002dc67e8258390110a9b4666ba80e4878491d\
                \1ac20465c9893a8df5581dc705770626203d4d23fe6a7acdda5a1b41f56100\
                \f02bfa270a3c560c4e55cf8312331b00000017484721ca021a0001ffb80319\
                \8d280e80a0f5f6&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-1666"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950648"><span class="annot"><span class="annottext">balancePayload :: Payload
</span><a href="#local-6989586621682950648"><span class="hs-identifier hs-var hs-var">balancePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{serializedTx},
              &quot;redeemers&quot;: [],
              &quot;inputs&quot;: [
                  { &quot;id&quot; : &quot;0eaa33be8780935ca5a7c1e628a2d54402446f96236ca8f1770e07fa22ba8648&quot;
                  , &quot;index&quot;: 13
                  , &quot;address&quot;: &quot;addr1vxtlefx3dd5ga5d3cqcfycxsc5tv20txpx7qlmlt2kwnfds2mywcr&quot;
                  , &quot;amount&quot;:
                      { &quot;quantity&quot;: #{inpAmt}
                      , &quot;unit&quot;: &quot;lovelace&quot;
                      }
                  , &quot;assets&quot;: []
                  }
              ]
            }|]</span></span><span>
</span><span id="line-1681"></span><span>        </span><span id="local-6989586621682950647"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950647"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950653"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1682"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950650"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950648"><span class="hs-identifier hs-var">balancePayload</span></a></span><span>
</span><span id="line-1683"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950647"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1684"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1685"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1686"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1687"></span><span>
</span><span id="line-1688"></span><span>        </span><span class="hs-comment">-- let apiTx = getFromResponse #transaction rTx</span><span>
</span><span id="line-1689"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1690"></span><span>        </span><span class="hs-comment">-- signedTx &lt;- signTx ctx wa apiTx [ expectResponseCode HTTP.status202 ]</span><span>
</span><span id="line-1691"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1692"></span><span>        </span><span class="hs-comment">-- void $ submitTx ctx signedTx [ expectResponseCode HTTP.status202 ]</span><span>
</span><span id="line-1693"></span><span>
</span><span id="line-1694"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_01e - plutus with missing covering inputs wallet enough funds&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950645"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950645"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1695"></span><span>
</span><span id="line-1696"></span><span>        </span><span class="hs-comment">-- constructing source wallet</span><span>
</span><span id="line-1697"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950644"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950644"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">110_000_000_000</span></span><span>
</span><span id="line-1698"></span><span>        </span><span id="local-6989586621682950643"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950643"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950645"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950644"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1699"></span><span>
</span><span id="line-1700"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950642"><span class="annot"><span class="annottext">balancePayload :: Payload
</span><a href="#local-6989586621682950642"><span class="hs-identifier hs-var hs-var">balancePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
              &quot;transaction&quot;: #{serializedPlutusTx},
              &quot;redeemers&quot;: [],
              &quot;inputs&quot;: [
                  { &quot;id&quot; : &quot;888963613d2bb4c5c55cee335f724624cbc54b185ecaa2fb1eb07545ed5db421&quot;
                  , &quot;index&quot;: 1
                  , &quot;address&quot;: &quot;addr1wygn2yjfcgmahn3d62f7wqylstqzlde34s6p0w4esnfzsyqwr2xhg&quot;
                  , &quot;amount&quot;:
                      { &quot;quantity&quot;: 10
                      , &quot;unit&quot;: &quot;lovelace&quot;
                      }
                  , &quot;assets&quot;: []
                  }
              ]
          }|]</span></span><span>
</span><span id="line-1715"></span><span>        </span><span id="local-6989586621682950640"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950640"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950645"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1716"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950643"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950642"><span class="hs-identifier hs-var">balancePayload</span></a></span><span>
</span><span id="line-1717"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950640"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1718"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1719"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1720"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1721"></span><span>
</span><span id="line-1722"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_02a - Cannot balance on empty wallet&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1723"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950639"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950639"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1724"></span><span>        </span><span id="local-6989586621682950638"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950638"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950639"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1725"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950637"><span class="annot"><span class="annottext">balancePayload :: Payload
</span><a href="#local-6989586621682950637"><span class="hs-identifier hs-var hs-var">balancePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="Test.Integration.Plutus.html#pingPong_1"><span class="hs-identifier hs-var">PlutusScenario.pingPong_1</span></a></span><span>
</span><span id="line-1726"></span><span>        </span><span id="local-6989586621682950635"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950635"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950639"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1727"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950638"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950637"><span class="hs-identifier hs-var">balancePayload</span></a></span><span>
</span><span id="line-1728"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950635"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1729"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-1730"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403NotEnoughMoney"><span class="hs-identifier hs-var">errMsg403NotEnoughMoney</span></a></span><span>
</span><span id="line-1731"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1732"></span><span>
</span><span id="line-1733"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_02b - Cannot balance when I cannot afford fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1734"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950634"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950634"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1735"></span><span>        </span><span id="local-6989586621682950633"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950633"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950634"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1_000_000</span></span><span class="hs-special">]</span><span>
</span><span id="line-1736"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950632"><span class="annot"><span class="annottext">balancePayload :: Payload
</span><a href="#local-6989586621682950632"><span class="hs-identifier hs-var hs-var">balancePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="Test.Integration.Plutus.html#pingPong_1"><span class="hs-identifier hs-var">PlutusScenario.pingPong_1</span></a></span><span>
</span><span id="line-1737"></span><span>        </span><span id="local-6989586621682950631"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950631"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950634"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1738"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950633"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950632"><span class="hs-identifier hs-var">balancePayload</span></a></span><span>
</span><span id="line-1739"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950631"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1740"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-1741"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403Fee"><span class="hs-identifier hs-var">errMsg403Fee</span></a></span><span>
</span><span id="line-1742"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1743"></span><span>
</span><span id="line-1744"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_02c - \
        \Cannot balance when I cannot afford collateral&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1746"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950630"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1747"></span><span>        </span><span id="local-6989586621682950629"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950629"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1748"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2_500_000</span></span><span>
</span><span id="line-1749"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2_500_000</span></span><span>
</span><span id="line-1750"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1751"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950628"><span class="annot"><span class="annottext">toBalance :: Payload
</span><a href="#local-6989586621682950628"><span class="hs-identifier hs-var hs-var">toBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="Test.Integration.Plutus.html#pingPong_1"><span class="hs-identifier hs-var">PlutusScenario.pingPong_1</span></a></span><span>
</span><span id="line-1752"></span><span>        </span><span id="local-6989586621682950627"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950627"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1753"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950629"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950628"><span class="hs-identifier hs-var">toBalance</span></a></span><span>
</span><span id="line-1754"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950627"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1755"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1756"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1757"></span><span>
</span><span id="line-1758"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950626"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950626"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950625"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950627"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1759"></span><span>        </span><span id="local-6989586621682950624"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950624"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950629"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950626"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1760"></span><span>        </span><span id="local-6989586621682950623"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950623"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950629"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950624"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1761"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950623"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1762"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1763"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1764"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1765"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950622"><span class="annot"><span class="annottext">txId :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950622"><span class="hs-identifier hs-var hs-var">txId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
(ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;))) -&gt; ApiTxId -&gt; f ApiTxId
</span><a href="#local-6989586621682950621"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950623"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1766"></span><span>
</span><span id="line-1767"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForTxImmutability"><span class="hs-identifier hs-var">waitForTxImmutability</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1768"></span><span>        </span><span id="local-6989586621682950620"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950620"><span class="hs-identifier hs-var">partialTx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadFail m) =&gt;
Value -&gt; m Value
</span><a href="Test.Integration.Plutus.html#pingPong_2"><span class="hs-identifier hs-var">PlutusScenario.pingPong_2</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ResourceT IO Value) -&gt; Value -&gt; ResourceT IO Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.object</span></a></span><span>
</span><span id="line-1769"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;transactionId&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ApiT (Hash &quot;Tx&quot;) -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950622"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1770"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950618"><span class="annot"><span class="annottext">toBalance' :: Payload
</span><a href="#local-6989586621682950618"><span class="hs-identifier hs-var hs-var">toBalance'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950620"><span class="hs-identifier hs-var">partialTx'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1771"></span><span>
</span><span id="line-1772"></span><span>        </span><span id="local-6989586621682950617"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950617"><span class="hs-identifier hs-var">rTx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1773"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950629"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950618"><span class="hs-identifier hs-var">toBalance'</span></a></span><span>
</span><span id="line-1774"></span><span>
</span><span id="line-1775"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682950616"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950616"><span class="hs-identifier hs-var">requiredAmt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950615"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950615"><span class="hs-identifier hs-var">largestFound</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1776"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950630"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; ApiEra -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiBabbage</span></a></span><span>
</span><span id="line-1777"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;4.279050&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[2.852700]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1778"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;4.280100&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[2.853400]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1779"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950617"><span class="hs-identifier hs-var">rTx'</span></a></span><span>
</span><span id="line-1780"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-1781"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403Collateral"><span class="hs-identifier hs-var">errMsg403Collateral</span></a></span><span>
</span><span id="line-1782"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; (Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ResourceT IO ())
-&gt; String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1783"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;I need an ada amount of at least: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950616"><span class="hs-identifier hs-var">requiredAmt</span></a></span><span>
</span><span id="line-1784"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; (Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ResourceT IO ())
-&gt; String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1785"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The largest combination of pure ada UTxOs I could find is: &quot;</span></span><span>
</span><span id="line-1786"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950615"><span class="hs-identifier hs-var">largestFound</span></a></span><span>
</span><span id="line-1787"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1788"></span><span>
</span><span id="line-1789"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_03 - I can balance base-64 encoded tx&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1790"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950613"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950613"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1791"></span><span>        </span><span id="local-6989586621682950612"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950612"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950613"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1792"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950611"><span class="annot"><span class="annottext">pingPong1Base64 :: Payload
</span><a href="#local-6989586621682950611"><span class="hs-identifier hs-var hs-var">pingPong1Base64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
            &quot;transaction&quot;: &quot;hKUAgA2AAYGDWB1xTXLPVpozmhin2TAjE5g/VuDZbNRb3LHWUS3KahoAHoSAWCCSORjkA79Dw0tO9rSOsu4Eur7RcyDY0bn/mtCG6G9E7AIADoChBIHYeYD19g==&quot;,
            &quot;redeemers&quot;: [],
            &quot;inputs&quot;: []
        }|]</span></span><span>
</span><span id="line-1797"></span><span>        </span><span id="local-6989586621682950610"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950610"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950613"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1798"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950612"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950611"><span class="hs-identifier hs-var">pingPong1Base64</span></a></span><span>
</span><span id="line-1799"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950610"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1800"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1801"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1802"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1803"></span><span>
</span><span id="line-1804"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950609"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950609"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950608"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950610"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1805"></span><span>
</span><span id="line-1806"></span><span>        </span><span id="local-6989586621682950607"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950607"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950613"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950612"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950609"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1807"></span><span>
</span><span id="line-1808"></span><span>        </span><span id="local-6989586621682950606"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950606"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950613"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950612"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950607"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1809"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950606"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1810"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1811"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1812"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_04a - \
        \I get proper error message when payload is not hex or base64 encoded&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1816"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950605"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950605"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1817"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; IO ()
String -&gt; IO ()
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">pendingWith</span></a></span><span>
</span><span id="line-1818"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ADP-1225: revise error messages to reflect supported formats&quot;</span></span><span>
</span><span id="line-1819"></span><span>        </span><span id="local-6989586621682950604"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950604"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950605"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1820"></span><span>        </span><span class="hs-comment">-- transaction is invalid hex / base64</span><span>
</span><span id="line-1821"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950603"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950603"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
            &quot;transaction&quot;: &quot;!!!!#&quot;,
            &quot;redeemers&quot;: [],
            &quot;inputs&quot;: []
        }|]</span></span><span>
</span><span id="line-1826"></span><span>        </span><span id="local-6989586621682950602"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950602"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950605"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1827"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950604"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950603"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1828"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950602"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1829"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-1830"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parse error. Expecting CBOR-encoded transaction represented in either hex or base64 encoding.&quot;</span></span><span>
</span><span id="line-1831"></span><span>            </span><span class="hs-comment">-- returns: Parse error. Expecting Base64-encoded format.</span><span>
</span><span id="line-1832"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1833"></span><span>
</span><span id="line-1834"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_04b - \
        \I get proper error message when payload cannot be decoded&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1836"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950601"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950601"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1837"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; IO ()
String -&gt; IO ()
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">pendingWith</span></a></span><span>
</span><span id="line-1838"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ADP-1225: revise error messages to reflect supported formats&quot;</span></span><span>
</span><span id="line-1839"></span><span>        </span><span id="local-6989586621682950600"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950600"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950601"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1840"></span><span>        </span><span class="hs-comment">-- transaction is a VALID hex, but invalid transaction format</span><span>
</span><span id="line-1841"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950599"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950599"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
            &quot;transaction&quot;: &quot;11&quot;,
            &quot;redeemers&quot;: [],
            &quot;inputs&quot;: []
        }|]</span></span><span>
</span><span id="line-1846"></span><span>        </span><span id="local-6989586621682950598"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950598"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950601"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1847"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950600"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950599"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1848"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950598"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1849"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-1850"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parse error. Cannot deserialize transaction. Make sure it is valid CBOR-encoded transaction represented in either hex or base64 encoding.&quot;</span></span><span>
</span><span id="line-1851"></span><span>            </span><span class="hs-comment">-- returns: Parse error. Expecting Base64-encoded format.</span><span>
</span><span id="line-1852"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1853"></span><span>
</span><span id="line-1854"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_04c - \
        \I get proper error message when payload cannot be decoded&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1856"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950597"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950597"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1857"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; IO ()
String -&gt; IO ()
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">pendingWith</span></a></span><span>
</span><span id="line-1858"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ADP-1225: revise error messages to reflect supported formats&quot;</span></span><span>
</span><span id="line-1859"></span><span>        </span><span id="local-6989586621682950596"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950596"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950597"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1860"></span><span>        </span><span class="hs-comment">-- transaction is a VALID hex, but invalid transaction format</span><span>
</span><span id="line-1861"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950595"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950595"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
            &quot;transaction&quot;: &quot;11111&quot;,
            &quot;redeemers&quot;: [],
            &quot;inputs&quot;: []
        }|]</span></span><span>
</span><span id="line-1866"></span><span>        </span><span id="local-6989586621682950594"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950594"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950597"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1867"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950596"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950595"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1868"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950594"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1869"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-1870"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parse error. Cannot deserialize transaction. Make sure it is valid CBOR-encoded transaction represented in either hex or base64 encoding.&quot;</span></span><span>
</span><span id="line-1871"></span><span>            </span><span class="hs-comment">-- returns: Parse error. Expecting Base64-encoded format.</span><span>
</span><span id="line-1872"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1873"></span><span>
</span><span id="line-1874"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_04d - \
        \I get proper error message when payload cannot be decoded&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1876"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950593"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950593"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1877"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; IO ()
String -&gt; IO ()
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">pendingWith</span></a></span><span>
</span><span id="line-1878"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ADP-1225: revise error messages to reflect supported formats&quot;</span></span><span>
</span><span id="line-1879"></span><span>        </span><span id="local-6989586621682950592"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950592"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950593"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1880"></span><span>        </span><span class="hs-comment">-- transaction is a VALID base64, but invalid transaction format</span><span>
</span><span id="line-1881"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950591"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950591"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
            &quot;transaction&quot;: &quot;EQ==&quot;,
            &quot;redeemers&quot;: [],
            &quot;inputs&quot;: []
        }|]</span></span><span>
</span><span id="line-1886"></span><span>        </span><span id="local-6989586621682950590"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950590"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950593"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1887"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950592"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950591"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1888"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950590"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1889"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-1890"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parse error. Cannot deserialize transaction. Make sure it is valid CBOR-encoded transaction represented in either hex or base64 encoding.&quot;</span></span><span>
</span><span id="line-1891"></span><span>            </span><span class="hs-comment">-- returns: Deserialisation failure while decoding Shelley Tx. CBOR failed with error: DeserialiseFailure 0 'expected list len or indef'</span><span>
</span><span id="line-1892"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1893"></span><span>
</span><span id="line-1894"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_BALANCE_05/ADP-1286 - \
        \I can balance correctly in case I need to spend my remaining ADA for fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1896"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950589"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950589"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1897"></span><span>        </span><span id="local-6989586621682950588"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950588"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950589"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3_000_000</span></span><span class="hs-special">]</span><span>
</span><span id="line-1898"></span><span>        </span><span class="hs-comment">-- PlutusScenario.pingPong_1 is sending out 2&#8371; therefore tx fee</span><span>
</span><span id="line-1899"></span><span>        </span><span class="hs-comment">-- needs to be 1&#8371; to comply with minUTxOValue constraint</span><span>
</span><span id="line-1900"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950587"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682950587"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1_000_000</span></span><span>
</span><span id="line-1901"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950586"><span class="annot"><span class="annottext">balancePayload :: Payload
</span><a href="#local-6989586621682950586"><span class="hs-identifier hs-var hs-var">balancePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="Test.Integration.Plutus.html#pingPong_1"><span class="hs-identifier hs-var">PlutusScenario.pingPong_1</span></a></span><span>
</span><span id="line-1902"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950585"><span class="annot"><span class="annottext">hasExpectedFee :: [(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682950585"><span class="hs-identifier hs-var hs-var">hasExpectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682950584"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiDecodedTransaction n
-&gt; f (ApiDecodedTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950583"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950587"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1903"></span><span>
</span><span id="line-1904"></span><span>        </span><span id="local-6989586621682950582"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950582"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950589"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1905"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950588"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950586"><span class="hs-identifier hs-var">balancePayload</span></a></span><span>
</span><span id="line-1906"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950582"><span class="hs-identifier hs-var">rTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1907"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950581"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950581"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950580"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSerialisedTransaction)
</span><a href="#local-6989586621682950582"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-1908"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950579"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682950579"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950581"><span class="hs-identifier hs-var">apiTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1909"></span><span>
</span><span id="line-1910"></span><span>        </span><span id="local-6989586621682950578"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950578"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950589"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1911"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950588"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950579"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-1912"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950578"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682950585"><span class="hs-identifier hs-var">hasExpectedFee</span></a></span><span>
</span><span id="line-1913"></span><span>
</span><span id="line-1914"></span><span>        </span><span id="local-6989586621682950577"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950577"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950589"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950588"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950581"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1915"></span><span>        </span><span id="local-6989586621682950576"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950576"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950589"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950588"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950577"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1916"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950576"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1917"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1918"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1919"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1920"></span><span>
</span><span id="line-1921"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is as expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1922"></span><span>            </span><span id="local-6989586621682950575"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950575"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950589"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1923"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950588"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-1924"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950575"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-1925"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1926"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-1927"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950574"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950573"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950572"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1929"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1930"></span><span>
</span><span id="line-1931"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_SIGN_01 - Sign single-output transaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950571"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950571"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1932"></span><span>        </span><span id="local-6989586621682950570"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950570"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950571"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1933"></span><span>
</span><span id="line-1934"></span><span>        </span><span class="hs-comment">-- Construct tx</span><span>
</span><span id="line-1935"></span><span>        </span><span id="local-6989586621682950569"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950569"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; ResourceT IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950571"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950570"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ResourceT IO Payload)
-&gt; Natural -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950571"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1936"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950568"><span class="annot"><span class="annottext">constructEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950568"><span class="hs-identifier hs-var hs-var">constructEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950570"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1937"></span><span>        </span><span id="local-6989586621682950567"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950567"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950566"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiConstructTransaction n))
 -&gt; ApiT SealedTx)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO (ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-1938"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950571"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950568"><span class="hs-identifier hs-var">constructEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950569"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1939"></span><span>
</span><span id="line-1940"></span><span>        </span><span class="hs-comment">-- Sign tx</span><span>
</span><span id="line-1941"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950565"><span class="annot"><span class="annottext">toSign :: Payload
</span><a href="#local-6989586621682950565"><span class="hs-identifier hs-var hs-var">toSign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;transaction&quot;: #{sealedTx}
                , &quot;passphrase&quot;: #{fixturePassphrase}
                }|]</span></span><span>
</span><span id="line-1945"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950564"><span class="annot"><span class="annottext">signEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950564"><span class="hs-identifier hs-var hs-var">signEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.signTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950570"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1946"></span><span>        </span><span id="local-6989586621682950562"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950562"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction ApiSerialisedTransaction
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSerialisedTransaction ApiSerialisedTransaction
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ApiSerialisedTransaction)
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ApiSerialisedTransaction
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-1947"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950571"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950564"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950565"><span class="hs-identifier hs-var">toSign</span></a></span><span>
</span><span id="line-1948"></span><span>
</span><span id="line-1949"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-1950"></span><span>        </span><span id="local-6989586621682950560"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950560"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950571"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950570"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950562"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1951"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950560"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1952"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1953"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1954"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1955"></span><span>
</span><span id="line-1956"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_SIGN_02 - Rejects unsigned transaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950559"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950559"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1957"></span><span>        </span><span id="local-6989586621682950558"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950558"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950559"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1958"></span><span>
</span><span id="line-1959"></span><span>        </span><span class="hs-comment">-- Construct tx</span><span>
</span><span id="line-1960"></span><span>        </span><span id="local-6989586621682950557"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950557"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; ResourceT IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950559"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950558"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ResourceT IO Payload)
-&gt; Natural -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950559"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1961"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950556"><span class="annot"><span class="annottext">constructEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950556"><span class="hs-identifier hs-var hs-var">constructEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950558"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1962"></span><span>        </span><span id="local-6989586621682950555"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950555"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950554"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiConstructTransaction n))
 -&gt; ApiT SealedTx)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO (ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-1963"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950559"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950556"><span class="hs-identifier hs-var">constructEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950557"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1964"></span><span>
</span><span id="line-1965"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-1966"></span><span>        </span><span id="local-6989586621682950553"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950553"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950559"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950558"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950555"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1967"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950553"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1968"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-1969"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MissingWitsInTransaction"><span class="hs-identifier hs-var">errMsg403MissingWitsInTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1970"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1971"></span><span>
</span><span id="line-1972"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_SIGN_03 - Sign withdrawals&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950552"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950552"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1973"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682950551"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950551"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mnemonic 24
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950552"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-1974"></span><span>
</span><span id="line-1975"></span><span>        </span><span class="hs-comment">-- Construct tx</span><span>
</span><span id="line-1976"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950550"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950550"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{&quot;withdrawal&quot;: &quot;self&quot;}|]</span></span><span>
</span><span id="line-1977"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950549"><span class="annot"><span class="annottext">constructEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950549"><span class="hs-identifier hs-var hs-var">constructEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950551"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1978"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950548"><span class="annot"><span class="annottext">ApiConstructTransaction n
</span><a href="#local-6989586621682950548"><span class="hs-identifier hs-var">apiTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, ApiConstructTransaction n)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950552"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950549"><span class="hs-identifier hs-var">constructEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950550"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-1979"></span><span>        </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiCoinSelection n -&gt; [ApiCoinSelectionWithdrawal n]
forall (n :: NetworkDiscriminant).
ApiCoinSelection n -&gt; [ApiCoinSelectionWithdrawal n]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">withdrawals</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelection n -&gt; [ApiCoinSelectionWithdrawal n])
-&gt; ApiCoinSelection n -&gt; [ApiCoinSelectionWithdrawal n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransaction n -&gt; ApiCoinSelection n
forall (n :: NetworkDiscriminant).
ApiConstructTransaction n -&gt; ApiCoinSelection n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransaction n
</span><a href="#local-6989586621682950548"><span class="hs-identifier hs-var">apiTx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span>        </span><span class="hs-comment">-- Sign tx</span><span>
</span><span id="line-1982"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950546"><span class="annot"><span class="annottext">sealedTx :: ApiT SealedTx
</span><a href="#local-6989586621682950546"><span class="hs-identifier hs-var hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiConstructTransaction n
</span><a href="#local-6989586621682950548"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiConstructTransaction n
-&gt; ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
    -&gt; ApiConstructTransaction n
    -&gt; Const (ApiT SealedTx) (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiConstructTransaction n
   -&gt; Const (ApiT SealedTx) (ApiConstructTransaction n))
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiConstructTransaction n
-&gt; Const (ApiT SealedTx) (ApiConstructTransaction n)
</span><a href="#local-6989586621682950545"><span class="hs-var">#transaction</span></a></span><span>
</span><span id="line-1983"></span><span>            </span><span id="local-6989586621682950544"><span class="annot"><span class="annottext">toSign :: Payload
</span><a href="#local-6989586621682950544"><span class="hs-identifier hs-var hs-var">toSign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;transaction&quot;: #{sealedTx}
                , &quot;passphrase&quot;: #{fixturePassphrase}
                }|]</span></span><span>
</span><span id="line-1987"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950543"><span class="annot"><span class="annottext">signEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950543"><span class="hs-identifier hs-var hs-var">signEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.signTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950551"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1988"></span><span>        </span><span id="local-6989586621682950542"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950542"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction ApiSerialisedTransaction
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSerialisedTransaction ApiSerialisedTransaction
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span>
</span><span id="line-1989"></span><span>            </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ApiSerialisedTransaction)
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ApiSerialisedTransaction
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950552"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950543"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950544"><span class="hs-identifier hs-var">toSign</span></a></span><span>
</span><span id="line-1990"></span><span>
</span><span id="line-1991"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-1992"></span><span>        </span><span id="local-6989586621682950541"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950541"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950552"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950551"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950542"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-1993"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950541"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-1994"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-1995"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-1996"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-1997"></span><span>
</span><span id="line-1998"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_SIGN_04 - Sign extra required signatures&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950540"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950540"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1999"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682950539"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950539"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950538"><span class="annot"><span class="annottext">Mnemonic 15
</span><a href="#local-6989586621682950538"><span class="hs-identifier hs-var">mw</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Mnemonic 15)
-&gt; (ApiWallet, [Text]) -&gt; (ApiWallet, Mnemonic 15)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (n :: Nat) (csz :: Nat).
(ConsistentEntropy n 15 csz, EntropySize 15 ~ n, HasCallStack) =&gt;
[Text] -&gt; Mnemonic 15
forall (mw :: Nat) (n :: Nat) (csz :: Nat).
(ConsistentEntropy n mw csz, EntropySize mw ~ n, HasCallStack) =&gt;
[Text] -&gt; Mnemonic mw
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">unsafeMkMnemonic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">15</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ApiWallet, [Text]) -&gt; (ApiWallet, Mnemonic 15))
-&gt; ResourceT IO (ApiWallet, [Text])
-&gt; ResourceT IO (ApiWallet, Mnemonic 15)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy &quot;shelley&quot; -&gt; Context -&gt; ResourceT IO (ApiWallet, [Text])
forall (m :: * -&gt; *) (scheme :: Symbol).
(MonadIO m, NextWallet scheme) =&gt;
Proxy scheme -&gt; Context -&gt; ResourceT m (ApiWallet, [Text])
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWithMnemonics"><span class="hs-identifier hs-var">fixtureWalletWithMnemonics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy &quot;shelley&quot;
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;shelley&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950540"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2000"></span><span>
</span><span id="line-2001"></span><span>        </span><span class="hs-comment">-- Construct tx</span><span>
</span><span id="line-2002"></span><span>        </span><span id="local-6989586621682950537"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950537"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; ResourceT IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950540"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950539"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ResourceT IO Payload)
-&gt; Natural -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950540"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2003"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950536"><span class="annot"><span class="annottext">constructEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950536"><span class="hs-identifier hs-var hs-var">constructEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950539"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-2004"></span><span>        </span><span id="local-6989586621682950535"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682950535"><span class="hs-identifier hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) SealedTx
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiT SealedTx -&gt; f (ApiT SealedTx))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950534"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT SealedTx -&gt; f (ApiT SealedTx))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((SealedTx -&gt; f SealedTx) -&gt; ApiT SealedTx -&gt; f (ApiT SealedTx))
-&gt; (SealedTx -&gt; f SealedTx)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((SealedTx -&gt; f SealedTx) -&gt; ApiT SealedTx -&gt; f (ApiT SealedTx))
(SealedTx -&gt; f SealedTx) -&gt; ApiT SealedTx -&gt; f (ApiT SealedTx)
</span><a href="#local-6989586621682950533"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiConstructTransaction n))
 -&gt; SealedTx)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO SealedTx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2005"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950540"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950536"><span class="hs-identifier hs-var">constructEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950537"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2006"></span><span>
</span><span id="line-2007"></span><span>        </span><span class="hs-comment">-- NOTE: Picking a key that is</span><span>
</span><span id="line-2008"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2009"></span><span>        </span><span class="hs-comment">-- (a) known of the wallet (so within the address pool gap)</span><span>
</span><span id="line-2010"></span><span>        </span><span class="hs-comment">-- (b) not to small, so that it's not already present from the selected</span><span>
</span><span id="line-2011"></span><span>        </span><span class="hs-comment">-- inputs witnesses!</span><span>
</span><span id="line-2012"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950532"><span class="annot"><span class="annottext">rootSk :: ShelleyKey 'RootK XPrv
</span><a href="#local-6989586621682950532"><span class="hs-identifier hs-var hs-var">rootSk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SomeMnemonic, Maybe SomeMnemonic)
-&gt; Passphrase &quot;encryption&quot; -&gt; ShelleyKey 'RootK XPrv
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Shelley.generateKeyFromSeed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mnemonic 15 -&gt; SomeMnemonic
forall (mw :: Nat). KnownNat mw =&gt; Mnemonic mw -&gt; SomeMnemonic
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">SomeMnemonic</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic 15
</span><a href="#local-6989586621682950538"><span class="hs-identifier hs-var">mw</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SomeMnemonic
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-2013"></span><span>            </span><span id="local-6989586621682950529"><span class="annot"><span class="annottext">acctSk :: ShelleyKey 'AccountK XPrv
</span><a href="#local-6989586621682950529"><span class="hs-identifier hs-var hs-var">acctSk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
-&gt; ShelleyKey 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; ShelleyKey 'AccountK XPrv
forall (key :: Depth -&gt; * -&gt; *).
HardDerivation key =&gt;
Passphrase &quot;encryption&quot;
-&gt; key 'RootK XPrv
-&gt; Index 'Hardened 'AccountK
-&gt; key 'AccountK XPrv
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">deriveAccountPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'RootK XPrv
</span><a href="#local-6989586621682950532"><span class="hs-identifier hs-var">rootSk</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'AccountK
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span>
</span><span id="line-2014"></span><span>            </span><span id="local-6989586621682950526"><span class="annot"><span class="annottext">addrSk :: ShelleyKey 'AddressK XPrv
</span><a href="#local-6989586621682950526"><span class="hs-identifier hs-var hs-var">addrSk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
-&gt; ShelleyKey 'AccountK XPrv
-&gt; Role
-&gt; Index (AddressIndexDerivationType ShelleyKey) 'AddressK
-&gt; ShelleyKey 'AddressK XPrv
forall (key :: Depth -&gt; * -&gt; *).
HardDerivation key =&gt;
Passphrase &quot;encryption&quot;
-&gt; key 'AccountK XPrv
-&gt; Role
-&gt; Index (AddressIndexDerivationType key) 'AddressK
-&gt; key 'AddressK XPrv
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">deriveAddressPrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AccountK XPrv
</span><a href="#local-6989586621682950529"><span class="hs-identifier hs-var">acctSk</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UtxoExternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Index 'Soft 'AddressK
forall a. Enum a =&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toEnum</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">14</span></span><span class="hs-special">)</span><span>
</span><span id="line-2015"></span><span>            </span><span id="local-6989586621682950522"><span class="annot"><span class="annottext">addrVk :: XPub
</span><a href="#local-6989586621682950522"><span class="hs-identifier hs-var hs-var">addrVk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AddressK XPub -&gt; XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth) raw.
WalletKey key =&gt;
key depth raw -&gt; raw
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">getRawKey</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyKey 'AddressK XPub -&gt; XPub)
-&gt; ShelleyKey 'AddressK XPub -&gt; XPub
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AddressK XPrv -&gt; ShelleyKey 'AddressK XPub
forall (key :: Depth -&gt; * -&gt; *) (depth :: Depth).
WalletKey key =&gt;
key depth XPrv -&gt; key depth XPub
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">publicKey</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyKey 'AddressK XPrv
</span><a href="#local-6989586621682950526"><span class="hs-identifier hs-var">addrSk</span></a></span><span>
</span><span id="line-2016"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950519"><span class="annot"><span class="annottext">apiTx' :: ApiT SealedTx
</span><a href="#local-6989586621682950519"><span class="hs-identifier hs-var hs-var">apiTx'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; ApiT SealedTx
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682950535"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; [XPub] -&gt; SealedTx
</span><a href="#local-6989586621682950518"><span class="hs-operator hs-var">`addRequiredSigners`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">XPub
</span><a href="#local-6989586621682950522"><span class="hs-identifier hs-var">addrVk</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2017"></span><span>
</span><span id="line-2018"></span><span>        </span><span class="hs-comment">-- Sign Tx</span><span>
</span><span id="line-2019"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950517"><span class="annot"><span class="annottext">toSign :: Payload
</span><a href="#local-6989586621682950517"><span class="hs-identifier hs-var hs-var">toSign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;transaction&quot;: #{apiTx'}
                , &quot;passphrase&quot;: #{fixturePassphrase}
                }|]</span></span><span>
</span><span id="line-2023"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950516"><span class="annot"><span class="annottext">signEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950516"><span class="hs-identifier hs-var hs-var">signEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.signTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950539"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-2024"></span><span>        </span><span id="local-6989586621682950515"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950515"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction ApiSerialisedTransaction
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSerialisedTransaction ApiSerialisedTransaction
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ApiSerialisedTransaction)
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ApiSerialisedTransaction
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2025"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950540"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950516"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950517"><span class="hs-identifier hs-var">toSign</span></a></span><span>
</span><span id="line-2026"></span><span>
</span><span id="line-2027"></span><span>        </span><span class="hs-comment">-- Submit Tx</span><span>
</span><span id="line-2028"></span><span>        </span><span class="hs-comment">-- TODO:</span><span>
</span><span id="line-2029"></span><span>        </span><span class="hs-comment">-- The submission currently fails because we manually add the</span><span>
</span><span id="line-2030"></span><span>        </span><span class="hs-comment">-- 'requiredSigners' to the transaction and it becomes unbalanced. BUT,</span><span>
</span><span id="line-2031"></span><span>        </span><span class="hs-comment">-- it fails not because of a missing signature, but because the fees are</span><span>
</span><span id="line-2032"></span><span>        </span><span class="hs-comment">-- too small, which is good enough for this test... Yet really, we</span><span>
</span><span id="line-2033"></span><span>        </span><span class="hs-comment">-- should be able to construct transactions with extra signers from the</span><span>
</span><span id="line-2034"></span><span>        </span><span class="hs-comment">-- API!</span><span>
</span><span id="line-2035"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-2036"></span><span>        </span><span class="hs-comment">-- Update July 2022: For some reason the tx is now accepted. This may be</span><span>
</span><span id="line-2037"></span><span>        </span><span class="hs-comment">-- because of fee overestimation . Ideally fees should be as small as</span><span>
</span><span id="line-2038"></span><span>        </span><span class="hs-comment">-- possible, and this would fail.</span><span>
</span><span id="line-2039"></span><span>        </span><span id="local-6989586621682950514"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950514"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950540"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950539"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950515"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-2040"></span><span>
</span><span id="line-2041"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950514"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-2042"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2043"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2044"></span><span>
</span><span id="line-2045"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_SUBMIT_01 - Submitting on foreign wallet is forbidden&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2046"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950513"><span class="annot"><span class="annottext">scenarios :: [(String, Context -&gt; ResourceT IO ApiWallet)]
</span><a href="#local-6989586621682950513"><span class="hs-identifier hs-var hs-var">scenarios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2047"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;empty&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2048"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fixture&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2049"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-2050"></span><span>        </span><span class="annot"><span class="annottext">[(String, Context -&gt; ResourceT IO ApiWallet)]
-&gt; ((String, Context -&gt; ResourceT IO ApiWallet)
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Context -&gt; ResourceT IO ApiWallet)]
</span><a href="#local-6989586621682950513"><span class="hs-identifier hs-var">scenarios</span></a></span><span> </span><span class="annot"><span class="annottext">(((String, Context -&gt; ResourceT IO ApiWallet) -&gt; SpecWith Context)
 -&gt; SpecWith Context)
-&gt; ((String, Context -&gt; ResourceT IO ApiWallet)
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682950512"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950512"><span class="hs-identifier hs-var">title</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950511"><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
</span><a href="#local-6989586621682950511"><span class="hs-identifier hs-var">foreignWallet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950512"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950510"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2051"></span><span>            </span><span id="local-6989586621682950509"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950509"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2052"></span><span>            </span><span id="local-6989586621682950508"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950508"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
</span><a href="#local-6989586621682950511"><span class="hs-identifier hs-var">foreignWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2053"></span><span>
</span><span id="line-2054"></span><span>            </span><span class="hs-comment">-- Construct tx</span><span>
</span><span id="line-2055"></span><span>            </span><span id="local-6989586621682950507"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950507"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; ResourceT IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950508"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ResourceT IO Payload)
-&gt; Natural -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2056"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950506"><span class="annot"><span class="annottext">constructEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950506"><span class="hs-identifier hs-var hs-var">constructEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950509"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-2057"></span><span>            </span><span id="local-6989586621682950505"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950505"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950504"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiConstructTransaction n))
 -&gt; ApiT SealedTx)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO (ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2058"></span><span>                </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950506"><span class="hs-identifier hs-var">constructEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950507"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2059"></span><span>
</span><span id="line-2060"></span><span>            </span><span class="hs-comment">-- Sign tx</span><span>
</span><span id="line-2061"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950503"><span class="annot"><span class="annottext">toSign :: Payload
</span><a href="#local-6989586621682950503"><span class="hs-identifier hs-var hs-var">toSign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                    { &quot;transaction&quot;: #{sealedTx}
                    , &quot;passphrase&quot;: #{fixturePassphrase}
                    }|]</span></span><span>
</span><span id="line-2065"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950502"><span class="annot"><span class="annottext">signEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950502"><span class="hs-identifier hs-var hs-var">signEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.signTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950509"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-2066"></span><span>            </span><span id="local-6989586621682950501"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950501"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction ApiSerialisedTransaction
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSerialisedTransaction ApiSerialisedTransaction
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ApiSerialisedTransaction)
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ApiSerialisedTransaction
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2067"></span><span>                </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950502"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950503"><span class="hs-identifier hs-var">toSign</span></a></span><span>
</span><span id="line-2068"></span><span>
</span><span id="line-2069"></span><span>            </span><span class="hs-comment">-- Submit tx (from wb)</span><span>
</span><span id="line-2070"></span><span>            </span><span id="local-6989586621682950500"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950500"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950510"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950508"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950501"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-2071"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950500"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-2072"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-2073"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403ForeignTransaction"><span class="hs-identifier hs-var">errMsg403ForeignTransaction</span></a></span><span>
</span><span id="line-2074"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2075"></span><span>
</span><span id="line-2076"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_SUBMIT_02 - Submitting on foreign Byron wallet is forbidden&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2077"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950499"><span class="annot"><span class="annottext">scenarios :: [(String, Context -&gt; ResourceT IO ApiByronWallet)]
</span><a href="#local-6989586621682950499"><span class="hs-identifier hs-var hs-var">scenarios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2078"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Byron random&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiByronWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiByronWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyRandomWallet"><span class="hs-identifier hs-var">emptyRandomWallet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2079"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Byron icarus&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiByronWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiByronWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyIcarusWallet"><span class="hs-identifier hs-var">emptyIcarusWallet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2080"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-2081"></span><span>        </span><span class="annot"><span class="annottext">[(String, Context -&gt; ResourceT IO ApiByronWallet)]
-&gt; ((String, Context -&gt; ResourceT IO ApiByronWallet)
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Context -&gt; ResourceT IO ApiByronWallet)]
</span><a href="#local-6989586621682950499"><span class="hs-identifier hs-var">scenarios</span></a></span><span> </span><span class="annot"><span class="annottext">(((String, Context -&gt; ResourceT IO ApiByronWallet)
  -&gt; SpecWith Context)
 -&gt; SpecWith Context)
-&gt; ((String, Context -&gt; ResourceT IO ApiByronWallet)
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682950498"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950498"><span class="hs-identifier hs-var">title</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950497"><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiByronWallet
</span><a href="#local-6989586621682950497"><span class="hs-identifier hs-var">foreignByronWallet</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950498"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950496"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2082"></span><span>            </span><span id="local-6989586621682950495"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950495"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2083"></span><span>            </span><span id="local-6989586621682950494"><span class="annot"><span class="annottext">ApiByronWallet
</span><a href="#local-6989586621682950494"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiByronWallet
</span><a href="#local-6989586621682950497"><span class="hs-identifier hs-var">foreignByronWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2084"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950493"><span class="annot"><span class="annottext">wid :: Text
</span><a href="#local-6989586621682950493"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiByronWallet
</span><a href="#local-6989586621682950494"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">ApiByronWallet
-&gt; ((Text -&gt; Const Text Text)
    -&gt; ApiByronWallet -&gt; Const Text ApiByronWallet)
-&gt; Text
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Const Text Text)
-&gt; ApiByronWallet -&gt; Const Text ApiByronWallet
forall s. HasType (ApiT WalletId) s =&gt; Lens' s Text
</span><a href="Test.Integration.Framework.DSL.html#walletId"><span class="hs-identifier hs-var">walletId</span></a></span><span>
</span><span id="line-2085"></span><span>
</span><span id="line-2086"></span><span>            </span><span class="hs-comment">-- Construct tx</span><span>
</span><span id="line-2087"></span><span>            </span><span id="local-6989586621682950492"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950492"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; ResourceT IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950495"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ResourceT IO Payload)
-&gt; Natural -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2088"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950491"><span class="annot"><span class="annottext">constructEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950491"><span class="hs-identifier hs-var hs-var">constructEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950495"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-2089"></span><span>            </span><span id="local-6989586621682950490"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950490"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950489"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiConstructTransaction n))
 -&gt; ApiT SealedTx)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO (ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2090"></span><span>                </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950491"><span class="hs-identifier hs-var">constructEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950492"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2091"></span><span>
</span><span id="line-2092"></span><span>            </span><span class="hs-comment">-- Sign tx</span><span>
</span><span id="line-2093"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950488"><span class="annot"><span class="annottext">toSign :: Payload
</span><a href="#local-6989586621682950488"><span class="hs-identifier hs-var hs-var">toSign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                    { &quot;transaction&quot;: #{sealedTx}
                    , &quot;passphrase&quot;: #{fixturePassphrase}
                    }|]</span></span><span>
</span><span id="line-2097"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950487"><span class="annot"><span class="annottext">signEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950487"><span class="hs-identifier hs-var hs-var">signEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.signTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950495"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-2098"></span><span>            </span><span id="local-6989586621682950486"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950486"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction ApiSerialisedTransaction
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSerialisedTransaction ApiSerialisedTransaction
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ApiSerialisedTransaction)
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ApiSerialisedTransaction
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2099"></span><span>                </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950487"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950488"><span class="hs-identifier hs-var">toSign</span></a></span><span>
</span><span id="line-2100"></span><span>
</span><span id="line-2101"></span><span>            </span><span class="hs-comment">-- Submit tx (from wb)</span><span>
</span><span id="line-2102"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950485"><span class="annot"><span class="annottext">submitEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950485"><span class="hs-identifier hs-var hs-var">submitEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;POST&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;v2/wallets/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950493"><span class="hs-identifier hs-var">wid</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/transactions-submit&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2103"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950484"><span class="annot"><span class="annottext">submitPayload :: Payload
</span><a href="#local-6989586621682950484"><span class="hs-identifier hs-var hs-var">submitPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Payload) -&gt; Value -&gt; Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950486"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-2104"></span><span>            </span><span id="local-6989586621682950483"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950483"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950496"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950485"><span class="hs-identifier hs-var">submitEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950484"><span class="hs-identifier hs-var">submitPayload</span></a></span><span>
</span><span id="line-2105"></span><span>
</span><span id="line-2106"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950483"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-2107"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status404</span></a></span><span>
</span><span id="line-2108"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="Test.Integration.Framework.TestData.html#errMsg404NoWallet"><span class="hs-identifier hs-var">errMsg404NoWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950493"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2109"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2110"></span><span>
</span><span id="line-2111"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_SUBMIT_03 - Can submit transaction encoded in base16&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950481"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950481"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2112"></span><span>        </span><span id="local-6989586621682950480"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950480"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950481"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2113"></span><span>
</span><span id="line-2114"></span><span>        </span><span class="hs-comment">-- Construct tx</span><span>
</span><span id="line-2115"></span><span>        </span><span id="local-6989586621682950479"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950479"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; ResourceT IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950481"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950480"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ResourceT IO Payload)
-&gt; Natural -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950481"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2116"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950478"><span class="annot"><span class="annottext">constructEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950478"><span class="hs-identifier hs-var hs-var">constructEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950480"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-2117"></span><span>        </span><span id="local-6989586621682950477"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950477"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950476"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiConstructTransaction n))
 -&gt; ApiT SealedTx)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO (ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2118"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950481"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950478"><span class="hs-identifier hs-var">constructEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950479"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2119"></span><span>
</span><span id="line-2120"></span><span>        </span><span class="hs-comment">-- Sign tx</span><span>
</span><span id="line-2121"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950475"><span class="annot"><span class="annottext">toSign :: Payload
</span><a href="#local-6989586621682950475"><span class="hs-identifier hs-var hs-var">toSign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;transaction&quot;: #{sealedTx}
                , &quot;passphrase&quot;: #{fixturePassphrase}
                }|]</span></span><span>
</span><span id="line-2125"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950474"><span class="annot"><span class="annottext">signEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950474"><span class="hs-identifier hs-var hs-var">signEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.signTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950480"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-2126"></span><span>        </span><span id="local-6989586621682950473"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950473"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950472"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiSerialisedTransaction)
 -&gt; ApiT SealedTx)
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO (ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2127"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiSerialisedTransaction)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950481"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950474"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950475"><span class="hs-identifier hs-var">toSign</span></a></span><span>
</span><span id="line-2128"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950471"><span class="annot"><span class="annottext">signedTxHex :: Text
</span><a href="#local-6989586621682950471"><span class="hs-identifier hs-var hs-var">signedTxHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Text
</span><a href="Test.Integration.Plutus.html#toHex"><span class="hs-identifier hs-var">PlutusScenario.toHex</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; Text) -&gt; Method -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; Method
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">serialisedTx</span></a></span><span> </span><span class="annot"><span class="annottext">(SealedTx -&gt; Method) -&gt; SealedTx -&gt; Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; SealedTx
forall a. ApiT a -&gt; a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950473"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-2129"></span><span>
</span><span id="line-2130"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-2131"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950468"><span class="annot"><span class="annottext">submitEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950468"><span class="hs-identifier hs-var hs-var">submitEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.submitTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950480"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-2132"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950466"><span class="annot"><span class="annottext">toSend :: Payload
</span><a href="#local-6989586621682950466"><span class="hs-identifier hs-var hs-var">toSend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;transaction&quot;: #{signedTxHex}
                }|]</span></span><span>
</span><span id="line-2135"></span><span>        </span><span id="local-6989586621682950465"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950465"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950481"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950468"><span class="hs-identifier hs-var">submitEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950466"><span class="hs-identifier hs-var">toSend</span></a></span><span>
</span><span id="line-2136"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950465"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-2137"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2138"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2139"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2140"></span><span>
</span><span id="line-2141"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Plutus scenarios&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2142"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950464"><span class="annot"><span class="annottext">scenarios :: [(String,
  Context
  -&gt; ApiWallet
  -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value]),
  [(Status, Either RequestException (ApiDecodedTransaction n))
   -&gt; ResourceT IO ()])]
</span><a href="#local-6989586621682950464"><span class="hs-identifier hs-var hs-var">scenarios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2143"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ping-pong&quot;</span></span><span>
</span><span id="line-2144"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Value, [Value -&gt; ResourceT IO Value])
-&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-2145"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="Test.Integration.Plutus.html#pingPong_1"><span class="hs-identifier hs-var">PlutusScenario.pingPong_1</span></a></span><span>
</span><span id="line-2146"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadFail m) =&gt;
Value -&gt; m Value
</span><a href="Test.Integration.Plutus.html#pingPong_2"><span class="hs-identifier hs-var">PlutusScenario.pingPong_2</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2147"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-2148"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2149"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-2150"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;game state-machine&quot;</span></span><span>
</span><span id="line-2151"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Context
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Value, [Value -&gt; ResourceT IO Value])
-&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-2152"></span><span>                      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="Test.Integration.Plutus.html#game_1"><span class="hs-identifier hs-var">PlutusScenario.game_1</span></a></span><span>
</span><span id="line-2153"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadFail m) =&gt;
Value -&gt; m Value
</span><a href="Test.Integration.Plutus.html#game_2"><span class="hs-identifier hs-var">PlutusScenario.game_2</span></a></span><span>
</span><span id="line-2154"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadFail m) =&gt;
Value -&gt; m Value
</span><a href="Test.Integration.Plutus.html#game_3"><span class="hs-identifier hs-var">PlutusScenario.game_3</span></a></span><span>
</span><span id="line-2155"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-2156"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-2157"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2158"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-2159"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mint-burn&quot;</span></span><span>
</span><span id="line-2160"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950460"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950460"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682950459"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950459"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2161"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621682950458"><span class="annot"><span class="annottext">ApiVerificationKeyShelley
</span><a href="#local-6989586621682950458"><span class="hs-identifier hs-var">_vk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950457"><span class="annot"><span class="annottext">ApiT (Hash &quot;VerificationKey&quot;)
</span><a href="#local-6989586621682950457"><span class="hs-identifier hs-var">vkHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ResourceT
     IO (ApiVerificationKeyShelley, ApiT (Hash &quot;VerificationKey&quot;))
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; ApiWallet
-&gt; m (ApiVerificationKeyShelley, ApiT (Hash &quot;VerificationKey&quot;))
</span><a href="Test.Integration.Framework.DSL.html#getSomeVerificationKey"><span class="hs-identifier hs-var">getSomeVerificationKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950460"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950459"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-2162"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682950456"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950456"><span class="hs-identifier hs-var">policy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950455"><span class="annot"><span class="annottext">ApiT (Hash &quot;TokenPolicy&quot;)
</span><a href="#local-6989586621682950455"><span class="hs-identifier hs-var">policyId'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; (Text, ApiT (Hash &quot;TokenPolicy&quot;))
</span><a href="Test.Integration.Plutus.html#mkSignerPolicy"><span class="hs-identifier hs-var">PlutusScenario.mkSignerPolicy</span></a></span><span>
</span><span id="line-2163"></span><span>                                </span><span class="annot"><span class="">[json|{
                                    &quot;vkHash&quot;: #{vkHash} }
                                |]</span></span><span>
</span><span id="line-2166"></span><span>                        </span><span id="local-6989586621682950453"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950453"><span class="hs-identifier hs-var">mint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadFail m) =&gt;
Value -&gt; m Value
</span><a href="Test.Integration.Plutus.html#mintBurn_1"><span class="hs-identifier hs-var">PlutusScenario.mintBurn_1</span></a></span><span> </span><span class="annot"><span class="">[json|{
                            &quot;policy&quot;: #{policy},
                            &quot;policyId&quot;: #{policyId'},
                            &quot;vkHash&quot;: #{vkHash}
                        }|]</span></span><span>
</span><span id="line-2171"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950451"><span class="annot"><span class="annottext">burn :: Value -&gt; ResourceT IO Value
</span><a href="#local-6989586621682950451"><span class="hs-identifier hs-var hs-var">burn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
forall (m :: * -&gt; *).
(MonadUnliftIO m, MonadFail m) =&gt;
Value -&gt; m Value
</span><a href="Test.Integration.Plutus.html#mintBurn_2"><span class="hs-identifier hs-var">PlutusScenario.mintBurn_2</span></a></span><span> </span><span class="annot"><span class="">[json|{
                                &quot;policy&quot;: #{policy},
                                &quot;policyId&quot;: #{policyId'},
                                &quot;vkHash&quot;: #{vkHash}
                            }|]</span></span><span>
</span><span id="line-2176"></span><span>                        </span><span class="annot"><span class="annottext">(Value, [Value -&gt; ResourceT IO Value])
-&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950453"><span class="hs-identifier hs-var">mint</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
</span><a href="#local-6989586621682950451"><span class="hs-identifier hs-var">burn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2177"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2178"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-2179"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;withdrawal&quot;</span></span><span>
</span><span id="line-2180"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950449"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950449"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682950448"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950448"><span class="hs-identifier hs-var">_w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2181"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621682950447"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950447"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950446"><span class="annot"><span class="annottext">ApiT (Hash &quot;TokenPolicy&quot;)
</span><a href="#local-6989586621682950446"><span class="hs-identifier hs-var">_scriptHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text, ApiT (Hash &quot;TokenPolicy&quot;))
</span><a href="Test.Integration.Plutus.html#alwaysTrueValidator"><span class="hs-identifier hs-var">PlutusScenario.alwaysTrueValidator</span></a></span><span>
</span><span id="line-2182"></span><span>                        </span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; (Method, Coin) -&gt; IO ()
</span><a href="Test.Integration.Framework.Context.html#_moveRewardsToScript"><span class="hs-identifier hs-var hs-var">_moveRewardsToScript</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950449"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2183"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Method
forall b. (HasCallStack, ByteArray b) =&gt; Method -&gt; b
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">unsafeFromHex</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; Method) -&gt; Method -&gt; Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Method
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950447"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-2184"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Coin
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">42000000</span></span><span>
</span><span id="line-2185"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-2186"></span><span>                        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForNextEpoch"><span class="hs-identifier hs-var">waitForNextEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950449"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2187"></span><span>                        </span><span id="local-6989586621682950441"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950441"><span class="hs-identifier hs-var">withdrawal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ResourceT IO Value
forall (m :: * -&gt; *). (MonadUnliftIO m, MonadFail m) =&gt; m Value
</span><a href="Test.Integration.Plutus.html#withdrawScript_1"><span class="hs-identifier hs-var">PlutusScenario.withdrawScript_1</span></a></span><span>
</span><span id="line-2188"></span><span>                        </span><span class="annot"><span class="annottext">(Value, [Value -&gt; ResourceT IO Value])
-&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950441"><span class="hs-identifier hs-var">withdrawal</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2189"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2190"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-2191"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;currency&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950439"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950439"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682950438"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950438"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2192"></span><span>                    </span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; String -&gt; IO ()
String -&gt; IO ()
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">pendingWith</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;flaky #3124&quot;</span></span><span>
</span><span id="line-2193"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621682950437"><span class="annot"><span class="annottext">ApiT Address
</span><a href="#local-6989586621682950437"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621682950436"><span class="annot"><span class="annottext">Proxy n
</span><a href="#local-6989586621682950436"><span class="hs-identifier hs-var">proxy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950435"><span class="hs-var">#id</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; ([ApiAddress n] -&gt; ApiAddress n)
-&gt; [ApiAddress n]
-&gt; (ApiT Address, Proxy n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; ApiAddress n
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; (ApiT Address, Proxy n))
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO (ApiT Address, Proxy n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950439"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950438"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-2194"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950433"><span class="annot"><span class="annottext">getFreshUTxO :: ResourceT IO (Either RequestException (ApiWalletInput n))
</span><a href="#local-6989586621682950433"><span class="hs-identifier hs-var hs-var">getFreshUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2195"></span><span>                            </span><span class="hs-comment">-- To obtain a fresh UTxO, we perform</span><span>
</span><span id="line-2196"></span><span>                            </span><span class="hs-comment">-- coin selection and just pick the first input</span><span>
</span><span id="line-2197"></span><span>                            </span><span class="hs-comment">-- that has been selected.</span><span>
</span><span id="line-2198"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950432"><span class="annot"><span class="annottext">singleton :: a -&gt; NonEmpty a
</span><a href="#local-6989586621682950432"><span class="hs-identifier hs-var hs-var">singleton</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; NonEmpty a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-comment">-- specialized to NonEmpty</span><span>
</span><span id="line-2199"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950431"><span class="annot"><span class="annottext">Either RequestException (ApiCoinSelection n)
</span><a href="#local-6989586621682950431"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier hs-var">selectCoins</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950439"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950438"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (AddressAmount (ApiT Address, Proxy n))
 -&gt; ResourceT
      IO (Status, Either RequestException (ApiCoinSelection n)))
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2200"></span><span>                                </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; NonEmpty a
</span><a href="#local-6989586621682950432"><span class="hs-identifier hs-var">singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressAmount (ApiT Address, Proxy n)
 -&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n)))
-&gt; AddressAmount (ApiT Address, Proxy n)
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount :: forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">AddressAmount</span></a></span><span>
</span><span id="line-2201"></span><span>                                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:AddressAmount :: (ApiT Address, Proxy n)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT Address
</span><a href="#local-6989586621682950437"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proxy n
</span><a href="#local-6989586621682950436"><span class="hs-identifier hs-var">proxy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2202"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:AddressAmount :: Quantity &quot;lovelace&quot; Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">amount</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">10_000_000</span></span><span>
</span><span id="line-2203"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:AddressAmount :: ApiT TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span>
</span><span id="line-2204"></span><span>                                    </span><span class="hs-special">}</span><span>
</span><span id="line-2205"></span><span>                            </span><span class="annot"><span class="annottext">Either RequestException (ApiWalletInput n)
-&gt; ResourceT IO (Either RequestException (ApiWalletInput n))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either RequestException (ApiWalletInput n)
 -&gt; ResourceT IO (Either RequestException (ApiWalletInput n)))
-&gt; Either RequestException (ApiWalletInput n)
-&gt; ResourceT IO (Either RequestException (ApiWalletInput n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ApiWalletInput n
forall a. [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiWalletInput n] -&gt; ApiWalletInput n)
-&gt; (ApiCoinSelection n -&gt; [ApiWalletInput n])
-&gt; ApiCoinSelection n
-&gt; ApiWalletInput n
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(([ApiWalletInput n]
  -&gt; Const [ApiWalletInput n] [ApiWalletInput n])
 -&gt; ApiCoinSelection n
 -&gt; Const [ApiWalletInput n] (ApiCoinSelection n))
-&gt; ApiCoinSelection n -&gt; [ApiWalletInput n]
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n]
    -&gt; Const [ApiWalletInput n] [ApiWalletInput n])
   -&gt; ApiCoinSelection n
   -&gt; Const [ApiWalletInput n] (ApiCoinSelection n))
([ApiWalletInput n] -&gt; Const [ApiWalletInput n] [ApiWalletInput n])
-&gt; ApiCoinSelection n
-&gt; Const [ApiWalletInput n] (ApiCoinSelection n)
</span><a href="#local-6989586621682950426"><span class="hs-var">#inputs</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelection n -&gt; ApiWalletInput n)
-&gt; Either RequestException (ApiCoinSelection n)
-&gt; Either RequestException (ApiWalletInput n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Either RequestException (ApiCoinSelection n)
</span><a href="#local-6989586621682950431"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-2206"></span><span>                    </span><span id="local-6989586621682950425"><span class="annot"><span class="annottext">ApiWalletInput n
</span><a href="#local-6989586621682950425"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either RequestException (ApiWalletInput n)
-&gt; ResourceT IO (ApiWalletInput n)
forall e (m :: * -&gt; *) a.
(Exception e, MonadIO m) =&gt;
Either e a -&gt; m a
</span><a href="../../../../unliftio/html/src"><span class="hs-identifier hs-var">fromEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either RequestException (ApiWalletInput n)
 -&gt; ResourceT IO (ApiWalletInput n))
-&gt; ResourceT IO (Either RequestException (ApiWalletInput n))
-&gt; ResourceT IO (ApiWalletInput n)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Either RequestException (ApiWalletInput n))
</span><a href="#local-6989586621682950433"><span class="hs-identifier hs-var">getFreshUTxO</span></a></span><span>
</span><span id="line-2207"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950423"><span class="annot"><span class="annottext">mint :: Value
</span><a href="#local-6989586621682950423"><span class="hs-identifier hs-var hs-var">mint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletInput n -&gt; Value
forall (n :: NetworkDiscriminant).
EncodeAddress n =&gt;
ApiWalletInput n -&gt; Value
</span><a href="Test.Integration.Plutus.html#currencyTx"><span class="hs-identifier hs-var">PlutusScenario.currencyTx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletInput n
</span><a href="#local-6989586621682950425"><span class="hs-identifier hs-var">txOutRef</span></a></span><span>
</span><span id="line-2208"></span><span>                    </span><span class="annot"><span class="annottext">(Value, [Value -&gt; ResourceT IO Value])
-&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950423"><span class="hs-identifier hs-var">mint</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2209"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2210"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-2211"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2212"></span><span>
</span><span id="line-2213"></span><span>        </span><span class="annot"><span class="annottext">[(String,
  Context
  -&gt; ApiWallet
  -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value]),
  [(Status, Either RequestException (ApiDecodedTransaction n))
   -&gt; ResourceT IO ()])]
-&gt; ((String,
     Context
     -&gt; ApiWallet
     -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value]),
     [(Status, Either RequestException (ApiDecodedTransaction n))
      -&gt; ResourceT IO ()])
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(String,
  Context
  -&gt; ApiWallet
  -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value]),
  [(Status, Either RequestException (ApiDecodedTransaction n))
   -&gt; ResourceT IO ()])]
</span><a href="#local-6989586621682950464"><span class="hs-identifier hs-var">scenarios</span></a></span><span> </span><span class="annot"><span class="annottext">(((String,
   Context
   -&gt; ApiWallet
   -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value]),
   [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()])
  -&gt; SpecWith Context)
 -&gt; SpecWith Context)
-&gt; ((String,
     Context
     -&gt; ApiWallet
     -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value]),
     [(Status, Either RequestException (ApiDecodedTransaction n))
      -&gt; ResourceT IO ()])
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682950421"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950421"><span class="hs-identifier hs-var">title</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950420"><span class="annot"><span class="annottext">Context
-&gt; ApiWallet -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value])
</span><a href="#local-6989586621682950420"><span class="hs-identifier hs-var">setupContract</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950419"><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682950419"><span class="hs-identifier hs-var">decodeExp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682950421"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950418"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2214"></span><span>            </span><span id="local-6989586621682950417"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950417"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2215"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950416"><span class="annot"><span class="annottext">balanceEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950416"><span class="hs-identifier hs-var hs-var">balanceEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.balanceTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950417"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-2216"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950415"><span class="annot"><span class="annottext">signEndpoint :: (Method, Text)
</span><a href="#local-6989586621682950415"><span class="hs-identifier hs-var hs-var">signEndpoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.signTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950417"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-2217"></span><span>
</span><span id="line-2218"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682950414"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950414"><span class="hs-identifier hs-var">setup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950413"><span class="annot"><span class="annottext">[Value -&gt; ResourceT IO Value]
</span><a href="#local-6989586621682950413"><span class="hs-identifier hs-var">steps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet -&gt; ResourceT IO (Value, [Value -&gt; ResourceT IO Value])
</span><a href="#local-6989586621682950420"><span class="hs-identifier hs-var">setupContract</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950417"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-2219"></span><span>
</span><span id="line-2220"></span><span>            </span><span class="hs-comment">-- Balance</span><span>
</span><span id="line-2221"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950412"><span class="annot"><span class="annottext">toBalance :: Payload
</span><a href="#local-6989586621682950412"><span class="hs-identifier hs-var hs-var">toBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950414"><span class="hs-identifier hs-var">setup</span></a></span><span>
</span><span id="line-2222"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950411"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950411"><span class="hs-identifier hs-var">sealedTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; ApiT SealedTx)
-&gt; (Status, ApiSerialisedTransaction) -&gt; (Status, ApiT SealedTx)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
 -&gt; ApiSerialisedTransaction
 -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction -&gt; ApiT SealedTx
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction
   -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiSerialisedTransaction
-&gt; Const (ApiT SealedTx) ApiSerialisedTransaction
</span><a href="#local-6989586621682950410"><span class="hs-var">#transaction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Status, ApiSerialisedTransaction) -&gt; (Status, ApiT SealedTx))
-&gt; ResourceT IO (Status, ApiSerialisedTransaction)
-&gt; ResourceT IO (Status, ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2223"></span><span>                </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, ApiSerialisedTransaction)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950416"><span class="hs-identifier hs-var">balanceEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950412"><span class="hs-identifier hs-var">toBalance</span></a></span><span>
</span><span id="line-2224"></span><span>
</span><span id="line-2225"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950409"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682950409"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950411"><span class="hs-identifier hs-var">sealedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2226"></span><span>            </span><span id="local-6989586621682950408"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950408"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2227"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950417"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950409"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-2228"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950408"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682950419"><span class="hs-identifier hs-var">decodeExp</span></a></span><span>
</span><span id="line-2229"></span><span>
</span><span id="line-2230"></span><span>            </span><span class="hs-comment">-- Sign</span><span>
</span><span id="line-2231"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950407"><span class="annot"><span class="annottext">toSign :: Payload
</span><a href="#local-6989586621682950407"><span class="hs-identifier hs-var hs-var">toSign</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                    { &quot;transaction&quot;: #{sealedTx}
                    , &quot;passphrase&quot;: #{fixturePassphrase}
                    }|]</span></span><span>
</span><span id="line-2235"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950406"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950406"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2236"></span><span>                </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, ApiSerialisedTransaction)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950415"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950407"><span class="hs-identifier hs-var">toSign</span></a></span><span>
</span><span id="line-2237"></span><span>
</span><span id="line-2238"></span><span>            </span><span class="hs-comment">-- Submit</span><span>
</span><span id="line-2239"></span><span>            </span><span id="local-6989586621682950405"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950405"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950417"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950406"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-2240"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950405"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-2241"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2242"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2243"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2244"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950404"><span class="annot"><span class="annottext">txid :: ApiTxId
</span><a href="#local-6989586621682950404"><span class="hs-identifier hs-var hs-var">txid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId ApiTxId
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiTxId
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiTxId ApiTxId
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950405"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-2245"></span><span>
</span><span id="line-2246"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950403"><span class="annot"><span class="annottext">runStep :: ApiTxId -&gt; (Value -&gt; ResourceT IO Value) -&gt; ResourceT IO ApiTxId
</span><a href="#local-6989586621682950403"><span class="hs-identifier hs-var hs-var">runStep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950402"><span class="annot"><span class="annottext">ApiTxId
</span><a href="#local-6989586621682950402"><span class="hs-identifier hs-var">previous</span></a></span></span><span> </span><span id="local-6989586621682950401"><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
</span><a href="#local-6989586621682950401"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2247"></span><span>                    </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForTxImmutability"><span class="hs-identifier hs-var">waitForTxImmutability</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2248"></span><span>
</span><span id="line-2249"></span><span>                    </span><span class="hs-comment">-- Balance</span><span>
</span><span id="line-2250"></span><span>                    </span><span id="local-6989586621682950400"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950400"><span class="hs-identifier hs-var">partialTx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; ResourceT IO Value
</span><a href="#local-6989586621682950401"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ResourceT IO Value) -&gt; Value -&gt; ResourceT IO Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">Aeson.object</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;transactionId&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ApiT (Hash &quot;Tx&quot;) -&gt; Pair
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="../../../../aeson/html/src"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT (Hash &quot;Tx&quot;) -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiT (Hash &quot;Tx&quot;)))
 -&gt; ApiTxId -&gt; Const (ApiT (Hash &quot;Tx&quot;)) ApiTxId)
-&gt; ApiTxId -&gt; ApiT (Hash &quot;Tx&quot;)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; Const (ApiT (Hash &quot;Tx&quot;)) ApiTxId)
(ApiT (Hash &quot;Tx&quot;) -&gt; Const (ApiT (Hash &quot;Tx&quot;)) (ApiT (Hash &quot;Tx&quot;)))
-&gt; ApiTxId -&gt; Const (ApiT (Hash &quot;Tx&quot;)) ApiTxId
</span><a href="#local-6989586621682950399"><span class="hs-var">#id</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxId
</span><a href="#local-6989586621682950402"><span class="hs-identifier hs-var">previous</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2251"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950398"><span class="annot"><span class="annottext">toBalance' :: Payload
</span><a href="#local-6989586621682950398"><span class="hs-identifier hs-var hs-var">toBalance'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950400"><span class="hs-identifier hs-var">partialTx'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2252"></span><span>
</span><span id="line-2253"></span><span>                    </span><span class="hs-comment">-- Sign</span><span>
</span><span id="line-2254"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950397"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950397"><span class="hs-identifier hs-var">sealedTx'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; ApiT SealedTx)
-&gt; (Status, ApiSerialisedTransaction) -&gt; (Status, ApiT SealedTx)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">second</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
 -&gt; ApiSerialisedTransaction
 -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
-&gt; ApiSerialisedTransaction -&gt; ApiT SealedTx
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction
   -&gt; Const (ApiT SealedTx) ApiSerialisedTransaction)
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiSerialisedTransaction
-&gt; Const (ApiT SealedTx) ApiSerialisedTransaction
</span><a href="#local-6989586621682950396"><span class="hs-var">#transaction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Status, ApiSerialisedTransaction) -&gt; (Status, ApiT SealedTx))
-&gt; ResourceT IO (Status, ApiSerialisedTransaction)
-&gt; ResourceT IO (Status, ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2255"></span><span>                        </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, ApiSerialisedTransaction)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950416"><span class="hs-identifier hs-var">balanceEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950398"><span class="hs-identifier hs-var">toBalance'</span></a></span><span>
</span><span id="line-2256"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950395"><span class="annot"><span class="annottext">toSign' :: Payload
</span><a href="#local-6989586621682950395"><span class="hs-identifier hs-var hs-var">toSign'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                            { &quot;transaction&quot;: #{sealedTx'}
                            , &quot;passphrase&quot;: #{fixturePassphrase}
                            }|]</span></span><span>
</span><span id="line-2260"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682950394"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950394"><span class="hs-identifier hs-var">signedTx'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2261"></span><span>                        </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, ApiSerialisedTransaction)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950415"><span class="hs-identifier hs-var">signEndpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950395"><span class="hs-identifier hs-var">toSign'</span></a></span><span>
</span><span id="line-2262"></span><span>
</span><span id="line-2263"></span><span>                    </span><span class="hs-comment">-- Submit</span><span>
</span><span id="line-2264"></span><span>                    </span><span id="local-6989586621682950393"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950393"><span class="hs-identifier hs-var">submittedTx'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950418"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950417"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950394"><span class="hs-identifier hs-var">signedTx'</span></a></span><span>
</span><span id="line-2265"></span><span>                    </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950393"><span class="hs-identifier hs-var">submittedTx'</span></a></span><span>
</span><span id="line-2266"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2267"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2268"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-2269"></span><span>                    </span><span class="annot"><span class="annottext">ApiTxId -&gt; ResourceT IO ApiTxId
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxId -&gt; ResourceT IO ApiTxId)
-&gt; ApiTxId -&gt; ResourceT IO ApiTxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId ApiTxId
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiTxId
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiTxId ApiTxId
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950393"><span class="hs-identifier hs-var">submittedTx'</span></a></span><span>
</span><span id="line-2270"></span><span>
</span><span id="line-2271"></span><span>            </span><span class="annot"><span class="annottext">(ApiTxId -&gt; (Value -&gt; ResourceT IO Value) -&gt; ResourceT IO ApiTxId)
-&gt; ApiTxId -&gt; [Value -&gt; ResourceT IO Value] -&gt; ResourceT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldM_</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxId -&gt; (Value -&gt; ResourceT IO Value) -&gt; ResourceT IO ApiTxId
</span><a href="#local-6989586621682950403"><span class="hs-identifier hs-var">runStep</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxId
</span><a href="#local-6989586621682950404"><span class="hs-identifier hs-var">txid</span></a></span><span> </span><span class="annot"><span class="annottext">[Value -&gt; ResourceT IO Value]
</span><a href="#local-6989586621682950413"><span class="hs-identifier hs-var">steps</span></a></span><span>
</span><span id="line-2272"></span><span>
</span><span id="line-2273"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_JOIN_01a - Can join stakepool, rejoin another and quit&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950392"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2274"></span><span>
</span><span id="line-2275"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950391"><span class="annot"><span class="annottext">initialAmt :: Natural
</span><a href="#local-6989586621682950391"><span class="hs-identifier hs-var hs-var">initialAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2276"></span><span>        </span><span id="local-6989586621682950390"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Natural] -&gt; ResourceT IO ApiWallet
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(EncodeAddress n, DecodeAddress n, DecodeStakeAddress n, MonadIO m,
 MonadUnliftIO m) =&gt;
Context -&gt; [Natural] -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWalletWith"><span class="hs-identifier hs-var">fixtureWalletWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950391"><span class="hs-identifier hs-var">initialAmt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2277"></span><span>        </span><span id="local-6989586621682950389"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950389"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2278"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950388"><span class="annot"><span class="annottext">depositAmt :: Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var hs-var">depositAmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity unit Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1000000</span></span><span>
</span><span id="line-2279"></span><span>
</span><span id="line-2280"></span><span>        </span><span id="local-6989586621682950387"><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950387"><span class="hs-identifier hs-var">pool1</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621682950386"><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950386"><span class="hs-identifier hs-var">pool2</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ApiT PoolId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiStakePool -&gt; ApiT PoolId) -&gt; [ApiStakePool] -&gt; [ApiT PoolId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
 -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
-&gt; ApiStakePool -&gt; ApiT PoolId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
   -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
(ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
-&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool
</span><a href="#local-6989586621682950385"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiStakePool] -&gt; [ApiT PoolId])
-&gt; ((Status, [ApiStakePool]) -&gt; [ApiStakePool])
-&gt; (Status, [ApiStakePool])
-&gt; [ApiT PoolId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, [ApiStakePool]) -&gt; [ApiStakePool]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, [ApiStakePool]) -&gt; [ApiT PoolId])
-&gt; ResourceT IO (Status, [ApiStakePool])
-&gt; ResourceT IO [ApiT PoolId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, [ApiStakePool])
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span>
</span><span id="line-2281"></span><span>            </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiStakePool</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2282"></span><span>            </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="Test.Integration.Framework.DSL.html#arbitraryStake"><span class="hs-identifier hs-var">arbitraryStake</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2283"></span><span>
</span><span id="line-2284"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950383"><span class="annot"><span class="annottext">delegationJoin :: Payload
</span><a href="#local-6989586621682950383"><span class="hs-identifier hs-var hs-var">delegationJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool1},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2292"></span><span>        </span><span id="local-6989586621682950382"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950382"><span class="hs-identifier hs-var">rTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2293"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950383"><span class="hs-identifier hs-var">delegationJoin</span></a></span><span>
</span><span id="line-2294"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950382"><span class="hs-identifier hs-var">rTx1</span></a></span><span>
</span><span id="line-2295"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2296"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950381"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950380"><span class="hs-var">#depositsTaken</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var">depositAmt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2297"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950379"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950378"><span class="hs-var">#depositsReturned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2298"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2299"></span><span>
</span><span id="line-2300"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950377"><span class="annot"><span class="annottext">apiTx1 :: ApiT SealedTx
</span><a href="#local-6989586621682950377"><span class="hs-identifier hs-var hs-var">apiTx1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950376"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950382"><span class="hs-identifier hs-var">rTx1</span></a></span><span>
</span><span id="line-2301"></span><span>        </span><span id="local-6989586621682950375"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950375"><span class="hs-identifier hs-var">signedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950377"><span class="hs-identifier hs-var">apiTx1</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2302"></span><span>
</span><span id="line-2303"></span><span>        </span><span class="hs-comment">-- as we are joining for the first time we expect two certificates</span><span>
</span><span id="line-2304"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950374"><span class="annot"><span class="annottext">stakeKeyDerPath :: NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682950374"><span class="hs-identifier hs-var hs-var">stakeKeyDerPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiT DerivationIndex] -&gt; NonEmpty (ApiT DerivationIndex)
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-2305"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485500</span></span><span class="hs-special">)</span><span>
</span><span id="line-2306"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485463</span></span><span class="hs-special">)</span><span>
</span><span id="line-2307"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-2308"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2309"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2310"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2311"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950373"><span class="annot"><span class="annottext">registerStakeKeyCert :: ApiAnyCertificate n
</span><a href="#local-6989586621682950373"><span class="hs-identifier hs-var hs-var">registerStakeKeyCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2312"></span><span>                </span><span class="annot"><span class="annottext">ApiCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiCertificate -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCertificate -&gt; ApiAnyCertificate n)
-&gt; ApiCertificate -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">RegisterRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682950374"><span class="hs-identifier hs-var">stakeKeyDerPath</span></a></span><span>
</span><span id="line-2313"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950370"><span class="annot"><span class="annottext">delegatingCert :: ApiAnyCertificate n
</span><a href="#local-6989586621682950370"><span class="hs-identifier hs-var hs-var">delegatingCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2314"></span><span>                </span><span class="annot"><span class="annottext">ApiCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiCertificate -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCertificate -&gt; ApiAnyCertificate n)
-&gt; ApiCertificate -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiT PoolId -&gt; ApiCertificate
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">JoinPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682950374"><span class="hs-identifier hs-var">stakeKeyDerPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950387"><span class="hs-identifier hs-var">pool1</span></a></span><span>
</span><span id="line-2315"></span><span>
</span><span id="line-2316"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950368"><span class="annot"><span class="annottext">txCbor1 :: ApiT SealedTx
</span><a href="#local-6989586621682950368"><span class="hs-identifier hs-var hs-var">txCbor1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950367"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950375"><span class="hs-identifier hs-var">signedTx1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2317"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950366"><span class="annot"><span class="annottext">decodePayload1 :: Payload
</span><a href="#local-6989586621682950366"><span class="hs-identifier hs-var hs-var">decodePayload1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950368"><span class="hs-identifier hs-var">txCbor1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2318"></span><span>        </span><span id="local-6989586621682950365"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950365"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2319"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950366"><span class="hs-identifier hs-var">decodePayload1</span></a></span><span>
</span><span id="line-2320"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950365"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span><span>
</span><span id="line-2321"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2322"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950364"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; [ApiAnyCertificate n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiAnyCertificate n
forall (n :: NetworkDiscriminant). ApiAnyCertificate n
</span><a href="#local-6989586621682950373"><span class="hs-identifier hs-var">registerStakeKeyCert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiAnyCertificate n
</span><a href="#local-6989586621682950370"><span class="hs-identifier hs-var">delegatingCert</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2323"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950363"><span class="hs-var">#depositsTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var">depositAmt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2324"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950362"><span class="hs-var">#depositsReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2325"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2326"></span><span>
</span><span id="line-2327"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-2328"></span><span>        </span><span id="local-6989586621682950361"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950361"><span class="hs-identifier hs-var">submittedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950375"><span class="hs-identifier hs-var">signedTx1</span></a></span><span>
</span><span id="line-2329"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950361"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span>
</span><span id="line-2330"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2331"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2332"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2333"></span><span>
</span><span id="line-2334"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet has joined pool and deposit info persists&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2335"></span><span>            </span><span id="local-6989586621682950360"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950360"><span class="hs-identifier hs-var">rJoin'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2336"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2337"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ApiTxId ApiTxId
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiTxId
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiTxId ApiTxId
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950361"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2338"></span><span>                </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2339"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950360"><span class="hs-identifier hs-var">rJoin'</span></a></span><span>
</span><span id="line-2340"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2341"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950359"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950358"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2342"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950357"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950356"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2343"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositTaken&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950355"><span class="hs-var">#depositTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var">depositAmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2344"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositReturned&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950354"><span class="hs-var">#depositReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2345"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2346"></span><span>
</span><span id="line-2347"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950353"><span class="annot"><span class="annottext">txId1 :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950353"><span class="hs-identifier hs-var hs-var">txId1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
</span><a href="#local-6989586621682950352"><span class="hs-var">#id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950361"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span>
</span><span id="line-2348"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950351"><span class="annot"><span class="annottext">link :: (Method, Text)
</span><a href="#local-6989586621682950351"><span class="hs-identifier hs-var hs-var">link</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950353"><span class="hs-identifier hs-var">txId1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2349"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;delegation transaction is in ledger&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2350"></span><span>            </span><span id="local-6989586621682950350"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950350"><span class="hs-identifier hs-var">rSrc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950351"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2351"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950350"><span class="hs-identifier hs-var">rSrc</span></a></span><span>
</span><span id="line-2352"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2353"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950349"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950348"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2354"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950347"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950346"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2355"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Maybe TxMetadataWithSchema)
-&gt; (Maybe TxMetadataWithSchema -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Maybe TxMetadataWithSchema)
</span><a href="#local-6989586621682950345"><span class="hs-var">#metadata</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TxMetadataWithSchema -&gt; Maybe TxMetadataWithSchema -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadataWithSchema
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2356"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) [ApiTxInput n]
-&gt; ([ApiTxInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInput n] -&gt; f [ApiTxInput n])
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) [ApiTxInput n]
</span><a href="#local-6989586621682950344"><span class="hs-var">#inputs</span></a></span><span> </span><span class="annot"><span class="annottext">(([ApiTxInput n] -&gt; IO ())
 -&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ())
-&gt; ([ApiTxInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950343"><span class="annot"><span class="annottext">[ApiTxInput n]
</span><a href="#local-6989586621682950343"><span class="hs-identifier hs-var">inputs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2357"></span><span>                    </span><span class="annot"><span class="annottext">[ApiTxInput n]
</span><a href="#local-6989586621682950343"><span class="hs-identifier hs-var">inputs'</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInput n] -&gt; ([ApiTxInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxInput n -&gt; Bool) -&gt; [ApiTxInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (AddressAmount (ApiT Address, Proxy n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (AddressAmount (ApiT Address, Proxy n)) -&gt; Bool)
-&gt; (ApiTxInput n -&gt; Maybe (AddressAmount (ApiT Address, Proxy n)))
-&gt; ApiTxInput n
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInput n -&gt; Maybe (AddressAmount (ApiT Address, Proxy n))
forall (n :: NetworkDiscriminant).
ApiTxInput n -&gt; Maybe (ApiTxOutput n)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">source</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2358"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2359"></span><span>
</span><span id="line-2360"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForNextEpoch"><span class="hs-identifier hs-var">waitForNextEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2361"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForNextEpoch"><span class="hs-identifier hs-var">waitForNextEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2362"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet gets rewards from pool1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2363"></span><span>            </span><span id="local-6989586621682950341"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950341"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2364"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950341"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2365"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-2366"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950340"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;reward&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950339"><span class="hs-var">#reward</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2367"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall a. (Ord a, Show a) =&gt; a -&gt; a -&gt; IO ()
</span><a href="Test.Integration.Framework.DSL.html#.%3E"><span class="hs-operator hs-var">.&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2368"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2369"></span><span>
</span><span id="line-2370"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet is delegating to pool1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2371"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2372"></span><span>                </span><span class="annot"><span class="annottext">IO (Status, Either RequestException ApiWallet)
-&gt; ((Status, Either RequestException ApiWallet) -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet)
 -&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ())
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()]
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2373"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet ApiWalletDelegation
-&gt; (ApiWalletDelegation -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((ApiWalletDelegation -&gt; f ApiWalletDelegation)
   -&gt; ApiWallet -&gt; f ApiWallet)
Traversal' ApiWallet ApiWalletDelegation
</span><a href="#local-6989586621682950337"><span class="hs-var">#delegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWalletDelegation -&gt; ApiWalletDelegation -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
-&gt; [(Maybe (ApiT PoolId), ApiEpochInfo)] -&gt; ApiWalletDelegation
</span><a href="Test.Integration.Framework.DSL.html#delegating"><span class="hs-identifier hs-var">delegating</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950387"><span class="hs-identifier hs-var">pool1</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2374"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2375"></span><span>
</span><span id="line-2376"></span><span>        </span><span class="hs-comment">-- join another stake pool</span><span>
</span><span id="line-2377"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950336"><span class="annot"><span class="annottext">delegationRejoin :: Payload
</span><a href="#local-6989586621682950336"><span class="hs-identifier hs-var hs-var">delegationRejoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool2},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2385"></span><span>        </span><span id="local-6989586621682950335"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950335"><span class="hs-identifier hs-var">rTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2386"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950336"><span class="hs-identifier hs-var">delegationRejoin</span></a></span><span>
</span><span id="line-2387"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950335"><span class="hs-identifier hs-var">rTx2</span></a></span><span>
</span><span id="line-2388"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2389"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950334"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950333"><span class="hs-var">#depositsTaken</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2390"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950332"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950331"><span class="hs-var">#depositsReturned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2391"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2392"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950330"><span class="annot"><span class="annottext">apiTx2 :: ApiT SealedTx
</span><a href="#local-6989586621682950330"><span class="hs-identifier hs-var hs-var">apiTx2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950329"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950335"><span class="hs-identifier hs-var">rTx2</span></a></span><span>
</span><span id="line-2393"></span><span>        </span><span id="local-6989586621682950328"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950328"><span class="hs-identifier hs-var">signedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950330"><span class="hs-identifier hs-var">apiTx2</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2394"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950327"><span class="annot"><span class="annottext">delegatingCert2 :: ApiAnyCertificate n
</span><a href="#local-6989586621682950327"><span class="hs-identifier hs-var hs-var">delegatingCert2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2395"></span><span>                </span><span class="annot"><span class="annottext">ApiCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiCertificate -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCertificate -&gt; ApiAnyCertificate n)
-&gt; ApiCertificate -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiT PoolId -&gt; ApiCertificate
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">JoinPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682950374"><span class="hs-identifier hs-var">stakeKeyDerPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950386"><span class="hs-identifier hs-var">pool2</span></a></span><span>
</span><span id="line-2396"></span><span>
</span><span id="line-2397"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950326"><span class="annot"><span class="annottext">txCbor2 :: ApiT SealedTx
</span><a href="#local-6989586621682950326"><span class="hs-identifier hs-var hs-var">txCbor2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2398"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950325"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950328"><span class="hs-identifier hs-var">signedTx2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2399"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950324"><span class="annot"><span class="annottext">decodePayload2 :: Payload
</span><a href="#local-6989586621682950324"><span class="hs-identifier hs-var hs-var">decodePayload2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950326"><span class="hs-identifier hs-var">txCbor2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2400"></span><span>        </span><span id="local-6989586621682950323"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950323"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2401"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950324"><span class="hs-identifier hs-var">decodePayload2</span></a></span><span>
</span><span id="line-2402"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950323"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span><span>
</span><span id="line-2403"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2404"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950322"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; [ApiAnyCertificate n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiAnyCertificate n
</span><a href="#local-6989586621682950327"><span class="hs-identifier hs-var">delegatingCert2</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2405"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950321"><span class="hs-var">#depositsTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2406"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950320"><span class="hs-var">#depositsReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2407"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2408"></span><span>        </span><span id="local-6989586621682950319"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950319"><span class="hs-identifier hs-var">submittedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950328"><span class="hs-identifier hs-var">signedTx2</span></a></span><span>
</span><span id="line-2409"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950319"><span class="hs-identifier hs-var">submittedTx2</span></a></span><span>
</span><span id="line-2410"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2411"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2412"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2413"></span><span>
</span><span id="line-2414"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950318"><span class="annot"><span class="annottext">txid2 :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950318"><span class="hs-identifier hs-var hs-var">txid2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
(ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;))) -&gt; ApiTxId -&gt; f ApiTxId
</span><a href="#local-6989586621682950317"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950319"><span class="hs-identifier hs-var">submittedTx2</span></a></span><span>
</span><span id="line-2415"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950316"><span class="annot"><span class="annottext">queryTx2 :: (Method, Text)
</span><a href="#local-6989586621682950316"><span class="hs-identifier hs-var hs-var">queryTx2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950318"><span class="hs-identifier hs-var">txid2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2416"></span><span>        </span><span id="local-6989586621682950315"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950315"><span class="hs-identifier hs-var">rGetTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950316"><span class="hs-identifier hs-var">queryTx2</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2417"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950315"><span class="hs-identifier hs-var">rGetTx2</span></a></span><span>
</span><span id="line-2418"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2419"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositTaken&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950314"><span class="hs-var">#depositTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2420"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositReturned&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950313"><span class="hs-var">#depositReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2421"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2422"></span><span>
</span><span id="line-2423"></span><span>        </span><span class="hs-comment">-- Wait for the certificate to be inserted</span><span>
</span><span id="line-2424"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Certificates are inserted&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2425"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950312"><span class="annot"><span class="annottext">ep :: (Method, Text)
</span><a href="#local-6989586621682950312"><span class="hs-identifier hs-var hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listTransactions</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2426"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException [ApiTransaction n])
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950312"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Status, Either RequestException [ApiTransaction n])
-&gt; ((Status, Either RequestException [ApiTransaction n]) -&gt; IO ())
-&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException [ApiTransaction n])
 -&gt; [(Status, Either RequestException [ApiTransaction n]) -&gt; IO ()]
 -&gt; IO ())
-&gt; [(Status, Either RequestException [ApiTransaction n]) -&gt; IO ()]
-&gt; (Status, Either RequestException [ApiTransaction n])
-&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException [ApiTransaction n])
-&gt; [(Status, Either RequestException [ApiTransaction n]) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2427"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException [ApiTransaction n])
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Int
-&gt; Traversal' s a
-&gt; (a -&gt; IO ())
-&gt; (Status, Either RequestException [s])
-&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectListField"><span class="hs-identifier hs-var">expectListField</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2428"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950310"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950309"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2429"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException [ApiTransaction n])
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Int
-&gt; Traversal' s a
-&gt; (a -&gt; IO ())
-&gt; (Status, Either RequestException [s])
-&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectListField"><span class="hs-identifier hs-var">expectListField</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2430"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950308"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950307"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2431"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2432"></span><span>
</span><span id="line-2433"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet is delegating to pool2&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2434"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2435"></span><span>                </span><span class="annot"><span class="annottext">IO (Status, Either RequestException ApiWallet)
-&gt; ((Status, Either RequestException ApiWallet) -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet)
 -&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ())
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()]
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2436"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet ApiWalletDelegation
-&gt; (ApiWalletDelegation -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((ApiWalletDelegation -&gt; f ApiWalletDelegation)
   -&gt; ApiWallet -&gt; f ApiWallet)
Traversal' ApiWallet ApiWalletDelegation
</span><a href="#local-6989586621682950306"><span class="hs-var">#delegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWalletDelegation -&gt; ApiWalletDelegation -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
-&gt; [(Maybe (ApiT PoolId), ApiEpochInfo)] -&gt; ApiWalletDelegation
</span><a href="Test.Integration.Framework.DSL.html#delegating"><span class="hs-identifier hs-var">delegating</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950386"><span class="hs-identifier hs-var">pool2</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2437"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2438"></span><span>
</span><span id="line-2439"></span><span>        </span><span class="hs-comment">-- there's currently no withdrawals in the wallet</span><span>
</span><span id="line-2440"></span><span>        </span><span id="local-6989586621682950305"><span class="annot"><span class="annottext">(Status, Either RequestException [ApiTransaction n])
</span><a href="#local-6989586621682950305"><span class="hs-identifier hs-var">rw1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException [ApiTransaction n])
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2441"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet
-&gt; Maybe Natural
-&gt; Maybe Iso8601Time
-&gt; Maybe Iso8601Time
-&gt; Maybe SortOrder
-&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w) =&gt;
w
-&gt; Maybe Natural
-&gt; Maybe Iso8601Time
-&gt; Maybe Iso8601Time
-&gt; Maybe SortOrder
-&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listTransactions'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Maybe Natural
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-2442"></span><span>                </span><span class="annot"><span class="annottext">Maybe Iso8601Time
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Iso8601Time
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SortOrder
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2443"></span><span>            </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2444"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException [ApiTransaction n])
-&gt; [(Status, Either RequestException [ApiTransaction n])
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException [ApiTransaction n])
</span><a href="#local-6989586621682950305"><span class="hs-identifier hs-var">rw1</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (Status, Either RequestException [ApiTransaction n])
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) (xs :: * -&gt; *) a.
(HasCallStack, MonadIO m, Foldable xs) =&gt;
Int -&gt; (Status, Either RequestException (xs a)) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectListSize"><span class="hs-identifier hs-var">expectListSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2445"></span><span>
</span><span id="line-2446"></span><span>        </span><span class="hs-comment">-- can use rewards with an explicit withdrawal request to self.</span><span>
</span><span id="line-2447"></span><span>        </span><span id="local-6989586621682950303"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950303"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950389"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-2448"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950302"><span class="annot"><span class="annottext">coin :: Natural
</span><a href="#local-6989586621682950302"><span class="hs-identifier hs-var hs-var">coin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-2449"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950301"><span class="annot"><span class="annottext">addr :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950301"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950303"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950300"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-2450"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950299"><span class="annot"><span class="annottext">payloadWithdrawal :: Value
</span><a href="#local-6989586621682950299"><span class="hs-identifier hs-var hs-var">payloadWithdrawal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[json|
                { &quot;payments&quot;:
                    [ { &quot;address&quot;: #{addr}
                      , &quot;amount&quot;:
                        { &quot;quantity&quot;: #{coin}
                        , &quot;unit&quot;: &quot;lovelace&quot;
                        }
                      }
                    ]
                , &quot;passphrase&quot;: #{fixturePassphrase},
                  &quot;withdrawal&quot;: &quot;self&quot;
                }|]</span></span><span>
</span><span id="line-2462"></span><span>
</span><span id="line-2463"></span><span>        </span><span class="hs-comment">--TODO: ADP-1192 (take care of withdrawals in new tx workflow)</span><span>
</span><span id="line-2464"></span><span>        </span><span id="local-6989586621682950298"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950298"><span class="hs-identifier hs-var">rGet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2465"></span><span>                    </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2466"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950297"><span class="annot"><span class="annottext">previousBalance :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682950297"><span class="hs-identifier hs-var hs-var">previousBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiWallet (Quantity &quot;lovelace&quot; Natural)
-&gt; (Status, Either RequestException ApiWallet)
-&gt; Quantity &quot;lovelace&quot; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950296"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950295"><span class="hs-var">#available</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950298"><span class="hs-identifier hs-var">rGet</span></a></span><span>
</span><span id="line-2467"></span><span>        </span><span id="local-6989586621682950294"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950294"><span class="hs-identifier hs-var">rTx3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2468"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createTransactionOld</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2469"></span><span>            </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682950299"><span class="hs-identifier hs-var">payloadWithdrawal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2470"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950294"><span class="hs-identifier hs-var">rTx3</span></a></span><span>
</span><span id="line-2471"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;amount&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950292"><span class="hs-var">#amount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall a. (Ord a, Show a) =&gt; a -&gt; a -&gt; IO ()
</span><a href="Test.Integration.Framework.DSL.html#.%3E"><span class="hs-operator hs-var">.&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950302"><span class="hs-identifier hs-var">coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2472"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950291"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950290"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2473"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2474"></span><span>
</span><span id="line-2475"></span><span>        </span><span class="hs-comment">-- Rewards are have been consumed.</span><span>
</span><span id="line-2476"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet has consumed rewards&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2477"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2478"></span><span>                </span><span class="annot"><span class="annottext">IO (Status, Either RequestException ApiWallet)
-&gt; ((Status, Either RequestException ApiWallet) -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet)
 -&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ())
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()]
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2479"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-2480"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950289"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;reward&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950288"><span class="hs-var">#reward</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2481"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2482"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-2483"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950287"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950286"><span class="hs-var">#available</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2484"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall a. (Ord a, Show a) =&gt; a -&gt; a -&gt; IO ()
</span><a href="Test.Integration.Framework.DSL.html#.%3E"><span class="hs-operator hs-var">.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682950297"><span class="hs-identifier hs-var">previousBalance</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2485"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2486"></span><span>
</span><span id="line-2487"></span><span>        </span><span class="hs-comment">-- now we can quit</span><span>
</span><span id="line-2488"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950285"><span class="annot"><span class="annottext">delegationQuit :: Payload
</span><a href="#local-6989586621682950285"><span class="hs-identifier hs-var hs-var">delegationQuit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;quit&quot;: {
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2495"></span><span>        </span><span id="local-6989586621682950284"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950284"><span class="hs-identifier hs-var">rTx4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2496"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950285"><span class="hs-identifier hs-var">delegationQuit</span></a></span><span>
</span><span id="line-2497"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950284"><span class="hs-identifier hs-var">rTx4</span></a></span><span>
</span><span id="line-2498"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2499"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950283"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950282"><span class="hs-var">#depositsTaken</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2500"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950281"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950280"><span class="hs-var">#depositsReturned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var">depositAmt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2501"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2502"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950279"><span class="annot"><span class="annottext">apiTx4 :: ApiT SealedTx
</span><a href="#local-6989586621682950279"><span class="hs-identifier hs-var hs-var">apiTx4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950278"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950284"><span class="hs-identifier hs-var">rTx4</span></a></span><span>
</span><span id="line-2503"></span><span>        </span><span id="local-6989586621682950277"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950277"><span class="hs-identifier hs-var">signedTx4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950279"><span class="hs-identifier hs-var">apiTx4</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2504"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950276"><span class="annot"><span class="annottext">quittingCert :: ApiAnyCertificate n
</span><a href="#local-6989586621682950276"><span class="hs-identifier hs-var hs-var">quittingCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2505"></span><span>                </span><span class="annot"><span class="annottext">ApiCertificate -&gt; ApiAnyCertificate n
forall (n :: NetworkDiscriminant).
ApiCertificate -&gt; ApiAnyCertificate n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletDelegationCertificate</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCertificate -&gt; ApiAnyCertificate n)
-&gt; ApiCertificate -&gt; ApiAnyCertificate n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex) -&gt; ApiCertificate
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">QuitPool</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (ApiT DerivationIndex)
</span><a href="#local-6989586621682950374"><span class="hs-identifier hs-var">stakeKeyDerPath</span></a></span><span>
</span><span id="line-2506"></span><span>
</span><span id="line-2507"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950274"><span class="annot"><span class="annottext">txCbor4 :: ApiT SealedTx
</span><a href="#local-6989586621682950274"><span class="hs-identifier hs-var hs-var">txCbor4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950273"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950277"><span class="hs-identifier hs-var">signedTx4</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2508"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950272"><span class="annot"><span class="annottext">decodePayload4 :: Payload
</span><a href="#local-6989586621682950272"><span class="hs-identifier hs-var hs-var">decodePayload4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950274"><span class="hs-identifier hs-var">txCbor4</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2509"></span><span>        </span><span id="local-6989586621682950271"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950271"><span class="hs-identifier hs-var">rDecodedTx4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2510"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950272"><span class="hs-identifier hs-var">decodePayload4</span></a></span><span>
</span><span id="line-2511"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950271"><span class="hs-identifier hs-var">rDecodedTx4</span></a></span><span>
</span><span id="line-2512"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2513"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
-&gt; ([ApiAnyCertificate n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;certificates&quot;
  (([ApiAnyCertificate n] -&gt; f [ApiAnyCertificate n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiAnyCertificate n]
</span><a href="#local-6989586621682950270"><span class="hs-var">#certificates</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAnyCertificate n] -&gt; [ApiAnyCertificate n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiAnyCertificate n
forall (n :: NetworkDiscriminant). ApiAnyCertificate n
</span><a href="#local-6989586621682950276"><span class="hs-identifier hs-var">quittingCert</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2514"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950269"><span class="hs-var">#depositsReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var">depositAmt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2515"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950268"><span class="hs-var">#depositsTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2516"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2517"></span><span>        </span><span id="local-6989586621682950267"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950267"><span class="hs-identifier hs-var">submittedTx4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950277"><span class="hs-identifier hs-var">signedTx4</span></a></span><span>
</span><span id="line-2518"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950267"><span class="hs-identifier hs-var">submittedTx4</span></a></span><span>
</span><span id="line-2519"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2520"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2521"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2522"></span><span>
</span><span id="line-2523"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950266"><span class="annot"><span class="annottext">txid3 :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950266"><span class="hs-identifier hs-var hs-var">txid3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
(ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;))) -&gt; ApiTxId -&gt; f ApiTxId
</span><a href="#local-6989586621682950265"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950267"><span class="hs-identifier hs-var">submittedTx4</span></a></span><span>
</span><span id="line-2524"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950264"><span class="annot"><span class="annottext">queryTx3 :: (Method, Text)
</span><a href="#local-6989586621682950264"><span class="hs-identifier hs-var hs-var">queryTx3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950266"><span class="hs-identifier hs-var">txid3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2525"></span><span>        </span><span id="local-6989586621682950263"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950263"><span class="hs-identifier hs-var">rGetTx3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950264"><span class="hs-identifier hs-var">queryTx3</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2526"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950263"><span class="hs-identifier hs-var">rGetTx3</span></a></span><span>
</span><span id="line-2527"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2528"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositTaken&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950262"><span class="hs-var">#depositTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2529"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositReturned&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950261"><span class="hs-var">#depositReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var">depositAmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2530"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2531"></span><span>
</span><span id="line-2532"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet is not delegating&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2533"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950390"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2534"></span><span>                </span><span class="annot"><span class="annottext">IO (Status, Either RequestException ApiWallet)
-&gt; ((Status, Either RequestException ApiWallet) -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet)
 -&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ())
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()]
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2535"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet ApiWalletDelegation
-&gt; (ApiWalletDelegation -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((ApiWalletDelegation -&gt; f ApiWalletDelegation)
   -&gt; ApiWallet -&gt; f ApiWallet)
Traversal' ApiWallet ApiWalletDelegation
</span><a href="#local-6989586621682950260"><span class="hs-var">#delegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWalletDelegation -&gt; ApiWalletDelegation -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe (ApiT PoolId), ApiEpochInfo)] -&gt; ApiWalletDelegation
</span><a href="Test.Integration.Framework.DSL.html#notDelegating"><span class="hs-identifier hs-var">notDelegating</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2536"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2537"></span><span>
</span><span id="line-2538"></span><span>        </span><span class="hs-comment">-- transaction history shows deposit returned</span><span>
</span><span id="line-2539"></span><span>        </span><span id="local-6989586621682950259"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950259"><span class="hs-identifier hs-var">rGetTx4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950392"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950264"><span class="hs-identifier hs-var">queryTx3</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2540"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950259"><span class="hs-identifier hs-var">rGetTx4</span></a></span><span>
</span><span id="line-2541"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2542"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositTaken&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950258"><span class="hs-var">#depositTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2543"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositReturned&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950257"><span class="hs-var">#depositReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol). Quantity unit Natural
</span><a href="#local-6989586621682950388"><span class="hs-identifier hs-var">depositAmt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2544"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2545"></span><span>
</span><span id="line-2546"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_JOIN_01b - Invalid pool id&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950256"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950256"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2547"></span><span>
</span><span id="line-2548"></span><span>        </span><span id="local-6989586621682950255"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950255"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950256"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2549"></span><span>
</span><span id="line-2550"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950254"><span class="annot"><span class="annottext">invalidPoolId :: Text
</span><a href="#local-6989586621682950254"><span class="hs-identifier hs-var hs-var">invalidPoolId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;1&quot;</span></span><span>
</span><span id="line-2551"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950252"><span class="annot"><span class="annottext">delegation :: Payload
</span><a href="#local-6989586621682950252"><span class="hs-identifier hs-var hs-var">delegation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{invalidPoolId},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2559"></span><span>        </span><span id="local-6989586621682950251"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950251"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950256"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2560"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950255"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950252"><span class="hs-identifier hs-var">delegation</span></a></span><span>
</span><span id="line-2561"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950251"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2562"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-2563"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid stake pool id&quot;</span></span><span>
</span><span id="line-2564"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2565"></span><span>
</span><span id="line-2566"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_JOIN_01b - Absent pool id&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950250"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950250"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2567"></span><span>
</span><span id="line-2568"></span><span>        </span><span id="local-6989586621682950249"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950249"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950250"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2569"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950248"><span class="annot"><span class="annottext">absentPoolIdBech32 :: Text
</span><a href="#local-6989586621682950248"><span class="hs-identifier hs-var hs-var">absentPoolIdBech32</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pool1mgjlw24rg8sp4vrzctqxtf2nn29rjhtkq2kdzvf4tcjd5pl547k&quot;</span></span><span>
</span><span id="line-2570"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682950247"><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682950247"><span class="hs-identifier hs-var">absentPoolId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either TextDecodingError PoolId
-&gt; ResourceT IO (Either TextDecodingError PoolId)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TextDecodingError PoolId
 -&gt; ResourceT IO (Either TextDecodingError PoolId))
-&gt; Either TextDecodingError PoolId
-&gt; ResourceT IO (Either TextDecodingError PoolId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either TextDecodingError PoolId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">decodePoolIdBech32</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682950248"><span class="hs-identifier hs-var">absentPoolIdBech32</span></a></span><span>
</span><span id="line-2571"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950246"><span class="annot"><span class="annottext">delegation :: Payload
</span><a href="#local-6989586621682950246"><span class="hs-identifier hs-var hs-var">delegation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{absentPoolIdBech32},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2579"></span><span>        </span><span id="local-6989586621682950245"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950245"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950250"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2580"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950249"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950246"><span class="hs-identifier hs-var">delegation</span></a></span><span>
</span><span id="line-2581"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950245"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2582"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status404</span></a></span><span>
</span><span id="line-2583"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="Test.Integration.Framework.TestData.html#errMsg404NoSuchPool"><span class="hs-identifier hs-var">errMsg404NoSuchPool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">PoolId
</span><a href="#local-6989586621682950247"><span class="hs-identifier hs-var">absentPoolId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2584"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2585"></span><span>
</span><span id="line-2586"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_JOIN_01c - Multidelegation not supported&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950244"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950244"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2587"></span><span>
</span><span id="line-2588"></span><span>        </span><span id="local-6989586621682950243"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950243"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950244"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2589"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950242"><span class="annot"><span class="annottext">pool' :: Text
</span><a href="#local-6989586621682950242"><span class="hs-identifier hs-var hs-var">pool'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pool1mgjlw24rg8sp4vrzctqxtf2nn29rjhtkq2kdzvf4tcjd5pl547k&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-2590"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950241"><span class="annot"><span class="annottext">delegations :: Payload
</span><a href="#local-6989586621682950241"><span class="hs-identifier hs-var hs-var">delegations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool'},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                },{
                    &quot;quit&quot;: {
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2602"></span><span>        </span><span id="local-6989586621682950240"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950240"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950244"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2603"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950243"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950241"><span class="hs-identifier hs-var">delegations</span></a></span><span>
</span><span id="line-2604"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950240"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2605"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-2606"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MultidelegationTransaction"><span class="hs-identifier hs-var">errMsg403MultidelegationTransaction</span></a></span><span>
</span><span id="line-2607"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2608"></span><span>
</span><span id="line-2609"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_JOIN_01d - Multiaccount not supported&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950239"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950239"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2610"></span><span>
</span><span id="line-2611"></span><span>        </span><span id="local-6989586621682950238"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950238"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950239"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2612"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950237"><span class="annot"><span class="annottext">pool' :: Text
</span><a href="#local-6989586621682950237"><span class="hs-identifier hs-var hs-var">pool'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pool1mgjlw24rg8sp4vrzctqxtf2nn29rjhtkq2kdzvf4tcjd5pl547k&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-2613"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950236"><span class="annot"><span class="annottext">delegations :: Payload
</span><a href="#local-6989586621682950236"><span class="hs-identifier hs-var hs-var">delegations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool'},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                },{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool'},
                        &quot;stake_key_index&quot;: &quot;1H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2626"></span><span>        </span><span id="local-6989586621682950235"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950235"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950239"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2627"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950238"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950236"><span class="hs-identifier hs-var">delegations</span></a></span><span>
</span><span id="line-2628"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950235"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2629"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-2630"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MultiaccountTransaction"><span class="hs-identifier hs-var">errMsg403MultiaccountTransaction</span></a></span><span>
</span><span id="line-2631"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2632"></span><span>
</span><span id="line-2633"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_JOIN_01e - Can re-join and withdraw at once&quot;</span></span><span>  </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950234"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2634"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682950233"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mnemonic 24
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2635"></span><span>        </span><span id="local-6989586621682950232"><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950232"><span class="hs-identifier hs-var">pool1</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ApiT PoolId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiStakePool -&gt; ApiT PoolId) -&gt; [ApiStakePool] -&gt; [ApiT PoolId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
 -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
-&gt; ApiStakePool -&gt; ApiT PoolId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
   -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
(ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
-&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool
</span><a href="#local-6989586621682950231"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiStakePool] -&gt; [ApiT PoolId])
-&gt; ((Status, [ApiStakePool]) -&gt; [ApiStakePool])
-&gt; (Status, [ApiStakePool])
-&gt; [ApiT PoolId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, [ApiStakePool]) -&gt; [ApiStakePool]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, [ApiStakePool]) -&gt; [ApiT PoolId])
-&gt; ResourceT IO (Status, [ApiStakePool])
-&gt; ResourceT IO [ApiT PoolId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, [ApiStakePool])
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span>
</span><span id="line-2636"></span><span>            </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiStakePool</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2637"></span><span>            </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="Test.Integration.Framework.DSL.html#arbitraryStake"><span class="hs-identifier hs-var">arbitraryStake</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2638"></span><span>
</span><span id="line-2639"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950230"><span class="annot"><span class="annottext">delegationJoin :: Payload
</span><a href="#local-6989586621682950230"><span class="hs-identifier hs-var hs-var">delegationJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool1},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
                , &quot;withdrawal&quot;: &quot;self&quot;
            }|]</span></span><span>
</span><span id="line-2648"></span><span>        </span><span id="local-6989586621682950229"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950229"><span class="hs-identifier hs-var">rTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2649"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950230"><span class="hs-identifier hs-var">delegationJoin</span></a></span><span>
</span><span id="line-2650"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950228"><span class="annot"><span class="annottext">apiTx1 :: ApiT SealedTx
</span><a href="#local-6989586621682950228"><span class="hs-identifier hs-var hs-var">apiTx1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950227"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950229"><span class="hs-identifier hs-var">rTx1</span></a></span><span>
</span><span id="line-2651"></span><span>        </span><span id="local-6989586621682950226"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950226"><span class="hs-identifier hs-var">signedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950228"><span class="hs-identifier hs-var">apiTx1</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2652"></span><span>        </span><span id="local-6989586621682950225"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950225"><span class="hs-identifier hs-var">submittedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950226"><span class="hs-identifier hs-var">signedTx1</span></a></span><span>
</span><span id="line-2653"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950225"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span>
</span><span id="line-2654"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2655"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2656"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2657"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet has joined pool and deposit info persists&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2658"></span><span>            </span><span id="local-6989586621682950224"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950224"><span class="hs-identifier hs-var">rJoin'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2659"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2660"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ApiTxId ApiTxId
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiTxId
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiTxId ApiTxId
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950225"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2661"></span><span>                </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2662"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950224"><span class="hs-identifier hs-var">rJoin'</span></a></span><span>
</span><span id="line-2663"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2664"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950223"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950222"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2665"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950221"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950220"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2666"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) [ApiWithdrawal n]
-&gt; ([ApiWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawal n] -&gt; f [ApiWithdrawal n])
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) [ApiWithdrawal n]
</span><a href="#local-6989586621682950219"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawal n] -&gt; [ApiWithdrawal n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2667"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2668"></span><span>
</span><span id="line-2669"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950218"><span class="annot"><span class="annottext">txId1 :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950218"><span class="hs-identifier hs-var hs-var">txId1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
</span><a href="#local-6989586621682950217"><span class="hs-var">#id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950225"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span>
</span><span id="line-2670"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950216"><span class="annot"><span class="annottext">link :: (Method, Text)
</span><a href="#local-6989586621682950216"><span class="hs-identifier hs-var hs-var">link</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;) -&gt; ApiTxId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxId</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950218"><span class="hs-identifier hs-var">txId1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2671"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;delegation transaction is in ledger&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2672"></span><span>            </span><span id="local-6989586621682950215"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950215"><span class="hs-identifier hs-var">rSrc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682950216"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2673"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950215"><span class="hs-identifier hs-var">rSrc</span></a></span><span>
</span><span id="line-2674"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2675"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950214"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950213"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2676"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950212"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950211"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2677"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) (Maybe TxMetadataWithSchema)
-&gt; (Maybe TxMetadataWithSchema -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) (Maybe TxMetadataWithSchema)
</span><a href="#local-6989586621682950210"><span class="hs-var">#metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TxMetadataWithSchema -&gt; Maybe TxMetadataWithSchema -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxMetadataWithSchema
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2678"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) [ApiTxInput n]
-&gt; ([ApiTxInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInput n] -&gt; f [ApiTxInput n])
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
Traversal' (ApiTransaction n) [ApiTxInput n]
</span><a href="#local-6989586621682950209"><span class="hs-var">#inputs</span></a></span><span> </span><span class="annot"><span class="annottext">(([ApiTxInput n] -&gt; IO ())
 -&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ())
-&gt; ([ApiTxInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950208"><span class="annot"><span class="annottext">[ApiTxInput n]
</span><a href="#local-6989586621682950208"><span class="hs-identifier hs-var">inputs'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2679"></span><span>                    </span><span class="annot"><span class="annottext">[ApiTxInput n]
</span><a href="#local-6989586621682950208"><span class="hs-identifier hs-var">inputs'</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInput n] -&gt; ([ApiTxInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxInput n -&gt; Bool) -&gt; [ApiTxInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (AddressAmount (ApiT Address, Proxy n)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (AddressAmount (ApiT Address, Proxy n)) -&gt; Bool)
-&gt; (ApiTxInput n -&gt; Maybe (AddressAmount (ApiT Address, Proxy n)))
-&gt; ApiTxInput n
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInput n -&gt; Maybe (AddressAmount (ApiT Address, Proxy n))
forall (n :: NetworkDiscriminant).
ApiTxInput n -&gt; Maybe (ApiTxOutput n)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">source</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2680"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2681"></span><span>
</span><span id="line-2682"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForNextEpoch"><span class="hs-identifier hs-var">waitForNextEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2683"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForNextEpoch"><span class="hs-identifier hs-var">waitForNextEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2684"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet gets rewards from pool1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2685"></span><span>            </span><span id="local-6989586621682950207"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950207"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2686"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950207"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2687"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-2688"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950206"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;reward&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950205"><span class="hs-var">#reward</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2689"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall a. (Ord a, Show a) =&gt; a -&gt; a -&gt; IO ()
</span><a href="Test.Integration.Framework.DSL.html#.%3E"><span class="hs-operator hs-var">.&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2690"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2691"></span><span>
</span><span id="line-2692"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet is delegating to pool1&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2693"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950234"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950233"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2694"></span><span>                </span><span class="annot"><span class="annottext">IO (Status, Either RequestException ApiWallet)
-&gt; ((Status, Either RequestException ApiWallet) -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiWallet)
 -&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ())
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()]
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2695"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet ApiWalletDelegation
-&gt; (ApiWalletDelegation -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;delegation&quot;
  ((ApiWalletDelegation -&gt; f ApiWalletDelegation)
   -&gt; ApiWallet -&gt; f ApiWallet)
Traversal' ApiWallet ApiWalletDelegation
</span><a href="#local-6989586621682950204"><span class="hs-var">#delegation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWalletDelegation -&gt; ApiWalletDelegation -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
-&gt; [(Maybe (ApiT PoolId), ApiEpochInfo)] -&gt; ApiWalletDelegation
</span><a href="Test.Integration.Framework.DSL.html#delegating"><span class="hs-identifier hs-var">delegating</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950232"><span class="hs-identifier hs-var">pool1</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2696"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-2697"></span><span>
</span><span id="line-2698"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_JOIN_02 - Can join stakepool in case I have many UTxOs on 1 address&quot;</span></span><span>
</span><span id="line-2699"></span><span>        </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950203"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2700"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950202"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682950202"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2701"></span><span>        </span><span id="local-6989586621682950201"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2702"></span><span>        </span><span id="local-6989586621682950200"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950200"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2703"></span><span>
</span><span id="line-2704"></span><span>        </span><span class="hs-comment">-- Send ada to single wallet address to have [1A, 1A, 1A]</span><span>
</span><span id="line-2705"></span><span>        </span><span id="local-6989586621682950199"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950199"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2706"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950198"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950198"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950199"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950197"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-2707"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950196"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950196"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                },
                {
                    &quot;address&quot;: #{destination},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                },
                {
                    &quot;address&quot;: #{destination},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2730"></span><span>
</span><span id="line-2731"></span><span>        </span><span class="hs-comment">-- send transaction</span><span>
</span><span id="line-2732"></span><span>        </span><span id="local-6989586621682950195"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950195"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2733"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950200"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950196"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2734"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950195"><span class="hs-identifier hs-var">rTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2735"></span><span>
</span><span id="line-2736"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950194"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950194"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950193"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950195"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2737"></span><span>        </span><span id="local-6989586621682950192"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950192"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950200"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950194"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2738"></span><span>
</span><span id="line-2739"></span><span>        </span><span id="local-6989586621682950191"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950191"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950200"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950192"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-2740"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950191"><span class="hs-identifier hs-var">submittedTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2741"></span><span>
</span><span id="line-2742"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Target wallet balance is increased by amt and assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2743"></span><span>            </span><span id="local-6989586621682950190"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950190"><span class="hs-identifier hs-var">rWb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2744"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2745"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950190"><span class="hs-identifier hs-var">rWb</span></a></span><span>
</span><span id="line-2746"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2747"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-2748"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950189"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950188"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950187"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2749"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950202"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2750"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2751"></span><span>
</span><span id="line-2752"></span><span>        </span><span class="hs-comment">-- Delegate from src wallet</span><span>
</span><span id="line-2753"></span><span>        </span><span id="local-6989586621682950186"><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950186"><span class="hs-identifier hs-var">pool1</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ApiT PoolId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiStakePool -&gt; ApiT PoolId) -&gt; [ApiStakePool] -&gt; [ApiT PoolId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
 -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
-&gt; ApiStakePool -&gt; ApiT PoolId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
   -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
(ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
-&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool
</span><a href="#local-6989586621682950185"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiStakePool] -&gt; [ApiT PoolId])
-&gt; ((Status, [ApiStakePool]) -&gt; [ApiStakePool])
-&gt; (Status, [ApiStakePool])
-&gt; [ApiT PoolId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, [ApiStakePool]) -&gt; [ApiStakePool]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, [ApiStakePool]) -&gt; [ApiT PoolId])
-&gt; ResourceT IO (Status, [ApiStakePool])
-&gt; ResourceT IO [ApiT PoolId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, [ApiStakePool])
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span>
</span><span id="line-2754"></span><span>            </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiStakePool</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2755"></span><span>            </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="Test.Integration.Framework.DSL.html#arbitraryStake"><span class="hs-identifier hs-var">arbitraryStake</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2756"></span><span>
</span><span id="line-2757"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950184"><span class="annot"><span class="annottext">delegationJoin :: Payload
</span><a href="#local-6989586621682950184"><span class="hs-identifier hs-var hs-var">delegationJoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool1},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2765"></span><span>        </span><span id="local-6989586621682950183"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950183"><span class="hs-identifier hs-var">rTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2766"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950184"><span class="hs-identifier hs-var">delegationJoin</span></a></span><span>
</span><span id="line-2767"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950183"><span class="hs-identifier hs-var">rTx1</span></a></span><span>
</span><span id="line-2768"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2769"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950182"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950181"><span class="hs-var">#depositsTaken</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1000000</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2770"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950180"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950179"><span class="hs-var">#depositsReturned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2771"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2772"></span><span>
</span><span id="line-2773"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950178"><span class="annot"><span class="annottext">apiTx1 :: ApiT SealedTx
</span><a href="#local-6989586621682950178"><span class="hs-identifier hs-var hs-var">apiTx1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950177"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950183"><span class="hs-identifier hs-var">rTx1</span></a></span><span>
</span><span id="line-2774"></span><span>        </span><span id="local-6989586621682950176"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950176"><span class="hs-identifier hs-var">signedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950178"><span class="hs-identifier hs-var">apiTx1</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2775"></span><span>
</span><span id="line-2776"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950175"><span class="annot"><span class="annottext">txCbor1 :: ApiT SealedTx
</span><a href="#local-6989586621682950175"><span class="hs-identifier hs-var hs-var">txCbor1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682950174"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950176"><span class="hs-identifier hs-var">signedTx1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2777"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950173"><span class="annot"><span class="annottext">decodePayload1 :: Payload
</span><a href="#local-6989586621682950173"><span class="hs-identifier hs-var hs-var">decodePayload1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950175"><span class="hs-identifier hs-var">txCbor1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2778"></span><span>        </span><span id="local-6989586621682950172"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950172"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2779"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950173"><span class="hs-identifier hs-var">decodePayload1</span></a></span><span>
</span><span id="line-2780"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682950172"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span><span>
</span><span id="line-2781"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2782"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950171"><span class="hs-var">#depositsTaken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1000000</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2783"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682950170"><span class="hs-var">#depositsReturned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2784"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2785"></span><span>
</span><span id="line-2786"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-2787"></span><span>        </span><span id="local-6989586621682950169"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950169"><span class="hs-identifier hs-var">submittedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950176"><span class="hs-identifier hs-var">signedTx1</span></a></span><span>
</span><span id="line-2788"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950169"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span>
</span><span id="line-2789"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2790"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2791"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2792"></span><span>
</span><span id="line-2793"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet has joined pool and deposit info persists&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2794"></span><span>            </span><span id="local-6989586621682950168"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950168"><span class="hs-identifier hs-var">rJoin'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950203"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2795"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiTxId -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950201"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2796"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens' ApiTxId ApiTxId
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiTxId
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiTxId ApiTxId
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950169"><span class="hs-identifier hs-var">submittedTx1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2797"></span><span>                </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2798"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950168"><span class="hs-identifier hs-var">rJoin'</span></a></span><span>
</span><span id="line-2799"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-2800"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950167"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950166"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2801"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) Direction
-&gt; (Direction -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;direction&quot;
  ((ApiT Direction -&gt; f (ApiT Direction))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT Direction -&gt; f (ApiT Direction))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950165"><span class="hs-var">#direction</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Direction -&gt; f (ApiT Direction))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((Direction -&gt; f Direction)
    -&gt; ApiT Direction -&gt; f (ApiT Direction))
-&gt; (Direction -&gt; f Direction)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((Direction -&gt; f Direction)
   -&gt; ApiT Direction -&gt; f (ApiT Direction))
(Direction -&gt; f Direction) -&gt; ApiT Direction -&gt; f (ApiT Direction)
</span><a href="#local-6989586621682950164"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Outgoing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2802"></span><span>                </span><span class="hs-comment">-- , expectField #depositTaken (`shouldBe` Quantity 1000000)</span><span>
</span><span id="line-2803"></span><span>                </span><span class="hs-comment">-- , expectField #depositReturned (`shouldBe` Quantity 0)</span><span>
</span><span id="line-2804"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-2805"></span><span>
</span><span id="line-2806"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_QUIT_01 - Cannot quit if not joined&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950163"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950163"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2807"></span><span>
</span><span id="line-2808"></span><span>        </span><span id="local-6989586621682950162"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950162"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950163"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2809"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950161"><span class="annot"><span class="annottext">delegation :: Payload
</span><a href="#local-6989586621682950161"><span class="hs-identifier hs-var hs-var">delegation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;quit&quot;: {
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2816"></span><span>        </span><span id="local-6989586621682950160"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950160"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950163"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2817"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950162"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950161"><span class="hs-identifier hs-var">delegation</span></a></span><span>
</span><span id="line-2818"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950160"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2819"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-2820"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403NotDelegating"><span class="hs-identifier hs-var">errMsg403NotDelegating</span></a></span><span>
</span><span id="line-2821"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2822"></span><span>
</span><span id="line-2823"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_QUIT_02a - Cannot quit with rewards without explicit withdrawal&quot;</span></span><span>
</span><span id="line-2824"></span><span>        </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950159"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2825"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682950158"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950158"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mnemonic 24
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2826"></span><span>
</span><span id="line-2827"></span><span>        </span><span id="local-6989586621682950157"><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950157"><span class="hs-identifier hs-var">pool1</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">ApiT PoolId
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ApiT PoolId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiStakePool -&gt; ApiT PoolId) -&gt; [ApiStakePool] -&gt; [ApiT PoolId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
 -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
-&gt; ApiStakePool -&gt; ApiT PoolId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
   -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
(ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
-&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool
</span><a href="#local-6989586621682950156"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiStakePool] -&gt; [ApiT PoolId])
-&gt; ((Status, [ApiStakePool]) -&gt; [ApiStakePool])
-&gt; (Status, [ApiStakePool])
-&gt; [ApiT PoolId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, [ApiStakePool]) -&gt; [ApiStakePool]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span>
</span><span id="line-2828"></span><span>            </span><span class="annot"><span class="annottext">((Status, [ApiStakePool]) -&gt; [ApiT PoolId])
-&gt; ResourceT IO (Status, [ApiStakePool])
-&gt; ResourceT IO [ApiT PoolId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, [ApiStakePool])
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiStakePool</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2829"></span><span>                </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="Test.Integration.Framework.DSL.html#arbitraryStake"><span class="hs-identifier hs-var">arbitraryStake</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2830"></span><span>
</span><span id="line-2831"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950155"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950155"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool1},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2839"></span><span>        </span><span id="local-6989586621682950154"><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950154"><span class="hs-identifier hs-var">unsignedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
 -&gt; ApiConstructTransaction n
 -&gt; Const (ApiT SealedTx) (ApiConstructTransaction n))
-&gt; ApiConstructTransaction n -&gt; ApiT SealedTx
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
   -&gt; ApiConstructTransaction n
   -&gt; Const (ApiT SealedTx) (ApiConstructTransaction n))
(ApiT SealedTx -&gt; Const (ApiT SealedTx) (ApiT SealedTx))
-&gt; ApiConstructTransaction n
-&gt; Const (ApiT SealedTx) (ApiConstructTransaction n)
</span><a href="#local-6989586621682950153"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiConstructTransaction n -&gt; ApiT SealedTx)
-&gt; ((Status, ApiConstructTransaction n)
    -&gt; ApiConstructTransaction n)
-&gt; (Status, ApiConstructTransaction n)
-&gt; ApiT SealedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, ApiConstructTransaction n) -&gt; ApiConstructTransaction n
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span>
</span><span id="line-2840"></span><span>            </span><span class="annot"><span class="annottext">((Status, ApiConstructTransaction n) -&gt; ApiT SealedTx)
-&gt; ResourceT IO (Status, ApiConstructTransaction n)
-&gt; ResourceT IO (ApiT SealedTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, ApiConstructTransaction n)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2841"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950158"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950155"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2842"></span><span>        </span><span id="local-6989586621682950152"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950152"><span class="hs-identifier hs-var">signedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950158"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950154"><span class="hs-identifier hs-var">unsignedTx1</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2843"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950158"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950152"><span class="hs-identifier hs-var">signedTx1</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException ApiTxId)
-&gt; ((Status, Either RequestException ApiTxId) -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiTxId)
 -&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException ApiTxId)
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2844"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2845"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2846"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2847"></span><span>
</span><span id="line-2848"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForTxImmutability"><span class="hs-identifier hs-var">waitForTxImmutability</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2849"></span><span>
</span><span id="line-2850"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950151"><span class="annot"><span class="annottext">payload2 :: Payload
</span><a href="#local-6989586621682950151"><span class="hs-identifier hs-var hs-var">payload2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;quit&quot;: {
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2857"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950159"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2858"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950158"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950151"><span class="hs-identifier hs-var">payload2</span></a></span><span>
</span><span id="line-2859"></span><span>            </span><span class="annot"><span class="annottext">ResourceT
  IO (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ((Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiConstructTransaction n))
 -&gt; [(Status, Either RequestException (ApiConstructTransaction n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2860"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-2861"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403NonNullReward"><span class="hs-identifier hs-var">errMsg403NonNullReward</span></a></span><span>
</span><span id="line-2862"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2863"></span><span>
</span><span id="line-2864"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_QUIT_02b - Can quit with rewards with explicit withdrawal&quot;</span></span><span>
</span><span id="line-2865"></span><span>        </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682950150"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2866"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682950149"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950149"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Mnemonic 24
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2867"></span><span>
</span><span id="line-2868"></span><span>        </span><span id="local-6989586621682950148"><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950148"><span class="hs-identifier hs-var">pool1</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">ApiT PoolId
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ApiT PoolId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiStakePool -&gt; ApiT PoolId) -&gt; [ApiStakePool] -&gt; [ApiT PoolId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
 -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
-&gt; ApiStakePool -&gt; ApiT PoolId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
   -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
(ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
-&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool
</span><a href="#local-6989586621682950147"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiStakePool] -&gt; [ApiT PoolId])
-&gt; ((Status, [ApiStakePool]) -&gt; [ApiStakePool])
-&gt; (Status, [ApiStakePool])
-&gt; [ApiT PoolId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, [ApiStakePool]) -&gt; [ApiStakePool]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span>
</span><span id="line-2869"></span><span>            </span><span class="annot"><span class="annottext">((Status, [ApiStakePool]) -&gt; [ApiT PoolId])
-&gt; ResourceT IO (Status, [ApiStakePool])
-&gt; ResourceT IO [ApiT PoolId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, [ApiStakePool])
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiStakePool</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2870"></span><span>                </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="Test.Integration.Framework.DSL.html#arbitraryStake"><span class="hs-identifier hs-var">arbitraryStake</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2871"></span><span>
</span><span id="line-2872"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950146"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950146"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool1},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-2880"></span><span>        </span><span id="local-6989586621682950145"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950145"><span class="hs-identifier hs-var">rUnsignedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2881"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950149"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950146"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2882"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950144"><span class="annot"><span class="annottext">unsignedTx1 :: ApiT SealedTx
</span><a href="#local-6989586621682950144"><span class="hs-identifier hs-var hs-var">unsignedTx1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950143"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950145"><span class="hs-identifier hs-var">rUnsignedTx1</span></a></span><span>
</span><span id="line-2883"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950145"><span class="hs-identifier hs-var">rUnsignedTx1</span></a></span><span>
</span><span id="line-2884"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950142"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950141"><span class="hs-var">#depositsReturned</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2885"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2886"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950140"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950139"><span class="hs-var">#depositsTaken</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2887"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- key already registered</span><span>
</span><span id="line-2888"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2889"></span><span>        </span><span id="local-6989586621682950138"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950138"><span class="hs-identifier hs-var">signedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950149"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950144"><span class="hs-identifier hs-var">unsignedTx1</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2890"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950149"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950138"><span class="hs-identifier hs-var">signedTx1</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException ApiTxId)
-&gt; ((Status, Either RequestException ApiTxId) -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiTxId)
 -&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException ApiTxId)
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2891"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2892"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2893"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2894"></span><span>
</span><span id="line-2895"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#waitForTxImmutability"><span class="hs-identifier hs-var">waitForTxImmutability</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2896"></span><span>
</span><span id="line-2897"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950137"><span class="annot"><span class="annottext">payload2 :: Payload
</span><a href="#local-6989586621682950137"><span class="hs-identifier hs-var hs-var">payload2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;delegations&quot;: [{
                    &quot;quit&quot;: {
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }],
                &quot;withdrawal&quot;: &quot;self&quot;
            }|]</span></span><span>
</span><span id="line-2905"></span><span>        </span><span id="local-6989586621682950136"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950136"><span class="hs-identifier hs-var">rUnsignedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2906"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950149"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950137"><span class="hs-identifier hs-var">payload2</span></a></span><span>
</span><span id="line-2907"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950135"><span class="annot"><span class="annottext">unsignedTx2 :: ApiT SealedTx
</span><a href="#local-6989586621682950135"><span class="hs-identifier hs-var hs-var">unsignedTx2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950134"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950136"><span class="hs-identifier hs-var">rUnsignedTx2</span></a></span><span>
</span><span id="line-2908"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950136"><span class="hs-identifier hs-var">rUnsignedTx2</span></a></span><span>
</span><span id="line-2909"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950133"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950132"><span class="hs-var">#depositsReturned</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2910"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1000000</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2911"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950131"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950130"><span class="hs-var">#depositsTaken</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2912"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2913"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2914"></span><span>        </span><span id="local-6989586621682950129"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950129"><span class="hs-identifier hs-var">signedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950149"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950135"><span class="hs-identifier hs-var">unsignedTx2</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2915"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950150"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950149"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950129"><span class="hs-identifier hs-var">signedTx2</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException ApiTxId)
-&gt; ((Status, Either RequestException ApiTxId) -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException ApiTxId)
 -&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException ApiTxId)
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-2916"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2917"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2918"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2919"></span><span>
</span><span id="line-2920"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_MULTI_TX - Tx including \
        \payments, delegation, metadata, withdrawals, validity_interval&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2922"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950128"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2923"></span><span>
</span><span id="line-2924"></span><span>        </span><span id="local-6989586621682950127"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950127"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2925"></span><span>        </span><span id="local-6989586621682950126"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950126"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2926"></span><span>        </span><span id="local-6989586621682950125"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950125"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950126"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-2927"></span><span>
</span><span id="line-2928"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950124"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682950124"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-2929"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950123"><span class="annot"><span class="annottext">destination1 :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950123"><span class="hs-identifier hs-var hs-var">destination1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950125"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950122"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-2930"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950121"><span class="annot"><span class="annottext">destination2 :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950121"><span class="hs-identifier hs-var hs-var">destination2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950125"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950120"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-2931"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950119"><span class="annot"><span class="annottext">deposit :: Natural
</span><a href="#local-6989586621682950119"><span class="hs-identifier hs-var hs-var">deposit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682950118"><span class="hs-identifier hs-var">oneAda</span></a></span><span>
</span><span id="line-2932"></span><span>        </span><span id="local-6989586621682950117"><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950117"><span class="hs-identifier hs-var">pool'</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[ApiT PoolId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiStakePool -&gt; ApiT PoolId) -&gt; [ApiStakePool] -&gt; [ApiT PoolId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
 -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
-&gt; ApiStakePool -&gt; ApiT PoolId
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
   -&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool)
(ApiT PoolId -&gt; Const (ApiT PoolId) (ApiT PoolId))
-&gt; ApiStakePool -&gt; Const (ApiT PoolId) ApiStakePool
</span><a href="#local-6989586621682950116"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiStakePool] -&gt; [ApiT PoolId])
-&gt; ((Status, [ApiStakePool]) -&gt; [ApiStakePool])
-&gt; (Status, [ApiStakePool])
-&gt; [ApiT PoolId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, [ApiStakePool]) -&gt; [ApiStakePool]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, [ApiStakePool]) -&gt; [ApiT PoolId])
-&gt; ResourceT IO (Status, [ApiStakePool])
-&gt; ResourceT IO [ApiT PoolId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Payload
-&gt; ResourceT IO (Status, [ApiStakePool])
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span>
</span><span id="line-2933"></span><span>            </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiStakePool</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2934"></span><span>            </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Coin -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Coin
</span><a href="Test.Integration.Framework.DSL.html#arbitraryStake"><span class="hs-identifier hs-var">arbitraryStake</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2935"></span><span>
</span><span id="line-2936"></span><span>        </span><span id="local-6989586621682950115"><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950115"><span class="hs-identifier hs-var">rSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiNetworkInformation)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiNetworkInformation</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2937"></span><span>            </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getNetworkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-2938"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; [(Status, Either RequestException ApiNetworkInformation)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950115"><span class="hs-identifier hs-var">rSlot</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2939"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950114"><span class="annot"><span class="annottext">sl :: SlotNo
</span><a href="#local-6989586621682950114"><span class="hs-identifier hs-var hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiNetworkInformation SlotNo
-&gt; (Status, Either RequestException ApiNetworkInformation)
-&gt; SlotNo
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span>
</span><span id="line-2940"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;nodeTip&quot;
  ((ApiBlockReference -&gt; f ApiBlockReference)
   -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
(ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation
</span><a href="#local-6989586621682950113"><span class="hs-var">#nodeTip</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiBlockReference -&gt; f ApiBlockReference)
 -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
-&gt; ((SlotNo -&gt; f SlotNo)
    -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiNetworkInformation
-&gt; f ApiNetworkInformation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;absoluteSlotNumber&quot;
  ((ApiT SlotNo -&gt; f (ApiT SlotNo))
   -&gt; ApiBlockReference -&gt; f ApiBlockReference)
(ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; ApiBlockReference -&gt; f ApiBlockReference
</span><a href="#local-6989586621682950112"><span class="hs-var">#absoluteSlotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT SlotNo -&gt; f (ApiT SlotNo))
 -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiBlockReference
-&gt; f ApiBlockReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
(SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo)
</span><a href="#local-6989586621682950111"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950115"><span class="hs-identifier hs-var">rSlot</span></a></span><span>
</span><span id="line-2941"></span><span>
</span><span id="line-2942"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950110"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950110"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination1},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                },
                {
                    &quot;address&quot;: #{destination2},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                }],
                &quot;delegations&quot;: [{
                    &quot;join&quot;: {
                        &quot;pool&quot;: #{pool'},
                        &quot;stake_key_index&quot;: &quot;0H&quot;
                    }
                }],
                &quot;withdrawal&quot;: &quot;self&quot;,
                &quot;metadata&quot;: { &quot;1&quot;: { &quot;string&quot;: &quot;hello&quot; } },
                &quot;validity_interval&quot;: {
                    &quot;invalid_before&quot;: {
                        &quot;quantity&quot;: #{sl - 1},
                        &quot;unit&quot;: &quot;slot&quot;
                    },
                    &quot;invalid_hereafter&quot;: {
                        &quot;quantity&quot;: 30,
                        &quot;unit&quot;: &quot;second&quot;
                    }
                }
            }|]</span></span><span>
</span><span id="line-2976"></span><span>
</span><span id="line-2977"></span><span>        </span><span id="local-6989586621682950109"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950109"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-2978"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950127"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950110"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-2979"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950109"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2980"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2981"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-2982"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950108"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950107"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2983"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950106"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950105"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2984"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950104"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsTaken&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950103"><span class="hs-var">#depositsTaken</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950119"><span class="hs-identifier hs-var">deposit</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2985"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiConstructTransaction n) [Quantity &quot;lovelace&quot; Natural]
-&gt; ([Quantity &quot;lovelace&quot; Natural] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950102"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([Quantity &quot;lovelace&quot; Natural]
     -&gt; f [Quantity &quot;lovelace&quot; Natural])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([Quantity &quot;lovelace&quot; Natural]
    -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;depositsReturned&quot;
  (([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([Quantity &quot;lovelace&quot; Natural] -&gt; f [Quantity &quot;lovelace&quot; Natural])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950101"><span class="hs-var">#depositsReturned</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
-&gt; [Quantity &quot;lovelace&quot; Natural] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2986"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950100"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682950099"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2987"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950098"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950097"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2988"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2989"></span><span>
</span><span id="line-2990"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950096"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682950096"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682950095"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950094"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950109"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2991"></span><span>
</span><span id="line-2992"></span><span>        </span><span class="hs-comment">-- Sign tx</span><span>
</span><span id="line-2993"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950093"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682950093"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682950092"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950109"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-2994"></span><span>        </span><span id="local-6989586621682950091"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950091"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950127"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682950093"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2995"></span><span>        </span><span class="hs-comment">-- Submit tx</span><span>
</span><span id="line-2996"></span><span>        </span><span id="local-6989586621682950090"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950090"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950127"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682950091"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-2997"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950090"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-2998"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-2999"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-3000"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3001"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950089"><span class="annot"><span class="annottext">txId :: ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950089"><span class="hs-identifier hs-var hs-var">txId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiTxId (ApiT (Hash &quot;Tx&quot;))
-&gt; (Status, Either RequestException ApiTxId) -&gt; ApiT (Hash &quot;Tx&quot;)
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;)))
   -&gt; ApiTxId -&gt; f ApiTxId)
(ApiT (Hash &quot;Tx&quot;) -&gt; f (ApiT (Hash &quot;Tx&quot;))) -&gt; ApiTxId -&gt; f ApiTxId
</span><a href="#local-6989586621682950088"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682950090"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-3002"></span><span>
</span><span id="line-3003"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Metadata is on-chain&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3004"></span><span>            </span><span id="local-6989586621682950087"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950087"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3005"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; ApiT (Hash &quot;Tx&quot;) -&gt; (Method, Text)
forall (style :: WalletStyle) w t.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w,
 HasType (ApiT (Hash &quot;Tx&quot;)) t) =&gt;
w -&gt; t -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950127"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT (Hash &quot;Tx&quot;)
</span><a href="#local-6989586621682950089"><span class="hs-identifier hs-var">txId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3006"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
-&gt; [(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()]
-&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682950087"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-3007"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n)) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3008"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxStatus
-&gt; (TxStatus -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3009"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;status&quot;
  ((ApiT TxStatus -&gt; f (ApiT TxStatus))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950086"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TxStatus -&gt; f (ApiT TxStatus))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
-&gt; (TxStatus -&gt; f TxStatus)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus))
(TxStatus -&gt; f TxStatus) -&gt; ApiT TxStatus -&gt; f (ApiT TxStatus)
</span><a href="#local-6989586621682950085"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3010"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxStatus -&gt; TxStatus -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TxStatus
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">InLedger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3011"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiTransaction n) TxMetadata
-&gt; (TxMetadata -&gt; IO ())
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3012"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema))
   -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
(Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema))
-&gt; ApiTransaction n -&gt; f (ApiTransaction n)
</span><a href="#local-6989586621682950084"><span class="hs-var">#metadata</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema))
 -&gt; ApiTransaction n -&gt; f (ApiTransaction n))
-&gt; ((TxMetadata -&gt; f TxMetadata)
    -&gt; Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema))
-&gt; (TxMetadata -&gt; f TxMetadata)
-&gt; ApiTransaction n
-&gt; f (ApiTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMetadataWithSchema -&gt; f TxMetadataWithSchema)
-&gt; Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMetadataWithSchema -&gt; f TxMetadataWithSchema)
 -&gt; Maybe TxMetadataWithSchema -&gt; f (Maybe TxMetadataWithSchema))
-&gt; ((TxMetadata -&gt; f TxMetadata)
    -&gt; TxMetadataWithSchema -&gt; f TxMetadataWithSchema)
-&gt; (TxMetadata -&gt; f TxMetadata)
-&gt; Maybe TxMetadataWithSchema
-&gt; f (Maybe TxMetadataWithSchema)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;txMetadataWithSchema_metadata&quot;
  ((TxMetadata -&gt; f TxMetadata)
   -&gt; TxMetadataWithSchema -&gt; f TxMetadataWithSchema)
(TxMetadata -&gt; f TxMetadata)
-&gt; TxMetadataWithSchema -&gt; f TxMetadataWithSchema
</span><a href="#local-6989586621682950082"><span class="hs-var">#txMetadataWithSchema_metadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3013"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxMetadata -&gt; TxMetadata -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; TxMetadata
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Word64, TxMetadataValue)] -&gt; Map Word64 TxMetadataValue
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; TxMetadataValue
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TxMetaText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hello&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3014"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3015"></span><span>
</span><span id="line-3016"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Delegation certificates are inserted&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3017"></span><span>            </span><span id="local-6989586621682950081"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950081"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3018"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950127"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3019"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950081"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-3020"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3021"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet ApiWalletDelegation
-&gt; (ApiWalletDelegation -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span class="hs-cpp">
                        #delegation
</span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWalletDelegation -&gt; ApiWalletDelegation -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
-&gt; [(Maybe (ApiT PoolId), ApiEpochInfo)] -&gt; ApiWalletDelegation
</span><a href="Test.Integration.Framework.DSL.html#delegating"><span class="hs-identifier hs-var">delegating</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT PoolId
</span><a href="#local-6989586621682950117"><span class="hs-identifier hs-var">pool'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3024"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3025"></span><span>
</span><span id="line-3026"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Destination wallet balance is as expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3027"></span><span>            </span><span id="local-6989586621682950079"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950079"><span class="hs-identifier hs-var">rWb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3028"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950126"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3029"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950079"><span class="hs-identifier hs-var">rWb</span></a></span><span>
</span><span id="line-3030"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3031"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3032"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950078"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950077"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950076"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3033"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950124"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-3034"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3035"></span><span>
</span><span id="line-3036"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Source wallet balance is as expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3037"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950075"><span class="annot"><span class="annottext">balance :: Natural
</span><a href="#local-6989586621682950075"><span class="hs-identifier hs-var hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682951327"><span class="hs-identifier hs-var">oneMillionAda</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950124"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950096"><span class="hs-identifier hs-var">expectedFee</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950119"><span class="hs-identifier hs-var">deposit</span></a></span><span>
</span><span id="line-3038"></span><span>            </span><span id="local-6989586621682950074"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950074"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950128"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3039"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950127"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3040"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682950074"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-3041"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3042"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3043"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682950073"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682950072"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682950071"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3044"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682950075"><span class="hs-identifier hs-var">balance</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3045"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3046"></span><span>
</span><span id="line-3047"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10c - Minting/burning assets - \
        \one cosigner in template other than cosigner#0&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3049"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950070"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950070"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3050"></span><span>        </span><span id="local-6989586621682950069"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950069"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950070"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3051"></span><span>        </span><span id="local-6989586621682950068"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950068"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950070"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950069"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3052"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950067"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950067"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950068"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950066"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3053"></span><span>
</span><span id="line-3054"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950065"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950065"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                           [ &quot;cosigner#1&quot;,
                             { &quot;active_from&quot;: 120 }
                           ]
                        },
                    &quot;asset_name&quot;: &quot;ab12&quot;,
                    &quot;operation&quot;:
                        { &quot;mint&quot; :
                              { &quot;receiving_address&quot;: #{destination},
                                 &quot;quantity&quot;: 10000
                              }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3071"></span><span>
</span><span id="line-3072"></span><span>        </span><span id="local-6989586621682950064"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950064"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950070"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3073"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950069"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950065"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3074"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950064"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3075"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3076"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403CreatedWrongPolicyScriptTemplateTx"><span class="hs-identifier hs-var">errMsg403CreatedWrongPolicyScriptTemplateTx</span></a></span><span>
</span><span id="line-3077"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3078"></span><span>
</span><span id="line-3079"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10l - Minting when assetName too long&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3080"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950063"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950063"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3081"></span><span>
</span><span id="line-3082"></span><span>        </span><span id="local-6989586621682950062"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950062"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950063"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3083"></span><span>        </span><span id="local-6989586621682950061"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950061"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950063"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950062"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3084"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950060"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950060"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950061"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950059"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3085"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950058"><span class="annot"><span class="annottext">assetNameTooLong :: String
</span><a href="#local-6989586621682950058"><span class="hs-identifier hs-var hs-var">assetNameTooLong</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; String
forall a. Int -&gt; a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">66</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'1'</span></span><span>
</span><span id="line-3086"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950056"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950056"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;: &quot;cosigner#0&quot;,
                    &quot;asset_name&quot;: #{assetNameTooLong},
                    &quot;operation&quot;:
                        { &quot;mint&quot; :
                              { &quot;receiving_address&quot;: #{destination},
                                 &quot;quantity&quot;: 10000
                              }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3098"></span><span>
</span><span id="line-3099"></span><span>        </span><span id="local-6989586621682950055"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950055"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950063"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3100"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950062"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950056"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3101"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950055"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3102"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3103"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403AssetNameTooLong"><span class="hs-identifier hs-var">errMsg403AssetNameTooLong</span></a></span><span>
</span><span id="line-3104"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3105"></span><span>
</span><span id="line-3106"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10m1 - Minting amount too big&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3107"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950054"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950054"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3108"></span><span>        </span><span id="local-6989586621682950053"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950053"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950054"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3109"></span><span>        </span><span id="local-6989586621682950052"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950052"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950054"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950053"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3110"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950051"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950051"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950052"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950050"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3111"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950049"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950049"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;: &quot;cosigner#0&quot;,
                    &quot;asset_name&quot;: &quot;ab12&quot;,
                    &quot;operation&quot;:
                        { &quot;mint&quot; :
                              { &quot;receiving_address&quot;: #{destination},
                                 &quot;quantity&quot;: 9223372036854775808
                              }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3123"></span><span>
</span><span id="line-3124"></span><span>        </span><span id="local-6989586621682950048"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950048"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950054"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3125"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950053"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950049"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3126"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950048"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3127"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3128"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span>
</span><span id="line-3129"></span><span>                </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MintOrBurnAssetQuantityOutOfBounds"><span class="hs-identifier hs-var">errMsg403MintOrBurnAssetQuantityOutOfBounds</span></a></span><span>
</span><span id="line-3130"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3131"></span><span>
</span><span id="line-3132"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10m2 - Minting amount = 0&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3133"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950047"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950047"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3134"></span><span>        </span><span id="local-6989586621682950046"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950046"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950047"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3135"></span><span>        </span><span id="local-6989586621682950045"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950045"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950047"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950046"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3136"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950044"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950044"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950045"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950043"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3137"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950042"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950042"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;: &quot;cosigner#0&quot;,
                    &quot;asset_name&quot;: &quot;ab12&quot;,
                    &quot;operation&quot;:
                        { &quot;mint&quot; :
                              { &quot;receiving_address&quot;: #{destination},
                                 &quot;quantity&quot;: 0
                              }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3149"></span><span>
</span><span id="line-3150"></span><span>        </span><span id="local-6989586621682950041"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950041"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950047"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3151"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950046"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950042"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3152"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950041"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3153"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3154"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MintOrBurnAssetQuantityOutOfBounds"><span class="hs-identifier hs-var">errMsg403MintOrBurnAssetQuantityOutOfBounds</span></a></span><span>
</span><span id="line-3155"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3156"></span><span>
</span><span id="line-3157"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10d - Minting assets without timelock&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3158"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950040"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950040"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3159"></span><span>        </span><span id="local-6989586621682950039"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950039"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950040"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3160"></span><span>        </span><span id="local-6989586621682950038"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950038"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950040"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950039"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3161"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950037"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950037"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950038"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950036"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3162"></span><span>
</span><span id="line-3163"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682950035"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682950035"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Either String TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;ab12&quot;</span></span><span>
</span><span id="line-3164"></span><span>
</span><span id="line-3165"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950034"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950034"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                           [ &quot;cosigner#0&quot;
                           ]
                        },
                    &quot;asset_name&quot;: #{toText tokenName'},
                    &quot;operation&quot;:
                        { &quot;mint&quot; :
                              { &quot;receiving_address&quot;: #{destination},
                                 &quot;quantity&quot;: 50000
                              }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3181"></span><span>
</span><span id="line-3182"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950033"><span class="annot"><span class="annottext">scriptUsed :: elem -&gt; Script elem
</span><a href="#local-6989586621682950033"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span id="local-6989586621682950032"><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682950032"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Script elem] -&gt; Script elem
forall elem. [Script elem] -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireAllOf</span></a></span><span>
</span><span id="line-3183"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">elem -&gt; Script elem
forall elem. elem -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireSignatureOf</span></a></span><span> </span><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682950032"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span>
</span><span id="line-3184"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3185"></span><span>
</span><span id="line-3186"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682950031"><span class="hs-identifier hs-var">mintAssetsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950040"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950039"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682950035"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950034"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="#local-6989586621682950033"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3187"></span><span>
</span><span id="line-3188"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10e - Minting assets with timelocks \
       \successful as validity interval is inside time interval \
       \of a script&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3191"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950030"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950030"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3192"></span><span>
</span><span id="line-3193"></span><span>       </span><span class="hs-comment">--      slot 0       sl+10</span><span>
</span><span id="line-3194"></span><span>       </span><span class="hs-comment">--         |-----------&gt;       validity interval</span><span>
</span><span id="line-3195"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-3196"></span><span>       </span><span class="hs-comment">--         |--------------&gt;      script's timelock interval</span><span>
</span><span id="line-3197"></span><span>       </span><span class="hs-comment">--                       sl+11</span><span>
</span><span id="line-3198"></span><span>
</span><span id="line-3199"></span><span>        </span><span id="local-6989586621682950029"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950029"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950030"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3200"></span><span>        </span><span id="local-6989586621682950028"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950028"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950030"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950029"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3201"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950027"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950027"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950028"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950026"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3202"></span><span>
</span><span id="line-3203"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682950025"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682950025"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Either String TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;ab12&quot;</span></span><span>
</span><span id="line-3204"></span><span>
</span><span id="line-3205"></span><span>        </span><span id="local-6989586621682950024"><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950024"><span class="hs-identifier hs-var">rSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiNetworkInformation)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiNetworkInformation</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950030"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3206"></span><span>            </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getNetworkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3207"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; [(Status, Either RequestException ApiNetworkInformation)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950024"><span class="hs-identifier hs-var">rSlot</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3208"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span> </span><span id="local-6989586621682950023"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682950023"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiNetworkInformation SlotNo
-&gt; (Status, Either RequestException ApiNetworkInformation)
-&gt; SlotNo
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span>
</span><span id="line-3209"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;nodeTip&quot;
  ((ApiBlockReference -&gt; f ApiBlockReference)
   -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
(ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation
</span><a href="#local-6989586621682950022"><span class="hs-var">#nodeTip</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiBlockReference -&gt; f ApiBlockReference)
 -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
-&gt; ((SlotNo -&gt; f SlotNo)
    -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiNetworkInformation
-&gt; f ApiNetworkInformation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;absoluteSlotNumber&quot;
  ((ApiT SlotNo -&gt; f (ApiT SlotNo))
   -&gt; ApiBlockReference -&gt; f ApiBlockReference)
(ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; ApiBlockReference -&gt; f ApiBlockReference
</span><a href="#local-6989586621682950021"><span class="hs-var">#absoluteSlotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT SlotNo -&gt; f (ApiT SlotNo))
 -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiBlockReference
-&gt; f ApiBlockReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
(SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo)
</span><a href="#local-6989586621682950020"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950024"><span class="hs-identifier hs-var">rSlot</span></a></span><span>
</span><span id="line-3210"></span><span>
</span><span id="line-3211"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950019"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950019"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;validity_interval&quot;: {
                    &quot;invalid_hereafter&quot;: {
                        &quot;quantity&quot;: #{sl + 10},
                        &quot;unit&quot;: &quot;slot&quot;
                    }
                },
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                           [ &quot;cosigner#0&quot;,
                             { &quot;active_until&quot;: #{sl + 11} }
                           ]
                        },
                    &quot;asset_name&quot;: #{toText tokenName'},
                    &quot;operation&quot;:
                        { &quot;mint&quot; :
                              { &quot;receiving_address&quot;: #{destination},
                                 &quot;quantity&quot;: 50000
                              }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3234"></span><span>
</span><span id="line-3235"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950018"><span class="annot"><span class="annottext">scriptUsed :: KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682950018"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span id="local-6989586621682950017"><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682950017"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Script KeyHash] -&gt; Script KeyHash
forall elem. [Script elem] -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireAllOf</span></a></span><span>
</span><span id="line-3236"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireSignatureOf</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682950017"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span>
</span><span id="line-3237"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Script KeyHash
forall elem. Natural -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">ActiveUntilSlot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Natural) -&gt; Word64 -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682950023"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">11</span></span><span class="hs-special">)</span><span>
</span><span id="line-3238"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3239"></span><span>
</span><span id="line-3240"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682950031"><span class="hs-identifier hs-var">mintAssetsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950030"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950029"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682950025"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950019"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682950018"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3241"></span><span>
</span><span id="line-3242"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10e - \
        \Minting assets with timelocks not successful as validity interval \
        \is not inside time interval of a script&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3245"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950015"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950015"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3246"></span><span>
</span><span id="line-3247"></span><span>       </span><span class="hs-comment">--      slot 0       sl+10</span><span>
</span><span id="line-3248"></span><span>       </span><span class="hs-comment">--         |-----------&gt;       validity interval</span><span>
</span><span id="line-3249"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-3250"></span><span>       </span><span class="hs-comment">--               |--------------&gt;      script's timelock interval</span><span>
</span><span id="line-3251"></span><span>       </span><span class="hs-comment">--               slot 5        sl+11</span><span>
</span><span id="line-3252"></span><span>
</span><span id="line-3253"></span><span>        </span><span id="local-6989586621682950014"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950014"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950015"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3254"></span><span>        </span><span id="local-6989586621682950013"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950013"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950015"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950014"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3255"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950012"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682950012"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950013"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682950011"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3256"></span><span>
</span><span id="line-3257"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682950010"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682950010"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Either String TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;ab12&quot;</span></span><span>
</span><span id="line-3258"></span><span>
</span><span id="line-3259"></span><span>        </span><span id="local-6989586621682950009"><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950009"><span class="hs-identifier hs-var">rSlot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException ApiNetworkInformation)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiNetworkInformation</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950015"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3260"></span><span>            </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getNetworkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3261"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; [(Status, Either RequestException ApiNetworkInformation)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950009"><span class="hs-identifier hs-var">rSlot</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3262"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../../../../cardano-slotting/html/src"><span class="hs-identifier hs-type">SlotNo</span></a></span><span> </span><span id="local-6989586621682950008"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621682950008"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' ApiNetworkInformation SlotNo
-&gt; (Status, Either RequestException ApiNetworkInformation)
-&gt; SlotNo
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span>
</span><span id="line-3263"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;nodeTip&quot;
  ((ApiBlockReference -&gt; f ApiBlockReference)
   -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
(ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation
</span><a href="#local-6989586621682950007"><span class="hs-var">#nodeTip</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiBlockReference -&gt; f ApiBlockReference)
 -&gt; ApiNetworkInformation -&gt; f ApiNetworkInformation)
-&gt; ((SlotNo -&gt; f SlotNo)
    -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiNetworkInformation
-&gt; f ApiNetworkInformation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;absoluteSlotNumber&quot;
  ((ApiT SlotNo -&gt; f (ApiT SlotNo))
   -&gt; ApiBlockReference -&gt; f ApiBlockReference)
(ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; ApiBlockReference -&gt; f ApiBlockReference
</span><a href="#local-6989586621682950006"><span class="hs-var">#absoluteSlotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT SlotNo -&gt; f (ApiT SlotNo))
 -&gt; ApiBlockReference -&gt; f ApiBlockReference)
-&gt; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
-&gt; (SlotNo -&gt; f SlotNo)
-&gt; ApiBlockReference
-&gt; f ApiBlockReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot; ((SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo))
(SlotNo -&gt; f SlotNo) -&gt; ApiT SlotNo -&gt; f (ApiT SlotNo)
</span><a href="#local-6989586621682950005"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiNetworkInformation)
</span><a href="#local-6989586621682950009"><span class="hs-identifier hs-var">rSlot</span></a></span><span>
</span><span id="line-3264"></span><span>
</span><span id="line-3265"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682950004"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682950004"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;validity_interval&quot;:
                    { &quot;invalid_hereafter&quot;:
                        { &quot;quantity&quot;: #{sl + 10}
                        , &quot;unit&quot;: &quot;slot&quot;
                        }
                    }
                , &quot;mint_burn&quot;:
                    [   { &quot;policy_script_template&quot;:
                            { &quot;all&quot;:
                                [ &quot;cosigner#0&quot;
                                , { &quot;active_until&quot;: #{sl + 11} }
                                , { &quot;active_from&quot;: 5 }
                                ]
                            }
                        , &quot;asset_name&quot;: #{toText tokenName'}
                        , &quot;operation&quot;:
                            { &quot;mint&quot;:
                                { &quot;receiving_address&quot;: #{destination}
                                , &quot;quantity&quot;: 50000
                                }
                            }
                        }
                    ]
                }|]</span></span><span>
</span><span id="line-3290"></span><span>
</span><span id="line-3291"></span><span>        </span><span id="local-6989586621682950003"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950003"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950015"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3292"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950014"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682950004"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3293"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682950003"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3294"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3295"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span>
</span><span id="line-3296"></span><span>                </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403ValidityIntervalNotInsideScriptTimelock"><span class="hs-identifier hs-var">errMsg403ValidityIntervalNotInsideScriptTimelock</span></a></span><span>
</span><span id="line-3297"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3298"></span><span>
</span><span id="line-3299"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10f - Burning assets without timelock&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3300"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682950002"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950002"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3301"></span><span>
</span><span id="line-3302"></span><span>        </span><span id="local-6989586621682950001"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950001"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950002"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3303"></span><span>        </span><span id="local-6989586621682950000"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950000"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950002"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950001"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3304"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949999"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682949999"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682950000"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682949998"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3305"></span><span>
</span><span id="line-3306"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682949997"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949997"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Either String TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;ab12&quot;</span></span><span>
</span><span id="line-3307"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949996"><span class="annot"><span class="annottext">payloadMint :: Payload
</span><a href="#local-6989586621682949996"><span class="hs-identifier hs-var hs-var">payloadMint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                            [ &quot;cosigner#0&quot;
                            ]
                        },
                    &quot;asset_name&quot;: #{toText tokenName'},
                    &quot;operation&quot;:
                        { &quot;mint&quot; :
                            { &quot;receiving_address&quot;: #{destination},
                              &quot;quantity&quot;: 50000
                            }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3323"></span><span>
</span><span id="line-3324"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949995"><span class="annot"><span class="annottext">scriptUsed :: elem -&gt; Script elem
</span><a href="#local-6989586621682949995"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span id="local-6989586621682949994"><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682949994"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Script elem] -&gt; Script elem
forall elem. [Script elem] -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireAllOf</span></a></span><span>
</span><span id="line-3325"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">elem -&gt; Script elem
forall elem. elem -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireSignatureOf</span></a></span><span> </span><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682949994"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span>
</span><span id="line-3326"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3327"></span><span>
</span><span id="line-3328"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682950031"><span class="hs-identifier hs-var">mintAssetsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950002"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950001"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949997"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949996"><span class="hs-identifier hs-var">payloadMint</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="#local-6989586621682949995"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3329"></span><span>
</span><span id="line-3330"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949993"><span class="annot"><span class="annottext">payloadBurn :: Payload
</span><a href="#local-6989586621682949993"><span class="hs-identifier hs-var hs-var">payloadBurn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                            [ &quot;cosigner#0&quot;
                            ]
                        },
                    &quot;asset_name&quot;: #{toText tokenName'},
                    &quot;operation&quot;:
                        { &quot;burn&quot; :
                            { &quot;quantity&quot;: 50000
                            }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3345"></span><span>
</span><span id="line-3346"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682949992"><span class="hs-identifier hs-var">burnAssetsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682950002"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682950001"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949997"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949993"><span class="hs-identifier hs-var">payloadBurn</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="#local-6989586621682949995"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3347"></span><span>
</span><span id="line-3348"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10g - Burning assets without timelock and token name&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3349"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682949991"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949991"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3350"></span><span>
</span><span id="line-3351"></span><span>        </span><span id="local-6989586621682949990"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949990"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949991"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3352"></span><span>        </span><span id="local-6989586621682949989"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949989"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949991"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949990"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3353"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949988"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682949988"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949989"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682949987"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3354"></span><span>
</span><span id="line-3355"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682949986"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949986"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Either String TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-3356"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949985"><span class="annot"><span class="annottext">payloadMint :: Payload
</span><a href="#local-6989586621682949985"><span class="hs-identifier hs-var hs-var">payloadMint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [
                    { &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                            [ &quot;cosigner#0&quot;
                            ]
                        }
                    , &quot;operation&quot;:
                        { &quot;mint&quot;:
                            { &quot;receiving_address&quot;: #{destination}
                            , &quot;quantity&quot;: 50000
                            }
                        }
                    }
                ]
            }|]</span></span><span>
</span><span id="line-3372"></span><span>
</span><span id="line-3373"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949984"><span class="annot"><span class="annottext">scriptUsed :: elem -&gt; Script elem
</span><a href="#local-6989586621682949984"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span id="local-6989586621682949983"><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682949983"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Script elem] -&gt; Script elem
forall elem. [Script elem] -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireAllOf</span></a></span><span>
</span><span id="line-3374"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">elem -&gt; Script elem
forall elem. elem -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireSignatureOf</span></a></span><span> </span><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682949983"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span>
</span><span id="line-3375"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3376"></span><span>
</span><span id="line-3377"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682950031"><span class="hs-identifier hs-var">mintAssetsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949991"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949990"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949986"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949985"><span class="hs-identifier hs-var">payloadMint</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="#local-6989586621682949984"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3378"></span><span>
</span><span id="line-3379"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949982"><span class="annot"><span class="annottext">payloadBurn :: Payload
</span><a href="#local-6989586621682949982"><span class="hs-identifier hs-var hs-var">payloadBurn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [{
                    &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                            [ &quot;cosigner#0&quot;
                            ]
                        },
                    &quot;operation&quot;:
                        { &quot;burn&quot; :
                            { &quot;quantity&quot;: 50000
                            }
                        }
                }]
            }|]</span></span><span>
</span><span id="line-3393"></span><span>
</span><span id="line-3394"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682949992"><span class="hs-identifier hs-var">burnAssetsCheck</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949991"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949990"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949986"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949982"><span class="hs-identifier hs-var">payloadBurn</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="#local-6989586621682949984"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3395"></span><span>
</span><span id="line-3396"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_10h - \
        \Minting assets without timelock to foreign address&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3398"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682949981"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3399"></span><span>        </span><span id="local-6989586621682949980"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949980"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3400"></span><span>        </span><span id="local-6989586621682949979"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949979"><span class="hs-identifier hs-var">wForeign</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3401"></span><span>        </span><span id="local-6989586621682949978"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949978"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949979"><span class="hs-identifier hs-var">wForeign</span></a></span><span>
</span><span id="line-3402"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949977"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682949977"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949978"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682949976"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3403"></span><span>
</span><span id="line-3404"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682949975"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949975"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Either String TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;ab12&quot;</span></span><span>
</span><span id="line-3405"></span><span>
</span><span id="line-3406"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949974"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949974"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;mint_burn&quot;: [
                    { &quot;policy_script_template&quot;:
                        { &quot;all&quot;:
                           [ &quot;cosigner#0&quot;
                           ]
                        }
                    , &quot;asset_name&quot;: #{toText tokenName'}
                    , &quot;operation&quot;:
                        { &quot;mint&quot;:
                            { &quot;receiving_address&quot;: #{destination}
                            , &quot;quantity&quot;: 50000
                            }
                        }
                    }
                ]
            }|]</span></span><span>
</span><span id="line-3423"></span><span>
</span><span id="line-3424"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949973"><span class="annot"><span class="annottext">scriptUsed :: elem -&gt; Script elem
</span><a href="#local-6989586621682949973"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span id="local-6989586621682949972"><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682949972"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Script elem] -&gt; Script elem
forall elem. [Script elem] -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireAllOf</span></a></span><span>
</span><span id="line-3425"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">elem -&gt; Script elem
forall elem. elem -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireSignatureOf</span></a></span><span> </span><span class="annot"><span class="annottext">elem
</span><a href="#local-6989586621682949972"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span>
</span><span id="line-3426"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3427"></span><span>
</span><span id="line-3428"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682949971"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949971"><span class="hs-identifier hs-var">initialBalance</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949970"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949970"><span class="hs-identifier hs-var">expectedFee</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949969"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682949969"><span class="hs-identifier hs-var">tokens'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3429"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; ResourceT IO (Natural, Natural, TokenMap)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m (Natural, Natural, TokenMap)
</span><a href="#local-6989586621682949968"><span class="hs-identifier hs-var">mintAssetsCheckWithoutBalanceCheck</span></a></span><span>
</span><span id="line-3430"></span><span>                </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949980"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949975"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949974"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="#local-6989586621682949973"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3431"></span><span>
</span><span id="line-3432"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949967"><span class="annot"><span class="annottext">minutxo :: Natural
</span><a href="#local-6989586621682949967"><span class="hs-identifier hs-var hs-var">minutxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3433"></span><span>        </span><span class="hs-comment">-- we are sending to external address and it must be more than minimum</span><span>
</span><span id="line-3434"></span><span>        </span><span class="hs-comment">-- UTxO plus additional adjusting of assets in output. Here, we are</span><span>
</span><span id="line-3435"></span><span>        </span><span class="hs-comment">-- having 80-byte (10-word) asset's additional burden</span><span>
</span><span id="line-3436"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-3437"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949966"><span class="annot"><span class="annottext">minUtxoWithAsset :: Natural
</span><a href="#local-6989586621682949966"><span class="hs-identifier hs-var hs-var">minUtxoWithAsset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949967"><span class="hs-identifier hs-var">minutxo</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span>
</span><span id="line-3438"></span><span>                </span><span class="hs-comment">-- The extra amount is dependent on the era:</span><span>
</span><span id="line-3439"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; ApiEra -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiBabbage</span></a></span><span>
</span><span id="line-3440"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">193_950</span></span><span>
</span><span id="line-3441"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">344_820</span></span><span> </span><span class="hs-comment">-- = 34_482 lovelace per word * 10 words</span><span>
</span><span id="line-3442"></span><span>
</span><span id="line-3443"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span>
</span><span id="line-3444"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is decreased by fee and adjusted minimum UTxO and \
            \does not hold minted assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3446"></span><span>            </span><span id="local-6989586621682949965"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949965"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3447"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949980"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3448"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949965"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-3449"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3450"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3451"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949964"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682949963"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949962"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3452"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949971"><span class="hs-identifier hs-var">initialBalance</span></a></span><span>
</span><span id="line-3453"></span><span>                        </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949970"><span class="hs-identifier hs-var">expectedFee</span></a></span><span>
</span><span id="line-3454"></span><span>                        </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949966"><span class="hs-identifier hs-var">minUtxoWithAsset</span></a></span><span>
</span><span id="line-3455"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-3456"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949961"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949960"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949959"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3457"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3458"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949958"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949957"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949956"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3459"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3460"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3461"></span><span>
</span><span id="line-3462"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span>
</span><span id="line-3463"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Foreign Wallet balance is adjusted minimum UTxO and \
            \holds minted assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3465"></span><span>            </span><span id="local-6989586621682949955"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949955"><span class="hs-identifier hs-var">rForeign</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949981"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3466"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949979"><span class="hs-identifier hs-var">wForeign</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3467"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949955"><span class="hs-identifier hs-var">rForeign</span></a></span><span>
</span><span id="line-3468"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3469"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3470"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949954"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682949953"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949952"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3471"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949966"><span class="hs-identifier hs-var">minUtxoWithAsset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3472"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949951"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949950"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949949"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3473"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682949969"><span class="hs-identifier hs-var">tokens'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3474"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949948"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949947"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949946"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3475"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682949969"><span class="hs-identifier hs-var">tokens'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3476"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3477"></span><span>
</span><span id="line-3478"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_MINT_SCRIPTS_WRONG - I cannot mint with incorrect policy scripts&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3479"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949945"><span class="annot"><span class="annottext">scenarios :: [(String, Value)]
</span><a href="#local-6989586621682949945"><span class="hs-identifier hs-var hs-var">scenarios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3480"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no cosigner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;active_from&quot;: 0 }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3481"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all, no cosigner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;all&quot;: [ { &quot;active_from&quot;: 120 } ] }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3482"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;any, no cosigner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;any&quot;: [ { &quot;active_until&quot;: 120 } ] }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3483"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;some, no cosigner&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;some&quot;: { &quot;at_least&quot;: 1, &quot;from&quot;: [ { &quot;active_from&quot;: 120 } ]} }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3484"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;some, at least 2&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;some&quot;: { &quot;at_least&quot;: 2, &quot;from&quot;: [ &quot;cosigner#0&quot;, { &quot;active_from&quot;: 120 } ]} }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3485"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all, many cosigners&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;all&quot;: [ &quot;cosigner#0&quot;, &quot;cosigner#1&quot;, { &quot;active_from&quot;: 120 } ] }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3486"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;any, many cosigners&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;any&quot;: [ &quot;cosigner#0&quot;, &quot;cosigner#1&quot; ] }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3487"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all, cosigner#1&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;all&quot;: [ &quot;cosigner#1&quot; ] }|]</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3488"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-3489"></span><span>        </span><span class="annot"><span class="annottext">[(String, Value)]
-&gt; ((String, Value) -&gt; SpecWith Context) -&gt; SpecWith Context
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Value)]
</span><a href="#local-6989586621682949945"><span class="hs-identifier hs-var">scenarios</span></a></span><span> </span><span class="annot"><span class="annottext">(((String, Value) -&gt; SpecWith Context) -&gt; SpecWith Context)
-&gt; ((String, Value) -&gt; SpecWith Context) -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682949944"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682949944"><span class="hs-identifier hs-var">title</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949943"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682949943"><span class="hs-identifier hs-var">policyScriptTemplate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682949944"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682949942"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949942"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3490"></span><span>            </span><span id="local-6989586621682949941"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949941"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949942"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3491"></span><span>            </span><span id="local-6989586621682949940"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949940"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949942"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949941"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3492"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949939"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682949939"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949940"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682949938"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3493"></span><span>
</span><span id="line-3494"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949937"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949937"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                    &quot;mint_burn&quot;: [{
                        &quot;policy_script_template&quot;: #{policyScriptTemplate},
                        &quot;asset_name&quot;: &quot;ab12&quot;,
                        &quot;operation&quot;:
                            { &quot;mint&quot; :
                                  { &quot;receiving_address&quot;: #{destination},
                                     &quot;quantity&quot;: 10000
                                  }
                            }
                    }]
                }|]</span></span><span>
</span><span id="line-3506"></span><span>
</span><span id="line-3507"></span><span>            </span><span id="local-6989586621682949936"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949936"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949942"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3508"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949941"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949937"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3509"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949936"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3510"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3511"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403CreatedWrongPolicyScriptTemplateTx"><span class="hs-identifier hs-var">errMsg403CreatedWrongPolicyScriptTemplateTx</span></a></span><span>
</span><span id="line-3512"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-3513"></span><span>
</span><span id="line-3514"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_MINT_SCRIPTS - I can mint and burn with correct policy scripts&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3515"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949935"><span class="annot"><span class="annottext">scenarios :: [(String, Value, Bool)]
</span><a href="#local-6989586621682949935"><span class="hs-identifier hs-var hs-var">scenarios</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3516"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;all&quot;: [ &quot;cosigner#0&quot; ] }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3517"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;any&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;any&quot;: [ &quot;cosigner#0&quot; ] }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3518"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;some&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;some&quot;: {&quot;at_least&quot;: 1, &quot;from&quot;: [ &quot;cosigner#0&quot; ]} }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3519"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all, active_until 57297561&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;all&quot;: [ &quot;cosigner#0&quot;,  { &quot;active_until&quot;: 57297561 } ] }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3520"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;any, active_until 57297561&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;any&quot;: [ &quot;cosigner#0&quot;,  { &quot;active_until&quot;: 57297561 } ] }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3521"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;some, active_until 57297561&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;some&quot;: {&quot;at_least&quot;: 1, &quot;from&quot;: [ &quot;cosigner#0&quot;, { &quot;active_until&quot;: 57297561 } ]} }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3522"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all, active_from 10&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;all&quot;: [ &quot;cosigner#0&quot;,  { &quot;active_from&quot;: 10 } ] }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3523"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;any, active_from 10&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;any&quot;: [ &quot;cosigner#0&quot;,  { &quot;active_from&quot;: 10 } ] }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3524"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;some, active_from 10&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;some&quot;: {&quot;at_least&quot;: 1, &quot;from&quot;: [ &quot;cosigner#0&quot;, { &quot;active_from&quot;: 10 } ]} }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3525"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all, active_from 10, active_until 57297561&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;all&quot;: [ &quot;cosigner#0&quot;,  { &quot;active_from&quot;: 10 }, { &quot;active_until&quot;: 57297561 } ] }|]</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3526"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;any, active_until 57297561, active_from 58297561&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;any&quot;: [ &quot;cosigner#0&quot;,  { &quot;active_until&quot;: 57297561 }, { &quot;active_from&quot;: 58297561 } ] }|]</span></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3527"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;some, active_from 10, active_until 57297561&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">[json|{ &quot;some&quot;: {&quot;at_least&quot;: 1, &quot;from&quot;: [ &quot;cosigner#0&quot;, { &quot;active_from&quot;: 10 }, { &quot;active_until&quot;: 57297561 } ]} }|]</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-3528"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-3529"></span><span>        </span><span class="annot"><span class="annottext">[(String, Value, Bool)]
-&gt; ((String, Value, Bool) -&gt; SpecWith Context) -&gt; SpecWith Context
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Value, Bool)]
</span><a href="#local-6989586621682949935"><span class="hs-identifier hs-var">scenarios</span></a></span><span> </span><span class="annot"><span class="annottext">(((String, Value, Bool) -&gt; SpecWith Context) -&gt; SpecWith Context)
-&gt; ((String, Value, Bool) -&gt; SpecWith Context) -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682949934"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682949934"><span class="hs-identifier hs-var">title</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949933"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621682949933"><span class="hs-identifier hs-var">policyScriptTemplate</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949932"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682949932"><span class="hs-identifier hs-var">addInvalidBefore</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682949934"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682949931"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3530"></span><span>            </span><span id="local-6989586621682949930"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3531"></span><span>
</span><span id="line-3532"></span><span>            </span><span class="hs-comment">-- Mint it!</span><span>
</span><span id="line-3533"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949929"><span class="annot"><span class="annottext">payloadMint :: Payload
</span><a href="#local-6989586621682949929"><span class="hs-identifier hs-var hs-var">payloadMint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3534"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682949932"><span class="hs-identifier hs-var">addInvalidBefore</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                    &quot;mint_burn&quot;: [
                        { &quot;policy_script_template&quot;: #{policyScriptTemplate}
                        , &quot;asset_name&quot;: &quot;1111&quot;
                        , &quot;operation&quot;: { &quot;mint&quot;: { &quot;quantity&quot;: 50000 } }
                        }
                    ],
                    &quot;validity_interval&quot;:
                      { &quot;invalid_before&quot;:
                          { &quot;quantity&quot;: 11
                          , &quot;unit&quot;: &quot;slot&quot;
                          }
                      }
                }|]</span></span><span>
</span><span id="line-3548"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                    &quot;mint_burn&quot;: [
                        { &quot;policy_script_template&quot;: #{policyScriptTemplate}
                        , &quot;asset_name&quot;: &quot;1111&quot;
                        , &quot;operation&quot;: { &quot;mint&quot;: { &quot;quantity&quot;: 50000 } }
                        }
                    ]
                }|]</span></span><span>
</span><span id="line-3556"></span><span>
</span><span id="line-3557"></span><span>            </span><span id="local-6989586621682949928"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949928"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3558"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949929"><span class="hs-identifier hs-var">payloadMint</span></a></span><span>
</span><span id="line-3559"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949928"><span class="hs-identifier hs-var">rTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3560"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949927"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682949927"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682949926"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949928"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3561"></span><span>            </span><span id="local-6989586621682949925"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949925"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949927"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3562"></span><span>            </span><span id="local-6989586621682949924"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949924"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949925"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-3563"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949924"><span class="hs-identifier hs-var">submittedTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3564"></span><span>
</span><span id="line-3565"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949923"><span class="annot"><span class="annottext">initialBalance :: Natural
</span><a href="#local-6989586621682949923"><span class="hs-identifier hs-var hs-var">initialBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; ApiWallet -&gt; Const Natural ApiWallet)
-&gt; Natural
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
   -&gt; ApiWallet -&gt; Const Natural ApiWallet)
(ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; ApiWallet -&gt; Const Natural ApiWallet
</span><a href="#local-6989586621682949922"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
 -&gt; ApiWallet -&gt; Const Natural ApiWallet)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; ApiWallet
-&gt; Const Natural ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural
    -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural
 -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance
</span><a href="#local-6989586621682949921"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural
  -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural
    -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; ApiWalletBalance
-&gt; Const Natural ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; Const Natural Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural
   -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; Const Natural Natural)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Const Natural (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949920"><span class="hs-var">#getQuantity</span></a></span><span>
</span><span id="line-3566"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949919"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682949919"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682949918"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949917"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949928"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3567"></span><span>
</span><span id="line-3568"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Assets are minted!&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3569"></span><span>                </span><span id="local-6989586621682949916"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949916"><span class="hs-identifier hs-var">rW</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3570"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3571"></span><span>                </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949916"><span class="hs-identifier hs-var">rW</span></a></span><span>
</span><span id="line-3572"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3573"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3574"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949915"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682949914"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949913"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3575"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949923"><span class="hs-identifier hs-var">initialBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949919"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3576"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949912"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949911"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949910"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3577"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3578"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949909"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949908"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949907"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3579"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3580"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-3581"></span><span>
</span><span id="line-3582"></span><span>            </span><span class="hs-comment">-- Burn it!</span><span>
</span><span id="line-3583"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949906"><span class="annot"><span class="annottext">payloadBurn :: Payload
</span><a href="#local-6989586621682949906"><span class="hs-identifier hs-var hs-var">payloadBurn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3584"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621682949932"><span class="hs-identifier hs-var">addInvalidBefore</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                    &quot;mint_burn&quot;: [
                        { &quot;policy_script_template&quot;: #{policyScriptTemplate}
                        , &quot;asset_name&quot;: &quot;1111&quot;
                        , &quot;operation&quot;: { &quot;burn&quot;: { &quot;quantity&quot;: 50000 } }
                        }
                    ],
                    &quot;validity_interval&quot;:
                      { &quot;invalid_before&quot;:
                          { &quot;quantity&quot;: 11
                          , &quot;unit&quot;: &quot;slot&quot;
                          }
                      }
                }|]</span></span><span>
</span><span id="line-3598"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                    &quot;mint_burn&quot;: [
                        { &quot;policy_script_template&quot;: #{policyScriptTemplate}
                        , &quot;asset_name&quot;: &quot;1111&quot;
                        , &quot;operation&quot;: { &quot;burn&quot;: { &quot;quantity&quot;: 50000 } }
                        }
                    ]
                }|]</span></span><span>
</span><span id="line-3606"></span><span>
</span><span id="line-3607"></span><span>            </span><span id="local-6989586621682949905"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949905"><span class="hs-identifier hs-var">rTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3608"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949906"><span class="hs-identifier hs-var">payloadBurn</span></a></span><span>
</span><span id="line-3609"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949905"><span class="hs-identifier hs-var">rTx2</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3610"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949904"><span class="annot"><span class="annottext">apiTx2 :: ApiT SealedTx
</span><a href="#local-6989586621682949904"><span class="hs-identifier hs-var hs-var">apiTx2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682949903"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949905"><span class="hs-identifier hs-var">rTx2</span></a></span><span>
</span><span id="line-3611"></span><span>            </span><span id="local-6989586621682949902"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949902"><span class="hs-identifier hs-var">signedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949904"><span class="hs-identifier hs-var">apiTx2</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3612"></span><span>            </span><span id="local-6989586621682949901"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949901"><span class="hs-identifier hs-var">submittedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; ResourceT IO (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949902"><span class="hs-identifier hs-var">signedTx2</span></a></span><span>
</span><span id="line-3613"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949901"><span class="hs-identifier hs-var">submittedTx2</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiTxId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3614"></span><span>
</span><span id="line-3615"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949900"><span class="annot"><span class="annottext">newBalance :: Natural
</span><a href="#local-6989586621682949900"><span class="hs-identifier hs-var hs-var">newBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949923"><span class="hs-identifier hs-var">initialBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949919"><span class="hs-identifier hs-var">expectedFee</span></a></span><span>
</span><span id="line-3616"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949899"><span class="annot"><span class="annottext">expectedFeeBurn :: Natural
</span><a href="#local-6989586621682949899"><span class="hs-identifier hs-var hs-var">expectedFeeBurn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682949898"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949897"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949905"><span class="hs-identifier hs-var">rTx2</span></a></span><span>
</span><span id="line-3617"></span><span>
</span><span id="line-3618"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Assets are burned!&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3619"></span><span>                </span><span id="local-6989586621682949896"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949896"><span class="hs-identifier hs-var">rW</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949931"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3620"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949930"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3621"></span><span>                </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949896"><span class="hs-identifier hs-var">rW</span></a></span><span>
</span><span id="line-3622"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3623"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-3624"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949895"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682949894"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949893"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3625"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949900"><span class="hs-identifier hs-var">newBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949899"><span class="hs-identifier hs-var">expectedFeeBurn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3626"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949892"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949891"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949890"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3627"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3628"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949889"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949888"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949887"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3629"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3630"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-3631"></span><span>
</span><span id="line-3632"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_11 - Get policy id - incorrect template \
        \&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682949886"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949886"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3634"></span><span>        </span><span id="local-6989586621682949885"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949885"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949886"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3635"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949884"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949884"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;policy_script_template&quot;:
                    { &quot;all&quot;:
                       [ { &quot;active_from&quot;: 120 }
                       ]
                    }
                }|]</span></span><span>
</span><span id="line-3642"></span><span>
</span><span id="line-3643"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949883"><span class="annot"><span class="annottext">postPolicyId :: (Method, Text)
</span><a href="#local-6989586621682949883"><span class="hs-identifier hs-var hs-var">postPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.postPolicyId</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949885"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3644"></span><span>        </span><span id="local-6989586621682949881"><span class="annot"><span class="annottext">(Status, Either RequestException ApiPolicyId)
</span><a href="#local-6989586621682949881"><span class="hs-identifier hs-var">rGet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiPolicyId)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949886"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682949883"><span class="hs-identifier hs-var">postPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949884"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3645"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiPolicyId)
-&gt; [(Status, Either RequestException ApiPolicyId)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiPolicyId)
</span><a href="#local-6989586621682949881"><span class="hs-identifier hs-var">rGet</span></a></span><span>
</span><span id="line-3646"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiPolicyId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3647"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException ApiPolicyId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403CreatedWrongPolicyScriptTemplatePolicyId"><span class="hs-identifier hs-var">errMsg403CreatedWrongPolicyScriptTemplatePolicyId</span></a></span><span>
</span><span id="line-3648"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3649"></span><span>
</span><span id="line-3650"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_CREATE_11 - Get policy id \
        \&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682949880"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949880"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3652"></span><span>        </span><span id="local-6989586621682949879"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949879"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949880"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3653"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949878"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949878"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;policy_script_template&quot;:
                    { &quot;all&quot;:
                       [ &quot;cosigner#0&quot;
                       ]
                    }
                }|]</span></span><span>
</span><span id="line-3660"></span><span>
</span><span id="line-3661"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949877"><span class="annot"><span class="annottext">policyWithHash :: (Method, Text)
</span><a href="#local-6989586621682949877"><span class="hs-identifier hs-var hs-var">policyWithHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; Maybe Bool -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; Maybe Bool -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getPolicyKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949879"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3662"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949876"><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949876"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3663"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text) -&gt; Payload -&gt; ResourceT IO (Status, ApiPolicyKey)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949880"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682949877"><span class="hs-identifier hs-var">policyWithHash</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-3664"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682949875"><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682949875"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3665"></span><span>                </span><span class="annot"><span class="annottext">(KeyRole, Method) -&gt; Maybe KeyHash
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">keyHashFromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyRole
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Policy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Method
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949876"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3666"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949873"><span class="annot"><span class="annottext">scriptUsed :: Script KeyHash
</span><a href="#local-6989586621682949873"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Script KeyHash] -&gt; Script KeyHash
forall elem. [Script elem] -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireAllOf</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
forall elem. elem -&gt; Script elem
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">RequireSignatureOf</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682949875"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3667"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949872"><span class="annot"><span class="annottext">tokenPolicyId' :: TokenPolicyId
</span><a href="#local-6989586621682949872"><span class="hs-identifier hs-var hs-var">tokenPolicyId'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3668"></span><span>                </span><span class="annot"><span class="annottext">Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId)
-&gt; (Method -&gt; Hash &quot;TokenPolicy&quot;) -&gt; Method -&gt; TokenPolicyId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Hash &quot;TokenPolicy&quot;
forall (tag :: Symbol). Method -&gt; Hash tag
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Hash</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; TokenPolicyId) -&gt; Method -&gt; TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3669"></span><span>                </span><span class="annot"><span class="annottext">ScriptHash -&gt; Method
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var hs-var">unScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Method) -&gt; ScriptHash -&gt; Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3670"></span><span>                </span><span class="annot"><span class="annottext">Script KeyHash -&gt; ScriptHash
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">toScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Script KeyHash
</span><a href="#local-6989586621682949873"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-3671"></span><span>
</span><span id="line-3672"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949870"><span class="annot"><span class="annottext">postPolicyId :: (Method, Text)
</span><a href="#local-6989586621682949870"><span class="hs-identifier hs-var hs-var">postPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.postPolicyId</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949879"><span class="hs-identifier hs-var">wa</span></a></span><span>
</span><span id="line-3673"></span><span>        </span><span id="local-6989586621682949869"><span class="annot"><span class="annottext">(Status, Either RequestException ApiPolicyId)
</span><a href="#local-6989586621682949869"><span class="hs-identifier hs-var">rGet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiPolicyId)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949880"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682949870"><span class="hs-identifier hs-var">postPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949878"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3674"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiPolicyId)
-&gt; [(Status, Either RequestException ApiPolicyId)
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiPolicyId)
</span><a href="#local-6989586621682949869"><span class="hs-identifier hs-var">rGet</span></a></span><span>
</span><span id="line-3675"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiPolicyId) -&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-3676"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiPolicyId (ApiT TokenPolicyId)
-&gt; (ApiT TokenPolicyId -&gt; IO ())
-&gt; (Status, Either RequestException ApiPolicyId)
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;policyId&quot;
  ((ApiT TokenPolicyId -&gt; f (ApiT TokenPolicyId))
   -&gt; ApiPolicyId -&gt; f ApiPolicyId)
Traversal' ApiPolicyId (ApiT TokenPolicyId)
</span><a href="#local-6989586621682949868"><span class="hs-var">#policyId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT TokenPolicyId -&gt; ApiT TokenPolicyId -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenPolicyId -&gt; ApiT TokenPolicyId
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682949872"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3677"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3678"></span><span>
</span><span id="line-3679"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_VALIDITY_INTERVAL_02 - \
        \Validity bounds should be ordered correctly&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3681"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682949867"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949867"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3682"></span><span>
</span><span id="line-3683"></span><span>        </span><span id="local-6989586621682949866"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949866"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949867"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3684"></span><span>
</span><span id="line-3685"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949865"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949865"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;withdrawal&quot;: &quot;self&quot;
                , &quot;validity_interval&quot;:
                    { &quot;invalid_before&quot;:
                        { &quot;quantity&quot;: 100
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                    , &quot;invalid_hereafter&quot;:
                        { &quot;quantity&quot;: 50
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                    }
                }|]</span></span><span>
</span><span id="line-3698"></span><span>
</span><span id="line-3699"></span><span>        </span><span id="local-6989586621682949864"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949864"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949867"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3700"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949866"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949865"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3701"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949864"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3702"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-3703"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidValidityBounds"><span class="hs-identifier hs-var">errMsg403InvalidValidityBounds</span></a></span><span>
</span><span id="line-3704"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3705"></span><span>
</span><span id="line-3706"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_VALIDITY_INTERVAL_02 - \
        \Missing lower validity bound is acceptable&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3708"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682949863"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949863"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3709"></span><span>
</span><span id="line-3710"></span><span>        </span><span id="local-6989586621682949862"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949862"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949863"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3711"></span><span>
</span><span id="line-3712"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949861"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949861"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;withdrawal&quot;: &quot;self&quot;
                , &quot;validity_interval&quot;:
                    { &quot;invalid_hereafter&quot;:
                        { &quot;quantity&quot;: 10
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                    }
                }|]</span></span><span>
</span><span id="line-3721"></span><span>
</span><span id="line-3722"></span><span>        </span><span id="local-6989586621682949860"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949860"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949863"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3723"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949862"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949861"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3724"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949860"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3725"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-3726"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3727"></span><span>
</span><span id="line-3728"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_VALIDITY_INTERVAL_02 - \
        \Missing upper validity bound is acceptable&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3730"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682949859"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949859"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3731"></span><span>
</span><span id="line-3732"></span><span>        </span><span id="local-6989586621682949858"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949858"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949859"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3733"></span><span>
</span><span id="line-3734"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949857"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949857"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;withdrawal&quot;: &quot;self&quot;
                , &quot;validity_interval&quot;:
                    { &quot;invalid_before&quot;:
                        { &quot;quantity&quot;: 10
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                      }
                }|]</span></span><span>
</span><span id="line-3743"></span><span>
</span><span id="line-3744"></span><span>        </span><span id="local-6989586621682949856"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949856"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949859"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3745"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949858"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949857"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3746"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949856"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3747"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-3748"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3749"></span><span>
</span><span id="line-3750"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_VALIDITY_INTERVAL_02 - \
        \Validity interval slot should be &gt;= 0&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3752"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682949855"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949855"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3753"></span><span>
</span><span id="line-3754"></span><span>        </span><span id="local-6989586621682949854"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949854"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949855"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3755"></span><span>
</span><span id="line-3756"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949853"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949853"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;withdrawal&quot;: &quot;self&quot;
                , &quot;validity_interval&quot;:
                    { &quot;invalid_before&quot;:
                        { &quot;quantity&quot;: -1
                        , &quot;unit&quot;: &quot;slot&quot;
                        }
                    , &quot;invalid_hereafter&quot;:
                        { &quot;quantity&quot;: -1
                        , &quot;unit&quot;: &quot;slot&quot;
                        }
                    }
                }|]</span></span><span>
</span><span id="line-3769"></span><span>
</span><span id="line-3770"></span><span>        </span><span id="local-6989586621682949852"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949852"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949855"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3771"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949854"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949853"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3772"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949852"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3773"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-3774"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span>
</span><span id="line-3775"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;parsing Word64 failed, \
                \value is either floating or will cause over or underflow&quot;</span></span><span>
</span><span id="line-3777"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3778"></span><span>
</span><span id="line-3779"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TRANS_NEW_VALIDITY_INTERVAL_02 - \
        \Validity interval 'unspecified'&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3781"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682949851"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949851"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3782"></span><span>
</span><span id="line-3783"></span><span>        </span><span id="local-6989586621682949850"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949850"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949851"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3784"></span><span>
</span><span id="line-3785"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949849"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682949849"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;withdrawal&quot;: &quot;self&quot;
                , &quot;validity_interval&quot;:
                    { &quot;invalid_before&quot;: &quot;unspecified&quot;
                    , &quot;invalid_hereafter&quot;: &quot;unspecified&quot;
                    }
                }|]</span></span><span>
</span><span id="line-3792"></span><span>
</span><span id="line-3793"></span><span>        </span><span id="local-6989586621682949848"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949848"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949851"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-3794"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949850"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949849"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-3795"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949848"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-3796"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-3797"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span>
</span><span id="line-3798"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;parsing ApiValidityBound object failed, \
                \expected Object, but encountered String&quot;</span></span><span>
</span><span id="line-3800"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3801"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3802"></span><span>
</span><span id="line-3803"></span><span>    </span><span class="hs-comment">-- | Just one million Ada, in Lovelace.</span><span>
</span><span id="line-3804"></span><span>    </span><span class="annot"><a href="#local-6989586621682951327"><span class="hs-identifier hs-type">oneMillionAda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-3805"></span><span>    </span><span id="local-6989586621682951327"><span class="annot"><span class="annottext">oneMillionAda :: Integer
</span><a href="#local-6989586621682951327"><span class="hs-identifier hs-var hs-var">oneMillionAda</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1_000_000</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621682950118"><span class="hs-identifier hs-var">oneAda</span></a></span><span>
</span><span id="line-3806"></span><span>
</span><span id="line-3807"></span><span>    </span><span class="annot"><a href="#local-6989586621682950118"><span class="hs-identifier hs-type">oneAda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span>
</span><span id="line-3808"></span><span>    </span><span id="local-6989586621682950118"><span class="annot"><span class="annottext">oneAda :: Integer
</span><a href="#local-6989586621682950118"><span class="hs-identifier hs-var hs-var">oneAda</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1_000_000</span></span><span>
</span><span id="line-3809"></span><span>
</span><span id="line-3810"></span><span>    </span><span class="hs-comment">-- Construct a JSON payment request for the given quantity of lovelace.</span><span>
</span><span id="line-3811"></span><span>    </span><span id="local-6989586621682952040"><span class="annot"><a href="#local-6989586621682951178"><span class="hs-identifier hs-type">mkTxPayload</span></a></span><span>
</span><span id="line-3812"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682952040"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3813"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-3814"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-3815"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-3816"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682952040"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span></span><span>
</span><span id="line-3817"></span><span>    </span><span id="local-6989586621682951178"><span class="annot"><span class="annottext">mkTxPayload :: Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682951178"><span class="hs-identifier hs-var hs-var">mkTxPayload</span></a></span></span><span> </span><span id="local-6989586621682949847"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949847"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682949846"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949846"><span class="hs-identifier hs-var">wDest</span></a></span></span><span> </span><span id="local-6989586621682949845"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949845"><span class="hs-identifier hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3818"></span><span>        </span><span id="local-6989586621682949844"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949844"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; m [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949847"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949846"><span class="hs-identifier hs-var">wDest</span></a></span><span>
</span><span id="line-3819"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949843"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682949843"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682949844"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682949842"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-3820"></span><span>        </span><span class="annot"><span class="annottext">Payload -&gt; m Payload
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; m Payload) -&gt; Payload -&gt; m Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-3829"></span><span>
</span><span id="line-3830"></span><span>    </span><span class="hs-comment">-- Like mkTxPayload, except that assets are included in the payment.</span><span>
</span><span id="line-3831"></span><span>    </span><span class="hs-comment">-- Asset amounts are specified by ((PolicyId Hex, AssetName Hex), amount).</span><span>
</span><span id="line-3832"></span><span>    </span><span class="annot"><a href="#local-6989586621682950943"><span class="hs-identifier hs-type">mkTxPayloadMA</span></a></span><span>
</span><span id="line-3833"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682951940"><span class="annot"><a href="#local-6989586621682951940"><span class="hs-identifier hs-type">l</span></a></span></span><span> </span><span id="local-6989586621682951939"><span class="annot"><a href="#local-6989586621682951939"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3834"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951940"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-3835"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeStakeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951940"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-3836"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">EncodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951940"><span class="hs-identifier hs-type">l</span></a></span><span>
</span><span id="line-3837"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951939"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3838"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-3839"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiT</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951940"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3840"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-3841"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3842"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682951939"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-3843"></span><span>    </span><span id="local-6989586621682950943"><span class="annot"><span class="annottext">mkTxPayloadMA :: (ApiT Address, Proxy l)
-&gt; Natural -&gt; [((Text, Text), Natural)] -&gt; m Payload
</span><a href="#local-6989586621682950943"><span class="hs-identifier hs-var hs-var">mkTxPayloadMA</span></a></span></span><span> </span><span id="local-6989586621682949841"><span class="annot"><span class="annottext">(ApiT Address, Proxy l)
</span><a href="#local-6989586621682949841"><span class="hs-identifier hs-var">destination</span></a></span></span><span> </span><span id="local-6989586621682949840"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949840"><span class="hs-identifier hs-var">coin</span></a></span></span><span> </span><span id="local-6989586621682949839"><span class="annot"><span class="annottext">[((Text, Text), Natural)]
</span><a href="#local-6989586621682949839"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3844"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949838"><span class="annot"><span class="annottext">assetJson :: ((a, a), a) -&gt; Value
</span><a href="#local-6989586621682949838"><span class="hs-identifier hs-var hs-var">assetJson</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621682949837"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682949837"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949836"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682949836"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949835"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621682949835"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[json|{
                    &quot;policy_id&quot;: #{pid},
                    &quot;asset_name&quot;: #{name},
                    &quot;quantity&quot;: #{q}
                }|]</span></span><span>
</span><span id="line-3849"></span><span>        </span><span class="annot"><span class="annottext">Payload -&gt; m Payload
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; m Payload) -&gt; Payload -&gt; m Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{coin},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    },
                    &quot;assets&quot;: #{map assetJson val}
                }]
            }|]</span></span><span>
</span><span id="line-3859"></span><span>
</span><span id="line-3860"></span><span>    </span><span class="annot"><a href="#local-6989586621682950641"><span class="hs-identifier hs-type">serializedPlutusTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span>
</span><span id="line-3861"></span><span>    </span><span id="local-6989586621682950641"><span class="annot"><span class="annottext">serializedPlutusTx :: Text
</span><a href="#local-6989586621682950641"><span class="hs-identifier hs-var hs-var">serializedPlutusTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3862"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;84a60081825820888963613d2bb4c5c55cee335f724624cbc54b185eca\
        \a2fb1eb07545ed5db421010d80018002000e800b58201dd28c3485f707\
        \dd5fb5db3ef96c5ed723c05ce5ef5439b0cc291f8a8ac6531ca3038159\
        \1b6f591b6c010000332332233322232323232332232333222333222333\
        \3333322222222332233333222223332223333222233223322332233223\
        \3223332223322332233223322323232323232323232323232323232323\
        \2323232323232323232323232323232323232323232323232323232323\
        \2323232323232323232323232323232323232323232323232300112001\
        \23355002307812001307812001112222223335306433300433503a0060\
        \0333503a00500230070012088012350810149821c048c8c8c8c8c8c8cc\
        \cd5ca99b8935573e600a24002900011801090009180389000843809198\
        \26180109000980189000918039aba230031200123043357446ae8cc008\
        \480048d55d018010900091ba900323507b4988c8c8c8c8c8c8c8c8c8c8\
        \c8c8c8c8c8c8c8c8c8c8c8c8cccd5ca99b8935573e602a240029000118\
        \01090009180b8900084b009199999999982e9801090009801890009802\
        \0900098028900098030900098038900098040900098048900098050900\
        \0980589000919a822980b890009aba23013120012335044301e1200135\
        \744602224002466a086604e240026ae88c03c480048cd4108c09848004\
        \d5d1180689000919a8209817890009aba2300b12001233504033550413\
        \0321200130311200135744601224002466a072606c240026ae88c01c48\
        \0048cd40f8c0f448004d5d1180289000919a81e99aa81f182289000982\
        \4090009aba23003120012304f357446ae8cc008480048d5d1980109000\
        \91aba330021200123574660042400246ae8cc008480048d5d198010900\
        \091aba330021200123574660042400246ae8cc008480048d55d0180109\
        \00091ba900323507a4988ccd41d800c0180088c8c8c8c8c8c8cccd5ca9\
        \9b8935573e600a24002900011801090009180389000842009198269801\
        \09000980189000918229aba23003120012300d357446ae8cc008480048\
        \d55d018010900091ba90032350784988d4c11400488cdd22400066aed0\
        \c010008cd5da18068009bb24988d4c18400488cdd22400066aed0c0100\
        \08cd5da1ba7001376493119ba448000cd5da1ba800137649311999999a\
        \baf2323232323232323333572a66e24d55cf980389000a400046004240\
        \024a100021040246666aaed494200048c00c48004c01848004208048cc\
        \cd55da9283f91801890009802090008408091999aabb52300312001250\
        \7e35746600624002100024666a6a0f6600e6ae88c00c4800488ccd4d41\
        \f4c048d5d1180209000911a84080998260020011283f840809283e83f9\
        \1aba3300212001235574060042400246ea400c941e0941e0941e0941e0\
        \0041e88ccccccd5d79191919191919191999ab95337126aae7cc01c480\
        \05200023002120012507f08101233335576a4a0fe4600624002600c240\
        \021020246666aaed4941f88c00c48004c01048004200048cccd55da918\
        \01890009283e9aba330031200107f233353507a3007357446006240024\
        \4666a6a0f860526ae88c0104800488d420004cc1a0010008941f820004\
        \941f01f88d5d198010900091aaba0300212001237520064a0ee4a0ee4a\
        \0ee4a0ee0020f246666666aebc8c8c8c8c8c8cccd5ca99b8935573e600\
        \a24002900011801090009283e03f11999aabb52507c230031200130041\
        \200107e233335576a46006240024a0f66ae8cc00c480041f48ccd4d41e\
        \0c0d8d5d1180109000911a83e0011283d03e11aaba0300212001237520\
        \064a0ec4a0ec4a0ec4a0ec0020f04666a0dc00a0100044646464646464\
        \64646666ae54cdc49aab9f300712001480008c008480048c024480041f\
        \88ccc124c00848004c00c48004c010480048c024d5d1180289000919a8\
        \161808090009aba23003120012335008303312001357446ae8cc008480\
        \048d5d198010900091aaba03002120012375200646a0e0931191919191\
        \9191999ab95337126aae7cc0144800520002300212001230071200107b\
        \23304d3002120013003120012303b35744600624002466a00c60362400\
        \26ae88d5d198010900091aaba03002120012375200646a0de930911919\
        \191919191999ab953371260082400290001180109000918020900083d9\
        \1a83c980109000919a8168039aba235574060082400246666ae54cdc49\
        \80109000a40044a0ee4600a240020f246aae7cc008480048dd480191a8\
        \37a4c46a607a00244466e912000335768600a00666aed0cd403cc02848\
        \004008cd5da19a8031817090008009bb24988d4c10c00488cdd2240006\
        \6aed0c060008cd5da19a802180b090008009bb2498488ccd4d41b80048\
        \8cdd22400066aed0cd40a4010008dd924c466e91200237649303911999\
        \999abaf23232323232323232323333572a66e24d55cf980489000a4000\
        \46004240024a0f00f446666aaed4941e08c00c48004c020480041e88cc\
        \cd55da9283b918018900098030900083c91999aabb5250762300312001\
        \300412001078233335576a46006240024a0ea6ae8cc00c480041dc8ccd\
        \4d41c8c020d5d118020900091199a9a83a19a8099806090009aba23005\
        \120012233353507633500d30321200135744600c24002446a0f466608e\
        \00c0080044a0f00f44a0ec0f04a0e80ec46ae8cc008480048d5d198010\
        \900091aaba0300212001237520064a0dc4a0dc4a0dc4a0dc0020e04666\
        \6666aebc8c8c8c8c8c8c8c8cccd5ca99b8935573e600e2400290001180\
        \1090009283a83b91999aabb52507523003120013006120010772333355\
        \76a4a0e846006240026008240020ec46666aaed48c00c48004941ccd5d\
        \198018900083a9199a9a838180d1aba230031200122333535072335009\
        \30181200135744600824002446a0ec660940080044a0e80ec4a0e40e84\
        \6ae8cc008480048d55d018010900091ba90032506d2506d2506d2506d0\
        \0106f1223333333575e46464646464646464646666ae54cdc498028900\
        \0a400046004240024600a240020f246666aaed4941dc8c00c48004c01c\
        \480041e48cccd55da91801890009283b1aba3300612001078233353507\
        \333502e00a35744600a24002446a0ee6a0ee0044a0ea0ee46666ae54cd\
        \c4980109000a400446008240024a0e80ec46aae7cc010480048cccd55d\
        \a91802890009283918010900083a11aaba03002120012375200846a0de\
        \a0dc4a0da4a0da4a0da4a0da0020de466aa03c60142400260042400246\
        \6aa006600424002601a240024666a0c404804aeb44488ccd4188cd5400\
        \c008004cd54014008004cd5401c0080044488d400ccd5406c008004488\
        \c8c8dd318008019a80090008918009aa83591199a9a81c00091bb24988\
        \88cd5da19a812004001980280103608911a80199aa80c8010008911919\
        \1999999abaf25067250672300237560084a0ce4a0ce0060d26a0024002\
        \2460026aa0d244646666aaed48c008480048ccd4d41a0cd408c01cd5d1\
        \00191199a9a83518031aba3005223506e33503d0040022506c06e2506a\
        \06c00206b235069503911223501633550170020012333505b01d01e75a\
        \4666a0b4004006044466666666a60920024466e912002335768600e004\
        \6ec92622233748900219abb430080033357686ea0008dd924c4466e912\
        \000335768600e0046ec92623374890051bb24988cdd2240186ec926222\
        \33748900319abb4375000666aed0dd40011bb2498888cdd22401066aed\
        \0dd400199abb4374e0046ec92606223333333575e46464646464646464\
        \64646464646464646464646464646464646464646464646464646666ae\
        \54cdc4980e89000a4018460042400246008240021080246666aaed48c0\
        \0c480049420804c08448004210048d4204041b48cccd5ca99b89301b12\
        \001480288c00c480048c01448004208048cccd55da91801890009283f9\
        \80f090008408091a83f03591999ab95337126030240029004118018900\
        \0918040900083f91999aabb52507c2300312001301b1200107e2333355\
        \76a4a0f646006240026008240020fa46666aaed48c00c48004941e8d5d\
        \198018900083e1199a9a83b981a9aba230181200122333535079302635\
        \744600824002446a0fa660ce0080044a0f60fa4a0f20f646ae8cc05c48\
        \0048cccd5ca99b89301212001480188c00c480048c020480041e48cccd\
        \55da9283b1180189000980a8900083c11999aabb525075230031200130\
        \0412001077233335576a46006240024a0e86ae8cc00c480041d88ccd4d\
        \41c4c0bcd5d118090900091199a9a83998189aba230041200122350773\
        \3062004002250750772507307523574660222400246666ae54cdc49806\
        \09000a4008460062400246010240020e646666aaed4941c08c00c48004\
        \c03c480041c88cccd55da92837918018900098020900083891999aabb5\
        \23003120012506e357466006240020e04666a6a0d660286ae88c030480\
        \0488ccd4d41b4c0acd5d1180209000911a838998300020011283783892\
        \83683791aba3300b1200123333572a66e24c0184800520022300312001\
        \230061200106d233335576a4a0d446006240026012240020d846666aae\
        \d48c00c48004941a4d5d19804090008359199a9a83318079aba2300712\
        \001223506a305a0022506806a23333572a66e24c008480052000230041\
        \200125067069235573e600c2400246666aaed4941948c00c48004c0104\
        \800419c8cccd55da9180189000928321aba33003120010662333535061\
        \300a35744600424002446a0ca60a60044a0c60ca46aae80c008480048d\
        \d48019282f9282f9282f9282f8008309199a82b804004bac2333505600\
        \200401f2335304d001233748900019abb4300300137649311119ba4480\
        \08cd5da1ba70033357686e9c008cd5da1ba7001376493119a982780091\
        \9ba448000cd5da1ba8001376493119ba448008cd5da1ba800137649311\
        \999999abaf232323232323232323232323232323333572a66e24c02448\
        \00520022300212001230091200106b233335576a4a0d24600624002601\
        \a240020d646666aaed4941a08c00c48004c018480041a88cccd55da928\
        \33918018900098020900083491999aabb5230031200125066357466006\
        \240020d04666a6a0c660206ae88c0244800488ccd4d4194c048d5d1180\
        \28900091199a9a833980a1aba2300612001223506b33305d0060040022\
        \506906b250670692506506723574660042400246ae8cc01c480048cccd\
        \5ca99b89300212001480008c01048004941881908d55cf980309000919\
        \99aabb5250602300312001300412001062233335576a46006240024a0b\
        \e6ae8cc00c480041848ccd4d4170c018d5d1180109000911a830182980\
        \11282f03011aaba0300212001237520064a0b44a0b44a0b44a0b40020b\
        \846666666aebc8c8c8c8c8c8c8c8c8c8c8cccd5ca99b89300512001480\
        \088c008480048c014480041988cccd55da928321180189000980489000\
        \83311999aabb5230031200125063357466010240020ca4666a6a0c0603\
        \c6ae88c01c4800488d4190c164008941881908cccd5ca99b8930021200\
        \1480008c010480049418418c8d55cf98030900091999aabb52505f2300\
        \312001300412001061233335576a46006240024a0bc6ae8cc00c480041\
        \808ccd4d416cc064d5d1180109000911a82f982a8011282e82f91aaba0\
        \300212001237520064a0b24a0b24a0b24a0b20020b64666a0a2004006e\
        \b08dd380091999999abaf25056250562505623505737580044a0ac0020\
        \b02446464646464646666ae54cdc49aab9f300512001480008c0084800\
        \48c01c480041788cd40c8c00848004c00c480048cd402001cd5d118018\
        \9000919a8040031aba23574660042400246aae80c008480048dd480191\
        \a82924c2446464646464646666ae54cdc49aab9f300512001480008c00\
        \8480048c01c480041748cd40d4c00848004c00c480048cd402401cd5d1\
        \180189000918049aba23574660042400246aae80c008480048dd480191\
        \a828a4c2446464646464646666ae54cdc49aab9f300512001480008c00\
        \8480048c01c480041708cd40c8c00848004c00c480048cd402001cd5d1\
        \180189000918041aba23574660042400246aae80c008480048dd480191\
        \a82824c244646464646464646666ae54cdc4980289000a40084a06e460\
        \04240020b846666ae54cdc4980289000a400446006240024600a240020\
        \b846a06e600424002466a01a00e6ae88d55d018020900091999ab95337\
        \1260042400290001281a918028900082c91aab9f300212001237520064\
        \6a09e9311919191999ab95337126004240029001101b118010900082b1\
        \1999ab95337126004240029000101a918020900082b11aab9f37520064\
        \6a09a931199a8248058063ad1223232300137560066a00240022460026\
        \aa0a8446666aaed4940908cd408ccd4024018d5d100118019aba300200\
        \1055112233350483355005002001335500700200133550030020011122\
        \23232323232323333572a66e24d55cf980289000a40004600424002460\
        \0e240020ae466aa04e600424002600624002466a0120106ae88c00c480\
        \048cd4020018d5d11aba3300212001235574060042400246ea400c8d41\
        \2d26123535044001222001112223535501e0012233748900019abb4335\
        \00600500233576866a00c0080026ec9261235350420012220031122233\
        \33333575e4646464646464646666ae54cdc49aab9f300712001480008c\
        \008480049414c1548cccd55da92829918018900098030900082a91999a\
        \abb5250522300312001300412001054233335576a46006240024a0a26a\
        \e8cc00c4800414c8ccd4d4138cd4024020d5d118018900091199a9a828\
        \19a8058049aba230041200122350543355026004002250520542505005\
        \223574660042400246aae80c008480048dd48019282592825928259282\
        \5800826891a9a8200009110011199a820001001bad2375000246666666\
        \aebc941149411494114941148d4118dd68010008239199a81ea8012822\
        \001890009000919191919191919191919191919191999ab95337126014\
        \240029003118010900091802090008289181a980109000918079aba235\
        \574060182400246666ae54cdc4980409000a400846006240024600a240\
        \0209e460606004240024601a6ae88d55d018048900091999ab95337126\
        \00a2400290011180189000918028900082611816180109000918061aba\
        \2355740600c2400246666ae54cdc4980109000a400046008240024600e\
        \2400209246aae7cc010480048c0a8c008480048dd69aba235574060042\
        \400246ea400c8d40f52623232323232323232323232323232323232323\
        \23232323232323333572a66e24c05448005200c2046230021200105b23\
        \333572a66e24c05448005200a2047230031200105b23333572a66e24c0\
        \504800520082300312001230071200105a233041300212001300312001\
        \2375a6ae88c00c480048dd61aba23574660042400246aae80c04c48004\
        \8cccd5ca99b89300f12001480188c00c480048c01c480041548cc0f4c0\
        \0848004c00c480048dd69aba23003120012375a6ae88d5d19801090009\
        \1aaba0300e1200123333572a66e24c0284800520042300312001230071\
        \200105023303c3002120013003120012300e3574460062400246eb4d5d\
        \11aba3300212001235574060122400246666ae54cdc4980289000a4004\
        \46006240024600a2400209646070600424002460126ae88d55d0180309\
        \00091999ab953371260042400290001180209000918038900082411aab\
        \9f3004120012303230021200123005357446aae80c008480048dd48019\
        \1a81e24c46464646464646464646464646666ae54cdc4980409000a400\
        \44600424002460102400209a466607a600424002600624002600824002\
        \46eb0d5d118028900091bac3574460062400246eb0d5d11aba33002120\
        \0123574660042400246aae80c018480048cccd5ca99b89300212001480\
        \008c010480048c01c4800411c8d55cf9802090009181b1801090009180\
        \29aba235574060042400246ea400c8d40ed26232323232323232323333\
        \572a66e24c010480052002230021200123004120010482303b30021200\
        \12375a6ae88d55d018030900091999ab95337126004240029000118020\
        \9000918038900082311aab9f300412001230383002120012375a6ae88d\
        \55d018010900091ba900323503a4988c8c8c8c8c8c8cccd5ca99b89355\
        \73e600a240029000118010900091803890008229198159801090009801\
        \89000918039aba2300312001237586ae88d5d198010900091aaba03002\
        \120012375200646a0729311919191999ab95337126aae7cc0084800520\
        \00230021200123004120010412375a6ae88d55d018010900091ba90032\
        \350384988848cc00400c0088004888888888848cccccccccc00402c028\
        \02402001c01801401000c00880048848cc00400c008800488848ccc004\
        \01000c00880044488008488488cc00401000c48004448848cc00400c00\
        \84480048848cc00400c008800448848cc00400c0084800448848cc0040\
        \0c0084800448848cc00400c00848004484888c00c01044888008448880\
        \04480044880084880048004848888c010014848888c00c014848888c00\
        \8014848888c00401480048848cc00400c0088004848888888c01c02088\
        \48888888cc018024020848888888c014020488888880104888888800c8\
        \848888888cc0080240208848888888cc00402402080048488c00800c88\
        \8488ccc00401401000c80048488c00800c8488c00400c80048ccd400c0\
        \1801c010488848ccc00401000c008480048c8cccd5ca99b8935573e6ea\
        \40092000200b230021200100a2350034984988d4c018004cdd2240006e\
        \c92623333333575e46464646666ae54cdc49aab9f300212001480008c0\
        \0848004940200288cccd55da9180209000928041aaba030021200100a2\
        \375200846a00c0104a0084a0084a0084a00800200c2424460040062244\
        \0022400224002400222464600200244660066460020020040026646664\
        \4466644466666666444444446644666664444466644466664444664466\
        \4466446664446644664466644466446644664466446466446464664464\
        \646464646400244446600a6020002008446a60200044444444444666a6\
        \a04e666aa601e24002a01a4666a606a666ae54cdc800600081b81b11a8\
        \15801128150098019101c101b009099a804a800a80d891199a9a80d801\
        \1100210010031a80090008918009aa81e910891911199a9a80b80091a8\
        \05802911199803090009802801999aa98048900080380280100491a804\
        \801090009000891a9a80180091000891a9a80100091001091091980080\
        \18010900091a9801000910011109198008018011000911111111109199\
        \9999999800805805004804003803002802001801100091091980080180\
        \1100091109199800802001801100088910010910911980080200189000\
        \8891091980080180108900091091980080180110008909118010018891\
        \0008900089109198008018010900089109198008018010900089109198\
        \0080180109000890911180180208911001089110008900089100109100\
        \0900090911118020029091111801802909111180100290911118008029\
        \0009109198008018011000909111111180380411091111111980300480\
        \4109111111180280409111111002091111110019109111111198010048\
        \0411091111111980080480410009091180100191109119980080280200\
        \1900090911801001909118008019000889191800800911980199180080\
        \0801000a451c35dedd2982a03cf39e7dce03c839994ffdec2ec6b04f1c\
        \f2d40e61a300010481d879800581840000d8798082191a221a019d6038\
        \f5f6&quot;</span></span><span>
</span><span id="line-4109"></span><span>
</span><span id="line-4110"></span><span>    </span><span class="hs-comment">-- TODO: This function should really not exist, but instead, it should be</span><span>
</span><span id="line-4111"></span><span>    </span><span class="hs-comment">-- possible to construct a transaction from the API with additional required</span><span>
</span><span id="line-4112"></span><span>    </span><span class="hs-comment">-- signers!</span><span>
</span><span id="line-4113"></span><span>    </span><span class="annot"><a href="#local-6989586621682950518"><span class="hs-identifier hs-type">addRequiredSigners</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">SealedTx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">SealedTx</span></a></span><span>
</span><span id="line-4114"></span><span>    </span><span id="local-6989586621682950518"><span class="annot"><span class="annottext">addRequiredSigners :: SealedTx -&gt; [XPub] -&gt; SealedTx
</span><a href="#local-6989586621682950518"><span class="hs-identifier hs-var hs-var">addRequiredSigners</span></a></span></span><span> </span><span id="local-6989586621682949834"><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682949834"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621682949833"><span class="annot"><span class="annottext">[XPub]
</span><a href="#local-6989586621682949833"><span class="hs-identifier hs-var">vks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4115"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SealedTx -&gt; InAnyCardanoEra TxBody
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">getSealedTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682949834"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4116"></span><span>            </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">InAnyCardanoEra</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoEra era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">AlonzoEra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">Cardano.ShelleyTxBody</span></a></span><span> </span><span id="local-6989586621682949830"><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621682949830"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621682949829"><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra era)
</span><a href="#local-6989586621682949829"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621682949828"><span class="annot"><span class="annottext">[Script (ShelleyLedgerEra era)]
</span><a href="#local-6989586621682949828"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621682949827"><span class="annot"><span class="annottext">TxBodyScriptData era
</span><a href="#local-6989586621682949827"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621682949826"><span class="annot"><span class="annottext">Maybe (AuxiliaryData (ShelleyLedgerEra era))
</span><a href="#local-6989586621682949826"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621682949825"><span class="annot"><span class="annottext">TxScriptValidity era
</span><a href="#local-6989586621682949825"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4117"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949824"><span class="annot"><span class="annottext">body' :: TxBody (AlonzoEra StandardCrypto)
</span><a href="#local-6989586621682949824"><span class="hs-identifier hs-var hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBody (AlonzoEra StandardCrypto)
TxBody (ShelleyLedgerEra era)
</span><a href="#local-6989586621682949829"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-4118"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">reqSignerHashes :: Set (KeyHash 'Witness (Crypto (AlonzoEra StandardCrypto)))
</span><a href="../../../../cardano-ledger-alonzo/html/src"><span class="hs-identifier hs-var">Alonzo.reqSignerHashes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[KeyHash 'Witness StandardCrypto]
-&gt; Set (KeyHash 'Witness StandardCrypto)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([KeyHash 'Witness StandardCrypto]
 -&gt; Set (KeyHash 'Witness StandardCrypto))
-&gt; [KeyHash 'Witness StandardCrypto]
-&gt; Set (KeyHash 'Witness StandardCrypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; KeyHash 'Witness StandardCrypto
forall (kd :: KeyRole) crypto.
Crypto crypto =&gt;
XPub -&gt; KeyHash kd crypto
</span><a href="#local-6989586621682949821"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">(XPub -&gt; KeyHash 'Witness StandardCrypto)
-&gt; [XPub] -&gt; [KeyHash 'Witness StandardCrypto]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[XPub]
</span><a href="#local-6989586621682949833"><span class="hs-identifier hs-var">vks</span></a></span><span>
</span><span id="line-4119"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-4120"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; SealedTx
forall era. IsCardanoEra era =&gt; TxBody era -&gt; SealedTx
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">sealedTxFromCardanoBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; TxBody (ShelleyLedgerEra era)
-&gt; [Script (ShelleyLedgerEra era)]
-&gt; TxBodyScriptData era
-&gt; Maybe (AuxiliaryData (ShelleyLedgerEra era))
-&gt; TxScriptValidity era
-&gt; TxBody era
forall era.
ShelleyBasedEra era
-&gt; TxBody (ShelleyLedgerEra era)
-&gt; [Script (ShelleyLedgerEra era)]
-&gt; TxBodyScriptData era
-&gt; Maybe (AuxiliaryData (ShelleyLedgerEra era))
-&gt; TxScriptValidity era
-&gt; TxBody era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.ShelleyTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
</span><a href="#local-6989586621682949830"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody (AlonzoEra StandardCrypto)
TxBody (ShelleyLedgerEra era)
</span><a href="#local-6989586621682949824"><span class="hs-identifier hs-var">body'</span></a></span><span> </span><span class="annot"><span class="annottext">[Script (ShelleyLedgerEra era)]
</span><a href="#local-6989586621682949828"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyScriptData era
</span><a href="#local-6989586621682949827"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (AuxiliaryData (ShelleyLedgerEra era))
</span><a href="#local-6989586621682949826"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity era
</span><a href="#local-6989586621682949825"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4121"></span><span>            </span><span class="annot"><span class="annottext">InAnyCardanoEra TxBody
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4122"></span><span>                </span><span class="annot"><span class="annottext">SealedTx
</span><a href="#local-6989586621682949834"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-4123"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-4124"></span><span>        </span><span class="annot"><a href="#local-6989586621682949821"><span class="hs-identifier hs-type">hashKey</span></a></span><span>
</span><span id="line-4125"></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682951562"><span class="annot"><a href="#local-6989586621682951562"><span class="hs-identifier hs-type">kd</span></a></span></span><span> </span><span id="local-6989586621682951564"><span class="annot"><a href="#local-6989586621682951564"><span class="hs-identifier hs-type">crypto</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Ledger.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951564"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4126"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">XPub</span></a></span><span>
</span><span id="line-4127"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Ledger.KeyHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951562"><span class="hs-identifier hs-type">kd</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951564"><span class="hs-identifier hs-type">crypto</span></a></span><span>
</span><span id="line-4128"></span><span>        </span><span id="local-6989586621682949821"><span class="annot"><span class="annottext">hashKey :: XPub -&gt; KeyHash kd crypto
</span><a href="#local-6989586621682949821"><span class="hs-identifier hs-var hs-var">hashKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4129"></span><span>            </span><span class="annot"><span class="annottext">VKey kd crypto -&gt; KeyHash kd crypto
forall crypto (kd :: KeyRole).
Crypto crypto =&gt;
VKey kd crypto -&gt; KeyHash kd crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Ledger.hashKey</span></a></span><span>
</span><span id="line-4130"></span><span>            </span><span class="annot"><span class="annottext">(VKey kd crypto -&gt; KeyHash kd crypto)
-&gt; (XPub -&gt; VKey kd crypto) -&gt; XPub -&gt; KeyHash kd crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">VerKeyDSIGN (DSIGN crypto) -&gt; VKey kd crypto
forall (kd :: KeyRole) crypto.
VerKeyDSIGN (DSIGN crypto) -&gt; VKey kd crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Ledger.VKey</span></a></span><span>
</span><span id="line-4131"></span><span>            </span><span class="annot"><span class="annottext">(VerKeyDSIGN (DSIGN crypto) -&gt; VKey kd crypto)
-&gt; (XPub -&gt; VerKeyDSIGN (DSIGN crypto)) -&gt; XPub -&gt; VKey kd crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (VerKeyDSIGN (DSIGN crypto)) -&gt; VerKeyDSIGN (DSIGN crypto)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span>
</span><span id="line-4132"></span><span>            </span><span class="annot"><span class="annottext">(Maybe (VerKeyDSIGN (DSIGN crypto)) -&gt; VerKeyDSIGN (DSIGN crypto))
-&gt; (XPub -&gt; Maybe (VerKeyDSIGN (DSIGN crypto)))
-&gt; XPub
-&gt; VerKeyDSIGN (DSIGN crypto)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Maybe (VerKeyDSIGN (DSIGN crypto))
forall v. DSIGNAlgorithm v =&gt; Method -&gt; Maybe (VerKeyDSIGN v)
</span><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier hs-var">rawDeserialiseVerKeyDSIGN</span></a></span><span>
</span><span id="line-4133"></span><span>            </span><span class="annot"><span class="annottext">(Method -&gt; Maybe (VerKeyDSIGN (DSIGN crypto)))
-&gt; (XPub -&gt; Method) -&gt; XPub -&gt; Maybe (VerKeyDSIGN (DSIGN crypto))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">XPub -&gt; Method
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">xpubPublicKey</span></a></span><span>
</span><span id="line-4134"></span><span>
</span><span id="line-4135"></span><span>    </span><span id="local-6989586621682950761"><span class="annot"><span class="annottext">fromTextEnvelope :: Text -&gt; Text
</span><a href="#local-6989586621682950761"><span class="hs-identifier hs-var hs-var">fromTextEnvelope</span></a></span></span><span> </span><span id="local-6989586621682949818"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682949818"><span class="hs-identifier hs-var">cborHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4136"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949817"><span class="annot"><span class="annottext">textEnvelope :: TextEnvelope
</span><a href="#local-6989586621682949817"><span class="hs-identifier hs-var hs-var">textEnvelope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4137"></span><span>                </span><span class="annot"><span class="annottext">TextEnvelopeType -&gt; TextEnvelopeDescr -&gt; Method -&gt; TextEnvelope
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TextEnvelope</span></a></span><span>
</span><span id="line-4138"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TextEnvelopeType
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.TextEnvelopeType</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TxBodyAlonzo&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4139"></span><span>                </span><span class="annot"><span class="annottext">TextEnvelopeDescr
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-4140"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method -&gt; Method
forall b. (HasCallStack, ByteArray b) =&gt; Method -&gt; b
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">unsafeFromHex</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; Method) -&gt; Method -&gt; Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Method
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682949818"><span class="hs-identifier hs-var">cborHex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4141"></span><span>
</span><span id="line-4142"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682949814"><span class="annot"><span class="annottext">TxBody AlonzoEra
</span><a href="#local-6989586621682949814"><span class="hs-identifier hs-var">txBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4143"></span><span>                </span><span class="annot"><span class="annottext">AsType (TxBody AlonzoEra)
-&gt; TextEnvelope -&gt; Either TextEnvelopeError (TxBody AlonzoEra)
forall a.
HasTextEnvelope a =&gt;
AsType a -&gt; TextEnvelope -&gt; Either TextEnvelopeError a
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.deserialiseFromTextEnvelope</span></a></span><span>
</span><span id="line-4144"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AsType AlonzoEra -&gt; AsType (TxBody AlonzoEra)
forall era. AsType era -&gt; AsType (TxBody era)
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.AsTxBody</span></a></span><span> </span><span class="annot"><span class="annottext">AsType AlonzoEra
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.AsAlonzoEra</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TextEnvelope
</span><a href="#local-6989586621682949817"><span class="hs-identifier hs-var">textEnvelope</span></a></span><span>
</span><span id="line-4145"></span><span>
</span><span id="line-4146"></span><span>            </span><span id="local-6989586621682949810"><span class="annot"><span class="annottext">toCborHexTx :: TxBody era -&gt; Text
</span><a href="#local-6989586621682949810"><span class="hs-identifier hs-var hs-var">toCborHexTx</span></a></span></span><span> </span><span id="local-6989586621682949809"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621682949809"><span class="hs-identifier hs-var">txbody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4147"></span><span>                </span><span class="annot"><span class="annottext">Method -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; Text) -&gt; Method -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4148"></span><span>                </span><span class="annot"><span class="annottext">Method -&gt; Method
forall bin. ByteArrayAccess bin =&gt; bin -&gt; Method
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">hex</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; Method) -&gt; Method -&gt; Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4149"></span><span>                </span><span class="annot"><span class="annottext">Tx era -&gt; Method
forall a. SerialiseAsCBOR a =&gt; a -&gt; Method
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.serialiseToCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[KeyWitness era] -&gt; TxBody era -&gt; Tx era
forall era. [KeyWitness era] -&gt; TxBody era -&gt; Tx era
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">Cardano.makeSignedTransaction</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621682949809"><span class="hs-identifier hs-var">txbody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4150"></span><span>
</span><span id="line-4151"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TxBody AlonzoEra -&gt; Text
forall era. IsCardanoEra era =&gt; TxBody era -&gt; Text
</span><a href="#local-6989586621682949810"><span class="hs-identifier hs-var">toCborHexTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody AlonzoEra
</span><a href="#local-6989586621682949814"><span class="hs-identifier hs-var">txBody</span></a></span><span>
</span><span id="line-4152"></span><span>
</span><span id="line-4153"></span><span>    </span><span id="local-6989586621682951610"><span class="annot"><a href="#local-6989586621682949968"><span class="hs-identifier hs-type">mintAssetsCheckWithoutBalanceCheck</span></a></span><span>
</span><span id="line-4154"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951610"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4155"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-4156"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-4157"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">TokenName</span></a></span><span>
</span><span id="line-4158"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-4159"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">Script</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4160"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682951610"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">TokenMap.TokenMap</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-4161"></span><span>    </span><span id="local-6989586621682949968"><span class="annot"><span class="annottext">mintAssetsCheckWithoutBalanceCheck :: Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m (Natural, Natural, TokenMap)
</span><a href="#local-6989586621682949968"><span class="hs-identifier hs-var hs-var">mintAssetsCheckWithoutBalanceCheck</span></a></span></span><span>
</span><span id="line-4162"></span><span>        </span><span id="local-6989586621682949805"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682949804"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span id="local-6989586621682949803"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949803"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span> </span><span id="local-6989586621682949802"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949802"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span id="local-6989586621682949801"><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682949801"><span class="hs-identifier hs-var">scriptUsedF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4163"></span><span>
</span><span id="line-4164"></span><span>        </span><span id="local-6989586621682949800"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949800"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4165"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949802"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-4166"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; m ()]
-&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949800"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-4167"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4168"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4169"></span><span>
</span><span id="line-4170"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949799"><span class="annot"><span class="annottext">txCbor1 :: ApiT SealedTx
</span><a href="#local-6989586621682949799"><span class="hs-identifier hs-var hs-var">txCbor1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682949798"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949800"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-4171"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949797"><span class="annot"><span class="annottext">decodePayload1 :: Payload
</span><a href="#local-6989586621682949797"><span class="hs-identifier hs-var hs-var">decodePayload1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949799"><span class="hs-identifier hs-var">txCbor1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4172"></span><span>
</span><span id="line-4173"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949796"><span class="annot"><span class="annottext">policyWithHash :: (Method, Text)
</span><a href="#local-6989586621682949796"><span class="hs-identifier hs-var hs-var">policyWithHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; Maybe Bool -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; Maybe Bool -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getPolicyKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4174"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949795"><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949795"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-4175"></span><span>            </span><span class="annot"><span class="annottext">Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, ApiPolicyKey)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682949796"><span class="hs-identifier hs-var">policyWithHash</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-4176"></span><span>
</span><span id="line-4177"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949794"><span class="annot"><span class="annottext">postPolicyKey :: (Method, Text)
</span><a href="#local-6989586621682949794"><span class="hs-identifier hs-var hs-var">postPolicyKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; Maybe Bool -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; Maybe Bool -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.postPolicyKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4178"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949792"><span class="annot"><span class="annottext">passwdPayload :: Payload
</span><a href="#local-6989586621682949792"><span class="hs-identifier hs-var hs-var">passwdPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json| {
                &quot;passphrase&quot;: #{fixturePassphrase}
                } |]</span></span><span>
</span><span id="line-4181"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949791"><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949791"><span class="hs-identifier hs-var">policyKeyHashPayload'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-4182"></span><span>            </span><span class="annot"><span class="annottext">Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, ApiPolicyKey)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682949794"><span class="hs-identifier hs-var">postPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949792"><span class="hs-identifier hs-var">passwdPayload</span></a></span><span>
</span><span id="line-4183"></span><span>
</span><span id="line-4184"></span><span>        </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949795"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; ApiPolicyKey -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949791"><span class="hs-identifier hs-var">policyKeyHashPayload'</span></a></span><span>
</span><span id="line-4185"></span><span>
</span><span id="line-4186"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682949790"><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682949790"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4187"></span><span>                </span><span class="annot"><span class="annottext">(KeyRole, Method) -&gt; Maybe KeyHash
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">keyHashFromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyRole
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Policy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Method
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949795"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4188"></span><span>
</span><span id="line-4189"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949789"><span class="annot"><span class="annottext">scriptUsed :: Script KeyHash
</span><a href="#local-6989586621682949789"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682949801"><span class="hs-identifier hs-var">scriptUsedF</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682949790"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span>
</span><span id="line-4190"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949788"><span class="annot"><span class="annottext">tokenPolicyId' :: TokenPolicyId
</span><a href="#local-6989586621682949788"><span class="hs-identifier hs-var hs-var">tokenPolicyId'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4191"></span><span>                </span><span class="annot"><span class="annottext">Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId)
-&gt; (Method -&gt; Hash &quot;TokenPolicy&quot;) -&gt; Method -&gt; TokenPolicyId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Hash &quot;TokenPolicy&quot;
forall (tag :: Symbol). Method -&gt; Hash tag
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Hash</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; TokenPolicyId) -&gt; Method -&gt; TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4192"></span><span>                </span><span class="annot"><span class="annottext">ScriptHash -&gt; Method
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var hs-var">unScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Method) -&gt; ScriptHash -&gt; Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4193"></span><span>                </span><span class="annot"><span class="annottext">Script KeyHash -&gt; ScriptHash
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">toScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Script KeyHash
</span><a href="#local-6989586621682949789"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-4194"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949787"><span class="annot"><span class="annottext">tokens' :: TokenMap
</span><a href="#local-6989586621682949787"><span class="hs-identifier hs-var hs-var">tokens'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssetId -&gt; TokenQuantity -&gt; TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.singleton</span></a></span><span>
</span><span id="line-4195"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; AssetId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AssetId</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682949788"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949803"><span class="hs-identifier hs-var">tokenName'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4196"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; TokenQuantity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">50_000</span></span><span class="hs-special">)</span><span>
</span><span id="line-4197"></span><span>
</span><span id="line-4198"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949783"><span class="annot"><span class="annottext">apiTokenAmountFingerprint :: ApiTokenAmountFingerprint
</span><a href="#local-6989586621682949783"><span class="hs-identifier hs-var hs-var">apiTokenAmountFingerprint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTokenAmountFingerprint :: ApiT TokenName
-&gt; Natural -&gt; ApiT TokenFingerprint -&gt; ApiTokenAmountFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTokenAmountFingerprint</span></a></span><span>
</span><span id="line-4199"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assetName:ApiTokenAmountFingerprint :: ApiT TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; ApiT TokenName
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949803"><span class="hs-identifier hs-var">tokenName'</span></a></span><span>
</span><span id="line-4200"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:quantity:ApiTokenAmountFingerprint :: Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">quantity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">50_000</span></span><span>
</span><span id="line-4201"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fingerprint:ApiTokenAmountFingerprint :: ApiT TokenFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">fingerprint</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4202"></span><span>                    </span><span class="annot"><span class="annottext">TokenFingerprint -&gt; ApiT TokenFingerprint
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenFingerprint -&gt; ApiT TokenFingerprint)
-&gt; TokenFingerprint -&gt; ApiT TokenFingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; TokenFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682949788"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949803"><span class="hs-identifier hs-var">tokenName'</span></a></span><span>
</span><span id="line-4203"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4204"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949782"><span class="annot"><span class="annottext">apiTokens :: ApiTokens
</span><a href="#local-6989586621682949782"><span class="hs-identifier hs-var hs-var">apiTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTokens :: ApiT TokenPolicyId
-&gt; ApiT AnyScript
-&gt; NonEmpty ApiTokenAmountFingerprint
-&gt; ApiTokens
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTokens</span></a></span><span>
</span><span id="line-4205"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:policyId:ApiTokens :: ApiT TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; ApiT TokenPolicyId
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682949788"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span>
</span><span id="line-4206"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:policyScript:ApiTokens :: ApiT AnyScript
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">policyScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyScript -&gt; ApiT AnyScript
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script KeyHash -&gt; AnyScript
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">NativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">Script KeyHash
</span><a href="#local-6989586621682949789"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4207"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiTokens :: NonEmpty ApiTokenAmountFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiTokenAmountFingerprint] -&gt; NonEmpty ApiTokenAmountFingerprint
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTokenAmountFingerprint
</span><a href="#local-6989586621682949783"><span class="hs-identifier hs-var">apiTokenAmountFingerprint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4208"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4209"></span><span>
</span><span id="line-4210"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949781"><span class="annot"><span class="annottext">activeAssetsInfo :: ApiAssetMintBurn
</span><a href="#local-6989586621682949781"><span class="hs-identifier hs-var hs-var">activeAssetsInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-4211"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTokens
</span><a href="#local-6989586621682949782"><span class="hs-identifier hs-var">apiTokens</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4212"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Maybe ApiPolicyKey
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949795"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span><span>
</span><span id="line-4213"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4214"></span><span>                    </span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex))
-&gt; ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-4215"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4216"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949780"><span class="annot"><span class="annottext">inactiveAssetsInfo :: ApiAssetMintBurn
</span><a href="#local-6989586621682949780"><span class="hs-identifier hs-var hs-var">inactiveAssetsInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-4217"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4218"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiPolicyKey
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4219"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4220"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4221"></span><span>
</span><span id="line-4222"></span><span>        </span><span id="local-6989586621682949779"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949779"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4223"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949797"><span class="hs-identifier hs-var">decodePayload1</span></a></span><span>
</span><span id="line-4224"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; m ()]
-&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949779"><span class="hs-identifier hs-var">rDecodedTx1</span></a></span><span>
</span><span id="line-4225"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4226"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mint&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949778"><span class="hs-var">#mint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949781"><span class="hs-identifier hs-var">activeAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4227"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;burn&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949777"><span class="hs-var">#burn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949780"><span class="hs-identifier hs-var">inactiveAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4228"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4229"></span><span>
</span><span id="line-4230"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949776"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682949776"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682949775"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949800"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-4231"></span><span>        </span><span id="local-6989586621682949774"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949774"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949776"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4232"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949773"><span class="annot"><span class="annottext">txCbor2 :: ApiT SealedTx
</span><a href="#local-6989586621682949773"><span class="hs-identifier hs-var hs-var">txCbor2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4233"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682949772"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949774"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4234"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949771"><span class="annot"><span class="annottext">decodePayload2 :: Payload
</span><a href="#local-6989586621682949771"><span class="hs-identifier hs-var hs-var">decodePayload2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949773"><span class="hs-identifier hs-var">txCbor2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4235"></span><span>        </span><span id="local-6989586621682949770"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949770"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4236"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949771"><span class="hs-identifier hs-var">decodePayload2</span></a></span><span>
</span><span id="line-4237"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; m ()]
-&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949770"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span><span>
</span><span id="line-4238"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4239"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mint&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949769"><span class="hs-var">#mint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949781"><span class="hs-identifier hs-var">activeAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4240"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;burn&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949768"><span class="hs-var">#burn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949780"><span class="hs-identifier hs-var">inactiveAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4241"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4242"></span><span>
</span><span id="line-4243"></span><span>        </span><span id="local-6989586621682949767"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949767"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949805"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949774"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-4244"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; m ()] -&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949767"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-4245"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; m ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-4246"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status -&gt; (Status, Either RequestException ApiTxId) -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4247"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4248"></span><span>
</span><span id="line-4249"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949766"><span class="annot"><span class="annottext">initialBalance :: Natural
</span><a href="#local-6989586621682949766"><span class="hs-identifier hs-var hs-var">initialBalance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949804"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; ApiWallet -&gt; Const Natural ApiWallet)
-&gt; Natural
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
   -&gt; ApiWallet -&gt; Const Natural ApiWallet)
(ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; ApiWallet -&gt; Const Natural ApiWallet
</span><a href="#local-6989586621682949765"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
 -&gt; ApiWallet -&gt; Const Natural ApiWallet)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; ApiWallet
-&gt; Const Natural ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural
    -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural
 -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance
</span><a href="#local-6989586621682949764"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural
  -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; Const Natural ApiWalletBalance)
-&gt; ((Natural -&gt; Const Natural Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural
    -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; Const Natural Natural)
-&gt; ApiWalletBalance
-&gt; Const Natural ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; Const Natural Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural
   -&gt; Const Natural (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; Const Natural Natural)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; Const Natural (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949763"><span class="hs-var">#getQuantity</span></a></span><span>
</span><span id="line-4250"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949762"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682949762"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682949761"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949760"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949800"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-4251"></span><span>
</span><span id="line-4252"></span><span>        </span><span class="annot"><span class="annottext">(Natural, Natural, TokenMap) -&gt; m (Natural, Natural, TokenMap)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949766"><span class="hs-identifier hs-var">initialBalance</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949762"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682949787"><span class="hs-identifier hs-var">tokens'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4253"></span><span>
</span><span id="line-4254"></span><span>    </span><span id="local-6989586621682951616"><span class="annot"><a href="#local-6989586621682950031"><span class="hs-identifier hs-type">mintAssetsCheck</span></a></span><span>
</span><span id="line-4255"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951616"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4256"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-4257"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-4258"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">TokenName</span></a></span><span>
</span><span id="line-4259"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-4260"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">Script</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4261"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682951616"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-4262"></span><span>    </span><span id="local-6989586621682950031"><span class="annot"><span class="annottext">mintAssetsCheck :: Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682950031"><span class="hs-identifier hs-var hs-var">mintAssetsCheck</span></a></span></span><span> </span><span id="local-6989586621682949759"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949759"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682949758"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949758"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span id="local-6989586621682949757"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949757"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span> </span><span id="local-6989586621682949756"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949756"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span id="local-6989586621682949755"><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682949755"><span class="hs-identifier hs-var">scriptUsedF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4263"></span><span>
</span><span id="line-4264"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682949754"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949754"><span class="hs-identifier hs-var">initialBalance</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949753"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949753"><span class="hs-identifier hs-var">expectedFee</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949752"><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682949752"><span class="hs-identifier hs-var">tokens'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-4265"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m (Natural, Natural, TokenMap)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m (Natural, Natural, TokenMap)
</span><a href="#local-6989586621682949968"><span class="hs-identifier hs-var">mintAssetsCheckWithoutBalanceCheck</span></a></span><span>
</span><span id="line-4266"></span><span>                </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949759"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949758"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949757"><span class="hs-identifier hs-var">tokenName'</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949756"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682949755"><span class="hs-identifier hs-var">scriptUsedF</span></a></span><span>
</span><span id="line-4267"></span><span>
</span><span id="line-4268"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span>
</span><span id="line-4269"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance is decreased by fee and holds minted assets&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4270"></span><span>            </span><span id="local-6989586621682949751"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949751"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949759"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4271"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949758"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-4272"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949751"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-4273"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-4274"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-4275"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949750"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Natural -&gt; f Natural)
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682949749"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiWalletBalance
-&gt; f ApiWalletBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682949748"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4276"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949754"><span class="hs-identifier hs-var">initialBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682949753"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4277"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949747"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949746"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949745"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4278"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682949752"><span class="hs-identifier hs-var">tokens'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4279"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949744"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949743"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949742"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4280"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682949752"><span class="hs-identifier hs-var">tokens'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4281"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4282"></span><span>
</span><span id="line-4283"></span><span>    </span><span id="local-6989586621682949741"><span class="annot"><a href="#local-6989586621682949992"><span class="hs-identifier hs-type">burnAssetsCheck</span></a></span><span>
</span><span id="line-4284"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682949741"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-4285"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-4286"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-4287"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">TokenName</span></a></span><span>
</span><span id="line-4288"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span><span>
</span><span id="line-4289"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">Script</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-type">KeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4290"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682949741"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-4291"></span><span>    </span><span id="local-6989586621682949992"><span class="annot"><span class="annottext">burnAssetsCheck :: Context
-&gt; ApiWallet
-&gt; TokenName
-&gt; Payload
-&gt; (KeyHash -&gt; Script KeyHash)
-&gt; m ()
</span><a href="#local-6989586621682949992"><span class="hs-identifier hs-var hs-var">burnAssetsCheck</span></a></span></span><span> </span><span id="local-6989586621682949740"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682949739"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span id="local-6989586621682949738"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949738"><span class="hs-identifier hs-var">tokenName'</span></a></span></span><span> </span><span id="local-6989586621682949737"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949737"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span id="local-6989586621682949736"><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682949736"><span class="hs-identifier hs-var">scriptUsedF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4292"></span><span>
</span><span id="line-4293"></span><span>        </span><span id="local-6989586621682949735"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949735"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4294"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949737"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-4295"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; m ()]
-&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949735"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-4296"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4297"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4298"></span><span>
</span><span id="line-4299"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949734"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682949734"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682949733"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949735"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-4300"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949732"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682949732"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949734"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4301"></span><span>
</span><span id="line-4302"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949731"><span class="annot"><span class="annottext">policyWithHash :: (Method, Text)
</span><a href="#local-6989586621682949731"><span class="hs-identifier hs-var hs-var">policyWithHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWallet -&gt; Maybe Bool -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; Maybe Bool -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getPolicyKey</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4303"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682949730"><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949730"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-4304"></span><span>            </span><span class="annot"><span class="annottext">Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, ApiPolicyKey)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (Method, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682949731"><span class="hs-identifier hs-var">policyWithHash</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-4305"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621682949729"><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682949729"><span class="hs-identifier hs-var">policyKeyHash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4306"></span><span>                </span><span class="annot"><span class="annottext">(KeyRole, Method) -&gt; Maybe KeyHash
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">keyHashFromBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyRole
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">Policy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Method
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiPolicyKey</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949730"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4307"></span><span>
</span><span id="line-4308"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949728"><span class="annot"><span class="annottext">scriptUsed :: Script KeyHash
</span><a href="#local-6989586621682949728"><span class="hs-identifier hs-var hs-var">scriptUsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash -&gt; Script KeyHash
</span><a href="#local-6989586621682949736"><span class="hs-identifier hs-var">scriptUsedF</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash
</span><a href="#local-6989586621682949729"><span class="hs-identifier hs-var">policyKeyHash</span></a></span><span>
</span><span id="line-4309"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949727"><span class="annot"><span class="annottext">tokenPolicyId' :: TokenPolicyId
</span><a href="#local-6989586621682949727"><span class="hs-identifier hs-var hs-var">tokenPolicyId'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4310"></span><span>                </span><span class="annot"><span class="annottext">Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId)
-&gt; (Method -&gt; Hash &quot;TokenPolicy&quot;) -&gt; Method -&gt; TokenPolicyId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Hash &quot;TokenPolicy&quot;
forall (tag :: Symbol). Method -&gt; Hash tag
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Hash</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; TokenPolicyId) -&gt; Method -&gt; TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4311"></span><span>                </span><span class="annot"><span class="annottext">ScriptHash -&gt; Method
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var hs-var">unScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; Method) -&gt; ScriptHash -&gt; Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Script KeyHash -&gt; ScriptHash
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">toScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Script KeyHash
</span><a href="#local-6989586621682949728"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span>
</span><span id="line-4312"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949726"><span class="annot"><span class="annottext">apiTokenAmountFingerprint :: ApiTokenAmountFingerprint
</span><a href="#local-6989586621682949726"><span class="hs-identifier hs-var hs-var">apiTokenAmountFingerprint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTokenAmountFingerprint :: ApiT TokenName
-&gt; Natural -&gt; ApiT TokenFingerprint -&gt; ApiTokenAmountFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTokenAmountFingerprint</span></a></span><span>
</span><span id="line-4313"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:assetName:ApiTokenAmountFingerprint :: ApiT TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenName -&gt; ApiT TokenName
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949738"><span class="hs-identifier hs-var">tokenName'</span></a></span><span>
</span><span id="line-4314"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:quantity:ApiTokenAmountFingerprint :: Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">quantity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">50_000</span></span><span>
</span><span id="line-4315"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fingerprint:ApiTokenAmountFingerprint :: ApiT TokenFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">fingerprint</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4316"></span><span>                    </span><span class="annot"><span class="annottext">TokenFingerprint -&gt; ApiT TokenFingerprint
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenFingerprint -&gt; ApiT TokenFingerprint)
-&gt; TokenFingerprint -&gt; ApiT TokenFingerprint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; TokenFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">mkTokenFingerprint</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682949727"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682949738"><span class="hs-identifier hs-var">tokenName'</span></a></span><span>
</span><span id="line-4317"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4318"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949725"><span class="annot"><span class="annottext">apiTokens :: ApiTokens
</span><a href="#local-6989586621682949725"><span class="hs-identifier hs-var hs-var">apiTokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiTokens :: ApiT TokenPolicyId
-&gt; ApiT AnyScript
-&gt; NonEmpty ApiTokenAmountFingerprint
-&gt; ApiTokens
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTokens</span></a></span><span>
</span><span id="line-4319"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:policyId:ApiTokens :: ApiT TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; ApiT TokenPolicyId
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682949727"><span class="hs-identifier hs-var">tokenPolicyId'</span></a></span><span>
</span><span id="line-4320"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:policyScript:ApiTokens :: ApiT AnyScript
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">policyScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnyScript -&gt; ApiT AnyScript
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Script KeyHash -&gt; AnyScript
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">NativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">Script KeyHash
</span><a href="#local-6989586621682949728"><span class="hs-identifier hs-var">scriptUsed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4321"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiTokens :: NonEmpty ApiTokenAmountFingerprint
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiTokenAmountFingerprint] -&gt; NonEmpty ApiTokenAmountFingerprint
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTokenAmountFingerprint
</span><a href="#local-6989586621682949726"><span class="hs-identifier hs-var">apiTokenAmountFingerprint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4322"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4323"></span><span>
</span><span id="line-4324"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949724"><span class="annot"><span class="annottext">activeAssetsInfo :: ApiAssetMintBurn
</span><a href="#local-6989586621682949724"><span class="hs-identifier hs-var hs-var">activeAssetsInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-4325"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-4326"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ApiPolicyKey
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4327"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT DerivationIndex)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4328"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4329"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949723"><span class="annot"><span class="annottext">inactiveAssetsInfo :: ApiAssetMintBurn
</span><a href="#local-6989586621682949723"><span class="hs-identifier hs-var hs-var">inactiveAssetsInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn :: [ApiTokens]
-&gt; Maybe ApiPolicyKey
-&gt; Maybe (ApiT DerivationIndex)
-&gt; ApiAssetMintBurn
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAssetMintBurn</span></a></span><span>
</span><span id="line-4330"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:tokens:ApiAssetMintBurn :: [ApiTokens]
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">tokens</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTokens
</span><a href="#local-6989586621682949725"><span class="hs-identifier hs-var">apiTokens</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4331"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyHash:ApiAssetMintBurn :: Maybe ApiPolicyKey
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey -&gt; Maybe ApiPolicyKey
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPolicyKey
</span><a href="#local-6989586621682949730"><span class="hs-identifier hs-var">policyKeyHashPayload</span></a></span><span>
</span><span id="line-4332"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:walletPolicyKeyIndex:ApiAssetMintBurn :: Maybe (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">walletPolicyKeyIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4333"></span><span>                    </span><span class="annot"><span class="annottext">ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex))
-&gt; ApiT DerivationIndex -&gt; Maybe (ApiT DerivationIndex)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-4334"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-4335"></span><span>
</span><span id="line-4336"></span><span>        </span><span id="local-6989586621682949722"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949722"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4337"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949732"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-4338"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; m ()]
-&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949722"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span>
</span><span id="line-4339"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4340"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mint&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949721"><span class="hs-var">#mint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949724"><span class="hs-identifier hs-var">activeAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4341"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;burn&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949720"><span class="hs-var">#burn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949723"><span class="hs-identifier hs-var">inactiveAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4342"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4343"></span><span>
</span><span id="line-4344"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949719"><span class="annot"><span class="annottext">apiTx :: ApiT SealedTx
</span><a href="#local-6989586621682949719"><span class="hs-identifier hs-var hs-var">apiTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682949718"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682949735"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-4345"></span><span>        </span><span id="local-6989586621682949717"><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949717"><span class="hs-identifier hs-var">signedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiT SealedTx
-&gt; [(Status, Either RequestException ApiSerialisedTransaction)
    -&gt; m ()]
-&gt; m ApiSerialisedTransaction
</span><a href="Test.Integration.Framework.DSL.html#signTx"><span class="hs-identifier hs-var">signTx</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949719"><span class="hs-identifier hs-var">apiTx</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4346"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949716"><span class="annot"><span class="annottext">txCbor2 :: ApiT SealedTx
</span><a href="#local-6989586621682949716"><span class="hs-identifier hs-var hs-var">txCbor2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4347"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSerialisedTransaction (ApiT SealedTx)
-&gt; (Status, Either RequestException ApiSerialisedTransaction)
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiSerialisedTransaction -&gt; f ApiSerialisedTransaction)
Lens' ApiSerialisedTransaction (ApiT SealedTx)
</span><a href="#local-6989586621682949715"><span class="hs-var">#transaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
-&gt; Either RequestException ApiSerialisedTransaction
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949717"><span class="hs-identifier hs-var">signedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4348"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682949714"><span class="annot"><span class="annottext">decodePayload2 :: Payload
</span><a href="#local-6989586621682949714"><span class="hs-identifier hs-var hs-var">decodePayload2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682949716"><span class="hs-identifier hs-var">txCbor2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4349"></span><span>        </span><span id="local-6989586621682949713"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949713"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682951404"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4350"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682949714"><span class="hs-identifier hs-var">decodePayload2</span></a></span><span>
</span><span id="line-4351"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; m ()]
-&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682949713"><span class="hs-identifier hs-var">rDecodedTx2</span></a></span><span>
</span><span id="line-4352"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4353"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;mint&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949712"><span class="hs-var">#mint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949724"><span class="hs-identifier hs-var">activeAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4354"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
-&gt; (ApiAssetMintBurn -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; m ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;burn&quot;
  ((ApiAssetMintBurn -&gt; f ApiAssetMintBurn)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiAssetMintBurn
</span><a href="#local-6989586621682949711"><span class="hs-var">#burn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiAssetMintBurn -&gt; ApiAssetMintBurn -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">ApiAssetMintBurn
</span><a href="#local-6989586621682949723"><span class="hs-identifier hs-var">inactiveAssetsInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4355"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4356"></span><span>
</span><span id="line-4357"></span><span>        </span><span id="local-6989586621682949710"><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949710"><span class="hs-identifier hs-var">submittedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context
-&gt; ApiWallet
-&gt; ApiSerialisedTransaction
-&gt; m (Status, Either RequestException ApiTxId)
</span><a href="Test.Integration.Framework.DSL.html#submitTxWithWid"><span class="hs-identifier hs-var">submitTxWithWid</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSerialisedTransaction
</span><a href="#local-6989586621682949717"><span class="hs-identifier hs-var">signedTx</span></a></span><span>
</span><span id="line-4358"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
-&gt; [(Status, Either RequestException ApiTxId) -&gt; m ()] -&gt; m ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId)
</span><a href="#local-6989586621682949710"><span class="hs-identifier hs-var">submittedTx</span></a></span><span>
</span><span id="line-4359"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiTxId) -&gt; m ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-4360"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status -&gt; (Status, Either RequestException ApiTxId) -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-4361"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-4362"></span><span>
</span><span id="line-4363"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wallet balance does not have minted assets anymore&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4364"></span><span>            </span><span id="local-6989586621682949709"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949709"><span class="hs-identifier hs-var">rWa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682949740"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-4365"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682949739"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-4366"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
-&gt; [(Status, Either RequestException ApiWallet) -&gt; IO ()] -&gt; IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682949709"><span class="hs-identifier hs-var">rWa</span></a></span><span>
</span><span id="line-4367"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet) -&gt; IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-4368"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949708"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949707"><span class="hs-var">#available</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949706"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4369"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4370"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' ApiWallet TokenMap
-&gt; (TokenMap -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;assets&quot;
  ((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682949705"><span class="hs-var">#assets</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((TokenMap -&gt; f TokenMap)
    -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;total&quot;
  ((ApiT TokenMap -&gt; f (ApiT TokenMap))
   -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
(ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance
</span><a href="#local-6989586621682949704"><span class="hs-var">#total</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; f (ApiT TokenMap))
 -&gt; ApiWalletAssetsBalance -&gt; f ApiWalletAssetsBalance)
-&gt; ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
-&gt; (TokenMap -&gt; f TokenMap)
-&gt; ApiWalletAssetsBalance
-&gt; f ApiWalletAssetsBalance
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getApiT&quot;
  ((TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap))
(TokenMap -&gt; f TokenMap) -&gt; ApiT TokenMap -&gt; f (ApiT TokenMap)
</span><a href="#local-6989586621682949703"><span class="hs-var">#getApiT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4371"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; TokenMap -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4372"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-4373"></span></pre></body></html>