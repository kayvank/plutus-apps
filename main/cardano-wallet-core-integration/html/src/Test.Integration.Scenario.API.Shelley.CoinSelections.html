<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-12"></span><span class="hs-comment">{- HLINT ignore &quot;Use camelCase&quot; -}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Integration.Scenario.API.Shelley.CoinSelections</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Scenario.API.Shelley.CoinSelections.html#spec"><span class="hs-identifier">spec</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Mnemonic</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">mnemonicToText</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Api.Types</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">AddressAmount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiCoinSelection</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiCoinSelectionOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiWallet</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DecodeAddress</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DecodeStakeAddress</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">EncodeAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">WalletStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">PaymentAddress</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Byron</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ByronKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Icarus</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">IcarusKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation.Shelley</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ShelleyKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDiscovery.Sequential</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">purposeBIP44</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">purposeCIP1852</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Hash</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Hash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">AssetId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenPolicy</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TokenName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TokenPolicyId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenQuantity</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TokenQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">txOutMaxTokenQuantity</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM_</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL.Lens</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(:|)</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">Data.Text.Class</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../text-class/html/src"><span class="hs-identifier">toText</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../hspec/html/src"><span class="hs-identifier">Test.Hspec</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier">SpecWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier">describe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations/html/src"><span class="hs-identifier">shouldBe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations/html/src"><span class="hs-identifier">shouldSatisfy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier">Test.Hspec.Extra</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier">it</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html"><span class="hs-identifier">Test.Integration.Framework.DSL</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier">Context</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Headers"><span class="hs-identifier">Headers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier">Payload</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#addField"><span class="hs-identifier">addField</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier">emptyWallet</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier">expectErrorMessage</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier">expectField</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier">expectResponseCode</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier">fixtureWallet</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#isValidDerivationPath"><span class="hs-identifier">isValidDerivationPath</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#json"><span class="hs-identifier">json</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier">listAddresses</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier">minUTxOValue</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier">request</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier">rewardWallet</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">runResourceT</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier">selectCoins</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#selectCoinsWith"><span class="hs-identifier">selectCoinsWith</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier">verify</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#walletId"><span class="hs-identifier">walletId</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html"><span class="hs-identifier">Test.Integration.Framework.TestData</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg400TxMetadataStringTooLong"><span class="hs-identifier">errMsg400TxMetadataStringTooLong</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403OutputTokenBundleSizeExceedsLimit"><span class="hs-identifier">errMsg403OutputTokenBundleSizeExceedsLimit</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403OutputTokenQuantityExceedsLimit"><span class="hs-identifier">errMsg403OutputTokenQuantityExceedsLimit</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg404NoWallet"><span class="hs-identifier">errMsg404NoWallet</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg406"><span class="hs-identifier">errMsg406</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg415"><span class="hs-identifier">errMsg415</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Api.Link</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Link</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenMap</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenQuantity</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenQuantity</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../unordered-containers/html/src"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="annot"><a href="Test.Integration.Scenario.API.Shelley.CoinSelections.html#spec"><span class="hs-identifier hs-type">spec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682944982"><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeStakeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">EncodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ShelleyKey</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">IcarusKey</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">PaymentAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ByronKey</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-117"></span><span id="spec"><span class="annot"><span class="annottext">spec :: SpecWith Context
</span><a href="Test.Integration.Scenario.API.Shelley.CoinSelections.html#spec"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHELLEY_COIN_SELECTION&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_01 - \
        \A singleton payment is included in the coin selection output.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682944981"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944981"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>            </span><span id="local-6989586621682944980"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944980"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944981"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span id="local-6989586621682944979"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944979"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944981"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-124"></span><span>            </span><span id="local-6989586621682944978"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944978"><span class="hs-identifier hs-var">targetAddress</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944977"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944981"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944979"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944975"><span class="annot"><span class="annottext">amount :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944975"><span class="hs-identifier hs-var hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944981"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-126"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944971"><span class="annot"><span class="annottext">payment :: AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944971"><span class="hs-identifier hs-var hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944978"><span class="hs-identifier hs-var">targetAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944975"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-127"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944969"><span class="annot"><span class="annottext">output :: ApiCoinSelectionOutput n
</span><a href="#local-6989586621682944969"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiCoinSelectionOutput n
forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiCoinSelectionOutput n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiCoinSelectionOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944978"><span class="hs-identifier hs-var">targetAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944975"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-128"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier hs-var">selectCoins</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944981"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944980"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944971"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-129"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-130"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiWalletInput n]
</span><a href="#local-6989586621682944964"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-131"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiWalletInput n]
</span><a href="#local-6989586621682944961"><span class="hs-var">#inputs</span></a></span><span>
</span><span id="line-133"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletInput n -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span>
</span><span id="line-134"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; Bool
</span><a href="Test.Integration.Framework.DSL.html#isValidDerivationPath"><span class="hs-identifier hs-var">isValidDerivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">purposeCIP1852</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiT DerivationIndex) -&gt; Bool)
-&gt; (ApiWalletInput n -&gt; NonEmpty (ApiT DerivationIndex))
-&gt; ApiWalletInput n
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (ApiT DerivationIndex)
  -&gt; Const
       (NonEmpty (ApiT DerivationIndex))
       (NonEmpty (ApiT DerivationIndex)))
 -&gt; ApiWalletInput n
 -&gt; Const (NonEmpty (ApiT DerivationIndex)) (ApiWalletInput n))
-&gt; ApiWalletInput n -&gt; NonEmpty (ApiT DerivationIndex)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;derivationPath&quot;
  ((NonEmpty (ApiT DerivationIndex)
    -&gt; Const
         (NonEmpty (ApiT DerivationIndex))
         (NonEmpty (ApiT DerivationIndex)))
   -&gt; ApiWalletInput n
   -&gt; Const (NonEmpty (ApiT DerivationIndex)) (ApiWalletInput n))
(NonEmpty (ApiT DerivationIndex)
 -&gt; Const
      (NonEmpty (ApiT DerivationIndex))
      (NonEmpty (ApiT DerivationIndex)))
-&gt; ApiWalletInput n
-&gt; Const (NonEmpty (ApiT DerivationIndex)) (ApiWalletInput n)
</span><a href="#local-6989586621682944959"><span class="hs-var">#derivationPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionChange n]
</span><a href="#local-6989586621682944958"><span class="hs-var">#change</span></a></span><span>
</span><span id="line-136"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionChange n]
</span><a href="#local-6989586621682944957"><span class="hs-var">#change</span></a></span><span>
</span><span id="line-138"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelectionChange n -&gt; Bool)
-&gt; [ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span>
</span><span id="line-139"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; Bool
</span><a href="Test.Integration.Framework.DSL.html#isValidDerivationPath"><span class="hs-identifier hs-var">isValidDerivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">purposeCIP1852</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiT DerivationIndex) -&gt; Bool)
-&gt; (ApiCoinSelectionChange n -&gt; NonEmpty (ApiT DerivationIndex))
-&gt; ApiCoinSelectionChange n
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (ApiT DerivationIndex)
  -&gt; Const
       (NonEmpty (ApiT DerivationIndex))
       (NonEmpty (ApiT DerivationIndex)))
 -&gt; ApiCoinSelectionChange n
 -&gt; Const
      (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionChange n))
-&gt; ApiCoinSelectionChange n -&gt; NonEmpty (ApiT DerivationIndex)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;derivationPath&quot;
  ((NonEmpty (ApiT DerivationIndex)
    -&gt; Const
         (NonEmpty (ApiT DerivationIndex))
         (NonEmpty (ApiT DerivationIndex)))
   -&gt; ApiCoinSelectionChange n
   -&gt; Const
        (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionChange n))
(NonEmpty (ApiT DerivationIndex)
 -&gt; Const
      (NonEmpty (ApiT DerivationIndex))
      (NonEmpty (ApiT DerivationIndex)))
-&gt; ApiCoinSelectionChange n
-&gt; Const
     (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionChange n)
</span><a href="#local-6989586621682944956"><span class="hs-var">#derivationPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionOutput n]
</span><a href="#local-6989586621682944955"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-141"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; [ApiCoinSelectionOutput n] -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; a -&gt; a -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiCoinSelectionOutput n
</span><a href="#local-6989586621682944969"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
</span><a href="#local-6989586621682944954"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-143"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) (Maybe ApiBase64)
</span><a href="#local-6989586621682944953"><span class="hs-var">#metadata</span></a></span><span>
</span><span id="line-145"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Maybe ApiBase64 -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; a -&gt; a -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_02 - \
        \Multiple payments are all included in the coin selection output.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682944952"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944952"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944951"><span class="annot"><span class="annottext">paymentCount :: Int
</span><a href="#local-6989586621682944951"><span class="hs-identifier hs-var hs-var">paymentCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-152"></span><span>            </span><span id="local-6989586621682944950"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944950"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944952"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-153"></span><span>            </span><span id="local-6989586621682944949"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944949"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944952"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-154"></span><span>            </span><span id="local-6989586621682944948"><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><a href="#local-6989586621682944948"><span class="hs-identifier hs-var">targetAddresses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944947"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944952"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944949"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944946"><span class="annot"><span class="annottext">amounts :: [Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682944946"><span class="hs-identifier hs-var hs-var">amounts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; [Natural] -&gt; [Quantity &quot;lovelace&quot; Natural]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944952"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944945"><span class="annot"><span class="annottext">assets :: [ApiT TokenMap]
</span><a href="#local-6989586621682944945"><span class="hs-identifier hs-var hs-var">assets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap -&gt; [ApiT TokenMap]
forall a. a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944943"><span class="annot"><span class="annottext">payments :: NonEmpty (AddressAmount (ApiT Address, Proxy n))
</span><a href="#local-6989586621682944943"><span class="hs-identifier hs-var hs-var">payments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-158"></span><span>                    </span><span class="annot"><span class="annottext">([AddressAmount (ApiT Address, Proxy n)]
 -&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n)))
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; [AddressAmount (ApiT Address, Proxy n)]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682944951"><span class="hs-identifier hs-var">paymentCount</span></a></span><span>
</span><span id="line-159"></span><span>                    </span><span class="annot"><span class="annottext">([AddressAmount (ApiT Address, Proxy n)]
 -&gt; [AddressAmount (ApiT Address, Proxy n)])
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; [AddressAmount (ApiT Address, Proxy n)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT TokenMap -&gt; AddressAmount (ApiT Address, Proxy n))
 -&gt; AddressAmount (ApiT Address, Proxy n))
-&gt; [ApiT TokenMap -&gt; AddressAmount (ApiT Address, Proxy n)]
-&gt; [AddressAmount (ApiT Address, Proxy n)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiT TokenMap -&gt; AddressAmount (ApiT Address, Proxy n))
-&gt; ApiT TokenMap -&gt; AddressAmount (ApiT Address, Proxy n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>                    </span><span class="annot"><span class="annottext">([ApiT TokenMap -&gt; AddressAmount (ApiT Address, Proxy n)]
 -&gt; [AddressAmount (ApiT Address, Proxy n)])
-&gt; [ApiT TokenMap -&gt; AddressAmount (ApiT Address, Proxy n)]
-&gt; [AddressAmount (ApiT Address, Proxy n)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Address, Proxy n)
 -&gt; Quantity &quot;lovelace&quot; Natural
 -&gt; ApiT TokenMap
 -&gt; AddressAmount (ApiT Address, Proxy n))
-&gt; [(ApiT Address, Proxy n)]
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; [ApiT TokenMap -&gt; AddressAmount (ApiT Address, Proxy n)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><a href="#local-6989586621682944948"><span class="hs-identifier hs-var">targetAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682944946"><span class="hs-identifier hs-var">amounts</span></a></span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944939"><span class="annot"><span class="annottext">outputs :: [ApiCoinSelectionOutput n]
</span><a href="#local-6989586621682944939"><span class="hs-identifier hs-var hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [ApiCoinSelectionOutput n] -&gt; [ApiCoinSelectionOutput n]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682944951"><span class="hs-identifier hs-var">paymentCount</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiCoinSelectionOutput n] -&gt; [ApiCoinSelectionOutput n])
-&gt; [ApiCoinSelectionOutput n] -&gt; [ApiCoinSelectionOutput n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiT Address, Proxy n)
 -&gt; Quantity &quot;lovelace&quot; Natural
 -&gt; ApiT TokenMap
 -&gt; ApiCoinSelectionOutput n)
-&gt; [(ApiT Address, Proxy n)]
-&gt; [Quantity &quot;lovelace&quot; Natural]
-&gt; [ApiT TokenMap]
-&gt; [ApiCoinSelectionOutput n]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zipWith3</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiCoinSelectionOutput n
forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; ApiCoinSelectionOutput n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiCoinSelectionOutput</span></a></span><span>
</span><span id="line-162"></span><span>                    </span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><a href="#local-6989586621682944948"><span class="hs-identifier hs-var">targetAddresses</span></a></span><span> </span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
</span><a href="#local-6989586621682944946"><span class="hs-identifier hs-var">amounts</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiT TokenMap]
</span><a href="#local-6989586621682944945"><span class="hs-identifier hs-var">assets</span></a></span><span>
</span><span id="line-163"></span><span>            </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier hs-var">selectCoins</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944952"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944950"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AddressAmount (ApiT Address, Proxy n))
</span><a href="#local-6989586621682944943"><span class="hs-identifier hs-var">payments</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-164"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-165"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiWalletInput n]
</span><a href="#local-6989586621682944937"><span class="hs-var">#inputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionChange n]
</span><a href="#local-6989586621682944936"><span class="hs-var">#change</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionOutput n]
</span><a href="#local-6989586621682944935"><span class="hs-var">#outputs</span></a></span><span>
</span><span id="line-168"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; HashSet (ApiCoinSelectionOutput n)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="../../../../unordered-containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
</span><a href="#local-6989586621682944939"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (ApiCoinSelectionOutput n)
-&gt; HashSet (ApiCoinSelectionOutput n) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HashSet (ApiCoinSelectionOutput n) -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n]
    -&gt; HashSet (ApiCoinSelectionOutput n))
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; HashSet (ApiCoinSelectionOutput n)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="../../../../unordered-containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
</span><a href="#local-6989586621682944933"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) (Maybe ApiBase64)
</span><a href="#local-6989586621682944932"><span class="hs-var">#metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Maybe ApiBase64 -&gt; IO ()
forall a. (HasCallStack, Show a, Eq a) =&gt; a -&gt; a -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_03 - \
        \Deleted wallet is not available for selection&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944931"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944931"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621682944930"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944930"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944931"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682944929"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944929"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944928"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944931"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944930"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944927"><span class="annot"><span class="annottext">minUTxOValue' :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944927"><span class="hs-identifier hs-var hs-var">minUTxOValue'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944931"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944926"><span class="annot"><span class="annottext">payments :: NonEmpty (AddressAmount (ApiT Address, Proxy n))
</span><a href="#local-6989586621682944926"><span class="hs-identifier hs-var hs-var">payments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944929"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944927"><span class="hs-identifier hs-var">minUTxOValue'</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944931"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.deleteWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944930"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier hs-var">selectCoins</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944931"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944930"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (AddressAmount (ApiT Address, Proxy n))
</span><a href="#local-6989586621682944926"><span class="hs-identifier hs-var">payments</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status404</span></a></span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><a href="Test.Integration.Framework.TestData.html#errMsg404NoWallet"><span class="hs-identifier hs-var">errMsg404NoWallet</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; Text -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944930"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((Text -&gt; Const Text Text) -&gt; ApiWallet -&gt; Const Text ApiWallet)
-&gt; Text
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Const Text Text) -&gt; ApiWallet -&gt; Const Text ApiWallet
forall s. HasType (ApiT WalletId) s =&gt; Lens' s Text
</span><a href="Test.Integration.Framework.DSL.html#walletId"><span class="hs-identifier hs-var">walletId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_03 - \
        \Wrong selection method (not 'random')&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944921"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944921"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>        </span><span id="local-6989586621682944920"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944920"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944921"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682944919"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944919"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944918"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944921"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944920"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944917"><span class="annot"><span class="annottext">minUTxOValue' :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944917"><span class="hs-identifier hs-var hs-var">minUTxOValue'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944921"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944916"><span class="annot"><span class="annottext">payments :: NonEmpty (AddressAmount (ApiT Address, Proxy n))
</span><a href="#local-6989586621682944916"><span class="hs-identifier hs-var hs-var">payments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944919"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944917"><span class="hs-identifier hs-var">minUTxOValue'</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944915"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682944915"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json| { &quot;payments&quot;: #{payments} } |]</span></span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944911"><span class="annot"><span class="annottext">wid :: Text
</span><a href="#local-6989586621682944911"><span class="hs-identifier hs-var hs-var">wid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WalletId -&gt; Text
forall a. ToText a =&gt; a -&gt; Text
</span><a href="../../../../text-class/html/src"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletId -&gt; Text) -&gt; WalletId -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT WalletId -&gt; WalletId
forall a. ApiT a -&gt; a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT WalletId -&gt; WalletId) -&gt; ApiT WalletId -&gt; WalletId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944920"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
-&gt; ((ApiT WalletId -&gt; Const (ApiT WalletId) (ApiT WalletId))
    -&gt; ApiWallet -&gt; Const (ApiT WalletId) ApiWallet)
-&gt; ApiT WalletId
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  ((ApiT WalletId -&gt; Const (ApiT WalletId) (ApiT WalletId))
   -&gt; ApiWallet -&gt; Const (ApiT WalletId) ApiWallet)
(ApiT WalletId -&gt; Const (ApiT WalletId) (ApiT WalletId))
-&gt; ApiWallet -&gt; Const (ApiT WalletId) ApiWallet
</span><a href="#local-6989586621682944909"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944908"><span class="annot"><span class="annottext">endpoints :: [(Method, Text)]
</span><a href="#local-6989586621682944908"><span class="hs-identifier hs-var hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;POST&quot;</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; (Method, Text))
-&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; (Method, Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; (Method, Text)) -&gt; [[Text]] -&gt; [(Method, Text)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-194"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;v2/wallets/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682944911"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/coin-selections/largest-first&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-195"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;v2/wallets/&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621682944911"><span class="hs-identifier hs-var">wid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/coin-selections&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">[(Method, Text)]
-&gt; ((Method, Text) -&gt; ResourceT IO ()) -&gt; ResourceT IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(Method, Text)]
</span><a href="#local-6989586621682944908"><span class="hs-identifier hs-var">endpoints</span></a></span><span> </span><span class="annot"><span class="annottext">(((Method, Text) -&gt; ResourceT IO ()) -&gt; ResourceT IO ())
-&gt; ((Method, Text) -&gt; ResourceT IO ()) -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944907"><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682944907"><span class="hs-identifier hs-var">endpoint</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>            </span><span id="local-6989586621682944906"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944906"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944921"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">(Method, Text)
</span><a href="#local-6989586621682944907"><span class="hs-identifier hs-var">endpoint</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682944915"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-199"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944906"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status404</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_04 - HTTP headers&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944905"><span class="annot"><span class="annottext">matrix :: [(String, Headers,
  [(Status, Either RequestException (ApiCoinSelection n))
   -&gt; ResourceT IO ()])]
</span><a href="#local-6989586621682944905"><span class="hs-identifier hs-var hs-var">matrix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No HTTP headers -&gt; 415&quot;</span></span><span>
</span><span id="line-204"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#None"><span class="hs-identifier hs-var">None</span></a></span><span>
</span><span id="line-205"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status415</span></a></span><span>
</span><span id="line-206"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg415"><span class="hs-identifier hs-var">errMsg415</span></a></span><span>
</span><span id="line-207"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-208"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Accept: text/plain -&gt; 406&quot;</span></span><span>
</span><span id="line-210"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RequestHeaders -&gt; Headers
</span><a href="Test.Integration.Framework.Request.html#Headers"><span class="hs-identifier hs-var">Headers</span></a></span><span>
</span><span id="line-211"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;application/json&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Accept&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status406</span></a></span><span>
</span><span id="line-215"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg406"><span class="hs-identifier hs-var">errMsg406</span></a></span><span>
</span><span id="line-216"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-217"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No Accept -&gt; 200&quot;</span></span><span>
</span><span id="line-219"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RequestHeaders -&gt; Headers
</span><a href="Test.Integration.Framework.Request.html#Headers"><span class="hs-identifier hs-var">Headers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;application/json&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-220"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No Content-Type -&gt; 415&quot;</span></span><span>
</span><span id="line-223"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RequestHeaders -&gt; Headers
</span><a href="Test.Integration.Framework.Request.html#Headers"><span class="hs-identifier hs-var">Headers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Accept&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;application/json&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-224"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status415</span></a></span><span>
</span><span id="line-225"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg415"><span class="hs-identifier hs-var">errMsg415</span></a></span><span>
</span><span id="line-226"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Content-Type: text/plain -&gt; 415&quot;</span></span><span>
</span><span id="line-229"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RequestHeaders -&gt; Headers
</span><a href="Test.Integration.Framework.Request.html#Headers"><span class="hs-identifier hs-var">Headers</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><span class="hs-string">&quot;Content-Type&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;text/plain&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status415</span></a></span><span>
</span><span id="line-231"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg415"><span class="hs-identifier hs-var">errMsg415</span></a></span><span>
</span><span id="line-232"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span>                  </span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">[(String, Headers,
  [(Status, Either RequestException (ApiCoinSelection n))
   -&gt; ResourceT IO ()])]
-&gt; ((String, Headers,
     [(Status, Either RequestException (ApiCoinSelection n))
      -&gt; ResourceT IO ()])
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, Headers,
  [(Status, Either RequestException (ApiCoinSelection n))
   -&gt; ResourceT IO ()])]
</span><a href="#local-6989586621682944905"><span class="hs-identifier hs-var">matrix</span></a></span><span> </span><span class="annot"><span class="annottext">(((String, Headers,
   [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()])
  -&gt; SpecWith Context)
 -&gt; SpecWith Context)
-&gt; ((String, Headers,
     [(Status, Either RequestException (ApiCoinSelection n))
      -&gt; ResourceT IO ()])
    -&gt; SpecWith Context)
-&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621682944900"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682944900"><span class="hs-identifier hs-var">title</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682944899"><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621682944899"><span class="hs-identifier hs-var">headers</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682944898"><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiCoinSelection n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682944898"><span class="hs-identifier hs-var">expectations</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621682944900"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944897"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944897"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>            </span><span id="local-6989586621682944896"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944896"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944897"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621682944895"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944895"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944894"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944897"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944896"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-238"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944893"><span class="annot"><span class="annottext">amt :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944893"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (Context -&gt; Natural) -&gt; Context -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Natural) -&gt; (Context -&gt; ApiEra) -&gt; Context -&gt; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">(Context -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; Context -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944897"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944892"><span class="annot"><span class="annottext">payments :: NonEmpty (AddressAmount (ApiT Address, Proxy n))
</span><a href="#local-6989586621682944892"><span class="hs-identifier hs-var hs-var">payments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944895"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944893"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944891"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682944891"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json| { &quot;payments&quot;: #{payments} } |]</span></span><span>
</span><span id="line-241"></span><span>            </span><span id="local-6989586621682944890"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944890"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (Method, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiCoinSelection</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944897"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-242"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (Method, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (Method, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.selectCoins</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944896"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="#local-6989586621682944899"><span class="hs-identifier hs-var">headers</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682944891"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944890"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiCoinSelection n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682944898"><span class="hs-identifier hs-var">expectations</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_05a - can include metadata&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944888"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944888"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>        </span><span id="local-6989586621682944887"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944887"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944888"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span id="local-6989586621682944886"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944886"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944885"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944888"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944887"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944884"><span class="annot"><span class="annottext">amount :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944884"><span class="hs-identifier hs-var hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944888"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944883"><span class="annot"><span class="annottext">payment :: AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944883"><span class="hs-identifier hs-var hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944886"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944884"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944882"><span class="annot"><span class="annottext">transform :: Payload -&gt; Payload
</span><a href="#local-6989586621682944882"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Payload -&gt; Payload
forall a. ToJSON a =&gt; Text -&gt; a -&gt; Payload -&gt; Payload
</span><a href="Test.Integration.Framework.DSL.html#addField"><span class="hs-identifier hs-var">addField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;metadata&quot;</span></span><span>
</span><span id="line-252"></span><span>                </span><span class="annot"><span class="">[json|{ &quot;1&quot;: { &quot;string&quot;: &quot;hello&quot; } }|]</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoinsWith"><span class="hs-identifier hs-var">selectCoinsWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944888"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944887"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944883"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="#local-6989586621682944882"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-255"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-256"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) (Maybe ApiBase64)
</span><a href="#local-6989586621682944879"><span class="hs-var">#metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; (Maybe ApiBase64 -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_05b - choke on invalid metadata&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944878"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944878"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>        </span><span id="local-6989586621682944877"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944877"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944878"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span id="local-6989586621682944876"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944876"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944875"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944878"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944877"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944874"><span class="annot"><span class="annottext">amount :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944874"><span class="hs-identifier hs-var hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944878"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944873"><span class="annot"><span class="annottext">payment :: AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944873"><span class="hs-identifier hs-var hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944876"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944874"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944872"><span class="annot"><span class="annottext">transform :: Payload -&gt; Payload
</span><a href="#local-6989586621682944872"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Payload -&gt; Payload
forall a. ToJSON a =&gt; Text -&gt; a -&gt; Payload -&gt; Payload
</span><a href="Test.Integration.Framework.DSL.html#addField"><span class="hs-identifier hs-var">addField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;metadata&quot;</span></span><span>
</span><span id="line-266"></span><span>                </span><span class="annot"><span class="">[json|{ &quot;1&quot;: { &quot;string&quot;: #{T.replicate 65 &quot;a&quot;} } }|]</span></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoinsWith"><span class="hs-identifier hs-var">selectCoinsWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944878"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944877"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944873"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="#local-6989586621682944872"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-269"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status400</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg400TxMetadataStringTooLong"><span class="hs-identifier hs-var">errMsg400TxMetadataStringTooLong</span></a></span><span>
</span><span id="line-271"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_06a - can redeem rewards from self&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944869"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944869"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621682944868"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944868"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Mnemonic 24
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944869"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621682944867"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944867"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944866"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944869"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944868"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944865"><span class="annot"><span class="annottext">amount :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944865"><span class="hs-identifier hs-var hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944869"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944864"><span class="annot"><span class="annottext">payment :: AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944864"><span class="hs-identifier hs-var hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944867"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944865"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944863"><span class="annot"><span class="annottext">transform :: Payload -&gt; Payload
</span><a href="#local-6989586621682944863"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String -&gt; Payload -&gt; Payload
forall a. ToJSON a =&gt; Text -&gt; a -&gt; Payload -&gt; Payload
</span><a href="Test.Integration.Framework.DSL.html#addField"><span class="hs-identifier hs-var">addField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;withdrawal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;self&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoinsWith"><span class="hs-identifier hs-var">selectCoinsWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944869"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944868"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944864"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="#local-6989586621682944863"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-282"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-283"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
</span><a href="#local-6989586621682944862"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-284"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool)
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Int)
-&gt; [ApiCoinSelectionWithdrawal n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
</span><a href="#local-6989586621682944860"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-286"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelectionWithdrawal n -&gt; Bool)
-&gt; [ApiCoinSelectionWithdrawal n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span>
</span><span id="line-287"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; Bool
</span><a href="Test.Integration.Framework.DSL.html#isValidDerivationPath"><span class="hs-identifier hs-var">isValidDerivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">purposeCIP1852</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiT DerivationIndex) -&gt; Bool)
-&gt; (ApiCoinSelectionWithdrawal n
    -&gt; NonEmpty (ApiT DerivationIndex))
-&gt; ApiCoinSelectionWithdrawal n
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (ApiT DerivationIndex)
  -&gt; Const
       (NonEmpty (ApiT DerivationIndex))
       (NonEmpty (ApiT DerivationIndex)))
 -&gt; ApiCoinSelectionWithdrawal n
 -&gt; Const
      (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionWithdrawal n))
-&gt; ApiCoinSelectionWithdrawal n -&gt; NonEmpty (ApiT DerivationIndex)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;derivationPath&quot;
  ((NonEmpty (ApiT DerivationIndex)
    -&gt; Const
         (NonEmpty (ApiT DerivationIndex))
         (NonEmpty (ApiT DerivationIndex)))
   -&gt; ApiCoinSelectionWithdrawal n
   -&gt; Const
        (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionWithdrawal n))
(NonEmpty (ApiT DerivationIndex)
 -&gt; Const
      (NonEmpty (ApiT DerivationIndex))
      (NonEmpty (ApiT DerivationIndex)))
-&gt; ApiCoinSelectionWithdrawal n
-&gt; Const
     (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionWithdrawal n)
</span><a href="#local-6989586621682944859"><span class="hs-var">#derivationPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_06b - can redeem rewards from other&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682944858"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944858"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621682944857"><span class="annot"><span class="annottext">Mnemonic 24
</span><a href="#local-6989586621682944857"><span class="hs-identifier hs-var">mnemonic</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO (ApiWallet, Mnemonic 24)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m (ApiWallet, Mnemonic 24)
</span><a href="Test.Integration.Framework.DSL.html#rewardWallet"><span class="hs-identifier hs-var">rewardWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944858"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span id="local-6989586621682944856"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944856"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944858"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621682944855"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944855"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944854"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944858"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944856"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944853"><span class="annot"><span class="annottext">amount :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944853"><span class="hs-identifier hs-var hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944858"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944852"><span class="annot"><span class="annottext">payment :: AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944852"><span class="hs-identifier hs-var hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944855"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944853"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TokenMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-297"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944851"><span class="annot"><span class="annottext">transform :: Payload -&gt; Payload
</span><a href="#local-6989586621682944851"><span class="hs-identifier hs-var hs-var">transform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Payload -&gt; Payload
forall a. ToJSON a =&gt; Text -&gt; a -&gt; Payload -&gt; Payload
</span><a href="Test.Integration.Framework.DSL.html#addField"><span class="hs-identifier hs-var">addField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;withdrawal&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Mnemonic 24 -&gt; [Text]
forall (mw :: Nat). Mnemonic mw -&gt; [Text]
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mnemonicToText</span></a></span><span> </span><span class="annot"><span class="annottext">Mnemonic 24
</span><a href="#local-6989586621682944857"><span class="hs-identifier hs-var">mnemonic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; (Payload -&gt; Payload)
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoinsWith"><span class="hs-identifier hs-var">selectCoinsWith</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944858"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944856"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944852"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload -&gt; Payload
</span><a href="#local-6989586621682944851"><span class="hs-identifier hs-var">transform</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-300"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-301"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
</span><a href="#local-6989586621682944850"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-302"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool)
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Int)
-&gt; [ApiCoinSelectionWithdrawal n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiCoinSelectionWithdrawal n]
    -&gt; f [ApiCoinSelectionWithdrawal n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
Traversal' (ApiCoinSelection n) [ApiCoinSelectionWithdrawal n]
</span><a href="#local-6989586621682944849"><span class="hs-var">#withdrawals</span></a></span><span>
</span><span id="line-304"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionWithdrawal n]
-&gt; ([ApiCoinSelectionWithdrawal n] -&gt; Bool) -&gt; IO ()
forall a. (HasCallStack, Show a) =&gt; a -&gt; (a -&gt; Bool) -&gt; IO ()
</span><a href="../../../../hspec-expectations/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiCoinSelectionWithdrawal n -&gt; Bool)
-&gt; [ApiCoinSelectionWithdrawal n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span>
</span><span id="line-305"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
-&gt; NonEmpty (ApiT DerivationIndex) -&gt; Bool
</span><a href="Test.Integration.Framework.DSL.html#isValidDerivationPath"><span class="hs-identifier hs-var">isValidDerivationPath</span></a></span><span> </span><span class="annot"><span class="annottext">Index 'Hardened 'PurposeK
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">purposeBIP44</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (ApiT DerivationIndex) -&gt; Bool)
-&gt; (ApiCoinSelectionWithdrawal n
    -&gt; NonEmpty (ApiT DerivationIndex))
-&gt; ApiCoinSelectionWithdrawal n
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (ApiT DerivationIndex)
  -&gt; Const
       (NonEmpty (ApiT DerivationIndex))
       (NonEmpty (ApiT DerivationIndex)))
 -&gt; ApiCoinSelectionWithdrawal n
 -&gt; Const
      (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionWithdrawal n))
-&gt; ApiCoinSelectionWithdrawal n -&gt; NonEmpty (ApiT DerivationIndex)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;derivationPath&quot;
  ((NonEmpty (ApiT DerivationIndex)
    -&gt; Const
         (NonEmpty (ApiT DerivationIndex))
         (NonEmpty (ApiT DerivationIndex)))
   -&gt; ApiCoinSelectionWithdrawal n
   -&gt; Const
        (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionWithdrawal n))
(NonEmpty (ApiT DerivationIndex)
 -&gt; Const
      (NonEmpty (ApiT DerivationIndex))
      (NonEmpty (ApiT DerivationIndex)))
-&gt; ApiCoinSelectionWithdrawal n
-&gt; Const
     (NonEmpty (ApiT DerivationIndex)) (ApiCoinSelectionWithdrawal n)
</span><a href="#local-6989586621682944848"><span class="hs-var">#derivationPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-comment">-- Attempt to create a coin selection with an output that has an</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-comment">-- excessively high token quantity. (This should fail.)</span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_07 - \
        \Single output with excessively high token quantity.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682944847"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944847"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944846"><span class="annot"><span class="annottext">assetName :: TokenName
</span><a href="#local-6989586621682944846"><span class="hs-identifier hs-var hs-var">assetName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;1&quot;</span></span><span>
</span><span id="line-314"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944844"><span class="annot"><span class="annottext">policyId :: TokenPolicyId
</span><a href="#local-6989586621682944844"><span class="hs-identifier hs-var hs-var">policyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId)
-&gt; Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-315"></span><span>                    </span><span class="annot"><span class="annottext">Method -&gt; Hash &quot;TokenPolicy&quot;
forall (tag :: Symbol). Method -&gt; Hash tag
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Hash</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;1234567890123456789012345678&quot;</span></span><span>
</span><span id="line-316"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944841"><span class="annot"><span class="annottext">adaQuantity :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944841"><span class="hs-identifier hs-var hs-var">adaQuantity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944847"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944840"><span class="annot"><span class="annottext">assetId :: AssetId
</span><a href="#local-6989586621682944840"><span class="hs-identifier hs-var hs-var">assetId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; AssetId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AssetId</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682944844"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682944846"><span class="hs-identifier hs-var">assetName</span></a></span><span>
</span><span id="line-318"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944838"><span class="annot"><span class="annottext">excessiveQuantity :: TokenQuantity
</span><a href="#local-6989586621682944838"><span class="hs-identifier hs-var hs-var">excessiveQuantity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenQuantity -&gt; TokenQuantity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenQuantity.succ</span></a></span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">txOutMaxTokenQuantity</span></a></span><span>
</span><span id="line-319"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944836"><span class="annot"><span class="annottext">nonAdaQuantities :: TokenMap
</span><a href="#local-6989586621682944836"><span class="hs-identifier hs-var hs-var">nonAdaQuantities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssetId -&gt; TokenQuantity -&gt; TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">AssetId
</span><a href="#local-6989586621682944840"><span class="hs-identifier hs-var">assetId</span></a></span><span> </span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682944838"><span class="hs-identifier hs-var">excessiveQuantity</span></a></span><span>
</span><span id="line-320"></span><span>            </span><span id="local-6989586621682944834"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944834"><span class="hs-identifier hs-var">sourceWallet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944847"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-321"></span><span>            </span><span id="local-6989586621682944833"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944833"><span class="hs-identifier hs-var">targetWallet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944847"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-322"></span><span>            </span><span id="local-6989586621682944832"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944832"><span class="hs-identifier hs-var">targetAddress</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944831"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-323"></span><span>                </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944847"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944833"><span class="hs-identifier hs-var">targetWallet</span></a></span><span>
</span><span id="line-324"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944830"><span class="annot"><span class="annottext">payment :: AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944830"><span class="hs-identifier hs-var hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span>
</span><span id="line-325"></span><span>                    </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944832"><span class="hs-identifier hs-var">targetAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944841"><span class="hs-identifier hs-var">adaQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682944836"><span class="hs-identifier hs-var">nonAdaQuantities</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944828"><span class="annot"><span class="annottext">makeRequest :: ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944828"><span class="hs-identifier hs-var hs-var">makeRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier hs-var">selectCoins</span></a></span><span>
</span><span id="line-327"></span><span>                    </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944847"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944834"><span class="hs-identifier hs-var">sourceWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944830"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>            </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944828"><span class="hs-identifier hs-var">makeRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-329"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-330"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; (Status, Either RequestException (ApiCoinSelection n))
 -&gt; ResourceT IO ())
-&gt; String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address
-&gt; TokenPolicyId
-&gt; TokenName
-&gt; TokenQuantity
-&gt; TokenQuantity
-&gt; String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403OutputTokenQuantityExceedsLimit"><span class="hs-identifier hs-var">errMsg403OutputTokenQuantityExceedsLimit</span></a></span><span>
</span><span id="line-331"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT Address -&gt; Address
forall a. ApiT a -&gt; a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address -&gt; Address) -&gt; ApiT Address -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n) -&gt; ApiT Address
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944832"><span class="hs-identifier hs-var">targetAddress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682944844"><span class="hs-identifier hs-var">policyId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621682944846"><span class="hs-identifier hs-var">assetName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="#local-6989586621682944838"><span class="hs-identifier hs-var">excessiveQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenQuantity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">txOutMaxTokenQuantity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- Attempt to create a coin selection with an output that has an excessive</span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-comment">-- number of assets, such that the serialized representation of the output</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-comment">-- would exceed the limit required by the protocol. (This should fail.)</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WALLETS_COIN_SELECTION_08 - \
        \Single output with excessively high number of assets.&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682944826"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944826"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944825"><span class="annot"><span class="annottext">adaQuantity :: Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944825"><span class="hs-identifier hs-var hs-var">adaQuantity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; (ApiEra -&gt; Natural) -&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiEra -&gt; Quantity &quot;lovelace&quot; Natural)
-&gt; ApiEra -&gt; Quantity &quot;lovelace&quot; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944826"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-345"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944824"><span class="annot"><span class="annottext">assetCount :: Int
</span><a href="#local-6989586621682944824"><span class="hs-identifier hs-var hs-var">assetCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1280</span></span><span>
</span><span id="line-346"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944823"><span class="annot"><span class="annottext">policyId :: TokenPolicyId
</span><a href="#local-6989586621682944823"><span class="hs-identifier hs-var hs-var">policyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenPolicyId</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId)
-&gt; Hash &quot;TokenPolicy&quot; -&gt; TokenPolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-347"></span><span>                    </span><span class="annot"><span class="annottext">Method -&gt; Hash &quot;TokenPolicy&quot;
forall (tag :: Symbol). Method -&gt; Hash tag
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Hash</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-string">&quot;1234567890123456789012345678&quot;</span></span><span>
</span><span id="line-348"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944822"><span class="annot"><span class="annottext">tokenNames :: [TokenName]
</span><a href="#local-6989586621682944822"><span class="hs-identifier hs-var hs-var">tokenNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Method -&gt; TokenName
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">UnsafeTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">(Method -&gt; TokenName) -&gt; (Char -&gt; Method) -&gt; Char -&gt; TokenName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Method
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Method) -&gt; (Char -&gt; Text) -&gt; Char -&gt; Method
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; TokenName) -&gt; String -&gt; [TokenName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-349"></span><span>                    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'a'</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944819"><span class="annot"><span class="annottext">assetIds :: [AssetId]
</span><a href="#local-6989586621682944819"><span class="hs-identifier hs-var hs-var">assetIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenPolicyId -&gt; TokenName -&gt; AssetId
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AssetId</span></a></span><span> </span><span class="annot"><span class="annottext">TokenPolicyId
</span><a href="#local-6989586621682944823"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">(TokenName -&gt; AssetId) -&gt; [TokenName] -&gt; [AssetId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [TokenName] -&gt; [TokenName]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682944824"><span class="hs-identifier hs-var">assetCount</span></a></span><span> </span><span class="annot"><span class="annottext">[TokenName]
</span><a href="#local-6989586621682944822"><span class="hs-identifier hs-var">tokenNames</span></a></span><span>
</span><span id="line-351"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944818"><span class="annot"><span class="annottext">nonAdaQuantities :: TokenMap
</span><a href="#local-6989586621682944818"><span class="hs-identifier hs-var hs-var">nonAdaQuantities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(AssetId, TokenQuantity)] -&gt; TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.fromFlatList</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, TokenQuantity)] -&gt; TokenMap)
-&gt; [(AssetId, TokenQuantity)] -&gt; TokenMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-352"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; TokenQuantity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AssetId -&gt; (AssetId, TokenQuantity))
-&gt; [AssetId] -&gt; [(AssetId, TokenQuantity)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[AssetId]
</span><a href="#local-6989586621682944819"><span class="hs-identifier hs-var">assetIds</span></a></span><span>
</span><span id="line-353"></span><span>            </span><span id="local-6989586621682944815"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944815"><span class="hs-identifier hs-var">sourceWallet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944826"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-354"></span><span>            </span><span id="local-6989586621682944814"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944814"><span class="hs-identifier hs-var">targetWallet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944826"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-355"></span><span>            </span><span id="local-6989586621682944813"><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944813"><span class="hs-identifier hs-var">targetAddress</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[(ApiT Address, Proxy n)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApiAddress n -&gt; (ApiT Address, Proxy n))
-&gt; [ApiAddress n] -&gt; [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(((ApiT Address, Proxy n)
  -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
 -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; ApiAddress n -&gt; (ApiT Address, Proxy n)
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682944812"><span class="hs-var">#id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ApiAddress n] -&gt; [(ApiT Address, Proxy n)])
-&gt; ResourceT IO [ApiAddress n]
-&gt; ResourceT IO [(ApiT Address, Proxy n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-356"></span><span>                </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682944982"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944826"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944814"><span class="hs-identifier hs-var">targetWallet</span></a></span><span>
</span><span id="line-357"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944811"><span class="annot"><span class="annottext">payment :: AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944811"><span class="hs-identifier hs-var hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount (ApiT Address, Proxy n)
forall addr.
addr
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; AddressAmount addr
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">AddressAmount</span></a></span><span>
</span><span id="line-358"></span><span>                    </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944813"><span class="hs-identifier hs-var">targetAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><a href="#local-6989586621682944825"><span class="hs-identifier hs-var">adaQuantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="#local-6989586621682944818"><span class="hs-identifier hs-var">nonAdaQuantities</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682944810"><span class="annot"><span class="annottext">makeRequest :: ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944810"><span class="hs-identifier hs-var hs-var">makeRequest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiWallet
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; ResourceT
     IO (Status, Either RequestException (ApiCoinSelection n))
forall (n :: NetworkDiscriminant) (style :: WalletStyle) w
       (m :: * -&gt; *).
(HasType (ApiT WalletId) w, DecodeAddress n, DecodeStakeAddress n,
 EncodeAddress n, Discriminate style, MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; w
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
-&gt; m (Status, Either RequestException (ApiCoinSelection n))
</span><a href="Test.Integration.Framework.DSL.html#selectCoins"><span class="hs-identifier hs-var">selectCoins</span></a></span><span>
</span><span id="line-360"></span><span>                    </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682944826"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682944815"><span class="hs-identifier hs-var">sourceWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
</span><a href="#local-6989586621682944811"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">AddressAmount (ApiT Address, Proxy n)
-&gt; [AddressAmount (ApiT Address, Proxy n)]
-&gt; NonEmpty (AddressAmount (ApiT Address, Proxy n))
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>            </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
</span><a href="#local-6989586621682944810"><span class="hs-identifier hs-var">makeRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (Status, Either RequestException (ApiCoinSelection n))
-&gt; ((Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ())
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((Status, Either RequestException (ApiCoinSelection n))
 -&gt; [(Status, Either RequestException (ApiCoinSelection n))
     -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiCoinSelection n))
-&gt; [(Status, Either RequestException (ApiCoinSelection n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span>
</span><span id="line-362"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-363"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; (Status, Either RequestException (ApiCoinSelection n))
 -&gt; ResourceT IO ())
-&gt; String
-&gt; (Status, Either RequestException (ApiCoinSelection n))
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address -&gt; Int -&gt; String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403OutputTokenBundleSizeExceedsLimit"><span class="hs-identifier hs-var">errMsg403OutputTokenBundleSizeExceedsLimit</span></a></span><span>
</span><span id="line-364"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT Address -&gt; Address
forall a. ApiT a -&gt; a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var hs-var">getApiT</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address -&gt; Address) -&gt; ApiT Address -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n) -&gt; ApiT Address
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682944813"><span class="hs-identifier hs-var">targetAddress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682944824"><span class="hs-identifier hs-var">assetCount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-367"></span></pre></body></html>