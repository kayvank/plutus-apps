<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Integration.Scenario.API.Shared.Transactions</span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Scenario.API.Shared.Transactions.html#spec"><span class="hs-identifier">spec</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">Cardano.Mnemonic</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier">MkSomeMnemonic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Api.Types</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiAddress</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiConstructTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiDecodedTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiFee</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiSerialisedTransaction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTransaction</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxInputGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiTxOutputGeneral</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiWallet</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">ApiWalletOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DecodeAddress</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DecodeStakeAddress</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">EncodeAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">WalletStyle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.AddressDerivation</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">DerivationIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Passphrase</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Passphrase</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.Tx</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">TxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">TxMetadataValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">TxScriptValidity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier">Control.Monad.IO.Unlift</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier">MonadUnliftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">Control.Monad.Trans.Resource</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">runResourceT</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">toJSON</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../either/html/src"><span class="hs-identifier">Data.Either.Combinators</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../either/html/src"><span class="hs-identifier">swapEither</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">Data.Generics.Internal.VL.Lens</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../generic-lens/html/src"><span class="hs-operator">(^.)</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">isJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Data.Quantity</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Numeric.Natural</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Natural</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../hspec/html/src"><span class="hs-identifier">Test.Hspec</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier">SpecWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier">describe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">Test.Hspec.Expectations.Lifted</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">shouldBe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">shouldNotContain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-identifier">shouldSatisfy</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier">Test.Hspec.Extra</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier">it</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html"><span class="hs-identifier">Test.Integration.Framework.DSL</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier">Context</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Headers"><span class="hs-identifier">Headers</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#MnemonicLength"><span class="hs-identifier">MnemonicLength</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier">Payload</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#accPubKeyFromMnemonics"><span class="hs-identifier">accPubKeyFromMnemonics</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier">emptyWallet</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier">eventually</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier">expectErrorMessage</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier">expectField</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier">expectResponseCode</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier">expectSuccess</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#faucetAmt"><span class="hs-identifier">faucetAmt</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#faucetUtxoAmt"><span class="hs-identifier">faucetUtxoAmt</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixturePassphrase"><span class="hs-identifier">fixturePassphrase</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier">fixtureWallet</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#genMnemonics"><span class="hs-identifier">genMnemonics</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier">getFromResponse</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#getSharedWallet"><span class="hs-identifier">getSharedWallet</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#json"><span class="hs-identifier">json</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier">listAddresses</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier">minUTxOValue</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#postSharedWallet"><span class="hs-identifier">postSharedWallet</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier">request</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier">unsafeRequest</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier">verify</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html"><span class="hs-identifier">Test.Integration.Framework.TestData</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403EmptyUTxO"><span class="hs-identifier">errMsg403EmptyUTxO</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403Fee"><span class="hs-identifier">errMsg403Fee</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidConstructTx"><span class="hs-identifier">errMsg403InvalidConstructTx</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403MinUTxOValue"><span class="hs-identifier">errMsg403MinUTxOValue</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Integration.Framework.TestData.html#errMsg403SharedWalletPending"><span class="hs-identifier">errMsg403SharedWalletPending</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Api.Link</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Link</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier">Cardano.Wallet.Primitive.Types.TokenMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TokenMap</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../memory/html/src"><span class="hs-identifier">Data.ByteArray</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../http-types/html/src"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><a href="Test.Integration.Scenario.API.Shared.Transactions.html#spec"><span class="hs-identifier hs-type">spec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621682943178"><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">DecodeStakeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">EncodeAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-120"></span><span id="spec"><span class="annot"><span class="annottext">spec :: SpecWith Context
</span><a href="Test.Integration.Scenario.API.Shared.Transactions.html#spec"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SpecWith Context -&gt; SpecWith Context
forall a. HasCallStack =&gt; String -&gt; SpecWith a -&gt; SpecWith a
</span><a href="../../../../hspec-core/html/src"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SpecWith Context -&gt; SpecWith Context)
-&gt; SpecWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_01 - Cannot create tx for a pending shared wallet&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682943177"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943177"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>        </span><span id="local-6989586621682943176"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943176"><span class="hs-identifier hs-var">m15txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Text] -&gt; ResourceT IO [Text]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Text] -&gt; ResourceT IO [Text])
-&gt; IO [Text] -&gt; ResourceT IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength -&gt; IO [Text]
</span><a href="Test.Integration.Framework.DSL.html#genMnemonics"><span class="hs-identifier hs-var">genMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength
</span><a href="Test.Integration.Framework.DSL.html#M15"><span class="hs-identifier hs-var">M15</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span id="local-6989586621682943174"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943174"><span class="hs-identifier hs-var">m12txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Text] -&gt; ResourceT IO [Text]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Text] -&gt; ResourceT IO [Text])
-&gt; IO [Text] -&gt; ResourceT IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength -&gt; IO [Text]
</span><a href="Test.Integration.Framework.DSL.html#genMnemonics"><span class="hs-identifier hs-var">genMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength
</span><a href="Test.Integration.Framework.DSL.html#M12"><span class="hs-identifier hs-var">M12</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682943172"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943172"><span class="hs-identifier hs-var">m15</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Either (MkSomeMnemonicError '[15]) SomeMnemonic
forall (sz :: [Nat]).
MkSomeMnemonic sz =&gt;
[Text] -&gt; Either (MkSomeMnemonicError sz) SomeMnemonic
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mkSomeMnemonic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943176"><span class="hs-identifier hs-var">m15txt</span></a></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682943170"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943170"><span class="hs-identifier hs-var">m12</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Either (MkSomeMnemonicError '[12]) SomeMnemonic
forall (sz :: [Nat]).
MkSomeMnemonic sz =&gt;
[Text] -&gt; Either (MkSomeMnemonicError sz) SomeMnemonic
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mkSomeMnemonic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-number">12</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943174"><span class="hs-identifier hs-var">m12txt</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943169"><span class="annot"><span class="annottext">passphrase :: Passphrase purpose
</span><a href="#local-6989586621682943169"><span class="hs-identifier hs-var hs-var">passphrase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Passphrase purpose
forall (purpose :: Symbol). ScrubbedBytes -&gt; Passphrase purpose
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; Passphrase purpose)
-&gt; ScrubbedBytes -&gt; Passphrase purpose
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ScrubbedBytes
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ScrubbedBytes) -&gt; ByteString -&gt; ScrubbedBytes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Test.Integration.Framework.DSL.html#fixturePassphrase"><span class="hs-identifier hs-var">fixturePassphrase</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943165"><span class="annot"><span class="annottext">index :: Word32
</span><a href="#local-6989586621682943165"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">30</span></span><span>
</span><span id="line-129"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943164"><span class="annot"><span class="annottext">accXPubDerived :: Text
</span><a href="#local-6989586621682943164"><span class="hs-identifier hs-var hs-var">accXPubDerived</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
-&gt; Maybe SomeMnemonic -&gt; Word32 -&gt; Passphrase &quot;encryption&quot; -&gt; Text
</span><a href="Test.Integration.Framework.DSL.html#accPubKeyFromMnemonics"><span class="hs-identifier hs-var">accPubKeyFromMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943172"><span class="hs-identifier hs-var">m15</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Maybe SomeMnemonic
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943170"><span class="hs-identifier hs-var">m12</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682943165"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
forall (purpose :: Symbol). Passphrase purpose
</span><a href="#local-6989586621682943169"><span class="hs-identifier hs-var">passphrase</span></a></span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943163"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682943163"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json| {
                &quot;name&quot;: &quot;Shared Wallet&quot;,
                &quot;mnemonic_sentence&quot;: #{m15txt},
                &quot;mnemonic_second_factor&quot;: #{m12txt},
                &quot;passphrase&quot;: #{fixturePassphrase},
                &quot;account_index&quot;: &quot;30H&quot;,
                &quot;payment_script_template&quot;:
                    { &quot;cosigners&quot;:
                        { &quot;cosigner#0&quot;: #{accXPubDerived} },
                      &quot;template&quot;:
                          { &quot;all&quot;:
                             [ &quot;cosigner#0&quot;,
                               &quot;cosigner#1&quot;,
                               { &quot;active_from&quot;: 120 }
                             ]
                          }
                    }
                } |]</span></span><span>
</span><span id="line-148"></span><span>        </span><span id="local-6989586621682943155"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682943155"><span class="hs-identifier hs-var">rPost</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiSharedWallet)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; Headers
-&gt; Payload
-&gt; ResourceT m (Status, Either RequestException ApiSharedWallet)
</span><a href="Test.Integration.Framework.DSL.html#postSharedWallet"><span class="hs-identifier hs-var">postSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943177"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943163"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><span class="annottext">(Status,
 Either
   RequestException
   (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; [(Status,
     Either
       RequestException
       (Either ApiActiveSharedWallet ApiPendingSharedWallet))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiSharedWallet
 -&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet)
-&gt; Either RequestException ApiSharedWallet
-&gt; Either
     RequestException
     (Either ApiActiveSharedWallet ApiPendingSharedWallet)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet
forall e a. Either e a -&gt; Either a e
</span><a href="../../../../either/html/src"><span class="hs-identifier hs-var">swapEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet)
-&gt; (ApiSharedWallet
    -&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet)
-&gt; ApiSharedWallet
-&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Either ApiPendingSharedWallet ApiActiveSharedWallet
  -&gt; Const
       (Either ApiPendingSharedWallet ApiActiveSharedWallet)
       (Either ApiPendingSharedWallet ApiActiveSharedWallet))
 -&gt; ApiSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      ApiSharedWallet)
-&gt; ApiSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;wallet&quot;
  ((Either ApiPendingSharedWallet ApiActiveSharedWallet
    -&gt; Const
         (Either ApiPendingSharedWallet ApiActiveSharedWallet)
         (Either ApiPendingSharedWallet ApiActiveSharedWallet))
   -&gt; ApiSharedWallet
   -&gt; Const
        (Either ApiPendingSharedWallet ApiActiveSharedWallet)
        ApiSharedWallet)
(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; ApiSharedWallet
-&gt; Const
     (Either ApiPendingSharedWallet ApiActiveSharedWallet)
     ApiSharedWallet
</span><a href="#local-6989586621682943152"><span class="hs-var">#wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either RequestException ApiSharedWallet
 -&gt; Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; (Status, Either RequestException ApiSharedWallet)
-&gt; (Status,
    Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682943155"><span class="hs-identifier hs-var">rPost</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status,
    Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status201</span></a></span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621682943148"><span class="annot"><span class="annottext">ApiPendingSharedWallet
</span><a href="#local-6989586621682943148"><span class="hs-identifier hs-var">wal</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSharedWallet ApiSharedWallet
-&gt; (Status, Either RequestException ApiSharedWallet)
-&gt; ApiSharedWallet
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSharedWallet ApiSharedWallet
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682943155"><span class="hs-identifier hs-var">rPost</span></a></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943146"><span class="annot"><span class="annottext">metadata :: Payload
</span><a href="#local-6989586621682943146"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{ &quot;metadata&quot;: { &quot;1&quot;: { &quot;string&quot;: &quot;hello&quot; } } }|]</span></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>        </span><span id="local-6989586621682943145"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943145"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943177"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-159"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiPendingSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiPendingSharedWallet
</span><a href="#local-6989586621682943148"><span class="hs-identifier hs-var">wal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943146"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943145"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-162"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403SharedWalletPending"><span class="hs-identifier hs-var">errMsg403SharedWalletPending</span></a></span><span>
</span><span id="line-163"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_01 - Can create tx for an active shared wallet&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682943141"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943141"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>        </span><span id="local-6989586621682943140"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943140"><span class="hs-identifier hs-var">m15txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Text] -&gt; ResourceT IO [Text]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Text] -&gt; ResourceT IO [Text])
-&gt; IO [Text] -&gt; ResourceT IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength -&gt; IO [Text]
</span><a href="Test.Integration.Framework.DSL.html#genMnemonics"><span class="hs-identifier hs-var">genMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength
</span><a href="Test.Integration.Framework.DSL.html#M15"><span class="hs-identifier hs-var">M15</span></a></span><span>
</span><span id="line-167"></span><span>        </span><span id="local-6989586621682943139"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943139"><span class="hs-identifier hs-var">m12txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Text] -&gt; ResourceT IO [Text]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Text] -&gt; ResourceT IO [Text])
-&gt; IO [Text] -&gt; ResourceT IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength -&gt; IO [Text]
</span><a href="Test.Integration.Framework.DSL.html#genMnemonics"><span class="hs-identifier hs-var">genMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength
</span><a href="Test.Integration.Framework.DSL.html#M12"><span class="hs-identifier hs-var">M12</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682943138"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943138"><span class="hs-identifier hs-var">m15</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Either (MkSomeMnemonicError '[15]) SomeMnemonic
forall (sz :: [Nat]).
MkSomeMnemonic sz =&gt;
[Text] -&gt; Either (MkSomeMnemonicError sz) SomeMnemonic
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mkSomeMnemonic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943140"><span class="hs-identifier hs-var">m15txt</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682943137"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943137"><span class="hs-identifier hs-var">m12</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Either (MkSomeMnemonicError '[12]) SomeMnemonic
forall (sz :: [Nat]).
MkSomeMnemonic sz =&gt;
[Text] -&gt; Either (MkSomeMnemonicError sz) SomeMnemonic
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mkSomeMnemonic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-number">12</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682943139"><span class="hs-identifier hs-var">m12txt</span></a></span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943136"><span class="annot"><span class="annottext">passphrase :: Passphrase purpose
</span><a href="#local-6989586621682943136"><span class="hs-identifier hs-var hs-var">passphrase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Passphrase purpose
forall (purpose :: Symbol). ScrubbedBytes -&gt; Passphrase purpose
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; Passphrase purpose)
-&gt; ScrubbedBytes -&gt; Passphrase purpose
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ScrubbedBytes
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ScrubbedBytes) -&gt; ByteString -&gt; ScrubbedBytes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Test.Integration.Framework.DSL.html#fixturePassphrase"><span class="hs-identifier hs-var">fixturePassphrase</span></a></span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943135"><span class="annot"><span class="annottext">index :: Word32
</span><a href="#local-6989586621682943135"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">30</span></span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943134"><span class="annot"><span class="annottext">accXPubDerived :: Text
</span><a href="#local-6989586621682943134"><span class="hs-identifier hs-var hs-var">accXPubDerived</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
-&gt; Maybe SomeMnemonic -&gt; Word32 -&gt; Passphrase &quot;encryption&quot; -&gt; Text
</span><a href="Test.Integration.Framework.DSL.html#accPubKeyFromMnemonics"><span class="hs-identifier hs-var">accPubKeyFromMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943138"><span class="hs-identifier hs-var">m15</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Maybe SomeMnemonic
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682943137"><span class="hs-identifier hs-var">m12</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682943135"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
forall (purpose :: Symbol). Passphrase purpose
</span><a href="#local-6989586621682943136"><span class="hs-identifier hs-var">passphrase</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943133"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682943133"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json| {
                &quot;name&quot;: &quot;Shared Wallet&quot;,
                &quot;mnemonic_sentence&quot;: #{m15txt},
                &quot;mnemonic_second_factor&quot;: #{m12txt},
                &quot;passphrase&quot;: #{fixturePassphrase},
                &quot;account_index&quot;: &quot;30H&quot;,
                &quot;payment_script_template&quot;:
                    { &quot;cosigners&quot;:
                        { &quot;cosigner#0&quot;: #{accXPubDerived} },
                      &quot;template&quot;:
                          { &quot;all&quot;:
                             [ &quot;cosigner#0&quot; ]
                          }
                    }
                } |]</span></span><span>
</span><span id="line-188"></span><span>        </span><span id="local-6989586621682943132"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682943132"><span class="hs-identifier hs-var">rPost</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiSharedWallet)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; Headers
-&gt; Payload
-&gt; ResourceT m (Status, Either RequestException ApiSharedWallet)
</span><a href="Test.Integration.Framework.DSL.html#postSharedWallet"><span class="hs-identifier hs-var">postSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943141"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943133"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><span class="annottext">(Status,
 Either
   RequestException
   (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; [(Status,
     Either
       RequestException
       (Either ApiActiveSharedWallet ApiPendingSharedWallet))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiSharedWallet
 -&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet)
-&gt; Either RequestException ApiSharedWallet
-&gt; Either
     RequestException
     (Either ApiActiveSharedWallet ApiPendingSharedWallet)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet
forall e a. Either e a -&gt; Either a e
</span><a href="../../../../either/html/src"><span class="hs-identifier hs-var">swapEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet)
-&gt; (ApiSharedWallet
    -&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet)
-&gt; ApiSharedWallet
-&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Either ApiPendingSharedWallet ApiActiveSharedWallet
  -&gt; Const
       (Either ApiPendingSharedWallet ApiActiveSharedWallet)
       (Either ApiPendingSharedWallet ApiActiveSharedWallet))
 -&gt; ApiSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      ApiSharedWallet)
-&gt; ApiSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;wallet&quot;
  ((Either ApiPendingSharedWallet ApiActiveSharedWallet
    -&gt; Const
         (Either ApiPendingSharedWallet ApiActiveSharedWallet)
         (Either ApiPendingSharedWallet ApiActiveSharedWallet))
   -&gt; ApiSharedWallet
   -&gt; Const
        (Either ApiPendingSharedWallet ApiActiveSharedWallet)
        ApiSharedWallet)
(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; ApiSharedWallet
-&gt; Const
     (Either ApiPendingSharedWallet ApiActiveSharedWallet)
     ApiSharedWallet
</span><a href="#local-6989586621682943131"><span class="hs-var">#wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either RequestException ApiSharedWallet
 -&gt; Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; (Status, Either RequestException ApiSharedWallet)
-&gt; (Status,
    Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682943132"><span class="hs-identifier hs-var">rPost</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status,
    Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status201</span></a></span><span>
</span><span id="line-191"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943130"><span class="annot"><span class="annottext">walShared :: ApiSharedWallet
</span><a href="#local-6989586621682943130"><span class="hs-identifier hs-var">walShared</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682943129"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943129"><span class="hs-identifier hs-var">wal</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSharedWallet ApiSharedWallet
-&gt; (Status, Either RequestException ApiSharedWallet)
-&gt; ApiSharedWallet
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSharedWallet ApiSharedWallet
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682943132"><span class="hs-identifier hs-var">rPost</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943128"><span class="annot"><span class="annottext">metadata :: Payload
</span><a href="#local-6989586621682943128"><span class="hs-identifier hs-var hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{ &quot;metadata&quot;: { &quot;1&quot;: { &quot;string&quot;: &quot;hello&quot; } } }|]</span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>        </span><span id="local-6989586621682943127"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943127"><span class="hs-identifier hs-var">rTx1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943141"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943129"><span class="hs-identifier hs-var">wal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943128"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943127"><span class="hs-identifier hs-var">rTx1</span></a></span><span>
</span><span id="line-201"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-202"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403EmptyUTxO"><span class="hs-identifier hs-var">errMsg403EmptyUTxO</span></a></span><span>
</span><span id="line-203"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943126"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682943126"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943141"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; Natural -&gt; ApiSharedWallet -&gt; ResourceT IO ()
</span><a href="#local-6989586621682943123"><span class="hs-identifier hs-var">fundSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943141"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682943126"><span class="hs-identifier hs-var">amt</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWallet
</span><a href="#local-6989586621682943130"><span class="hs-identifier hs-var">walShared</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>        </span><span id="local-6989586621682943122"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943122"><span class="hs-identifier hs-var">rTx2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943141"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-209"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943129"><span class="hs-identifier hs-var">wal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943128"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943122"><span class="hs-identifier hs-var">rTx2</span></a></span><span>
</span><span id="line-211"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-212"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) (Maybe ApiBase64)
-&gt; (Maybe ApiBase64 -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943120"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; (Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
(Maybe ApiBase64 -&gt; f (Maybe ApiBase64))
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682943119"><span class="hs-var">#metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; (Maybe ApiBase64 -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ApiBase64 -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">isJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943118"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682943117"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943115"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682943115"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682943114"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943122"><span class="hs-identifier hs-var">rTx2</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943113"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682943113"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682943115"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>        </span><span id="local-6989586621682943111"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682943111"><span class="hs-identifier hs-var">rDecodedTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943141"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943129"><span class="hs-identifier hs-var">wal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943113"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943109"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682943109"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943108"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682943107"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943122"><span class="hs-identifier hs-var">rTx2</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943106"><span class="annot"><span class="annottext">metadata' :: ApiT TxMetadata
</span><a href="#local-6989586621682943106"><span class="hs-identifier hs-var hs-var">metadata'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadata -&gt; ApiT TxMetadata
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Word64 TxMetadataValue -&gt; TxMetadata
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">TxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Word64, TxMetadataValue)] -&gt; Map Word64 TxMetadataValue
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Text -&gt; TxMetadataValue
</span><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-var">TxMetaText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;hello&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682943111"><span class="hs-identifier hs-var">rDecodedTx</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682943101"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiDecodedTransaction n
-&gt; f (ApiDecodedTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682943100"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682943109"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n] -&gt; f [ApiWithdrawalGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682943099"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n] -&gt; [ApiWithdrawalGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateral&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682943098"><span class="hs-var">#collateral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiTxMetadata
-&gt; (ApiTxMetadata -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((ApiTxMetadata -&gt; f ApiTxMetadata)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiTxMetadata
</span><a href="#local-6989586621682943097"><span class="hs-var">#metadata</span></a></span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiTxMetadata -&gt; ApiTxMetadata -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT TxMetadata -&gt; Maybe (ApiT TxMetadata)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TxMetadata
</span><a href="#local-6989586621682943106"><span class="hs-identifier hs-var">metadata'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiDecodedTransaction n) (Maybe (ApiT TxScriptValidity))
-&gt; (Maybe (ApiT TxScriptValidity) -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidity&quot;
  ((Maybe (ApiT TxScriptValidity)
    -&gt; f (Maybe (ApiT TxScriptValidity)))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal'
  (ApiDecodedTransaction n) (Maybe (ApiT TxScriptValidity))
</span><a href="#local-6989586621682943095"><span class="hs-var">#scriptValidity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxScriptValidity)
-&gt; Maybe (ApiT TxScriptValidity) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity))
-&gt; ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity -&gt; ApiT TxScriptValidity
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TxScriptValid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_01a - Empty payload is not allowed&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682943093"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943093"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>        </span><span id="local-6989586621682943092"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943092"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiActiveSharedWallet
</span><a href="#local-6989586621682943091"><span class="hs-identifier hs-var">fixtureSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943093"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943090"><span class="annot"><span class="annottext">emptyPayload :: Payload
</span><a href="#local-6989586621682943090"><span class="hs-identifier hs-var hs-var">emptyPayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{}|]</span></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621682943089"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943089"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943093"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943092"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943090"><span class="hs-identifier hs-var">emptyPayload</span></a></span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943089"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidConstructTx"><span class="hs-identifier hs-var">errMsg403InvalidConstructTx</span></a></span><span>
</span><span id="line-241"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_01b - \
        \Validity interval only is not allowed&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-glyph">\</span><span id="local-6989586621682943088"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943088"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>        </span><span id="local-6989586621682943087"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943087"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiActiveSharedWallet
</span><a href="#local-6989586621682943091"><span class="hs-identifier hs-var">fixtureSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943088"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943086"><span class="annot"><span class="annottext">validityInterval :: Payload
</span><a href="#local-6989586621682943086"><span class="hs-identifier hs-var hs-var">validityInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|
                { &quot;validity_interval&quot;:
                    { &quot;invalid_before&quot;:
                        { &quot;quantity&quot;: 10
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                    , &quot;invalid_hereafter&quot;:
                        { &quot;quantity&quot;: 50
                        , &quot;unit&quot;: &quot;second&quot;
                        }
                    }
                }|]</span></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>        </span><span id="local-6989586621682943085"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943085"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943088"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943087"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943086"><span class="hs-identifier hs-var">validityInterval</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943085"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-264"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-265"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403InvalidConstructTx"><span class="hs-identifier hs-var">errMsg403InvalidConstructTx</span></a></span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_04a - Single Output Transaction with decode transaction&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682943084"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>        </span><span id="local-6989586621682943083"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943083"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiActiveSharedWallet
</span><a href="#local-6989586621682943091"><span class="hs-identifier hs-var">fixtureSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span id="local-6989586621682943082"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943082"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943081"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682943081"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>        </span><span id="local-6989586621682943080"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943080"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682943079"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943082"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682943081"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>        </span><span id="local-6989586621682943078"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943078"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-277"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943083"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943080"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943078"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-280"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-281"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943077"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682943076"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943073"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682943072"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943071"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682943070"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943069"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682943068"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943067"><span class="annot"><span class="annottext">txCbor :: ApiT SealedTx
</span><a href="#local-6989586621682943067"><span class="hs-identifier hs-var hs-var">txCbor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) (ApiT SealedTx)
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ApiT SealedTx
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;transaction&quot;
  ((ApiT SealedTx -&gt; f (ApiT SealedTx))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
Lens' (ApiConstructTransaction n) (ApiT SealedTx)
</span><a href="#local-6989586621682943066"><span class="hs-var">#transaction</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943078"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943065"><span class="annot"><span class="annottext">decodePayload :: Payload
</span><a href="#local-6989586621682943065"><span class="hs-identifier hs-var hs-var">decodePayload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiSerialisedTransaction -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiSerialisedTransaction -&gt; Value)
-&gt; ApiSerialisedTransaction -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx -&gt; ApiSerialisedTransaction
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiSerialisedTransaction</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT SealedTx
</span><a href="#local-6989586621682943067"><span class="hs-identifier hs-var">txCbor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621682943064"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682943064"><span class="hs-identifier hs-var">rDecodedTxSource</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-289"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943083"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943065"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span id="local-6989586621682943063"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682943063"><span class="hs-identifier hs-var">rDecodedTxTarget</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiDecodedTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiDecodedTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-291"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.decodeTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943082"><span class="hs-identifier hs-var">wb</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943065"><span class="hs-identifier hs-var">decodePayload</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943062"><span class="annot"><span class="annottext">expectedFee :: Natural
</span><a href="#local-6989586621682943062"><span class="hs-identifier hs-var hs-var">expectedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' (ApiConstructTransaction n) Natural
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; Natural
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943061"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682943060"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943078"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943059"><span class="annot"><span class="annottext">sharedExpectationsBetweenWallets :: [(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682943059"><span class="hs-identifier hs-var hs-var">sharedExpectationsBetweenWallets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-296"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682943058"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiDecodedTransaction n
-&gt; f (ApiDecodedTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682943057"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682943062"><span class="hs-identifier hs-var">expectedFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
-&gt; ([ApiWithdrawalGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;withdrawals&quot;
  (([ApiWithdrawalGeneral n] -&gt; f [ApiWithdrawalGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiWithdrawalGeneral n]
</span><a href="#local-6989586621682943056"><span class="hs-var">#withdrawals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWithdrawalGeneral n] -&gt; [ApiWithdrawalGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;collateral&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682943055"><span class="hs-var">#collateral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; [ApiTxInputGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) ApiTxMetadata
-&gt; (ApiTxMetadata -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;metadata&quot;
  ((ApiTxMetadata -&gt; f ApiTxMetadata)
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) ApiTxMetadata
</span><a href="#local-6989586621682943054"><span class="hs-var">#metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiTxMetadata -&gt; ApiTxMetadata -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata) -&gt; ApiTxMetadata
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiTxMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ApiT TxMetadata)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (ApiDecodedTransaction n) (Maybe (ApiT TxScriptValidity))
-&gt; (Maybe (ApiT TxScriptValidity) -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;scriptValidity&quot;
  ((Maybe (ApiT TxScriptValidity)
    -&gt; f (Maybe (ApiT TxScriptValidity)))
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal'
  (ApiDecodedTransaction n) (Maybe (ApiT TxScriptValidity))
</span><a href="#local-6989586621682943053"><span class="hs-var">#scriptValidity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (ApiT TxScriptValidity)
-&gt; Maybe (ApiT TxScriptValidity) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity))
-&gt; ApiT TxScriptValidity -&gt; Maybe (ApiT TxScriptValidity)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity -&gt; ApiT TxScriptValidity
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TxScriptValid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682943063"><span class="hs-identifier hs-var">rDecodedTxTarget</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682943059"><span class="hs-identifier hs-var">sharedExpectationsBetweenWallets</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943052"><span class="annot"><span class="annottext">isInpOurs :: ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682943052"><span class="hs-identifier hs-var hs-var">isInpOurs</span></a></span></span><span> </span><span id="local-6989586621682943051"><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682943051"><span class="hs-identifier hs-var">inp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n
</span><a href="#local-6989586621682943051"><span class="hs-identifier hs-var">inp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ExternalInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiT TxIn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">WalletInput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletInput n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943048"><span class="annot"><span class="annottext">areOurs :: [ApiTxInputGeneral n] -&gt; Bool
</span><a href="#local-6989586621682943048"><span class="hs-identifier hs-var hs-var">areOurs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiTxInputGeneral n -&gt; Bool) -&gt; [ApiTxInputGeneral n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxInputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxInputGeneral n -&gt; Bool
</span><a href="#local-6989586621682943052"><span class="hs-identifier hs-var">isInpOurs</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621682943046"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682943046"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943084"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943082"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943045"><span class="annot"><span class="annottext">addrIx :: Int
</span><a href="#local-6989586621682943045"><span class="hs-identifier hs-var hs-var">addrIx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943044"><span class="annot"><span class="annottext">addrDest :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682943044"><span class="hs-identifier hs-var hs-var">addrDest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682943046"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682943045"><span class="hs-identifier hs-var">addrIx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682943042"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943041"><span class="annot"><span class="annottext">expectedTxOutTarget :: ApiTxOutputGeneral n
</span><a href="#local-6989586621682943041"><span class="hs-identifier hs-var hs-var">expectedTxOutTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall (n :: NetworkDiscriminant).
ApiWalletOutput n -&gt; ApiTxOutputGeneral n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiWalletOutput n -&gt; ApiTxOutputGeneral n)
-&gt; ApiWalletOutput n -&gt; ApiTxOutputGeneral n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput :: forall (n :: NetworkDiscriminant).
(ApiT Address, Proxy n)
-&gt; Quantity &quot;lovelace&quot; Natural
-&gt; ApiT TokenMap
-&gt; NonEmpty (ApiT DerivationIndex)
-&gt; ApiWalletOutput n
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWalletOutput</span></a></span><span>
</span><span id="line-313"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:address:ApiWalletOutput :: (ApiT Address, Proxy n)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">address</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ApiT Address, Proxy n)
</span><a href="#local-6989586621682943044"><span class="hs-identifier hs-var">addrDest</span></a></span><span>
</span><span id="line-314"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:amount:ApiWalletOutput :: Quantity &quot;lovelace&quot; Natural
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682943081"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-315"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:assets:ApiWalletOutput :: ApiT TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">assets</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TokenMap -&gt; ApiT TokenMap
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="annot"><span class="annottext">TokenMap
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">TokenMap.empty</span></a></span><span>
</span><span id="line-316"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:derivationPath:ApiWalletOutput :: NonEmpty (ApiT DerivationIndex)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">derivationPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ApiT DerivationIndex] -&gt; NonEmpty (ApiT DerivationIndex)
forall a. [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">NE.fromList</span></a></span><span>
</span><span id="line-317"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485500</span></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147485463</span></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2147483648</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivationIndex -&gt; ApiT DerivationIndex
forall a. a -&gt; ApiT a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">ApiT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; DerivationIndex
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">DerivationIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; DerivationIndex) -&gt; Word32 -&gt; DerivationIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621682943045"><span class="hs-identifier hs-var">addrIx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-323"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943030"><span class="annot"><span class="annottext">isOutOurs :: ApiTxOutputGeneral n -&gt; Bool
</span><a href="#local-6989586621682943030"><span class="hs-identifier hs-var hs-var">isOutOurs</span></a></span></span><span> </span><span id="local-6989586621682943029"><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682943029"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682943029"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">WalletOutput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWalletOutput n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-326"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ExternalOutput</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutput n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiDecodedTransaction n))
</span><a href="#local-6989586621682943064"><span class="hs-identifier hs-var">rDecodedTxSource</span></a></span><span> </span><span class="annot"><span class="annottext">([(Status, Either RequestException (ApiDecodedTransaction n))
  -&gt; ResourceT IO ()]
 -&gt; ResourceT IO ())
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-329"></span><span>            </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
</span><a href="#local-6989586621682943059"><span class="hs-identifier hs-var">sharedExpectationsBetweenWallets</span></a></span><span> </span><span class="annot"><span class="annottext">[(Status, Either RequestException (ApiDecodedTransaction n))
 -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
-&gt; [(Status, Either RequestException (ApiDecodedTransaction n))
    -&gt; ResourceT IO ()]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
-&gt; ([ApiTxInputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiTxInputGeneral n] -&gt; f [ApiTxInputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxInputGeneral n]
</span><a href="#local-6989586621682943027"><span class="hs-var">#inputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; ([ApiTxInputGeneral n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxInputGeneral n] -&gt; Bool
forall (n :: NetworkDiscriminant). [ApiTxInputGeneral n] -&gt; Bool
</span><a href="#local-6989586621682943048"><span class="hs-identifier hs-var">areOurs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
</span><a href="#local-6989586621682943026"><span class="hs-var">#outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n] -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
[a] -&gt; [a] -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldNotContain`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ApiTxOutputGeneral n
</span><a href="#local-6989586621682943041"><span class="hs-identifier hs-var">expectedTxOutTarget</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>            </span><span class="hs-comment">-- Check that the change output is there:</span><span>
</span><span id="line-333"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiDecodedTransaction n) [ApiTxOutputGeneral n]
-&gt; ([ApiTxOutputGeneral n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiDecodedTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
   -&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n))
([ApiTxOutputGeneral n] -&gt; f [ApiTxOutputGeneral n])
-&gt; ApiDecodedTransaction n -&gt; f (ApiDecodedTransaction n)
</span><a href="#local-6989586621682943025"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ())
-&gt; ([ApiTxOutputGeneral n] -&gt; Int)
-&gt; [ApiTxOutputGeneral n]
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiTxOutputGeneral n] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">([ApiTxOutputGeneral n] -&gt; Int)
-&gt; ([ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n])
-&gt; [ApiTxOutputGeneral n]
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ApiTxOutputGeneral n -&gt; Bool)
-&gt; [ApiTxOutputGeneral n] -&gt; [ApiTxOutputGeneral n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ApiTxOutputGeneral n -&gt; Bool
forall (n :: NetworkDiscriminant). ApiTxOutputGeneral n -&gt; Bool
</span><a href="#local-6989586621682943030"><span class="hs-identifier hs-var">isOutOurs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_04b - Cannot spend less than minUTxOValue&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682943023"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943023"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>        </span><span id="local-6989586621682943022"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943022"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiActiveSharedWallet
</span><a href="#local-6989586621682943091"><span class="hs-identifier hs-var">fixtureSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943023"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span id="local-6989586621682943021"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943021"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943023"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943020"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682943020"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943023"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621682943019"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943019"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682943079"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943023"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943021"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682943020"><span class="hs-identifier hs-var">amt</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>        </span><span id="local-6989586621682943018"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943018"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943023"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943022"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943019"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943018"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-346"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-347"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403MinUTxOValue"><span class="hs-identifier hs-var">errMsg403MinUTxOValue</span></a></span><span>
</span><span id="line-348"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_04c - Can't cover fee&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682943017"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943017"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-351"></span><span>        </span><span id="local-6989586621682943016"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943016"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiActiveSharedWallet
</span><a href="#local-6989586621682943091"><span class="hs-identifier hs-var">fixtureSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943017"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621682943015"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943015"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943017"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>        </span><span id="local-6989586621682943014"><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943014"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Payload -&gt; ResourceT IO Payload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Payload -&gt; ResourceT IO Payload)
-&gt; IO Payload -&gt; ResourceT IO Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; Natural -&gt; IO Payload
forall (m :: * -&gt; *).
MonadUnliftIO m =&gt;
Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682943079"><span class="hs-identifier hs-var">mkTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943017"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943015"><span class="hs-identifier hs-var">wb</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="Test.Integration.Framework.DSL.html#faucetUtxoAmt"><span class="hs-identifier hs-var">faucetUtxoAmt</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>        </span><span id="local-6989586621682943013"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943013"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943017"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-357"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943016"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943014"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943013"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-359"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status403</span></a></span><span>
</span><span id="line-360"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
String -&gt; (s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectErrorMessage"><span class="hs-identifier hs-var">expectErrorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Test.Integration.Framework.TestData.html#errMsg403Fee"><span class="hs-identifier hs-var">errMsg403Fee</span></a></span><span>
</span><span id="line-361"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ActionWith Context -&gt; SpecWith Context
forall ctx.
HasCallStack =&gt;
String -&gt; ActionWith ctx -&gt; SpecWith ctx
</span><a href="../../../../cardano-wallet-test-utils/html/src"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SHARED_TRANSACTIONS_CREATE_04e- Multiple Output Tx to single wallet&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ActionWith Context -&gt; SpecWith Context)
-&gt; ActionWith Context -&gt; SpecWith Context
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621682943012"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943012"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ()) -&gt; ResourceT IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>        </span><span id="local-6989586621682943011"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943011"><span class="hs-identifier hs-var">wa</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiActiveSharedWallet
</span><a href="#local-6989586621682943091"><span class="hs-identifier hs-var">fixtureSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943012"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span id="local-6989586621682943010"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943010"><span class="hs-identifier hs-var">wb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#emptyWallet"><span class="hs-identifier hs-var">emptyWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943012"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span id="local-6989586621682943009"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682943009"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; ResourceT IO [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943012"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682943010"><span class="hs-identifier hs-var">wb</span></a></span><span>
</span><span id="line-367"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943008"><span class="annot"><span class="annottext">amt :: Natural
</span><a href="#local-6989586621682943008"><span class="hs-identifier hs-var hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiEra -&gt; Natural
</span><a href="Test.Integration.Framework.DSL.html#minUTxOValue"><span class="hs-identifier hs-var">minUTxOValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Context -&gt; ApiEra
</span><a href="Test.Integration.Framework.Context.html#_mainEra"><span class="hs-identifier hs-var hs-var">_mainEra</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943012"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943007"><span class="annot"><span class="annottext">destination1 :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682943007"><span class="hs-identifier hs-var hs-var">destination1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682943009"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682943006"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943005"><span class="annot"><span class="annottext">destination2 :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682943005"><span class="hs-identifier hs-var hs-var">destination2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682943009"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682943004"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682943003"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682943003"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination1},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                },
                {
                    &quot;address&quot;: #{destination2},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                }]
            }|]</span></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span>        </span><span id="local-6989586621682943002"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943002"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiConstructTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiConstructTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682943012"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-388"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createUnsignedTransaction</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682943011"><span class="hs-identifier hs-var">wa</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682943003"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; [(Status, Either RequestException (ApiConstructTransaction n))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
</span><a href="#local-6989586621682943002"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-390"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) s a.
(HasCallStack, MonadIO m) =&gt;
(s, Either RequestException a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectSuccess"><span class="hs-identifier hs-var">expectSuccess</span></a></span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiWalletInput n]
-&gt; ([ApiWalletInput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682943001"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;inputs&quot;
  (([ApiWalletInput n] -&gt; f [ApiWalletInput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiWalletInput n] -&gt; f [ApiWalletInput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682943000"><span class="hs-var">#inputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiWalletInput n] -&gt; Bool) -&gt; [ApiWalletInput n] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiWalletInput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682942999"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;outputs&quot;
  (([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionOutput n] -&gt; f [ApiCoinSelectionOutput n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682942998"><span class="hs-var">#outputs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n]
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionOutput n] -&gt; Bool)
-&gt; [ApiCoinSelectionOutput n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionOutput n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) [ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;coinSelection&quot;
  ((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682942997"><span class="hs-var">#coinSelection</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiCoinSelection n -&gt; f (ApiCoinSelection n))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
    -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
-&gt; ([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;change&quot;
  (([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
   -&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n))
([ApiCoinSelectionChange n] -&gt; f [ApiCoinSelectionChange n])
-&gt; ApiCoinSelection n -&gt; f (ApiCoinSelection n)
</span><a href="#local-6989586621682942996"><span class="hs-var">#change</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n]
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([ApiCoinSelectionChange n] -&gt; Bool)
-&gt; [ApiCoinSelectionChange n]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiCoinSelectionChange n] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal' (ApiConstructTransaction n) Natural
-&gt; (Natural -&gt; IO ())
-&gt; (Status, Either RequestException (ApiConstructTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;fee&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n)
</span><a href="#local-6989586621682942995"><span class="hs-var">#fee</span></a></span><span> </span><span class="annot"><span class="annottext">((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
 -&gt; ApiConstructTransaction n -&gt; f (ApiConstructTransaction n))
-&gt; ((Natural -&gt; f Natural)
    -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; (Natural -&gt; f Natural)
-&gt; ApiConstructTransaction n
-&gt; f (ApiConstructTransaction n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;getQuantity&quot;
  ((Natural -&gt; f Natural)
   -&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
(Natural -&gt; f Natural)
-&gt; Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural)
</span><a href="#local-6989586621682942994"><span class="hs-var">#getQuantity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; (Natural -&gt; Bool) -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a) =&gt;
a -&gt; (a -&gt; Bool) -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldSatisfy`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>     </span><span id="local-6989586621682943123"><span class="annot"><span class="annottext">fundSharedWallet :: Context -&gt; Natural -&gt; ApiSharedWallet -&gt; ResourceT IO ()
</span><a href="#local-6989586621682943123"><span class="hs-identifier hs-var hs-var">fundSharedWallet</span></a></span></span><span> </span><span id="local-6989586621682942993"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942993"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682942992"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682942992"><span class="hs-identifier hs-var">amt</span></a></span></span><span> </span><span id="local-6989586621682942991"><span class="annot"><span class="annottext">ApiSharedWallet
</span><a href="#local-6989586621682942991"><span class="hs-identifier hs-var">walShared</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942990"><span class="annot"><span class="annottext">wal :: ApiActiveSharedWallet
</span><a href="#local-6989586621682942990"><span class="hs-identifier hs-var hs-var">wal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiSharedWallet
</span><a href="#local-6989586621682942991"><span class="hs-identifier hs-var">walShared</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-400"></span><span>                </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682942989"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682942989"><span class="hs-identifier hs-var">wal'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682942989"><span class="hs-identifier hs-var">wal'</span></a></span><span>
</span><span id="line-401"></span><span>                </span><span class="annot"><span class="annottext">ApiSharedWallet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; ApiActiveSharedWallet
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;funding of shared wallet make sense only for active one&quot;</span></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>        </span><span id="local-6989586621682942987"><span class="annot"><span class="annottext">(Status, Either RequestException [ApiAddress n])
</span><a href="#local-6989586621682942987"><span class="hs-identifier hs-var">rAddr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException [ApiAddress n])
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiAddress</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942993"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-404"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shared</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682942990"><span class="hs-identifier hs-var">wal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException [ApiAddress n])
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException [ApiAddress n])
</span><a href="#local-6989586621682942987"><span class="hs-identifier hs-var">rAddr</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942983"><span class="annot"><span class="annottext">sharedAddrs :: [ApiAddress n]
</span><a href="#local-6989586621682942983"><span class="hs-identifier hs-var hs-var">sharedAddrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Lens' [ApiAddress n] [ApiAddress n]
-&gt; (Status, Either RequestException [ApiAddress n])
-&gt; [ApiAddress n]
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' [ApiAddress n] [ApiAddress n]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException [ApiAddress n])
</span><a href="#local-6989586621682942987"><span class="hs-identifier hs-var">rAddr</span></a></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942982"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682942982"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682942983"><span class="hs-identifier hs-var">sharedAddrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682942981"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span>        </span><span id="local-6989586621682942980"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682942980"><span class="hs-identifier hs-var">wShelley</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ResourceT IO ApiWallet
forall (m :: * -&gt; *). MonadIO m =&gt; Context -&gt; ResourceT m ApiWallet
</span><a href="Test.Integration.Framework.DSL.html#fixtureWallet"><span class="hs-identifier hs-var">fixtureWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942993"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-410"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942979"><span class="annot"><span class="annottext">payloadTx :: Payload
</span><a href="#local-6989586621682942979"><span class="hs-identifier hs-var hs-var">payloadTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                &quot;payments&quot;: [{
                    &quot;address&quot;: #{destination},
                    &quot;amount&quot;: {
                        &quot;quantity&quot;: #{amt},
                        &quot;unit&quot;: &quot;lovelace&quot;
                    }
                }],
                &quot;passphrase&quot;: #{fixturePassphrase}
            }|]</span></span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Status
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiFee</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Quantity</span></a></span><span> </span><span id="local-6989586621682942977"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682942977"><span class="hs-identifier hs-var">feeMax</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Quantity &quot;lovelace&quot; Natural]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text) -&gt; Payload -&gt; ResourceT IO (Status, ApiFee)
forall a (m :: * -&gt; *).
(FromJSON a, MonadIO m, MonadUnliftIO m) =&gt;
Context -&gt; (ByteString, Text) -&gt; Payload -&gt; m (Status, a)
</span><a href="Test.Integration.Framework.Request.html#unsafeRequest"><span class="hs-identifier hs-var">unsafeRequest</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942993"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-421"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getTransactionFeeOld</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682942980"><span class="hs-identifier hs-var">wShelley</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682942979"><span class="hs-identifier hs-var">payloadTx</span></a></span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942975"><span class="annot"><span class="annottext">ep :: ApiWallet -&gt; (ByteString, Text)
</span><a href="#local-6989586621682942975"><span class="hs-identifier hs-var hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate 'Shelley) =&gt;
w -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(HasCallStack, HasType (ApiT WalletId) w, Discriminate style) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.createTransactionOld</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span>
</span><span id="line-423"></span><span>        </span><span id="local-6989586621682942973"><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682942973"><span class="hs-identifier hs-var">rTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; ResourceT
     IO (Status, Either RequestException (ApiTransaction n))
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiTransaction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942993"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (ByteString, Text)
</span><a href="#local-6989586621682942975"><span class="hs-identifier hs-var">ep</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682942980"><span class="hs-identifier hs-var">wShelley</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682942979"><span class="hs-identifier hs-var">payloadTx</span></a></span><span>
</span><span id="line-424"></span><span>        </span><span class="annot"><span class="annottext">Status
-&gt; (Status, Either RequestException (ApiTransaction n))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status202</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException (ApiTransaction n))
</span><a href="#local-6989586621682942973"><span class="hs-identifier hs-var">rTx</span></a></span><span>
</span><span id="line-425"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; String -&gt; IO a -&gt; m a
</span><a href="Test.Integration.Framework.DSL.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;wShelley balance is decreased&quot;</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; IO () -&gt; ResourceT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>            </span><span id="local-6989586621682942972"><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682942972"><span class="hs-identifier hs-var">ra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; IO (Status, Either RequestException ApiWallet)
forall a (m :: * -&gt; *) s.
(FromJSON a, MonadIO m, MonadUnliftIO m,
 HasType (URI, Manager) s) =&gt;
s
-&gt; (ByteString, Text)
-&gt; Headers
-&gt; Payload
-&gt; m (Status, Either RequestException a)
</span><a href="Test.Integration.Framework.Request.html#request"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942993"><span class="hs-identifier hs-var">ctx</span></a></span><span>
</span><span id="line-427"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiWallet -&gt; (ByteString, Text)
forall (style :: WalletStyle) w.
(Discriminate style, HasType (ApiT WalletId) w) =&gt;
w -&gt; (ByteString, Text)
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Link.getWallet</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">Shelley</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682942980"><span class="hs-identifier hs-var">wShelley</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="Test.Integration.Framework.Request.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-428"></span><span>            </span><span class="annot"><span class="annottext">Traversal' ApiWallet (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status, Either RequestException ApiWallet)
-&gt; IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span>
</span><span id="line-429"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiWallet -&gt; f ApiWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiWallet -&gt; f ApiWallet
</span><a href="#local-6989586621682942970"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiWallet -&gt; f ApiWallet)
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWallet
-&gt; f ApiWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682942969"><span class="hs-var">#available</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="Test.Integration.Framework.DSL.html#faucetAmt"><span class="hs-identifier hs-var">faucetAmt</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682942977"><span class="hs-identifier hs-var">feeMax</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682942992"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiWallet)
</span><a href="#local-6989586621682942972"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>        </span><span id="local-6989586621682942968"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682942968"><span class="hs-identifier hs-var">rWal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; ApiSharedWallet
-&gt; ResourceT IO (Status, Either RequestException ApiSharedWallet)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; ApiSharedWallet
-&gt; m (Status, Either RequestException ApiSharedWallet)
</span><a href="Test.Integration.Framework.DSL.html#getSharedWallet"><span class="hs-identifier hs-var">getSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942993"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWallet
</span><a href="#local-6989586621682942991"><span class="hs-identifier hs-var">walShared</span></a></span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><span class="annottext">(Status,
 Either
   RequestException
   (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; [(Status,
     Either
       RequestException
       (Either ApiPendingSharedWallet ApiActiveSharedWallet))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiSharedWallet
 -&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet)
-&gt; Either RequestException ApiSharedWallet
-&gt; Either
     RequestException
     (Either ApiPendingSharedWallet ApiActiveSharedWallet)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Either ApiPendingSharedWallet ApiActiveSharedWallet
  -&gt; Const
       (Either ApiPendingSharedWallet ApiActiveSharedWallet)
       (Either ApiPendingSharedWallet ApiActiveSharedWallet))
 -&gt; ApiSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      ApiSharedWallet)
-&gt; ApiSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;wallet&quot;
  ((Either ApiPendingSharedWallet ApiActiveSharedWallet
    -&gt; Const
         (Either ApiPendingSharedWallet ApiActiveSharedWallet)
         (Either ApiPendingSharedWallet ApiActiveSharedWallet))
   -&gt; ApiSharedWallet
   -&gt; Const
        (Either ApiPendingSharedWallet ApiActiveSharedWallet)
        ApiSharedWallet)
(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; ApiSharedWallet
-&gt; Const
     (Either ApiPendingSharedWallet ApiActiveSharedWallet)
     ApiSharedWallet
</span><a href="#local-6989586621682942967"><span class="hs-var">#wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either RequestException ApiSharedWallet
 -&gt; Either
      RequestException
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; (Status, Either RequestException ApiSharedWallet)
-&gt; (Status,
    Either
      RequestException
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682942968"><span class="hs-identifier hs-var">rWal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status,
    Either
      RequestException
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status200</span></a></span><span>
</span><span id="line-435"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Traversal'
  (Either ApiPendingSharedWallet ApiActiveSharedWallet)
  (Quantity &quot;lovelace&quot; Natural)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; IO ())
-&gt; (Status,
    Either
      RequestException
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a s.
(HasCallStack, MonadIO m, Show a) =&gt;
Traversal' s a
-&gt; (a -&gt; IO ()) -&gt; (Status, Either RequestException s) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectField"><span class="hs-identifier hs-var">expectField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiActiveSharedWallet -&gt; f ApiActiveSharedWallet)
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; f (Either ApiPendingSharedWallet ApiActiveSharedWallet)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiActiveSharedWallet -&gt; f ApiActiveSharedWallet)
 -&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; f (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiActiveSharedWallet -&gt; f ApiActiveSharedWallet)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; f (Either ApiPendingSharedWallet ApiActiveSharedWallet)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;balance&quot;
  ((ApiWalletBalance -&gt; f ApiWalletBalance)
   -&gt; ApiActiveSharedWallet -&gt; f ApiActiveSharedWallet)
(ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; ApiActiveSharedWallet -&gt; f ApiActiveSharedWallet
</span><a href="#local-6989586621682942965"><span class="hs-var">#balance</span></a></span><span> </span><span class="annot"><span class="annottext">((ApiWalletBalance -&gt; f ApiWalletBalance)
 -&gt; ApiActiveSharedWallet -&gt; f ApiActiveSharedWallet)
-&gt; ((Quantity &quot;lovelace&quot; Natural
     -&gt; f (Quantity &quot;lovelace&quot; Natural))
    -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
-&gt; (Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiActiveSharedWallet
-&gt; f ApiActiveSharedWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;available&quot;
  ((Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
   -&gt; ApiWalletBalance -&gt; f ApiWalletBalance)
(Quantity &quot;lovelace&quot; Natural -&gt; f (Quantity &quot;lovelace&quot; Natural))
-&gt; ApiWalletBalance -&gt; f ApiWalletBalance
</span><a href="#local-6989586621682942964"><span class="hs-var">#available</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity &quot;lovelace&quot; Natural -&gt; Quantity &quot;lovelace&quot; Natural -&gt; IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="../../../../hspec-expectations-lifted/html/src"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Quantity &quot;lovelace&quot; Natural
forall (unit :: Symbol) a. a -&gt; Quantity unit a
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Quantity</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682942992"><span class="hs-identifier hs-var">amt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span>     </span><span id="local-6989586621682943091"><span class="annot"><span class="annottext">fixtureSharedWallet :: Context -&gt; ResourceT IO ApiActiveSharedWallet
</span><a href="#local-6989586621682943091"><span class="hs-identifier hs-var hs-var">fixtureSharedWallet</span></a></span></span><span> </span><span id="local-6989586621682942963"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942963"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span>        </span><span id="local-6989586621682942962"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682942962"><span class="hs-identifier hs-var">m15txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Text] -&gt; ResourceT IO [Text]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Text] -&gt; ResourceT IO [Text])
-&gt; IO [Text] -&gt; ResourceT IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength -&gt; IO [Text]
</span><a href="Test.Integration.Framework.DSL.html#genMnemonics"><span class="hs-identifier hs-var">genMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength
</span><a href="Test.Integration.Framework.DSL.html#M15"><span class="hs-identifier hs-var">M15</span></a></span><span>
</span><span id="line-440"></span><span>        </span><span id="local-6989586621682942961"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682942961"><span class="hs-identifier hs-var">m12txt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Text] -&gt; ResourceT IO [Text]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Text] -&gt; ResourceT IO [Text])
-&gt; IO [Text] -&gt; ResourceT IO [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength -&gt; IO [Text]
</span><a href="Test.Integration.Framework.DSL.html#genMnemonics"><span class="hs-identifier hs-var">genMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">MnemonicLength
</span><a href="Test.Integration.Framework.DSL.html#M12"><span class="hs-identifier hs-var">M12</span></a></span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682942960"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682942960"><span class="hs-identifier hs-var">m15</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Either (MkSomeMnemonicError '[15]) SomeMnemonic
forall (sz :: [Nat]).
MkSomeMnemonic sz =&gt;
[Text] -&gt; Either (MkSomeMnemonicError sz) SomeMnemonic
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mkSomeMnemonic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-number">15</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682942962"><span class="hs-identifier hs-var">m15txt</span></a></span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682942959"><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682942959"><span class="hs-identifier hs-var">m12</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Either (MkSomeMnemonicError '[12]) SomeMnemonic
forall (sz :: [Nat]).
MkSomeMnemonic sz =&gt;
[Text] -&gt; Either (MkSomeMnemonicError sz) SomeMnemonic
</span><a href="../../../../cardano-addresses/html/src"><span class="hs-identifier hs-var">mkSomeMnemonic</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-number">12</span></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621682942961"><span class="hs-identifier hs-var">m12txt</span></a></span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942958"><span class="annot"><span class="annottext">passphrase :: Passphrase purpose
</span><a href="#local-6989586621682942958"><span class="hs-identifier hs-var hs-var">passphrase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScrubbedBytes -&gt; Passphrase purpose
forall (purpose :: Symbol). ScrubbedBytes -&gt; Passphrase purpose
</span><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-var">Passphrase</span></a></span><span> </span><span class="annot"><span class="annottext">(ScrubbedBytes -&gt; Passphrase purpose)
-&gt; ScrubbedBytes -&gt; Passphrase purpose
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ScrubbedBytes
forall bin bout.
(ByteArrayAccess bin, ByteArray bout) =&gt;
bin -&gt; bout
</span><a href="../../../../memory/html/src"><span class="hs-identifier hs-var">BA.convert</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ScrubbedBytes) -&gt; ByteString -&gt; ScrubbedBytes
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="Test.Integration.Framework.DSL.html#fixturePassphrase"><span class="hs-identifier hs-var">fixturePassphrase</span></a></span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942957"><span class="annot"><span class="annottext">index :: Word32
</span><a href="#local-6989586621682942957"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">30</span></span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942956"><span class="annot"><span class="annottext">accXPubDerived :: Text
</span><a href="#local-6989586621682942956"><span class="hs-identifier hs-var hs-var">accXPubDerived</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
-&gt; Maybe SomeMnemonic -&gt; Word32 -&gt; Passphrase &quot;encryption&quot; -&gt; Text
</span><a href="Test.Integration.Framework.DSL.html#accPubKeyFromMnemonics"><span class="hs-identifier hs-var">accPubKeyFromMnemonics</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682942960"><span class="hs-identifier hs-var">m15</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeMnemonic -&gt; Maybe SomeMnemonic
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SomeMnemonic
</span><a href="#local-6989586621682942959"><span class="hs-identifier hs-var">m12</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621682942957"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Passphrase &quot;encryption&quot;
forall (purpose :: Symbol). Passphrase purpose
</span><a href="#local-6989586621682942958"><span class="hs-identifier hs-var">passphrase</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942955"><span class="annot"><span class="annottext">payload :: Payload
</span><a href="#local-6989586621682942955"><span class="hs-identifier hs-var hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json| {
                &quot;name&quot;: &quot;Shared Wallet&quot;,
                &quot;mnemonic_sentence&quot;: #{m15txt},
                &quot;mnemonic_second_factor&quot;: #{m12txt},
                &quot;passphrase&quot;: #{fixturePassphrase},
                &quot;account_index&quot;: &quot;30H&quot;,
                &quot;payment_script_template&quot;:
                    { &quot;cosigners&quot;:
                        { &quot;cosigner#0&quot;: #{accXPubDerived} },
                      &quot;template&quot;:
                          { &quot;all&quot;:
                             [ &quot;cosigner#0&quot; ]
                          }
                    }
                } |]</span></span><span>
</span><span id="line-461"></span><span>        </span><span id="local-6989586621682942954"><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682942954"><span class="hs-identifier hs-var">rPost</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context
-&gt; Headers
-&gt; Payload
-&gt; ResourceT IO (Status, Either RequestException ApiSharedWallet)
forall (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m) =&gt;
Context
-&gt; Headers
-&gt; Payload
-&gt; ResourceT m (Status, Either RequestException ApiSharedWallet)
</span><a href="Test.Integration.Framework.DSL.html#postSharedWallet"><span class="hs-identifier hs-var">postSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942963"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Headers
</span><a href="Test.Integration.Framework.Request.html#Default"><span class="hs-identifier hs-var">Default</span></a></span><span> </span><span class="annot"><span class="annottext">Payload
</span><a href="#local-6989586621682942955"><span class="hs-identifier hs-var">payload</span></a></span><span>
</span><span id="line-462"></span><span>        </span><span class="annot"><span class="annottext">(Status,
 Either
   RequestException
   (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; [(Status,
     Either
       RequestException
       (Either ApiActiveSharedWallet ApiPendingSharedWallet))
    -&gt; ResourceT IO ()]
-&gt; ResourceT IO ()
forall a (m :: * -&gt; *).
(Show a, MonadUnliftIO m) =&gt;
a -&gt; [a -&gt; m ()] -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#verify"><span class="hs-identifier hs-var">verify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ApiSharedWallet
 -&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet)
-&gt; Either RequestException ApiSharedWallet
-&gt; Either
     RequestException
     (Either ApiActiveSharedWallet ApiPendingSharedWallet)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either ApiPendingSharedWallet ApiActiveSharedWallet
-&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet
forall e a. Either e a -&gt; Either a e
</span><a href="../../../../either/html/src"><span class="hs-identifier hs-var">swapEither</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet)
-&gt; (ApiSharedWallet
    -&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet)
-&gt; ApiSharedWallet
-&gt; Either ApiActiveSharedWallet ApiPendingSharedWallet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Either ApiPendingSharedWallet ApiActiveSharedWallet
  -&gt; Const
       (Either ApiPendingSharedWallet ApiActiveSharedWallet)
       (Either ApiPendingSharedWallet ApiActiveSharedWallet))
 -&gt; ApiSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      ApiSharedWallet)
-&gt; ApiSharedWallet
-&gt; Either ApiPendingSharedWallet ApiActiveSharedWallet
forall a s. ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; s -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;wallet&quot;
  ((Either ApiPendingSharedWallet ApiActiveSharedWallet
    -&gt; Const
         (Either ApiPendingSharedWallet ApiActiveSharedWallet)
         (Either ApiPendingSharedWallet ApiActiveSharedWallet))
   -&gt; ApiSharedWallet
   -&gt; Const
        (Either ApiPendingSharedWallet ApiActiveSharedWallet)
        ApiSharedWallet)
(Either ApiPendingSharedWallet ApiActiveSharedWallet
 -&gt; Const
      (Either ApiPendingSharedWallet ApiActiveSharedWallet)
      (Either ApiPendingSharedWallet ApiActiveSharedWallet))
-&gt; ApiSharedWallet
-&gt; Const
     (Either ApiPendingSharedWallet ApiActiveSharedWallet)
     ApiSharedWallet
</span><a href="#local-6989586621682942953"><span class="hs-var">#wallet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either RequestException ApiSharedWallet
 -&gt; Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; (Status, Either RequestException ApiSharedWallet)
-&gt; (Status,
    Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682942954"><span class="hs-identifier hs-var">rPost</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Status
-&gt; (Status,
    Either
      RequestException
      (Either ApiActiveSharedWallet ApiPendingSharedWallet))
-&gt; ResourceT IO ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadUnliftIO m, Show a) =&gt;
Status -&gt; (Status, a) -&gt; m ()
</span><a href="Test.Integration.Framework.DSL.html#expectResponseCode"><span class="hs-identifier hs-var">expectResponseCode</span></a></span><span> </span><span class="annot"><span class="annottext">Status
</span><a href="../../../../http-types/html/src"><span class="hs-identifier hs-var">HTTP.status201</span></a></span><span>
</span><span id="line-464"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-465"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942952"><span class="annot"><span class="annottext">walShared :: ApiSharedWallet
</span><a href="#local-6989586621682942952"><span class="hs-identifier hs-var">walShared</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiSharedWallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621682942951"><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682942951"><span class="hs-identifier hs-var">wal</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>                </span><span class="annot"><span class="annottext">Lens' ApiSharedWallet ApiSharedWallet
-&gt; (Status, Either RequestException ApiSharedWallet)
-&gt; ApiSharedWallet
forall s a.
HasCallStack =&gt;
Lens' s a -&gt; (Status, Either RequestException s) -&gt; a
</span><a href="Test.Integration.Framework.DSL.html#getFromResponse"><span class="hs-identifier hs-var">getFromResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
Lens' ApiSharedWallet ApiSharedWallet
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Prelude.id</span></a></span><span> </span><span class="annot"><span class="annottext">(Status, Either RequestException ApiSharedWallet)
</span><a href="#local-6989586621682942954"><span class="hs-identifier hs-var">rPost</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; Natural -&gt; ApiSharedWallet -&gt; ResourceT IO ()
</span><a href="#local-6989586621682943123"><span class="hs-identifier hs-var">fundSharedWallet</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942963"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="Test.Integration.Framework.DSL.html#faucetUtxoAmt"><span class="hs-identifier hs-var">faucetUtxoAmt</span></a></span><span> </span><span class="annot"><span class="annottext">ApiSharedWallet
</span><a href="#local-6989586621682942952"><span class="hs-identifier hs-var">walShared</span></a></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">ApiActiveSharedWallet -&gt; ResourceT IO ApiActiveSharedWallet
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ApiActiveSharedWallet
</span><a href="#local-6989586621682942951"><span class="hs-identifier hs-var">wal</span></a></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span>     </span><span id="local-6989586621682943305"><span class="annot"><a href="#local-6989586621682943079"><span class="hs-identifier hs-type">mkTxPayload</span></a></span><span>
</span><span id="line-473"></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621682943305"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-474"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Integration.Framework.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-475"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-wallet-core/html/src"><span class="hs-identifier hs-type">ApiWallet</span></a></span><span>
</span><span id="line-476"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Natural</span></a></span><span>
</span><span id="line-477"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621682943305"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Test.Integration.Framework.Request.html#Payload"><span class="hs-identifier hs-type">Payload</span></a></span></span><span>
</span><span id="line-478"></span><span>     </span><span id="local-6989586621682943079"><span class="annot"><span class="annottext">mkTxPayload :: Context -&gt; ApiWallet -&gt; Natural -&gt; m Payload
</span><a href="#local-6989586621682943079"><span class="hs-identifier hs-var hs-var">mkTxPayload</span></a></span></span><span> </span><span id="local-6989586621682942950"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942950"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621682942949"><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682942949"><span class="hs-identifier hs-var">wDest</span></a></span></span><span> </span><span id="local-6989586621682942948"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621682942948"><span class="hs-identifier hs-var">amt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>         </span><span id="local-6989586621682942947"><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682942947"><span class="hs-identifier hs-var">addrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Context -&gt; ApiWallet -&gt; m [ApiAddress n]
forall (n :: NetworkDiscriminant) (m :: * -&gt; *).
(MonadIO m, MonadUnliftIO m, DecodeAddress n) =&gt;
Context -&gt; ApiWallet -&gt; m [ApiAddress n]
</span><a href="Test.Integration.Framework.DSL.html#listAddresses"><span class="hs-identifier hs-var">listAddresses</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621682943178"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621682942950"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">ApiWallet
</span><a href="#local-6989586621682942949"><span class="hs-identifier hs-var">wDest</span></a></span><span>
</span><span id="line-480"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621682942946"><span class="annot"><span class="annottext">destination :: (ApiT Address, Proxy n)
</span><a href="#local-6989586621682942946"><span class="hs-identifier hs-var hs-var">destination</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ApiAddress n]
</span><a href="#local-6989586621682942947"><span class="hs-identifier hs-var">addrs</span></a></span><span> </span><span class="annot"><span class="annottext">[ApiAddress n] -&gt; Int -&gt; ApiAddress n
forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApiAddress n
-&gt; (((ApiT Address, Proxy n)
     -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
    -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
-&gt; (ApiT Address, Proxy n)
forall s a. s -&gt; ((a -&gt; Const a a) -&gt; s -&gt; Const a s) -&gt; a
</span><a href="../../../../generic-lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;id&quot;
  (((ApiT Address, Proxy n)
    -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
   -&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n))
((ApiT Address, Proxy n)
 -&gt; Const (ApiT Address, Proxy n) (ApiT Address, Proxy n))
-&gt; ApiAddress n -&gt; Const (ApiT Address, Proxy n) (ApiAddress n)
</span><a href="#local-6989586621682942945"><span class="hs-var">#id</span></a></span><span>
</span><span id="line-481"></span><span>         </span><span class="annot"><span class="annottext">Payload -&gt; m Payload
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Payload -&gt; m Payload) -&gt; Payload -&gt; m Payload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Payload
</span><a href="Test.Integration.Framework.Request.html#Json"><span class="hs-identifier hs-var">Json</span></a></span><span> </span><span class="annot"><span class="">[json|{
                 &quot;payments&quot;: [{
                     &quot;address&quot;: #{destination},
                     &quot;amount&quot;: {
                         &quot;quantity&quot;: #{amt},
                         &quot;unit&quot;: &quot;lovelace&quot;
                     }
                 }]
             }|]</span></span><span>
</span><span id="line-490"></span></pre></body></html>