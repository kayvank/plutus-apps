<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds            #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass       #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric        #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies   #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase           #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns       #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude    #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings    #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell      #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications     #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies         #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators        #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# OPTIONS -fplugin-opt Language.PlutusTx.Plugin:debug-context #-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- | This simple escrow contract facilitiates and exchange of currencies.</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.Contracts.SimpleEscrow</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier">Cardano.Node.Emulator.Params</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Params</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">makeClassyPrisms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Monad.Error.Lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">throwing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">FromJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">ToJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">POSIXTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">PaymentPubKeyHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">unPaymentPubKeyHash</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier">TxId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">getCardanoTxId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Interval</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">after</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">before</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier">Ledger.Tx.Constraints</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Constraints</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier">Ledger.Tx.Constraints.ValidityInterval</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Interval</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Typed.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier">ScriptContextV2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier">Ledger.Typed.Scripts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Scripts</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier">Plutus.Script.Utils.V2.Typed.Scripts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier">Plutus.Script.Utils.Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Value</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">geq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V2.Ledger.Api</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">txInfoValidRange</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V2.Ledger.Contexts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">txSignedBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">valuePaidTo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier">Plutus.V2.Ledger.Contexts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier">Plutus.Contract</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">PlutusTx.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">check</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier">foldMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">foldMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Haskell</span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621680995344"><span id="local-6989586621680995345"></span></span><span class="hs-keyword">data</span><span> </span><span id="EscrowParams"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-var">EscrowParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-49"></span><span>  </span><span id="EscrowParams"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-var">EscrowParams</span></a></span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="payee"><span class="annot"><span class="annottext">EscrowParams -&gt; PaymentPubKeyHash
</span><a href="Plutus.Contracts.SimpleEscrow.html#payee"><span class="hs-identifier hs-var hs-var">payee</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">PaymentPubKeyHash</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-comment">-- ^ The entity that needs to be paid the 'expecting' 'Value'.</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="paying"><span class="annot"><span class="annottext">EscrowParams -&gt; Value
</span><a href="Plutus.Contracts.SimpleEscrow.html#paying"><span class="hs-identifier hs-var hs-var">paying</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">-- ^ Value to be paid out to the redeemer.</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="expecting"><span class="annot"><span class="annottext">EscrowParams -&gt; Value
</span><a href="Plutus.Contracts.SimpleEscrow.html#expecting"><span class="hs-identifier hs-var hs-var">expecting</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">-- ^ Value to be received by the payee.</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="deadline"><span class="annot"><span class="annottext">EscrowParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.SimpleEscrow.html#deadline"><span class="hs-identifier hs-var hs-var">deadline</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">POSIXTime</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-comment">-- ^ Time after which the contract expires.</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995333"><span id="local-6989586621680995335"><span id="local-6989586621680995337"><span class="annot"><span class="annottext">Int -&gt; EscrowParams -&gt; ShowS
[EscrowParams] -&gt; ShowS
EscrowParams -&gt; String
(Int -&gt; EscrowParams -&gt; ShowS)
-&gt; (EscrowParams -&gt; String)
-&gt; ([EscrowParams] -&gt; ShowS)
-&gt; Show EscrowParams
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EscrowParams] -&gt; ShowS
$cshowList :: [EscrowParams] -&gt; ShowS
show :: EscrowParams -&gt; String
$cshow :: EscrowParams -&gt; String
showsPrec :: Int -&gt; EscrowParams -&gt; ShowS
$cshowsPrec :: Int -&gt; EscrowParams -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. EscrowParams -&gt; Rep EscrowParams x)
-&gt; (forall x. Rep EscrowParams x -&gt; EscrowParams)
-&gt; Generic EscrowParams
forall x. Rep EscrowParams x -&gt; EscrowParams
forall x. EscrowParams -&gt; Rep EscrowParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep EscrowParams x -&gt; EscrowParams
$cfrom :: forall x. EscrowParams -&gt; Rep EscrowParams x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995321"><span id="local-6989586621680995323"><span id="local-6989586621680995325"><span id="local-6989586621680995327"><span class="annot"><span class="annottext">[EscrowParams] -&gt; Encoding
[EscrowParams] -&gt; Value
EscrowParams -&gt; Encoding
EscrowParams -&gt; Value
(EscrowParams -&gt; Value)
-&gt; (EscrowParams -&gt; Encoding)
-&gt; ([EscrowParams] -&gt; Value)
-&gt; ([EscrowParams] -&gt; Encoding)
-&gt; ToJSON EscrowParams
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [EscrowParams] -&gt; Encoding
$ctoEncodingList :: [EscrowParams] -&gt; Encoding
toJSONList :: [EscrowParams] -&gt; Value
$ctoJSONList :: [EscrowParams] -&gt; Value
toEncoding :: EscrowParams -&gt; Encoding
$ctoEncoding :: EscrowParams -&gt; Encoding
toJSON :: EscrowParams -&gt; Value
$ctoJSON :: EscrowParams -&gt; Value
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995316"><span id="local-6989586621680995318"><span class="annot"><span class="annottext">Value -&gt; Parser [EscrowParams]
Value -&gt; Parser EscrowParams
(Value -&gt; Parser EscrowParams)
-&gt; (Value -&gt; Parser [EscrowParams]) -&gt; FromJSON EscrowParams
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [EscrowParams]
$cparseJSONList :: Value -&gt; Parser [EscrowParams]
parseJSON :: Value -&gt; Parser EscrowParams
$cparseJSON :: Value -&gt; Parser EscrowParams
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">type</span><span> </span><span id="EscrowSchema"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowSchema"><span class="hs-identifier hs-var">EscrowSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;lock&quot;</span></span><span>   </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-type">EscrowParams</span></a></span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="../../../../row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;refund&quot;</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-type">EscrowParams</span></a></span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><a href="../../../../row-types/html/src"><span class="hs-operator hs-type">.\/</span></a></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Endpoint</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;redeem&quot;</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-type">EscrowParams</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="Action"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Action"><span class="hs-identifier hs-var">Action</span></a></span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Redeem"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Redeem"><span class="hs-identifier hs-var">Redeem</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Refund"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Refund"><span class="hs-identifier hs-var">Refund</span></a></span></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span id="local-6989586621680995309"><span id="local-6989586621680995310"></span></span><span class="hs-keyword">data</span><span> </span><span id="RedeemFailReason"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RedeemFailReason"><span class="hs-identifier hs-var">RedeemFailReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DeadlinePassed"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#DeadlinePassed"><span class="hs-identifier hs-var">DeadlinePassed</span></a></span></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995304"><span id="local-6989586621680995306"><span class="annot"><span class="annottext">RedeemFailReason -&gt; RedeemFailReason -&gt; Bool
(RedeemFailReason -&gt; RedeemFailReason -&gt; Bool)
-&gt; (RedeemFailReason -&gt; RedeemFailReason -&gt; Bool)
-&gt; Eq RedeemFailReason
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: RedeemFailReason -&gt; RedeemFailReason -&gt; Bool
$c/= :: RedeemFailReason -&gt; RedeemFailReason -&gt; Bool
== :: RedeemFailReason -&gt; RedeemFailReason -&gt; Bool
$c== :: RedeemFailReason -&gt; RedeemFailReason -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995297"><span id="local-6989586621680995299"><span id="local-6989586621680995301"><span class="annot"><span class="annottext">Int -&gt; RedeemFailReason -&gt; ShowS
[RedeemFailReason] -&gt; ShowS
RedeemFailReason -&gt; String
(Int -&gt; RedeemFailReason -&gt; ShowS)
-&gt; (RedeemFailReason -&gt; String)
-&gt; ([RedeemFailReason] -&gt; ShowS)
-&gt; Show RedeemFailReason
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RedeemFailReason] -&gt; ShowS
$cshowList :: [RedeemFailReason] -&gt; ShowS
show :: RedeemFailReason -&gt; String
$cshow :: RedeemFailReason -&gt; String
showsPrec :: Int -&gt; RedeemFailReason -&gt; ShowS
$cshowsPrec :: Int -&gt; RedeemFailReason -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. RedeemFailReason -&gt; Rep RedeemFailReason x)
-&gt; (forall x. Rep RedeemFailReason x -&gt; RedeemFailReason)
-&gt; Generic RedeemFailReason
forall x. Rep RedeemFailReason x -&gt; RedeemFailReason
forall x. RedeemFailReason -&gt; Rep RedeemFailReason x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep RedeemFailReason x -&gt; RedeemFailReason
$cfrom :: forall x. RedeemFailReason -&gt; Rep RedeemFailReason x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995287"><span id="local-6989586621680995289"><span id="local-6989586621680995291"><span id="local-6989586621680995293"><span class="annot"><span class="annottext">[RedeemFailReason] -&gt; Encoding
[RedeemFailReason] -&gt; Value
RedeemFailReason -&gt; Encoding
RedeemFailReason -&gt; Value
(RedeemFailReason -&gt; Value)
-&gt; (RedeemFailReason -&gt; Encoding)
-&gt; ([RedeemFailReason] -&gt; Value)
-&gt; ([RedeemFailReason] -&gt; Encoding)
-&gt; ToJSON RedeemFailReason
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [RedeemFailReason] -&gt; Encoding
$ctoEncodingList :: [RedeemFailReason] -&gt; Encoding
toJSONList :: [RedeemFailReason] -&gt; Value
$ctoJSONList :: [RedeemFailReason] -&gt; Value
toEncoding :: RedeemFailReason -&gt; Encoding
$ctoEncoding :: RedeemFailReason -&gt; Encoding
toJSON :: RedeemFailReason -&gt; Value
$ctoJSON :: RedeemFailReason -&gt; Value
</span><a href="#local-6989586621680995287"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995283"><span id="local-6989586621680995285"><span class="annot"><span class="annottext">Value -&gt; Parser [RedeemFailReason]
Value -&gt; Parser RedeemFailReason
(Value -&gt; Parser RedeemFailReason)
-&gt; (Value -&gt; Parser [RedeemFailReason])
-&gt; FromJSON RedeemFailReason
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [RedeemFailReason]
$cparseJSONList :: Value -&gt; Parser [RedeemFailReason]
parseJSON :: Value -&gt; Parser RedeemFailReason
$cparseJSON :: Value -&gt; Parser RedeemFailReason
</span><a href="#local-6989586621680995283"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span id="local-6989586621680995281"><span id="local-6989586621680995282"></span></span><span class="hs-keyword">data</span><span> </span><span id="EscrowError"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowError"><span class="hs-identifier hs-var">EscrowError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-75"></span><span>    </span><span id="RedeemFailed"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RedeemFailed"><span class="hs-identifier hs-var">RedeemFailed</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RedeemFailReason"><span class="hs-identifier hs-type">RedeemFailReason</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RefundFailed"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RefundFailed"><span class="hs-identifier hs-var">RefundFailed</span></a></span></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="EContractError"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EContractError"><span class="hs-identifier hs-var">EContractError</span></a></span></span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">ContractError</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995272"><span id="local-6989586621680995274"><span id="local-6989586621680995276"><span class="annot"><span class="annottext">Int -&gt; EscrowError -&gt; ShowS
[EscrowError] -&gt; ShowS
EscrowError -&gt; String
(Int -&gt; EscrowError -&gt; ShowS)
-&gt; (EscrowError -&gt; String)
-&gt; ([EscrowError] -&gt; ShowS)
-&gt; Show EscrowError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EscrowError] -&gt; ShowS
$cshowList :: [EscrowError] -&gt; ShowS
show :: EscrowError -&gt; String
$cshow :: EscrowError -&gt; String
showsPrec :: Int -&gt; EscrowError -&gt; ShowS
$cshowsPrec :: Int -&gt; EscrowError -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. EscrowError -&gt; Rep EscrowError x)
-&gt; (forall x. Rep EscrowError x -&gt; EscrowError)
-&gt; Generic EscrowError
forall x. Rep EscrowError x -&gt; EscrowError
forall x. EscrowError -&gt; Rep EscrowError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep EscrowError x -&gt; EscrowError
$cfrom :: forall x. EscrowError -&gt; Rep EscrowError x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995262"><span id="local-6989586621680995264"><span id="local-6989586621680995266"><span id="local-6989586621680995268"><span class="annot"><span class="annottext">[EscrowError] -&gt; Encoding
[EscrowError] -&gt; Value
EscrowError -&gt; Encoding
EscrowError -&gt; Value
(EscrowError -&gt; Value)
-&gt; (EscrowError -&gt; Encoding)
-&gt; ([EscrowError] -&gt; Value)
-&gt; ([EscrowError] -&gt; Encoding)
-&gt; ToJSON EscrowError
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [EscrowError] -&gt; Encoding
$ctoEncodingList :: [EscrowError] -&gt; Encoding
toJSONList :: [EscrowError] -&gt; Value
$ctoJSONList :: [EscrowError] -&gt; Value
toEncoding :: EscrowError -&gt; Encoding
$ctoEncoding :: EscrowError -&gt; Encoding
toJSON :: EscrowError -&gt; Value
$ctoJSON :: EscrowError -&gt; Value
</span><a href="#local-6989586621680995262"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995258"><span id="local-6989586621680995260"><span class="annot"><span class="annottext">Value -&gt; Parser [EscrowError]
Value -&gt; Parser EscrowError
(Value -&gt; Parser EscrowError)
-&gt; (Value -&gt; Parser [EscrowError]) -&gt; FromJSON EscrowError
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [EscrowError]
$cparseJSONList :: Value -&gt; Parser [EscrowError]
parseJSON :: Value -&gt; Parser EscrowError
$cparseJSON :: Value -&gt; Parser EscrowError
</span><a href="#local-6989586621680995258"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span id="_EContractError"><span id="_RefundFailed"><span id="_RedeemFailed"><span id="_EscrowError"><span id="local-6989586621680995247"><span id="local-6989586621680995249"><span id="local-6989586621680995251"><span id="local-6989586621680995253"><span id="local-6989586621680995255"><span id="local-6989586621680995256"><span id="local-6989586621680995257"><span id="AsEscrowError"><span id="local-6989586621680995561"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EscrowError</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680995225"><span id="local-6989586621680995227"><span id="local-6989586621680995229"><span id="local-6989586621680995231"><span id="local-6989586621680995233"><span id="local-6989586621680995235"><span id="local-6989586621680995237"><span id="local-6989586621680995239"><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">AsContractError</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowError"><span class="hs-identifier hs-type">EscrowError</span></a></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621680995223"><span class="annot"><span class="annottext">_ContractError :: p ContractError (f ContractError) -&gt; p EscrowError (f EscrowError)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">_ContractError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p ContractError (f ContractError) -&gt; p EscrowError (f EscrowError)
forall r. AsEscrowError r =&gt; Prism' r ContractError
</span><a href="Plutus.Contracts.SimpleEscrow.html#_EContractError"><span class="hs-identifier hs-var">_EContractError</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">newtype</span><span> </span><span id="RefundSuccess"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RefundSuccess"><span class="hs-identifier hs-var">RefundSuccess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RefundSuccess"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RefundSuccess"><span class="hs-identifier hs-var">RefundSuccess</span></a></span></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995217"><span id="local-6989586621680995219"><span class="annot"><span class="annottext">RefundSuccess -&gt; RefundSuccess -&gt; Bool
(RefundSuccess -&gt; RefundSuccess -&gt; Bool)
-&gt; (RefundSuccess -&gt; RefundSuccess -&gt; Bool) -&gt; Eq RefundSuccess
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: RefundSuccess -&gt; RefundSuccess -&gt; Bool
$c/= :: RefundSuccess -&gt; RefundSuccess -&gt; Bool
== :: RefundSuccess -&gt; RefundSuccess -&gt; Bool
$c== :: RefundSuccess -&gt; RefundSuccess -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995211"><span id="local-6989586621680995213"><span id="local-6989586621680995215"><span class="annot"><span class="annottext">Int -&gt; RefundSuccess -&gt; ShowS
[RefundSuccess] -&gt; ShowS
RefundSuccess -&gt; String
(Int -&gt; RefundSuccess -&gt; ShowS)
-&gt; (RefundSuccess -&gt; String)
-&gt; ([RefundSuccess] -&gt; ShowS)
-&gt; Show RefundSuccess
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RefundSuccess] -&gt; ShowS
$cshowList :: [RefundSuccess] -&gt; ShowS
show :: RefundSuccess -&gt; String
$cshow :: RefundSuccess -&gt; String
showsPrec :: Int -&gt; RefundSuccess -&gt; ShowS
$cshowsPrec :: Int -&gt; RefundSuccess -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995207"><span id="local-6989586621680995209"><span class="annot"><span class="annottext">Rep RefundSuccess x -&gt; RefundSuccess
RefundSuccess -&gt; Rep RefundSuccess x
(forall x. RefundSuccess -&gt; Rep RefundSuccess x)
-&gt; (forall x. Rep RefundSuccess x -&gt; RefundSuccess)
-&gt; Generic RefundSuccess
forall x. Rep RefundSuccess x -&gt; RefundSuccess
forall x. RefundSuccess -&gt; Rep RefundSuccess x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
to :: Rep RefundSuccess x -&gt; RefundSuccess
$cto :: forall x. Rep RefundSuccess x -&gt; RefundSuccess
from :: RefundSuccess -&gt; Rep RefundSuccess x
$cfrom :: forall x. RefundSuccess -&gt; Rep RefundSuccess x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995199"><span id="local-6989586621680995201"><span id="local-6989586621680995203"><span id="local-6989586621680995205"><span class="annot"><span class="annottext">[RefundSuccess] -&gt; Encoding
[RefundSuccess] -&gt; Value
RefundSuccess -&gt; Encoding
RefundSuccess -&gt; Value
(RefundSuccess -&gt; Value)
-&gt; (RefundSuccess -&gt; Encoding)
-&gt; ([RefundSuccess] -&gt; Value)
-&gt; ([RefundSuccess] -&gt; Encoding)
-&gt; ToJSON RefundSuccess
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [RefundSuccess] -&gt; Encoding
$ctoEncodingList :: [RefundSuccess] -&gt; Encoding
toJSONList :: [RefundSuccess] -&gt; Value
$ctoJSONList :: [RefundSuccess] -&gt; Value
toEncoding :: RefundSuccess -&gt; Encoding
$ctoEncoding :: RefundSuccess -&gt; Encoding
toJSON :: RefundSuccess -&gt; Value
$ctoJSON :: RefundSuccess -&gt; Value
</span><a href="#local-6989586621680995199"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995195"><span id="local-6989586621680995197"><span class="annot"><span class="annottext">Value -&gt; Parser [RefundSuccess]
Value -&gt; Parser RefundSuccess
(Value -&gt; Parser RefundSuccess)
-&gt; (Value -&gt; Parser [RefundSuccess]) -&gt; FromJSON RefundSuccess
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [RefundSuccess]
$cparseJSONList :: Value -&gt; Parser [RefundSuccess]
parseJSON :: Value -&gt; Parser RefundSuccess
$cparseJSON :: Value -&gt; Parser RefundSuccess
</span><a href="#local-6989586621680995195"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">newtype</span><span> </span><span id="RedeemSuccess"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RedeemSuccess"><span class="hs-identifier hs-var">RedeemSuccess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RedeemSuccess"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RedeemSuccess"><span class="hs-identifier hs-var">RedeemSuccess</span></a></span></span><span> </span><span class="annot"><a href="../../../../cardano-api/html/src"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680995190"><span id="local-6989586621680995192"><span class="annot"><span class="annottext">RedeemSuccess -&gt; RedeemSuccess -&gt; Bool
(RedeemSuccess -&gt; RedeemSuccess -&gt; Bool)
-&gt; (RedeemSuccess -&gt; RedeemSuccess -&gt; Bool) -&gt; Eq RedeemSuccess
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: RedeemSuccess -&gt; RedeemSuccess -&gt; Bool
$c/= :: RedeemSuccess -&gt; RedeemSuccess -&gt; Bool
== :: RedeemSuccess -&gt; RedeemSuccess -&gt; Bool
$c== :: RedeemSuccess -&gt; RedeemSuccess -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680995184"><span id="local-6989586621680995186"><span id="local-6989586621680995188"><span class="annot"><span class="annottext">Int -&gt; RedeemSuccess -&gt; ShowS
[RedeemSuccess] -&gt; ShowS
RedeemSuccess -&gt; String
(Int -&gt; RedeemSuccess -&gt; ShowS)
-&gt; (RedeemSuccess -&gt; String)
-&gt; ([RedeemSuccess] -&gt; ShowS)
-&gt; Show RedeemSuccess
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RedeemSuccess] -&gt; ShowS
$cshowList :: [RedeemSuccess] -&gt; ShowS
show :: RedeemSuccess -&gt; String
$cshow :: RedeemSuccess -&gt; String
showsPrec :: Int -&gt; RedeemSuccess -&gt; ShowS
$cshowsPrec :: Int -&gt; RedeemSuccess -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">data</span><span> </span><span id="Escrow"><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Escrow"><span class="hs-identifier hs-var">Escrow</span></a></span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">Scripts.ValidatorTypes</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Escrow"><span class="hs-identifier hs-type">Escrow</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="RedeemerType"><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">RedeemerType</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Escrow"><span class="hs-identifier hs-type">Escrow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="DatumType"><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">DatumType</span></a></span></span><span>    </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Escrow"><span class="hs-identifier hs-type">Escrow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-type">EscrowParams</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#escrowAddress"><span class="hs-identifier hs-type">escrowAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-type">Ledger.CardanoAddress</span></a></span><span>
</span><span id="line-99"></span><span id="escrowAddress"><span class="annot"><span class="annottext">escrowAddress :: CardanoAddress
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowAddress"><span class="hs-identifier hs-var hs-var">escrowAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; TypedValidator Escrow -&gt; CardanoAddress
forall a. NetworkId -&gt; TypedValidator a -&gt; CardanoAddress
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.validatorCardanoAddress</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="../../../../cardano-node-emulator/html/src"><span class="hs-identifier hs-var">Params.testnet</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Escrow
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowInstance"><span class="hs-identifier hs-var">escrowInstance</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#escrowInstance"><span class="hs-identifier hs-type">escrowInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">V2.TypedValidator</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Escrow"><span class="hs-identifier hs-type">Escrow</span></a></span><span>
</span><span id="line-102"></span><span id="escrowInstance"><span class="annot"><span class="annottext">escrowInstance :: TypedValidator Escrow
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowInstance"><span class="hs-identifier hs-var hs-var">escrowInstance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompiledCode (ValidatorType Escrow)
-&gt; CompiledCode (ValidatorType Escrow -&gt; UntypedValidator)
-&gt; TypedValidator Escrow
forall a.
CompiledCode (ValidatorType a)
-&gt; CompiledCode (ValidatorType a -&gt; UntypedValidator)
-&gt; TypedValidator a
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">V2.mkTypedValidator</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Escrow"><span class="hs-identifier hs-type">Escrow</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">validate</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">$$(</span><span class="annot"><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-type">PlutusTx.compile</span></a></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">wrap</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-106"></span><span>        </span><span id="local-6989586621680995173"><span class="annot"><span class="annottext">wrap :: (EscrowParams -&gt; Action -&gt; ScriptContext -&gt; Bool)
-&gt; UntypedValidator
</span><a href="#local-6989586621680995173"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnsafeFromData EscrowParams, UnsafeFromData Action) =&gt;
(EscrowParams -&gt; Action -&gt; ScriptContext -&gt; Bool)
-&gt; UntypedValidator
forall sc d r.
(IsScriptContext sc, UnsafeFromData d, UnsafeFromData r) =&gt;
(d -&gt; r -&gt; sc -&gt; Bool) -&gt; UntypedValidator
</span><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-var">Scripts.mkUntypedValidator</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../plutus-script-utils/html/src"><span class="hs-identifier hs-type">ScriptContextV2</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-type">EscrowParams</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#validate"><span class="hs-pragma hs-type">validate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-109"></span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#validate"><span class="hs-identifier hs-type">validate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowParams"><span class="hs-identifier hs-type">EscrowParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#Action"><span class="hs-identifier hs-type">Action</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">V2.ScriptContext</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-110"></span><span id="validate"><span class="annot"><span class="annottext">validate :: EscrowParams -&gt; Action -&gt; ScriptContext -&gt; Bool
</span><a href="Plutus.Contracts.SimpleEscrow.html#validate"><span class="hs-identifier hs-var hs-var">validate</span></a></span></span><span> </span><span id="local-6989586621680995171"><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995171"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621680995170"><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621680995170"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="annot"><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-type">V2.ScriptContext</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">scriptContextTxInfo :: ScriptContext -&gt; TxInfo
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">V2.scriptContextTxInfo</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680995167"><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621680995167"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="#local-6989586621680995170"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">Action
</span><a href="Plutus.Contracts.SimpleEscrow.html#Redeem"><span class="hs-identifier hs-var">Redeem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>          </span><span class="hs-comment">-- Can't redeem after the deadline</span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680995166"><span class="annot"><span class="annottext">notLapsed :: Bool
</span><a href="#local-6989586621680995166"><span class="hs-identifier hs-var hs-var">notLapsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EscrowParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.SimpleEscrow.html#deadline"><span class="hs-identifier hs-var hs-var">deadline</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995171"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Interval POSIXTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; Interval a -&gt; Bool
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-operator hs-var">`after`</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; Interval POSIXTime
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var hs-var">txInfoValidRange</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621680995167"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-115"></span><span>          </span><span class="hs-comment">-- Payee has to have been paid</span><span>
</span><span id="line-116"></span><span>          </span><span id="local-6989586621680995165"><span class="annot"><span class="annottext">paid :: Bool
</span><a href="#local-6989586621680995165"><span class="hs-identifier hs-var hs-var">paid</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; PubKeyHash -&gt; Value
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var">valuePaidTo</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621680995167"><span class="hs-identifier hs-var">txInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; PubKeyHash
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var hs-var">unPaymentPubKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">(PaymentPubKeyHash -&gt; PubKeyHash)
-&gt; PaymentPubKeyHash -&gt; PubKeyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams -&gt; PaymentPubKeyHash
</span><a href="Plutus.Contracts.SimpleEscrow.html#payee"><span class="hs-identifier hs-var hs-var">payee</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995171"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-operator hs-var">`geq`</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams -&gt; Value
</span><a href="Plutus.Contracts.SimpleEscrow.html#expecting"><span class="hs-identifier hs-var hs-var">expecting</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995171"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-117"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">traceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;escrow-deadline-lapsed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680995166"><span class="hs-identifier hs-var">notLapsed</span></a></span><span>
</span><span id="line-118"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">traceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;escrow-not-paid&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680995165"><span class="hs-identifier hs-var">paid</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="annottext">Action
</span><a href="Plutus.Contracts.SimpleEscrow.html#Refund"><span class="hs-identifier hs-var">Refund</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>          </span><span class="hs-comment">-- Has to be the person that locked value requesting the refund</span><span>
</span><span id="line-121"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680995161"><span class="annot"><span class="annottext">signed :: Bool
</span><a href="#local-6989586621680995161"><span class="hs-identifier hs-var hs-var">signed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621680995167"><span class="hs-identifier hs-var">txInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; PubKeyHash -&gt; Bool
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-operator hs-var">`txSignedBy`</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; PubKeyHash
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var hs-var">unPaymentPubKeyHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EscrowParams -&gt; PaymentPubKeyHash
</span><a href="Plutus.Contracts.SimpleEscrow.html#payee"><span class="hs-identifier hs-var hs-var">payee</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995171"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>          </span><span class="hs-comment">-- And we only refund after the deadline has passed</span><span>
</span><span id="line-123"></span><span>          </span><span id="local-6989586621680995160"><span class="annot"><span class="annottext">lapsed :: Bool
</span><a href="#local-6989586621680995160"><span class="hs-identifier hs-var hs-var">lapsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EscrowParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.SimpleEscrow.html#deadline"><span class="hs-identifier hs-var hs-var">deadline</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995171"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; POSIXTime
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../plutus-tx/html/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; Interval POSIXTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; Interval a -&gt; Bool
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-operator hs-var">`before`</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; Interval POSIXTime
</span><a href="../../../../plutus-ledger-api/html/src"><span class="hs-identifier hs-var hs-var">txInfoValidRange</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621680995167"><span class="hs-identifier hs-var">txInfo</span></a></span><span>
</span><span id="line-124"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">traceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;escrow-not-signed&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680995161"><span class="hs-identifier hs-var">signed</span></a></span><span>
</span><span id="line-125"></span><span>          </span><span class="hs-comment">-- &amp;&amp; traceIfFalse &quot;refund-too-early&quot; lapsed</span><span>
</span><span id="line-126"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">traceIfFalse</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;refund-too-early&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680995160"><span class="hs-identifier hs-var">lapsed</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Lock the 'paying' 'Value' in the output of this script, with the</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- requirement that the transaction validates before the 'deadline'.</span><span>
</span><span id="line-130"></span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#lockEp"><span class="hs-identifier hs-type">lockEp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Promise</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowSchema"><span class="hs-identifier hs-type">EscrowSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowError"><span class="hs-identifier hs-type">EscrowError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span id="lockEp"><span class="annot"><span class="annottext">lockEp :: Promise () EscrowSchema EscrowError ()
</span><a href="Plutus.Contracts.SimpleEscrow.html#lockEp"><span class="hs-identifier hs-var hs-var">lockEp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e b.
(HasEndpoint &quot;lock&quot; a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">endpoint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;lock&quot;</span></span><span> </span><span class="annot"><span class="annottext">((EscrowParams
  -&gt; Contract
       ()
       ('R
          '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
             &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
             &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
       EscrowError
       ())
 -&gt; Promise
      ()
      ('R
         '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
      EscrowError
      ())
-&gt; (EscrowParams
    -&gt; Contract
         ()
         ('R
            '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
               &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
               &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
         EscrowError
         ())
-&gt; Promise
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680995156"><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995156"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680995155"><span class="annot"><span class="annottext">valRange :: ValidityInterval POSIXTime
</span><a href="#local-6989586621680995155"><span class="hs-identifier hs-var hs-var">valRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; ValidityInterval POSIXTime
forall a. a -&gt; ValidityInterval a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Interval.lessThan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime
forall a. Enum a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.pred</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; POSIXTime) -&gt; POSIXTime -&gt; POSIXTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime
forall a. Enum a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.pred</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; POSIXTime) -&gt; POSIXTime -&gt; POSIXTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.SimpleEscrow.html#deadline"><span class="hs-identifier hs-var hs-var">deadline</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995156"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>      </span><span id="local-6989586621680995152"><span class="annot"><span class="annottext">tx :: TxConstraints Action EscrowParams
</span><a href="#local-6989586621680995152"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EscrowParams -&gt; Value -&gt; TxConstraints Action EscrowParams
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToTheScriptWithDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995156"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EscrowParams -&gt; Value
</span><a href="Plutus.Contracts.SimpleEscrow.html#paying"><span class="hs-identifier hs-var hs-var">paying</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995156"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>            </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; TxConstraints Action EscrowParams
forall i o. ValidityInterval POSIXTime -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustValidateInTimeRange</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621680995155"><span class="hs-identifier hs-var">valRange</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="annottext">Contract
  ()
  ('R
     '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
        &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
        &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
  EscrowError
  CardanoTx
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract
   ()
   ('R
      '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
         &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
         &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
   EscrowError
   CardanoTx
 -&gt; Contract
      ()
      ('R
         '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
      EscrowError
      ())
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     CardanoTx
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups Escrow
-&gt; TxConstraints (RedeemerType Escrow) (DatumType Escrow)
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator Escrow -&gt; ScriptLookups Escrow
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Escrow
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowInstance"><span class="hs-identifier hs-var">escrowInstance</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Escrow) (DatumType Escrow)
TxConstraints Action EscrowParams
</span><a href="#local-6989586621680995152"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-136"></span><span>         </span><span class="annot"><span class="annottext">Contract
  ()
  ('R
     '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
        &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
        &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
  EscrowError
  UnbalancedTx
-&gt; (UnbalancedTx
    -&gt; Contract
         ()
         ('R
            '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
               &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
               &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
         EscrowError
         UnbalancedTx)
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract
  ()
  ('R
     '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
        &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
        &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
  EscrowError
  UnbalancedTx
-&gt; (UnbalancedTx
    -&gt; Contract
         ()
         ('R
            '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
               &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
               &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
         EscrowError
         CardanoTx)
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     CardanoTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     CardanoTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e CardanoTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitUnbalancedTx</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | Attempts to redeem the 'Value' locked into this script by paying in from</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- the callers address to the payee.</span><span>
</span><span id="line-140"></span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#redeemEp"><span class="hs-identifier hs-type">redeemEp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Promise</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowSchema"><span class="hs-identifier hs-type">EscrowSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowError"><span class="hs-identifier hs-type">EscrowError</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RedeemSuccess"><span class="hs-identifier hs-type">RedeemSuccess</span></a></span><span>
</span><span id="line-141"></span><span id="redeemEp"><span class="annot"><span class="annottext">redeemEp :: Promise () EscrowSchema EscrowError RedeemSuccess
</span><a href="Plutus.Contracts.SimpleEscrow.html#redeemEp"><span class="hs-identifier hs-var hs-var">redeemEp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EscrowParams
 -&gt; Contract
      ()
      ('R
         '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
      EscrowError
      RedeemSuccess)
-&gt; Promise
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     RedeemSuccess
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">endpoint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;redeem&quot;</span></span><span> </span><span class="annot"><span class="annottext">EscrowParams
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     RedeemSuccess
forall e w (s :: Row *).
(AsContractError e, AsEscrowError e) =&gt;
EscrowParams -&gt; Contract w s e RedeemSuccess
</span><a href="#local-6989586621680995144"><span class="hs-identifier hs-var">redeem</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621680995144"><span class="annot"><span class="annottext">redeem :: EscrowParams -&gt; Contract w s e RedeemSuccess
</span><a href="#local-6989586621680995144"><span class="hs-identifier hs-var hs-var">redeem</span></a></span></span><span> </span><span id="local-6989586621680995143"><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995143"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>      </span><span id="local-6989586621680995142"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680995142"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(POSIXTime, POSIXTime) -&gt; POSIXTime
forall a b. (a, b) -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((POSIXTime, POSIXTime) -&gt; POSIXTime)
-&gt; Contract w s e (POSIXTime, POSIXTime)
-&gt; Contract w s e POSIXTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e (POSIXTime, POSIXTime)
forall w (s :: Row *) e.
AsContractError e =&gt;
Contract w s e (POSIXTime, POSIXTime)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">currentNodeClientTimeRange</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span id="local-6989586621680995138"><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621680995138"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Contract w s e PaymentPubKeyHash
forall w (s :: Row *) e.
AsContractError e =&gt;
Contract w s e PaymentPubKeyHash
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">ownFirstPaymentPubKeyHash</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span id="local-6989586621680995136"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680995136"><span class="hs-identifier hs-var">unspentOutputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
forall w (s :: Row *) e.
AsContractError e =&gt;
CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">utxosAt</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowAddress"><span class="hs-identifier hs-var">escrowAddress</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680995134"><span class="annot"><span class="annottext">value :: Value
</span><a href="#local-6989586621680995134"><span class="hs-identifier hs-var hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DecoratedTxOut -&gt; Value) -&gt; Map TxOutRef DecoratedTxOut -&gt; Value
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; Value
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">Ledger.decoratedTxOutPlutusValue</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680995136"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span>
</span><span id="line-149"></span><span>          </span><span id="local-6989586621680995132"><span class="annot"><span class="annottext">validityTimeRange :: ValidityInterval POSIXTime
</span><a href="#local-6989586621680995132"><span class="hs-identifier hs-var hs-var">validityTimeRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; ValidityInterval POSIXTime
forall a. a -&gt; ValidityInterval a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Interval.lessThan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime
forall a. Enum a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.pred</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; POSIXTime) -&gt; POSIXTime -&gt; POSIXTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime
forall a. Enum a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.pred</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTime -&gt; POSIXTime) -&gt; POSIXTime -&gt; POSIXTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.SimpleEscrow.html#deadline"><span class="hs-identifier hs-var hs-var">deadline</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995143"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>          </span><span id="local-6989586621680995131"><span class="annot"><span class="annottext">tx :: TxConstraints Action EscrowParams
</span><a href="#local-6989586621680995131"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
-&gt; Action -&gt; TxConstraints Action EscrowParams
forall i o. Map TxOutRef DecoratedTxOut -&gt; i -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.spendUtxosFromTheScript</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680995136"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Plutus.Contracts.SimpleEscrow.html#Redeem"><span class="hs-identifier hs-var">Redeem</span></a></span><span>
</span><span id="line-151"></span><span>                      </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; TxConstraints Action EscrowParams
forall i o. ValidityInterval POSIXTime -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustValidateInTimeRange</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621680995132"><span class="hs-identifier hs-var">validityTimeRange</span></a></span><span>
</span><span id="line-152"></span><span>                      </span><span class="hs-comment">-- Pay me the output of this script</span><span>
</span><span id="line-153"></span><span>                      </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; Value -&gt; TxConstraints Action EscrowParams
forall i o. PaymentPubKeyHash -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToPubKey</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621680995138"><span class="hs-identifier hs-var">pk</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680995134"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-154"></span><span>                      </span><span class="hs-comment">-- Pay the payee their due</span><span>
</span><span id="line-155"></span><span>                      </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; Value -&gt; TxConstraints Action EscrowParams
forall i o. PaymentPubKeyHash -&gt; Value -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustPayToPubKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EscrowParams -&gt; PaymentPubKeyHash
</span><a href="Plutus.Contracts.SimpleEscrow.html#payee"><span class="hs-identifier hs-var hs-var">payee</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995143"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EscrowParams -&gt; Value
</span><a href="Plutus.Contracts.SimpleEscrow.html#expecting"><span class="hs-identifier hs-var hs-var">expecting</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995143"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680995142"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.SimpleEscrow.html#deadline"><span class="hs-identifier hs-var hs-var">deadline</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995143"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-158"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">AReview e RedeemFailReason
-&gt; RedeemFailReason -&gt; Contract w s e RedeemSuccess
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">throwing</span></a></span><span> </span><span class="annot"><span class="annottext">AReview e RedeemFailReason
forall r. AsEscrowError r =&gt; Prism' r RedeemFailReason
</span><a href="Plutus.Contracts.SimpleEscrow.html#_RedeemFailed"><span class="hs-identifier hs-var">_RedeemFailed</span></a></span><span> </span><span class="annot"><span class="annottext">RedeemFailReason
</span><a href="Plutus.Contracts.SimpleEscrow.html#DeadlinePassed"><span class="hs-identifier hs-var">DeadlinePassed</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>        </span><span id="local-6989586621680995127"><span class="annot"><span class="annottext">UnbalancedTx
</span><a href="#local-6989586621680995127"><span class="hs-identifier hs-var">utx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptLookups Escrow
-&gt; TxConstraints (RedeemerType Escrow) (DatumType Escrow)
-&gt; Contract w s e UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TypedValidator Escrow -&gt; ScriptLookups Escrow
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Escrow
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowInstance"><span class="hs-identifier hs-var">escrowInstance</span></a></span><span>
</span><span id="line-161"></span><span>                              </span><span class="annot"><span class="annottext">ScriptLookups Escrow
-&gt; ScriptLookups Escrow -&gt; ScriptLookups Escrow
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Escrow
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680995136"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span>
</span><span id="line-162"></span><span>                               </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Escrow) (DatumType Escrow)
TxConstraints Action EscrowParams
</span><a href="#local-6989586621680995131"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s e UnbalancedTx)
-&gt; Contract w s e UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s e UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">TxId -&gt; RedeemSuccess
</span><a href="Plutus.Contracts.SimpleEscrow.html#RedeemSuccess"><span class="hs-identifier hs-var">RedeemSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(TxId -&gt; RedeemSuccess)
-&gt; (CardanoTx -&gt; TxId) -&gt; CardanoTx -&gt; RedeemSuccess
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; TxId
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">getCardanoTxId</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoTx -&gt; RedeemSuccess)
-&gt; Contract w s e CardanoTx -&gt; Contract w s e RedeemSuccess
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s e CardanoTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e CardanoTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx
</span><a href="#local-6989586621680995127"><span class="hs-identifier hs-var">utx</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | Refunds the locked amount back to the 'payee'.</span><span>
</span><span id="line-166"></span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#refundEp"><span class="hs-identifier hs-type">refundEp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-type">Promise</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowSchema"><span class="hs-identifier hs-type">EscrowSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#EscrowError"><span class="hs-identifier hs-type">EscrowError</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.SimpleEscrow.html#RefundSuccess"><span class="hs-identifier hs-type">RefundSuccess</span></a></span><span>
</span><span id="line-167"></span><span id="refundEp"><span class="annot"><span class="annottext">refundEp :: Promise () EscrowSchema EscrowError RefundSuccess
</span><a href="Plutus.Contracts.SimpleEscrow.html#refundEp"><span class="hs-identifier hs-var hs-var">refundEp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EscrowParams
 -&gt; Contract
      ()
      ('R
         '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
            &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
      EscrowError
      RefundSuccess)
-&gt; Promise
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     RefundSuccess
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">endpoint</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;refund&quot;</span></span><span> </span><span class="annot"><span class="annottext">EscrowParams
-&gt; Contract
     ()
     ('R
        '[ &quot;lock&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;redeem&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint),
           &quot;refund&quot; ':-&gt; (EndpointValue EscrowParams, ActiveEndpoint)])
     EscrowError
     RefundSuccess
forall e w (s :: Row *).
(AsContractError e, AsEscrowError e) =&gt;
EscrowParams -&gt; Contract w s e RefundSuccess
</span><a href="#local-6989586621680995123"><span class="hs-identifier hs-var">refund</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621680995123"><span class="annot"><span class="annottext">refund :: EscrowParams -&gt; Contract w s e RefundSuccess
</span><a href="#local-6989586621680995123"><span class="hs-identifier hs-var hs-var">refund</span></a></span></span><span> </span><span id="local-6989586621680995122"><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995122"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>      </span><span id="local-6989586621680995121"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680995121"><span class="hs-identifier hs-var">unspentOutputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
forall w (s :: Row *) e.
AsContractError e =&gt;
CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">utxosAt</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowAddress"><span class="hs-identifier hs-var">escrowAddress</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680995120"><span class="annot"><span class="annottext">tx :: TxConstraints Action EscrowParams
</span><a href="#local-6989586621680995120"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
-&gt; Action -&gt; TxConstraints Action EscrowParams
forall i o. Map TxOutRef DecoratedTxOut -&gt; i -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.spendUtxosFromTheScript</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680995121"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">Action
</span><a href="Plutus.Contracts.SimpleEscrow.html#Refund"><span class="hs-identifier hs-var">Refund</span></a></span><span>
</span><span id="line-173"></span><span>                  </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; TxConstraints Action EscrowParams
forall i o. ValidityInterval POSIXTime -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustValidateInTimeRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; ValidityInterval POSIXTime
forall a. a -&gt; ValidityInterval a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Interval.from</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EscrowParams -&gt; POSIXTime
</span><a href="Plutus.Contracts.SimpleEscrow.html#deadline"><span class="hs-identifier hs-var hs-var">deadline</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995122"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>                  </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
-&gt; TxConstraints Action EscrowParams
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; TxConstraints Action EscrowParams
forall i o. PaymentPubKeyHash -&gt; TxConstraints i o
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.mustBeSignedBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EscrowParams -&gt; PaymentPubKeyHash
</span><a href="Plutus.Contracts.SimpleEscrow.html#payee"><span class="hs-identifier hs-var hs-var">payee</span></a></span><span> </span><span class="annot"><span class="annottext">EscrowParams
</span><a href="#local-6989586621680995122"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams -&gt; Bool
forall i o. TxConstraints i o -&gt; Bool
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.modifiesUtxoSet</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints Action EscrowParams
</span><a href="#local-6989586621680995120"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-177"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621680995116"><span class="annot"><span class="annottext">UnbalancedTx
</span><a href="#local-6989586621680995116"><span class="hs-identifier hs-var">utx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ScriptLookups Escrow
-&gt; TxConstraints (RedeemerType Escrow) (DatumType Escrow)
-&gt; Contract w s e UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">mkTxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">TypedValidator Escrow -&gt; ScriptLookups Escrow
forall a. TypedValidator a -&gt; ScriptLookups a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Escrow
</span><a href="Plutus.Contracts.SimpleEscrow.html#escrowInstance"><span class="hs-identifier hs-var">escrowInstance</span></a></span><span>
</span><span id="line-179"></span><span>                              </span><span class="annot"><span class="annottext">ScriptLookups Escrow
-&gt; ScriptLookups Escrow -&gt; ScriptLookups Escrow
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Escrow
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="../../../../plutus-tx-constraints/html/src"><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680995121"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span>
</span><span id="line-180"></span><span>                               </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType Escrow) (DatumType Escrow)
TxConstraints Action EscrowParams
</span><a href="#local-6989586621680995120"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s e UnbalancedTx)
-&gt; Contract w s e UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s e UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">adjustUnbalancedTx</span></a></span><span>
</span><span id="line-181"></span><span>        </span><span class="annot"><span class="annottext">TxId -&gt; RefundSuccess
</span><a href="Plutus.Contracts.SimpleEscrow.html#RefundSuccess"><span class="hs-identifier hs-var">RefundSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">(TxId -&gt; RefundSuccess)
-&gt; (CardanoTx -&gt; TxId) -&gt; CardanoTx -&gt; RefundSuccess
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; TxId
</span><a href="../../../../plutus-ledger/html/src"><span class="hs-identifier hs-var">getCardanoTxId</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoTx -&gt; RefundSuccess)
-&gt; Contract w s e CardanoTx -&gt; Contract w s e RefundSuccess
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../plutus-tx/html/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s e CardanoTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e CardanoTx
</span><a href="../../../../plutus-contract/html/src"><span class="hs-identifier hs-var">submitUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx
</span><a href="#local-6989586621680995116"><span class="hs-identifier hs-var">utx</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AReview e () -&gt; () -&gt; Contract w s e RefundSuccess
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">throwing</span></a></span><span> </span><span class="annot"><span class="annottext">AReview e ()
forall r. AsEscrowError r =&gt; Prism' r ()
</span><a href="Plutus.Contracts.SimpleEscrow.html#_RefundFailed"><span class="hs-identifier hs-var">_RefundFailed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621680995110"><span id="local-6989586621680995112"><span id="local-6989586621680995114"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EscrowParams</span></span></span></span><span>
</span><span id="line-185"></span><span id="local-6989586621680995100"><span id="local-6989586621680995102"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EscrowParams</span></span></span><span>
</span><span id="line-186"></span><span id="local-6989586621680995090"><span id="local-6989586621680995092"><span id="local-6989586621680995094"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Action</span></span></span></span><span>
</span><span id="line-187"></span><span id="local-6989586621680995086"><span id="local-6989586621680995088"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Action</span></span></span><span>
</span><span id="line-188"></span></pre></body></html>