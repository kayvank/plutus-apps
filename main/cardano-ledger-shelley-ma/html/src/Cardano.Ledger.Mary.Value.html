<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Mary.Value</span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier">AssetName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#insert"><span class="hs-identifier">insert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#lookup"><span class="hs-identifier">lookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#policies"><span class="hs-identifier">policies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#prune"><span class="hs-identifier">prune</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier">representationSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#showValue"><span class="hs-identifier">showValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier">valueFromList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#gettriples%27"><span class="hs-identifier">gettriples'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">Cardano.Binary</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">Decoder</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">DecoderError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">Encoding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">FromCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">ToCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">TokenType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">decodeInteger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">decodeWord64</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">fromCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier">peekTokenType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier">toCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier">Cardano.Crypto.Hash.Class</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hash</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">CompactForm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">integerToWord64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Crypto</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-shelley/html/src"><span class="hs-identifier">Cardano.Ledger.Shelley.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">DecodeMint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">DecodeNonNegative</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">EncodeMint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">Control.DeepSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">deepseq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier">rwhnf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forM_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.ST</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">runST</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../base16-bytestring/html/src"><span class="hs-identifier">Data.ByteString.Base16</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS16</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Char8</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS8</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Short</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Short.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">ShortByteString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">SBS</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">Data.CanonicalMaps</span></a></span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">canonicalMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">canonicalMapUnion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">pointWise</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">Data.Coders</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">Decode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">Encode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">cborError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">decode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">decodeMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">encode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-identifier">encodeMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-operator">(!&gt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="../../../../cardano-data/html/src"><span class="hs-operator">(&lt;!)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">foldMap'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../groups/html/src"><span class="hs-identifier">Data.Group</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../groups/html/src"><span class="hs-identifier">Abelian</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../groups/html/src"><span class="hs-identifier">Group</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">sortOn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Internal</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">link</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">link2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">assocs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Map.Strict.Internal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">splitLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../primitive/html/src"><span class="hs-identifier">Data.Primitive.ByteArray</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Sum</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">decodeLatin1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Word</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word32</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Word64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">NoThunks.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">NoThunks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier">OnlyCheckWhnfNamed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">lookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- | Asset Name</span><span>
</span><span id="line-102"></span><span class="hs-keyword">newtype</span><span> </span><span id="AssetName"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AssetName"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span></span><span> </span><span class="hs-special">{</span><span id="assetName"><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetName"><span class="hs-identifier hs-var hs-var">assetName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">SBS.ShortByteString</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679229305"><span id="local-6989586621679229307"><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
(AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool) -&gt; Eq AssetName
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: AssetName -&gt; AssetName -&gt; Bool
$c/= :: AssetName -&gt; AssetName -&gt; Bool
== :: AssetName -&gt; AssetName -&gt; Bool
$c== :: AssetName -&gt; AssetName -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>      </span><span id="local-6989586621679229297"><span id="local-6989586621679229299"><span id="local-6989586621679229301"><span class="annot"><span class="annottext">Typeable AssetName
Typeable AssetName
-&gt; (AssetName -&gt; Encoding)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy AssetName -&gt; Size)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [AssetName] -&gt; Size)
-&gt; ToCBOR AssetName
AssetName -&gt; Encoding
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [AssetName] -&gt; Size
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy AssetName -&gt; Size
forall a.
Typeable a
-&gt; (a -&gt; Encoding)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; ToCBOR a
encodedListSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [AssetName] -&gt; Size
$cencodedListSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [AssetName] -&gt; Size
encodedSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy AssetName -&gt; Size
$cencodedSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy AssetName -&gt; Size
toCBOR :: AssetName -&gt; Encoding
$ctoCBOR :: AssetName -&gt; Encoding
$cp1ToCBOR :: Typeable AssetName
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToCBOR</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>      </span><span id="local-6989586621679229281"><span id="local-6989586621679229283"><span id="local-6989586621679229285"><span id="local-6989586621679229287"><span id="local-6989586621679229289"><span id="local-6989586621679229291"><span id="local-6989586621679229293"><span class="annot"><span class="annottext">Eq AssetName
Eq AssetName
-&gt; (AssetName -&gt; AssetName -&gt; Ordering)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; AssetName)
-&gt; (AssetName -&gt; AssetName -&gt; AssetName)
-&gt; Ord AssetName
AssetName -&gt; AssetName -&gt; Bool
AssetName -&gt; AssetName -&gt; Ordering
AssetName -&gt; AssetName -&gt; AssetName
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: AssetName -&gt; AssetName -&gt; AssetName
$cmin :: AssetName -&gt; AssetName -&gt; AssetName
max :: AssetName -&gt; AssetName -&gt; AssetName
$cmax :: AssetName -&gt; AssetName -&gt; AssetName
&gt;= :: AssetName -&gt; AssetName -&gt; Bool
$c&gt;= :: AssetName -&gt; AssetName -&gt; Bool
&gt; :: AssetName -&gt; AssetName -&gt; Bool
$c&gt; :: AssetName -&gt; AssetName -&gt; Bool
&lt;= :: AssetName -&gt; AssetName -&gt; Bool
$c&lt;= :: AssetName -&gt; AssetName -&gt; Bool
&lt; :: AssetName -&gt; AssetName -&gt; Bool
$c&lt; :: AssetName -&gt; AssetName -&gt; Bool
compare :: AssetName -&gt; AssetName -&gt; Ordering
$ccompare :: AssetName -&gt; AssetName -&gt; Ordering
$cp1Ord :: Eq AssetName
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>      </span><span id="local-6989586621679229274"><span id="local-6989586621679229276"><span id="local-6989586621679229278"><span class="annot"><span class="annottext">Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
Proxy AssetName -&gt; String
(Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy AssetName -&gt; String)
-&gt; NoThunks AssetName
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy AssetName -&gt; String
$cshowTypeOf :: Proxy AssetName -&gt; String
wNoThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
</span><a href="../../../../nothunks/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621679229271"><span class="annot"><span class="annottext">AssetName -&gt; ()
(AssetName -&gt; ()) -&gt; NFData AssetName
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: AssetName -&gt; ()
$crnf :: AssetName -&gt; ()
</span><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229265"><span id="local-6989586621679229268"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621679229263"><span class="annot"><span class="annottext">show :: AssetName -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">BS8.unpack</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; String)
-&gt; (AssetName -&gt; ByteString) -&gt; AssetName -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../base16-bytestring/html/src"><span class="hs-identifier hs-var">BS16.encode</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (AssetName -&gt; ByteString) -&gt; AssetName -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS.fromShort</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; ByteString)
-&gt; (AssetName -&gt; ShortByteString) -&gt; AssetName -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetName"><span class="hs-identifier hs-var hs-var">assetName</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229254"><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-type">FromCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621679229252"><span class="annot"><span class="annottext">fromCBOR :: Decoder s AssetName
</span><a href="#local-6989586621679229252"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679229251"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679229251"><span class="hs-identifier hs-var">an</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s ShortByteString
forall a s. FromCBOR a =&gt; Decoder s a
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">fromCBOR</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679229251"><span class="hs-identifier hs-var">an</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-keyword">then</span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><span class="annottext">DecoderError -&gt; Decoder s AssetName
forall e s a. Buildable e =&gt; e -&gt; Decoder s a
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">cborError</span></a></span><span> </span><span class="annot"><span class="annottext">(DecoderError -&gt; Decoder s AssetName)
-&gt; DecoderError -&gt; Decoder s AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-120"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; DecoderError
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">DecoderErrorCustom</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;asset name exceeds 32 bytes:&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; DecoderError) -&gt; Text -&gt; DecoderError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../../../../text/html/src"><span class="hs-identifier hs-var">decodeLatin1</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../base16-bytestring/html/src"><span class="hs-identifier hs-var">BS16.encode</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS.fromShort</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679229251"><span class="hs-identifier hs-var">an</span></a></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; Decoder s AssetName
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Decoder s AssetName)
-&gt; AssetName -&gt; Decoder s AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; AssetName
</span><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679229251"><span class="hs-identifier hs-var">an</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | Policy ID</span><span>
</span><span id="line-125"></span><span class="hs-keyword">newtype</span><span> </span><span id="PolicyID"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-var">PolicyID</span></a></span></span><span> </span><span id="local-6989586621679229396"><span class="annot"><a href="#local-6989586621679229396"><span class="hs-identifier hs-type">crypto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PolicyID"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-var">PolicyID</span></a></span></span><span> </span><span class="hs-special">{</span><span id="policyID"><span class="annot"><span class="annottext">PolicyID crypto -&gt; ScriptHash crypto
</span><a href="Cardano.Ledger.Mary.Value.html#policyID"><span class="hs-identifier hs-var hs-var">policyID</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229396"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679229240"><span id="local-6989586621679229242"><span id="local-6989586621679229244"><span class="annot"><span class="annottext">Int -&gt; PolicyID crypto -&gt; ShowS
[PolicyID crypto] -&gt; ShowS
PolicyID crypto -&gt; String
(Int -&gt; PolicyID crypto -&gt; ShowS)
-&gt; (PolicyID crypto -&gt; String)
-&gt; ([PolicyID crypto] -&gt; ShowS)
-&gt; Show (PolicyID crypto)
forall crypto. Int -&gt; PolicyID crypto -&gt; ShowS
forall crypto. [PolicyID crypto] -&gt; ShowS
forall crypto. PolicyID crypto -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PolicyID crypto] -&gt; ShowS
$cshowList :: forall crypto. [PolicyID crypto] -&gt; ShowS
show :: PolicyID crypto -&gt; String
$cshow :: forall crypto. PolicyID crypto -&gt; String
showsPrec :: Int -&gt; PolicyID crypto -&gt; ShowS
$cshowsPrec :: forall crypto. Int -&gt; PolicyID crypto -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679229236"><span id="local-6989586621679229238"><span class="annot"><span class="annottext">PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
(PolicyID crypto -&gt; PolicyID crypto -&gt; Bool)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; Bool)
-&gt; Eq (PolicyID crypto)
forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
$c/= :: forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
== :: PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
$c== :: forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679229229"><span id="local-6989586621679229231"><span id="local-6989586621679229233"><span class="annot"><span class="annottext">Typeable (PolicyID crypto)
Typeable (PolicyID crypto)
-&gt; (PolicyID crypto -&gt; Encoding)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy (PolicyID crypto) -&gt; Size)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [PolicyID crypto] -&gt; Size)
-&gt; ToCBOR (PolicyID crypto)
PolicyID crypto -&gt; Encoding
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [PolicyID crypto] -&gt; Size
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (PolicyID crypto) -&gt; Size
forall a.
Typeable a
-&gt; (a -&gt; Encoding)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; ToCBOR a
forall crypto. Crypto crypto =&gt; Typeable (PolicyID crypto)
forall crypto. Crypto crypto =&gt; PolicyID crypto -&gt; Encoding
forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [PolicyID crypto] -&gt; Size
forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (PolicyID crypto) -&gt; Size
encodedListSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [PolicyID crypto] -&gt; Size
$cencodedListSizeExpr :: forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [PolicyID crypto] -&gt; Size
encodedSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (PolicyID crypto) -&gt; Size
$cencodedSizeExpr :: forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (PolicyID crypto) -&gt; Size
toCBOR :: PolicyID crypto -&gt; Encoding
$ctoCBOR :: forall crypto. Crypto crypto =&gt; PolicyID crypto -&gt; Encoding
$cp1ToCBOR :: forall crypto. Crypto crypto =&gt; Typeable (PolicyID crypto)
</span><a href="#local-6989586621679229229"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToCBOR</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679229224"><span id="local-6989586621679229226"><span class="annot"><span class="annottext">Typeable (PolicyID crypto)
Decoder s (PolicyID crypto)
Typeable (PolicyID crypto)
-&gt; (forall s. Decoder s (PolicyID crypto))
-&gt; (Proxy (PolicyID crypto) -&gt; Text)
-&gt; FromCBOR (PolicyID crypto)
Proxy (PolicyID crypto) -&gt; Text
forall s. Decoder s (PolicyID crypto)
forall a.
Typeable a
-&gt; (forall s. Decoder s a) -&gt; (Proxy a -&gt; Text) -&gt; FromCBOR a
forall crypto. Crypto crypto =&gt; Typeable (PolicyID crypto)
forall crypto. Crypto crypto =&gt; Proxy (PolicyID crypto) -&gt; Text
forall crypto s. Crypto crypto =&gt; Decoder s (PolicyID crypto)
label :: Proxy (PolicyID crypto) -&gt; Text
$clabel :: forall crypto. Crypto crypto =&gt; Proxy (PolicyID crypto) -&gt; Text
fromCBOR :: Decoder s (PolicyID crypto)
$cfromCBOR :: forall crypto s. Crypto crypto =&gt; Decoder s (PolicyID crypto)
$cp1FromCBOR :: forall crypto. Crypto crypto =&gt; Typeable (PolicyID crypto)
</span><a href="#local-6989586621679229224"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">FromCBOR</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679229209"><span id="local-6989586621679229211"><span id="local-6989586621679229213"><span id="local-6989586621679229215"><span id="local-6989586621679229217"><span id="local-6989586621679229219"><span id="local-6989586621679229221"><span class="annot"><span class="annottext">Eq (PolicyID crypto)
Eq (PolicyID crypto)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; Ordering)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; Bool)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; Bool)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; Bool)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; Bool)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto)
-&gt; (PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto)
-&gt; Ord (PolicyID crypto)
PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
PolicyID crypto -&gt; PolicyID crypto -&gt; Ordering
PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto
forall crypto. Eq (PolicyID crypto)
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Ordering
forall crypto.
PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto
min :: PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto
$cmin :: forall crypto.
PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto
max :: PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto
$cmax :: forall crypto.
PolicyID crypto -&gt; PolicyID crypto -&gt; PolicyID crypto
&gt;= :: PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
$c&gt;= :: forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
&gt; :: PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
$c&gt; :: forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
&lt;= :: PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
$c&lt;= :: forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
&lt; :: PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
$c&lt; :: forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Bool
compare :: PolicyID crypto -&gt; PolicyID crypto -&gt; Ordering
$ccompare :: forall crypto. PolicyID crypto -&gt; PolicyID crypto -&gt; Ordering
$cp1Ord :: forall crypto. Eq (PolicyID crypto)
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679229203"><span id="local-6989586621679229205"><span id="local-6989586621679229207"><span class="annot"><span class="annottext">Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo)
Proxy (PolicyID crypto) -&gt; String
(Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (PolicyID crypto) -&gt; String)
-&gt; NoThunks (PolicyID crypto)
forall crypto. Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo)
forall crypto. Proxy (PolicyID crypto) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy (PolicyID crypto) -&gt; String
$cshowTypeOf :: forall crypto. Proxy (PolicyID crypto) -&gt; String
wNoThunks :: Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall crypto. Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: forall crypto. Context -&gt; PolicyID crypto -&gt; IO (Maybe ThunkInfo)
</span><a href="#local-6989586621679229203"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679229201"><span class="annot"><span class="annottext">PolicyID crypto -&gt; ()
(PolicyID crypto -&gt; ()) -&gt; NFData (PolicyID crypto)
forall crypto. PolicyID crypto -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: PolicyID crypto -&gt; ()
$crnf :: forall crypto. PolicyID crypto -&gt; ()
</span><a href="#local-6989586621679229201"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | The Value representing MultiAssets</span><span>
</span><span id="line-129"></span><span id="local-6989586621679229199"><span id="local-6989586621679229200"></span></span><span class="hs-keyword">data</span><span> </span><span id="Value"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span></span><span> </span><span id="local-6989586621679229596"><span class="annot"><a href="#local-6989586621679229596"><span class="hs-identifier hs-type">crypto</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Value"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229596"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679229192"><span id="local-6989586621679229194"><span id="local-6989586621679229196"><span class="annot"><span class="annottext">Int -&gt; Value crypto -&gt; ShowS
[Value crypto] -&gt; ShowS
Value crypto -&gt; String
(Int -&gt; Value crypto -&gt; ShowS)
-&gt; (Value crypto -&gt; String)
-&gt; ([Value crypto] -&gt; ShowS)
-&gt; Show (Value crypto)
forall crypto. Int -&gt; Value crypto -&gt; ShowS
forall crypto. [Value crypto] -&gt; ShowS
forall crypto. Value crypto -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Value crypto] -&gt; ShowS
$cshowList :: forall crypto. [Value crypto] -&gt; ShowS
show :: Value crypto -&gt; String
$cshow :: forall crypto. Value crypto -&gt; String
showsPrec :: Int -&gt; Value crypto -&gt; ShowS
$cshowsPrec :: forall crypto. Int -&gt; Value crypto -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. Value crypto -&gt; Rep (Value crypto) x)
-&gt; (forall x. Rep (Value crypto) x -&gt; Value crypto)
-&gt; Generic (Value crypto)
forall x. Rep (Value crypto) x -&gt; Value crypto
forall x. Value crypto -&gt; Rep (Value crypto) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall crypto x. Rep (Value crypto) x -&gt; Value crypto
forall crypto x. Value crypto -&gt; Rep (Value crypto) x
$cto :: forall crypto x. Rep (Value crypto) x -&gt; Value crypto
$cfrom :: forall crypto x. Value crypto -&gt; Rep (Value crypto) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span id="local-6989586621679229188"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229185"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229188"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229188"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-133"></span><span>  </span><span id="local-6989586621679229184"><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679229184"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679229183"><span class="annot"><span class="annottext">== :: Value crypto -&gt; Value crypto -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></a></span></span><span> </span><span id="local-6989586621679229182"><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679229182"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool)
-&gt; Value crypto -&gt; Value crypto -&gt; Bool
forall t. Val t =&gt; (Integer -&gt; Integer -&gt; Bool) -&gt; t -&gt; t -&gt; Bool
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">pointwise</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">(==)</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679229184"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679229182"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span id="local-6989586621679229180"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229180"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621679229178"><span class="annot"><span class="annottext">rnf :: Value crypto -&gt; ()
</span><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229176"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229176"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229175"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229175"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229176"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; () -&gt; ()
forall a b. NFData a =&gt; a -&gt; b -&gt; b
</span><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-operator hs-var">`deepseq`</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-var">rnf</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229175"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span id="local-6989586621679229174"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229168"><span id="local-6989586621679229170"><span id="local-6989586621679229172"><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier hs-type">NoThunks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229174"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span id="local-6989586621679229167"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229162"><span id="local-6989586621679229164"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229167"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229160"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229160"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229159"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229159"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679229158"><span class="annot"><span class="annottext">&lt;&gt; :: Value crypto -&gt; Value crypto -&gt; Value crypto
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229157"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229157"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621679229156"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229156"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229160"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229157"><span class="hs-identifier hs-var">c1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer
 -&gt; Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">canonicalMapUnion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer)
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">canonicalMapUnion</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(+)</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229159"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229156"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span id="local-6989586621679229154"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229148"><span id="local-6989586621679229150"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229154"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>  </span><span id="local-6989586621679229146"><span class="annot"><span class="annottext">mempty :: Value crypto
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="local-6989586621679229145"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229139"><span id="local-6989586621679229141"><span class="annot"><a href="../../../../groups/html/src"><span class="hs-identifier hs-type">Group</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229145"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621679229137"><span class="annot"><span class="annottext">invert :: Value crypto -&gt; Value crypto
</span><a href="../../../../groups/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">invert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229135"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229135"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229134"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229134"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229135"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229134"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span id="local-6989586621679229132"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../groups/html/src"><span class="hs-identifier hs-type">Abelian</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229132"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">-- ===================================================</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- Make the Val instance of Value</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span id="local-6989586621679229129"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679229120"><span id="local-6989586621679229123"><span id="local-6989586621679229125"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229129"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229129"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679229109"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679229109"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679229108"><span class="annot"><span class="annottext">&lt;&#215;&gt; :: i -&gt; Value crypto -&gt; Value crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&#215;&gt;</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229106"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229106"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229105"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229105"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">i -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679229109"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229106"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">i -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679229109"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229105"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621679229104"><span class="annot"><span class="annottext">isZero :: Value crypto -&gt; Bool
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">isZero</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229102"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229102"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229101"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229101"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229102"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229101"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621679229098"><span class="annot"><span class="annottext">coin :: Value crypto -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">coin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229096"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229096"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229096"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621679229094"><span class="annot"><span class="annottext">inject :: Coin -&gt; Value crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621679229092"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229092"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229092"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span id="local-6989586621679229091"><span class="annot"><span class="annottext">modifyCoin :: (Coin -&gt; Coin) -&gt; Value crypto -&gt; Value crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">modifyCoin</span></a></span></span><span> </span><span id="local-6989586621679229089"><span class="annot"><span class="annottext">Coin -&gt; Coin
</span><a href="#local-6989586621679229089"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229088"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229088"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229087"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229087"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229086"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229087"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621679229086"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229086"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin
</span><a href="#local-6989586621679229089"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229088"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621679229085"><span class="annot"><span class="annottext">pointwise :: (Integer -&gt; Integer -&gt; Bool)
-&gt; Value crypto -&gt; Value crypto -&gt; Bool
</span><a href="#local-6989586621679229085"><span class="hs-identifier hs-var hs-var hs-var hs-var">pointwise</span></a></span></span><span> </span><span id="local-6989586621679229084"><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679229084"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229083"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229083"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229082"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229082"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229081"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229081"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621679229080"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229080"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679229084"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229083"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229081"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer -&gt; Bool)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Bool
forall k v.
(Ord k, CanonicalZero v) =&gt;
(v -&gt; v -&gt; Bool) -&gt; Map k v -&gt; Map k v -&gt; Bool
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">pointWise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer -&gt; Bool
forall k v.
(Ord k, CanonicalZero v) =&gt;
(v -&gt; v -&gt; Bool) -&gt; Map k v -&gt; Map k v -&gt; Bool
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">pointWise</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679229084"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229082"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229080"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-comment">-- returns the size, in Word64's, of the CompactValue representation of Value</span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621679229079"><span class="annot"><span class="annottext">size :: Value crypto -&gt; Integer
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">size</span></a></span></span><span> </span><span id="local-6989586621679229077"><span class="annot"><span class="annottext">vv :: Value crypto
</span><a href="#local-6989586621679229077"><span class="hs-identifier hs-var">vv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679229076"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229076"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- when Value contains only ada</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- !WARNING! This branch is INCORRECT in the Mary era and should ONLY be</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- used in the Alonzo ERA.</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- TODO - find a better way to reconcile the mistakes in Mary with what needs</span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- to be the case in Alonzo.</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229076"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- when Value contains ada as well as other tokens</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- sums up :</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">-- i) adaWords : the space taken up by the ada amount</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- ii) numberMulAssets : the space taken by number of words used to store</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-comment">--    number of non-ada assets in a value</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-comment">-- iii) the space taken up by the rest of the representation (quantities,</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-comment">--    PIDs, AssetNames, indeces)</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#roundupBytesToWords"><span class="hs-identifier hs-var">roundupBytesToWords</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)] -&gt; Int
forall crypto.
Crypto crypto =&gt;
[(PolicyID crypto, AssetName, Integer)] -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier hs-var">representationSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer, [(PolicyID crypto, AssetName, Integer)])
-&gt; [(PolicyID crypto, AssetName, Integer)]
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Integer, [(PolicyID crypto, AssetName, Integer)])
 -&gt; [(PolicyID crypto, AssetName, Integer)])
-&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
-&gt; [(PolicyID crypto, AssetName, Integer)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto -&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
forall crypto.
Value crypto -&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var">gettriples</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679229077"><span class="hs-identifier hs-var">vv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>              </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#repOverhead"><span class="hs-identifier hs-var">repOverhead</span></a></span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621679229072"><span class="annot"><span class="annottext">isAdaOnly :: Value crypto -&gt; Bool
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">isAdaOnly</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679229070"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229070"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229070"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621679229069"><span class="annot"><span class="annottext">isAdaOnlyCompact :: CompactForm (Value crypto) -&gt; Bool
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">isAdaOnlyCompact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621679229064"><span class="annot"><span class="annottext">injectCompact :: CompactForm Coin -&gt; CompactForm (Value crypto)
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">injectCompact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; CompactForm (Value crypto)
forall crypto. CompactValue crypto -&gt; CompactForm (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactValue crypto -&gt; CompactForm (Value crypto))
-&gt; (CompactForm Coin -&gt; CompactValue crypto)
-&gt; CompactForm Coin
-&gt; CompactForm (Value crypto)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactValue crypto
forall crypto. CompactForm Coin -&gt; CompactValue crypto
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- space (in Word64s) taken up by the ada amount</span><span>
</span><span id="line-199"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#adaWords"><span class="hs-identifier hs-type">adaWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-200"></span><span id="adaWords"><span class="annot"><span class="annottext">adaWords :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#adaWords"><span class="hs-identifier hs-var hs-var">adaWords</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="hs-comment">-- 64 bit machine Word64 length</span><span>
</span><span id="line-203"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-type">wordLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-204"></span><span id="wordLength"><span class="annot"><span class="annottext">wordLength :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-var hs-var">wordLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">-- overhead in MA compact rep</span><span>
</span><span id="line-207"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#repOverhead"><span class="hs-identifier hs-type">repOverhead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-208"></span><span id="repOverhead"><span class="annot"><span class="annottext">repOverhead :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#repOverhead"><span class="hs-identifier hs-var hs-var">repOverhead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#adaWords"><span class="hs-identifier hs-var">adaWords</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#numberMulAssets"><span class="hs-identifier hs-var">numberMulAssets</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- number of words used to store number of MAs in a value</span><span>
</span><span id="line-211"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#numberMulAssets"><span class="hs-identifier hs-type">numberMulAssets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-212"></span><span id="numberMulAssets"><span class="annot"><span class="annottext">numberMulAssets :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#numberMulAssets"><span class="hs-identifier hs-var hs-var">numberMulAssets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- converts bytes to words (rounding up)</span><span>
</span><span id="line-215"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#roundupBytesToWords"><span class="hs-identifier hs-type">roundupBytesToWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-216"></span><span id="roundupBytesToWords"><span class="annot"><span class="annottext">roundupBytesToWords :: Int -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#roundupBytesToWords"><span class="hs-identifier hs-var hs-var">roundupBytesToWords</span></a></span></span><span> </span><span id="local-6989586621679229059"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679229059"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">quot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679229059"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-var">wordLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-var">wordLength</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- ==============================================================</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- CBOR</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- TODO filter out 0s at deserialization</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- TODO Probably the actual serialization will be of the formal Coin OR Value type</span><span>
</span><span id="line-223"></span><span class="hs-comment">-- Maybe better to make this distinction in the TxOut de/serialization</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span id="local-6989586621679229502"><span id="local-6989586621679229503"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeValue"><span class="hs-identifier hs-type">decodeValue</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229503"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229502"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229503"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-228"></span><span id="decodeValue"><span class="annot"><span class="annottext">decodeValue :: Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValue"><span class="hs-identifier hs-var hs-var">decodeValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621679229056"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229056"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s TokenType
forall s. Decoder s TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">peekTokenType</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229056"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeUInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value crypto
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Value crypto)
-&gt; (Integer -&gt; Coin) -&gt; Integer -&gt; Value crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value crypto)
-&gt; Decoder s Integer -&gt; Decoder s (Value crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-232"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeUInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value crypto
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Value crypto)
-&gt; (Integer -&gt; Coin) -&gt; Integer -&gt; Value crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value crypto)
-&gt; Decoder s Integer -&gt; Decoder s (Value crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeNInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value crypto
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Value crypto)
-&gt; (Integer -&gt; Coin) -&gt; Integer -&gt; Value crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value crypto)
-&gt; Decoder s Integer -&gt; Decoder s (Value crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeNInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value crypto
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Value crypto)
-&gt; (Integer -&gt; Coin) -&gt; Integer -&gt; Value crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value crypto)
-&gt; Decoder s Integer -&gt; Decoder s (Value crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeListLen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
forall crypto s.
Crypto crypto =&gt;
(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeListLen64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
forall crypto s.
Crypto crypto =&gt;
(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeListLenIndef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
forall crypto s.
Crypto crypto =&gt;
(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s (Value crypto)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s (Value crypto))
-&gt; String -&gt; Decoder s (Value crypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Value: expected array or int, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229056"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span id="local-6989586621679229551"><span id="local-6989586621679229552"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-type">decodeValuePair</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-241"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229552"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679229046"><span class="annot"><a href="#local-6989586621679229046"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229046"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229551"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229552"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-244"></span><span id="decodeValuePair"><span class="annot"><span class="annottext">decodeValuePair :: (forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var hs-var">decodeValuePair</span></a></span></span><span> </span><span id="local-6989586621679229045"><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="#local-6989586621679229045"><span class="hs-identifier hs-var">decodeAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="annottext">Decode ('Closed 'Dense) (Value crypto) -&gt; Decoder s (Value crypto)
forall (w :: Wrapped) t s. Decode w t -&gt; Decoder s t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">(Decode ('Closed 'Dense) (Value crypto)
 -&gt; Decoder s (Value crypto))
-&gt; Decode ('Closed 'Dense) (Value crypto)
-&gt; Decoder s (Value crypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">(Integer
 -&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
-&gt; Decode
     ('Closed 'Dense)
     (Integer
      -&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
forall t. t -&gt; Decode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">RecD</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span>
</span><span id="line-247"></span><span>      </span><span class="annot"><span class="annottext">Decode
  ('Closed 'Dense)
  (Integer
   -&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
-&gt; Decode ('Closed 'Dense) Integer
-&gt; Decode
     ('Closed 'Dense)
     (Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
forall (w1 :: Wrapped) a t (w :: Density).
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Integer) -&gt; Decode ('Closed 'Dense) Integer
forall t. (forall s. Decoder s t) -&gt; Decode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="#local-6989586621679229045"><span class="hs-identifier hs-var">decodeAmount</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span class="annot"><span class="annottext">Decode
  ('Closed 'Dense)
  (Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
-&gt; Decode
     ('Closed 'Dense) (Map (PolicyID crypto) (Map AssetName Integer))
-&gt; Decode ('Closed 'Dense) (Value crypto)
forall (w1 :: Wrapped) a t (w :: Density).
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">(forall s.
 Decoder s (Map (PolicyID crypto) (Map AssetName Integer)))
-&gt; Decode
     ('Closed 'Dense) (Map (PolicyID crypto) (Map AssetName Integer))
forall t. (forall s. Decoder s t) -&gt; Decode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decoder s Integer
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
forall crypto s.
Crypto crypto =&gt;
Decoder s Integer
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAssetMaps"><span class="hs-identifier hs-var">decodeMultiAssetMaps</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="#local-6989586621679229045"><span class="hs-identifier hs-var">decodeAmount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span id="local-6989586621679229506"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#encodeMultiAssetMaps"><span class="hs-identifier hs-type">encodeMultiAssetMaps</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229506"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229506"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Encoding</span></a></span></span><span>
</span><span id="line-254"></span><span id="encodeMultiAssetMaps"><span class="annot"><span class="annottext">encodeMultiAssetMaps :: Map (PolicyID crypto) (Map AssetName Integer) -&gt; Encoding
</span><a href="Cardano.Ledger.Mary.Value.html#encodeMultiAssetMaps"><span class="hs-identifier hs-var hs-var">encodeMultiAssetMaps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PolicyID crypto -&gt; Encoding)
-&gt; (Map AssetName Integer -&gt; Encoding)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Encoding
forall a b.
(a -&gt; Encoding) -&gt; (b -&gt; Encoding) -&gt; Map a b -&gt; Encoding
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">encodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto -&gt; Encoding
forall a. ToCBOR a =&gt; a -&gt; Encoding
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(AssetName -&gt; Encoding)
-&gt; (Integer -&gt; Encoding) -&gt; Map AssetName Integer -&gt; Encoding
forall a b.
(a -&gt; Encoding) -&gt; (b -&gt; Encoding) -&gt; Map a b -&gt; Encoding
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">encodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; Encoding
forall a. ToCBOR a =&gt; a -&gt; Encoding
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Encoding
forall a. ToCBOR a =&gt; a -&gt; Encoding
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span id="local-6989586621679229529"><span id="local-6989586621679229530"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAssetMaps"><span class="hs-identifier hs-type">decodeMultiAssetMaps</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229530"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229529"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229529"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229530"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-260"></span><span id="decodeMultiAssetMaps"><span class="annot"><span class="annottext">decodeMultiAssetMaps :: Decoder s Integer
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAssetMaps"><span class="hs-identifier hs-var hs-var">decodeMultiAssetMaps</span></a></span></span><span> </span><span id="local-6989586621679229040"><span class="annot"><span class="annottext">Decoder s Integer
</span><a href="#local-6989586621679229040"><span class="hs-identifier hs-var">decodeAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall crypto.
Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="Cardano.Ledger.Mary.Value.html#prune"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (PolicyID crypto) (Map AssetName Integer)
 -&gt; Map (PolicyID crypto) (Map AssetName Integer))
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s (PolicyID crypto)
-&gt; Decoder s (Map AssetName Integer)
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
forall a s b.
Ord a =&gt;
Decoder s a -&gt; Decoder s b -&gt; Decoder s (Map a b)
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">decodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s (PolicyID crypto)
forall a s. FromCBOR a =&gt; Decoder s a
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">fromCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decoder s AssetName
-&gt; Decoder s Integer -&gt; Decoder s (Map AssetName Integer)
forall a s b.
Ord a =&gt;
Decoder s a -&gt; Decoder s b -&gt; Decoder s (Map a b)
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">decodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s AssetName
forall a s. FromCBOR a =&gt; Decoder s a
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">fromCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
</span><a href="#local-6989586621679229040"><span class="hs-identifier hs-var">decodeAmount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span id="local-6989586621679229039"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeInteger"><span class="hs-identifier hs-type">decodeNonNegativeInteger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229039"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span></span><span>
</span><span id="line-264"></span><span id="decodeNonNegativeInteger"><span class="annot"><span class="annottext">decodeNonNegativeInteger :: Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeInteger"><span class="hs-identifier hs-var hs-var">decodeNonNegativeInteger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Integer) -&gt; Decoder s Word64 -&gt; Decoder s Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Word64
forall s. Decoder s Word64
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeWord64</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span id="local-6989586621679229036"><span id="local-6989586621679229037"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeValue"><span class="hs-identifier hs-type">decodeNonNegativeValue</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229037"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229036"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229037"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-269"></span><span id="decodeNonNegativeValue"><span class="annot"><span class="annottext">decodeNonNegativeValue :: Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeValue"><span class="hs-identifier hs-var hs-var">decodeNonNegativeValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621679229034"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229034"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s TokenType
forall s. Decoder s TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">peekTokenType</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229034"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeUInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value crypto
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Value crypto)
-&gt; (Integer -&gt; Coin) -&gt; Integer -&gt; Value crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value crypto)
-&gt; Decoder s Integer -&gt; Decoder s (Value crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeInteger"><span class="hs-identifier hs-var">decodeNonNegativeInteger</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeUInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value crypto
forall t. Val t =&gt; Coin -&gt; t
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Value crypto)
-&gt; (Integer -&gt; Coin) -&gt; Integer -&gt; Value crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value crypto)
-&gt; Decoder s Integer -&gt; Decoder s (Value crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeInteger"><span class="hs-identifier hs-var">decodeNonNegativeInteger</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeListLen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
forall crypto s.
Crypto crypto =&gt;
(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeInteger"><span class="hs-identifier hs-var">decodeNonNegativeInteger</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeListLen64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
forall crypto s.
Crypto crypto =&gt;
(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeInteger"><span class="hs-identifier hs-var">decodeNonNegativeInteger</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeListLenIndef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
forall crypto s.
Crypto crypto =&gt;
(forall s. Decoder s Integer) -&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="annot"><span class="annottext">forall s. Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeInteger"><span class="hs-identifier hs-var">decodeNonNegativeInteger</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s (Value crypto)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s (Value crypto))
-&gt; String -&gt; Decoder s (Value crypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Value: expected array or int, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229034"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span id="local-6989586621679229033"><span class="hs-keyword">instance</span><span>
</span><span id="line-280"></span><span>  </span><span id="local-6989586621679229027"><span id="local-6989586621679229029"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229033"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-type">ToCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229033"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-282"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621679229026"><span class="annot"><span class="annottext">toCBOR :: Value crypto -&gt; Encoding
</span><a href="#local-6989586621679229026"><span class="hs-identifier hs-var hs-var hs-var hs-var">toCBOR</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679229025"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229025"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679229024"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229024"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229024"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-285"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Encoding
forall a. ToCBOR a =&gt; a -&gt; Encoding
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229025"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><span class="annottext">Encode ('Closed 'Dense) (Value crypto) -&gt; Encoding
forall (w :: Wrapped) t. Encode w t -&gt; Encoding
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Encode ('Closed 'Dense) (Value crypto) -&gt; Encoding)
-&gt; Encode ('Closed 'Dense) (Value crypto) -&gt; Encoding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><span class="annottext">(Integer
 -&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
-&gt; Encode
     ('Closed 'Dense)
     (Integer
      -&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
forall t. t -&gt; Encode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span>
</span><span id="line-289"></span><span>            </span><span class="annot"><span class="annottext">Encode
  ('Closed 'Dense)
  (Integer
   -&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
-&gt; Encode ('Closed 'Dense) Integer
-&gt; Encode
     ('Closed 'Dense)
     (Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Encode ('Closed 'Dense) Integer
forall t. ToCBOR t =&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">To</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229025"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-290"></span><span>            </span><span class="annot"><span class="annottext">Encode
  ('Closed 'Dense)
  (Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
-&gt; Encode
     ('Closed 'Dense) (Map (PolicyID crypto) (Map AssetName Integer))
-&gt; Encode ('Closed 'Dense) (Value crypto)
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="../../../../cardano-data/html/src"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (PolicyID crypto) (Map AssetName Integer) -&gt; Encoding)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Encode
     ('Closed 'Dense) (Map (PolicyID crypto) (Map AssetName Integer))
forall t. (t -&gt; Encoding) -&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="../../../../cardano-data/html/src"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; Encoding
forall crypto.
Crypto crypto =&gt;
Map (PolicyID crypto) (Map AssetName Integer) -&gt; Encoding
</span><a href="Cardano.Ledger.Mary.Value.html#encodeMultiAssetMaps"><span class="hs-identifier hs-var">encodeMultiAssetMaps</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679229024"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span id="local-6989586621679229020"><span class="hs-keyword">instance</span><span>
</span><span id="line-293"></span><span>  </span><span id="local-6989586621679229016"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229020"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-type">FromCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229020"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>  </span><span id="local-6989586621679229015"><span class="annot"><span class="annottext">fromCBOR :: Decoder s (Value crypto)
</span><a href="#local-6989586621679229015"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decoder s (Value crypto)
forall crypto s. Crypto crypto =&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValue"><span class="hs-identifier hs-var">decodeValue</span></a></span></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span id="local-6989586621679229014"><span class="hs-keyword">instance</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229014"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">DecodeNonNegative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229014"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679229011"><span class="annot"><span class="annottext">decodeNonNegative :: Decoder s (Value crypto)
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">decodeNonNegative</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decoder s (Value crypto)
forall crypto s. Crypto crypto =&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeValue"><span class="hs-identifier hs-var">decodeNonNegativeValue</span></a></span></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="local-6989586621679229009"><span class="hs-keyword">instance</span><span>
</span><span id="line-305"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229009"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">DecodeMint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229009"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>  </span><span id="local-6989586621679229006"><span class="annot"><span class="annottext">decodeMint :: Decoder s (Value crypto)
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">decodeMint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto)
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
-&gt; Decoder s (Value crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
forall crypto s.
Crypto crypto =&gt;
Decoder s Integer
-&gt; Decoder s (Map (PolicyID crypto) (Map AssetName Integer))
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAssetMaps"><span class="hs-identifier hs-var">decodeMultiAssetMaps</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeIntegerBounded64"><span class="hs-identifier hs-var">decodeIntegerBounded64</span></a></span></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">-- Note: we do not use `decodeInt64` from the cborg library here because the</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- implementation contains &quot;-- TODO FIXME: overflow&quot;</span><span>
</span><span id="line-312"></span><span id="local-6989586621679229003"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeIntegerBounded64"><span class="hs-identifier hs-type">decodeIntegerBounded64</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../cborg/html/src"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229003"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span></span><span>
</span><span id="line-313"></span><span id="decodeIntegerBounded64"><span class="annot"><span class="annottext">decodeIntegerBounded64 :: Decoder s Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeIntegerBounded64"><span class="hs-identifier hs-var hs-var">decodeIntegerBounded64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>  </span><span id="local-6989586621679229002"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229002"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s TokenType
forall s. Decoder s TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">peekTokenType</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679229002"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeUInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeUInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeNInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">TypeNInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Decoder s ()
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expected major type 0 or 1 when decoding mint field&quot;</span></span><span>
</span><span id="line-321"></span><span>  </span><span id="local-6989586621679229001"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229001"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall s. Decoder s Integer
</span><a href="../../../../cborg/html/src"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229001"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229000"><span class="hs-identifier hs-var">minval</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229001"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228998"><span class="hs-identifier hs-var">maxval</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Decoder s Integer
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229001"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-325"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Decoder s Integer
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Decoder s Integer) -&gt; String -&gt; Decoder s Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-327"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;overflow when decoding mint field. min value: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-328"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229000"><span class="hs-identifier hs-var">minval</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; max value: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-330"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228998"><span class="hs-identifier hs-var">maxval</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-331"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; got: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-332"></span><span>            </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679229001"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-333"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621679228998"><span class="annot"><span class="annottext">maxval :: Integer
</span><a href="#local-6989586621679228998"><span class="hs-identifier hs-var hs-var">maxval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span id="local-6989586621679229000"><span class="annot"><span class="annottext">minval :: Integer
</span><a href="#local-6989586621679229000"><span class="hs-identifier hs-var hs-var">minval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Int64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span id="local-6989586621679228994"><span class="hs-keyword">instance</span><span>
</span><span id="line-339"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228994"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">EncodeMint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228994"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-342"></span><span>  </span><span id="local-6989586621679228991"><span class="annot"><span class="annottext">encodeMint :: Value crypto -&gt; Encoding
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">encodeMint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679228989"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228989"><span class="hs-identifier hs-var">multiasset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; Encoding
forall crypto.
Crypto crypto =&gt;
Map (PolicyID crypto) (Map AssetName Integer) -&gt; Encoding
</span><a href="Cardano.Ledger.Mary.Value.html#encodeMultiAssetMaps"><span class="hs-identifier hs-var">encodeMultiAssetMaps</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228989"><span class="hs-identifier hs-var">multiasset</span></a></span></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-comment">-- ========================================================================</span><span>
</span><span id="line-345"></span><span class="hs-comment">-- Compactible</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- This is used in the TxOut which stores the (CompactForm Value).</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span id="local-6989586621679228988"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228988"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228988"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">newtype</span><span> </span><span id="CompactForm"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">CompactForm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228988"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompactValue"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228988"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679228978"><span id="local-6989586621679228980"><span class="annot"><span class="annottext">CompactForm (Value crypto) -&gt; CompactForm (Value crypto) -&gt; Bool
(CompactForm (Value crypto) -&gt; CompactForm (Value crypto) -&gt; Bool)
-&gt; (CompactForm (Value crypto)
    -&gt; CompactForm (Value crypto) -&gt; Bool)
-&gt; Eq (CompactForm (Value crypto))
forall crypto.
Crypto crypto =&gt;
CompactForm (Value crypto) -&gt; CompactForm (Value crypto) -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: CompactForm (Value crypto) -&gt; CompactForm (Value crypto) -&gt; Bool
$c/= :: forall crypto.
Crypto crypto =&gt;
CompactForm (Value crypto) -&gt; CompactForm (Value crypto) -&gt; Bool
== :: CompactForm (Value crypto) -&gt; CompactForm (Value crypto) -&gt; Bool
$c== :: forall crypto.
Crypto crypto =&gt;
CompactForm (Value crypto) -&gt; CompactForm (Value crypto) -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228972"><span id="local-6989586621679228974"><span id="local-6989586621679228976"><span class="annot"><span class="annottext">Int -&gt; CompactForm (Value crypto) -&gt; ShowS
[CompactForm (Value crypto)] -&gt; ShowS
CompactForm (Value crypto) -&gt; String
(Int -&gt; CompactForm (Value crypto) -&gt; ShowS)
-&gt; (CompactForm (Value crypto) -&gt; String)
-&gt; ([CompactForm (Value crypto)] -&gt; ShowS)
-&gt; Show (CompactForm (Value crypto))
forall crypto. Int -&gt; CompactForm (Value crypto) -&gt; ShowS
forall crypto. [CompactForm (Value crypto)] -&gt; ShowS
forall crypto. CompactForm (Value crypto) -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CompactForm (Value crypto)] -&gt; ShowS
$cshowList :: forall crypto. [CompactForm (Value crypto)] -&gt; ShowS
show :: CompactForm (Value crypto) -&gt; String
$cshow :: forall crypto. CompactForm (Value crypto) -&gt; String
showsPrec :: Int -&gt; CompactForm (Value crypto) -&gt; ShowS
$cshowsPrec :: forall crypto. Int -&gt; CompactForm (Value crypto) -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228966"><span id="local-6989586621679228968"><span id="local-6989586621679228970"><span class="annot"><span class="annottext">Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo)
Proxy (CompactForm (Value crypto)) -&gt; String
(Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (CompactForm (Value crypto)) -&gt; String)
-&gt; NoThunks (CompactForm (Value crypto))
forall crypto.
Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo)
forall crypto. Proxy (CompactForm (Value crypto)) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
showTypeOf :: Proxy (CompactForm (Value crypto)) -&gt; String
$cshowTypeOf :: forall crypto. Proxy (CompactForm (Value crypto)) -&gt; String
wNoThunks :: Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall crypto.
Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo)
$cnoThunks :: forall crypto.
Context -&gt; CompactForm (Value crypto) -&gt; IO (Maybe ThunkInfo)
</span><a href="#local-6989586621679228966"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228959"><span id="local-6989586621679228961"><span id="local-6989586621679228963"><span class="annot"><span class="annottext">Typeable (CompactForm (Value crypto))
Typeable (CompactForm (Value crypto))
-&gt; (CompactForm (Value crypto) -&gt; Encoding)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy (CompactForm (Value crypto)) -&gt; Size)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [CompactForm (Value crypto)] -&gt; Size)
-&gt; ToCBOR (CompactForm (Value crypto))
CompactForm (Value crypto) -&gt; Encoding
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [CompactForm (Value crypto)] -&gt; Size
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (CompactForm (Value crypto)) -&gt; Size
forall a.
Typeable a
-&gt; (a -&gt; Encoding)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. ToCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; ToCBOR a
forall crypto.
Crypto crypto =&gt;
Typeable (CompactForm (Value crypto))
forall crypto.
Crypto crypto =&gt;
CompactForm (Value crypto) -&gt; Encoding
forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [CompactForm (Value crypto)] -&gt; Size
forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (CompactForm (Value crypto)) -&gt; Size
encodedListSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [CompactForm (Value crypto)] -&gt; Size
$cencodedListSizeExpr :: forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [CompactForm (Value crypto)] -&gt; Size
encodedSizeExpr :: (forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (CompactForm (Value crypto)) -&gt; Size
$cencodedSizeExpr :: forall crypto.
Crypto crypto =&gt;
(forall t. ToCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (CompactForm (Value crypto)) -&gt; Size
toCBOR :: CompactForm (Value crypto) -&gt; Encoding
$ctoCBOR :: forall crypto.
Crypto crypto =&gt;
CompactForm (Value crypto) -&gt; Encoding
$cp1ToCBOR :: forall crypto.
Crypto crypto =&gt;
Typeable (CompactForm (Value crypto))
</span><a href="#local-6989586621679228959"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToCBOR</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228954"><span id="local-6989586621679228956"><span class="annot"><span class="annottext">Typeable (CompactForm (Value crypto))
Decoder s (CompactForm (Value crypto))
Typeable (CompactForm (Value crypto))
-&gt; (forall s. Decoder s (CompactForm (Value crypto)))
-&gt; (Proxy (CompactForm (Value crypto)) -&gt; Text)
-&gt; FromCBOR (CompactForm (Value crypto))
Proxy (CompactForm (Value crypto)) -&gt; Text
forall s. Decoder s (CompactForm (Value crypto))
forall a.
Typeable a
-&gt; (forall s. Decoder s a) -&gt; (Proxy a -&gt; Text) -&gt; FromCBOR a
forall crypto.
Crypto crypto =&gt;
Typeable (CompactForm (Value crypto))
forall crypto.
Crypto crypto =&gt;
Proxy (CompactForm (Value crypto)) -&gt; Text
forall crypto s.
Crypto crypto =&gt;
Decoder s (CompactForm (Value crypto))
label :: Proxy (CompactForm (Value crypto)) -&gt; Text
$clabel :: forall crypto.
Crypto crypto =&gt;
Proxy (CompactForm (Value crypto)) -&gt; Text
fromCBOR :: Decoder s (CompactForm (Value crypto))
$cfromCBOR :: forall crypto s.
Crypto crypto =&gt;
Decoder s (CompactForm (Value crypto))
$cp1FromCBOR :: forall crypto.
Crypto crypto =&gt;
Typeable (CompactForm (Value crypto))
</span><a href="#local-6989586621679228954"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">FromCBOR</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228952"><span class="annot"><span class="annottext">CompactForm (Value crypto) -&gt; ()
(CompactForm (Value crypto) -&gt; ())
-&gt; NFData (CompactForm (Value crypto))
forall crypto. CompactForm (Value crypto) -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
rnf :: CompactForm (Value crypto) -&gt; ()
$crnf :: forall crypto. CompactForm (Value crypto) -&gt; ()
</span><a href="#local-6989586621679228952"><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>  </span><span id="local-6989586621679228951"><span class="annot"><span class="annottext">toCompact :: Value crypto -&gt; Maybe (CompactForm (Value crypto))
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">toCompact</span></a></span></span><span> </span><span id="local-6989586621679228949"><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228949"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; CompactForm (Value crypto)
forall crypto. CompactValue crypto -&gt; CompactForm (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactValue crypto -&gt; CompactForm (Value crypto))
-&gt; Maybe (CompactValue crypto)
-&gt; Maybe (CompactForm (Value crypto))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto -&gt; Maybe (CompactValue crypto)
forall crypto.
Crypto crypto =&gt;
Value crypto -&gt; Maybe (CompactValue crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228949"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-352"></span><span>  </span><span id="local-6989586621679228947"><span class="annot"><span class="annottext">fromCompact :: CompactForm (Value crypto) -&gt; Value crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromCompact</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span id="local-6989586621679228945"><span class="annot"><a href="#local-6989586621679228945"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; Value crypto
forall crypto. Crypto crypto =&gt; CompactValue crypto -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue crypto
</span><a href="#local-6989586621679228945"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span id="local-6989586621679228943"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679228937"><span id="local-6989586621679228939"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228943"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-type">ToCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228943"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621679228936"><span class="annot"><span class="annottext">toCBOR :: CompactValue crypto -&gt; Encoding
</span><a href="#local-6989586621679228936"><span class="hs-identifier hs-var hs-var hs-var hs-var">toCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value crypto -&gt; Encoding
forall a. ToCBOR a =&gt; a -&gt; Encoding
</span><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-var">toCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">(Value crypto -&gt; Encoding)
-&gt; (CompactValue crypto -&gt; Value crypto)
-&gt; CompactValue crypto
-&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; Value crypto
forall crypto. Crypto crypto =&gt; CompactValue crypto -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span></span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span id="local-6989586621679228935"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679228931"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228935"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../cardano-binary/html/src"><span class="hs-identifier hs-type">FromCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228935"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-358"></span><span>  </span><span id="local-6989586621679228930"><span class="annot"><span class="annottext">fromCBOR :: Decoder s (CompactValue crypto)
</span><a href="#local-6989586621679228930"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621679228929"><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228929"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s (Value crypto)
forall crypto s. Crypto crypto =&gt; Decoder s (Value crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#decodeNonNegativeValue"><span class="hs-identifier hs-var">decodeNonNegativeValue</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value crypto -&gt; Maybe (CompactValue crypto)
forall crypto.
Crypto crypto =&gt;
Value crypto -&gt; Maybe (CompactValue crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228929"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">Maybe (CompactValue crypto)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; Decoder s (CompactValue crypto)
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fail</span></a></span><span>
</span><span id="line-363"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible failure: decoded nonnegative value that cannot be compacted&quot;</span></span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679228928"><span class="annot"><span class="annottext">CompactValue crypto
</span><a href="#local-6989586621679228928"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; Decoder s (CompactValue crypto)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue crypto
</span><a href="#local-6989586621679228928"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-keyword">data</span><span> </span><span id="CompactValue"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span></span><span> </span><span id="local-6989586621679229562"><span class="annot"><a href="#local-6989586621679229562"><span class="hs-identifier hs-type">crypto</span></a></span></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CompactValueAdaOnly"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CompactValueMultiAsset"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-var">CompactValueMultiAsset</span></a></span></span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ada</span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word32</span></a></span><span> </span><span class="hs-comment">-- number of ma's</span><span>
</span><span id="line-371"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-comment">-- rep</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679228922"><span id="local-6989586621679228924"><span id="local-6989586621679228926"><span class="annot"><span class="annottext">Int -&gt; CompactValue crypto -&gt; ShowS
[CompactValue crypto] -&gt; ShowS
CompactValue crypto -&gt; String
(Int -&gt; CompactValue crypto -&gt; ShowS)
-&gt; (CompactValue crypto -&gt; String)
-&gt; ([CompactValue crypto] -&gt; ShowS)
-&gt; Show (CompactValue crypto)
forall crypto. Int -&gt; CompactValue crypto -&gt; ShowS
forall crypto. [CompactValue crypto] -&gt; ShowS
forall crypto. CompactValue crypto -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [CompactValue crypto] -&gt; ShowS
$cshowList :: forall crypto. [CompactValue crypto] -&gt; ShowS
show :: CompactValue crypto -&gt; String
$cshow :: forall crypto. CompactValue crypto -&gt; String
showsPrec :: Int -&gt; CompactValue crypto -&gt; ShowS
$cshowsPrec :: forall crypto. Int -&gt; CompactValue crypto -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span id="local-6989586621679228921"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228921"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>  </span><span id="local-6989586621679228919"><span class="annot"><span class="annottext">rnf :: CompactValue crypto -&gt; ()
</span><a href="#local-6989586621679228919"><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; ()
forall a. a -&gt; ()
</span><a href="../../../../ghc/html/libraries/deepseq-1.4.4.0/src"><span class="hs-identifier hs-var">rwhnf</span></a></span></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span id="local-6989586621679228918"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679228915"><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228918"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228918"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621679228914"><span class="annot"><span class="annottext">CompactValue crypto
</span><a href="#local-6989586621679228914"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679228913"><span class="annot"><span class="annottext">== :: CompactValue crypto -&gt; CompactValue crypto -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></a></span></span><span> </span><span id="local-6989586621679228912"><span class="annot"><span class="annottext">CompactValue crypto
</span><a href="#local-6989586621679228912"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; Value crypto
forall crypto. Crypto crypto =&gt; CompactValue crypto -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue crypto
</span><a href="#local-6989586621679228914"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto -&gt; Value crypto -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; Value crypto
forall crypto. Crypto crypto =&gt; CompactValue crypto -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue crypto
</span><a href="#local-6989586621679228912"><span class="hs-identifier hs-var">b</span></a></span></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span id="local-6989586621679228906"><span id="local-6989586621679228908"><span id="local-6989586621679228910"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679228905"><span class="hs-keyword">via</span><span>
</span><span id="line-381"></span><span>  </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier hs-type">OnlyCheckWhnfNamed</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CompactValue&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228905"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">instance</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><a href="../../../../nothunks/html/src"><span class="hs-identifier hs-type">NoThunks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228905"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">{-
The Value surface type uses a nested map. For the compact version we use a
flattened representation, equivalent to a list of triples:
  [(PolicyID, AssetName, Quantity)]

Example:
  [ (&quot;0xa519f84e...&quot;, &quot;&quot;,       42)  -- empty asset name
  , (&quot;0xf820a82c...&quot;, &quot;Snark&quot;,  1)
  , (&quot;0xf820a82c...&quot;, &quot;Boojum&quot;, 1)   -- shared policy id, different name
  ]

We start by sorting in /descending/ order by asset name. Note that descending
order puts empty strings last:
  [ (&quot;0xf820a82c...&quot;, &quot;Snark&quot;,  1)
  , (&quot;0xf820a82c...&quot;, &quot;Boojum&quot;, 1)
  , (&quot;0xa519f84e...&quot;, &quot;&quot;,      42)
  ]

This example will be serialised as:
  &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;
A)&#9475;             1 &#9475;             1 &#9475;            42 &#9475; Word64 quantities
  &#9507;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9531;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9531;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;
B)&#9475; 36&#9475; 36&#9475; 64&#9475;                                     Word16 policyId offsets
  &#9507;&#9473;&#9473;&#9473;&#9547;&#9473;&#9473;&#9473;&#9547;&#9473;&#9473;&#9473;&#9515;
C)&#9475; 92&#9475; 98&#9475;103&#9475;                                     Word16 asset name offsets
  &#9507;&#9473;&#9519;&#9473;&#9543;&#9473;&#9519;&#9473;&#9543;&#9473;&#9519;&#9473;&#9543;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9491;
D)&#9475;f820a82c.. &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9475; 28 byte policyId #1
  &#9507;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9515;
  &#9475;a519f84e.. &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9475; 28 byte policyId #2
  &#9507;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9544;&#9473;&#9544;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9499;
E)&#9475;S&#9482;n&#9482;a&#9482;r&#9482;k&#9482;B&#9482;o&#9482;o&#9482;j&#9482;u&#9482;m&#9475;&#9664;&#9538;&#9472;padding to word size    Asset names, plus padding
  &#9495;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9531;&#9473;&#9499;
   &#9650;         &#9650;           &#9650;
   92-offset 97-offset   103-offset, end of string

Note that the asset name offsets end up sorted in ascending order, with empty
asset names pointing to the offset past the end of the concatenated names.

The serialised representation consists of five parts, concatenated together:
  A) A sequence of Word64s representing asset quantities.

  B) A sequence of Word16s representing policyId string offsets within D.
     We do not need to store a length because policyIds are fixed size.

  C) A sequence of Word16s representing asset name string offsets within E.
     We store only the starting offset and not a end offset or length. We can
     do this because we keep the assets in A,B,C sorted by the asset name, so
     the offsets in C are sorted. This means the next distinct entry gives the
     (exclusive) end offset of the asset name string. As a special case for
     empty asset names, the index points to the end of the string E.

     Note: If there are duplicate asset names, this can yield a sequence of
     multiple of the same offset. For example, if the assets are named
     &quot;Snark&quot;,&quot;Snark&quot;,&quot;Boojum&quot;, region E would contain &quot;SnarkBoojum&quot;,
     and region C would contain 92, 92, 97. For the decoder to determine the
     length of the first asset, it would subtract 92 from 97 (and not from the
     duplicate 92).

  D) a blob of policyIDs, without duplicates, concatenated.

  E) a blob of asset names, sorted, without duplicates, concatenated.

The size of the regions A,B,C are known based on the number of values. The
string offsets in B and C are relative to the whole of the representation, not
relative to the start of D &amp; E (since D is variable size depending on whether
there were duplicate policyIDs)

The encoding strategy is
 - Collect all (unique) policy Ids.
 - Collect all (unique) asset names.
 - Determine the sizes of the regions and allocate them.
   - size A = 8 * numassets
   - size B = 2 * numassets
   - size C = 2 * numassets
   - size D = length (concat policyIds)
   - size E = length (concat assetNames)
   - sum = 12*numassets
         + length (concat policyIds)
         + length (concat assetNames)
 - Write the policyIds to region D
 - Write the asset names to region E
 - For each asset entry
   - Locate the corresponding asset name and policyId
   - Write quantity, policyId location, and asset name location to corresponding
     regions
   - For the special case of 0 length asset names, the location is the end of
     region E

The decoding strategy is
 - Use length information to determine the beginnings of regions A,B,C
   (We do not need to do this for regions D and E because the policyId
   and asset name locations are relative to the beginning of entire rep.)
 - For each integer in 0..(numassets -1)
   - Read corresponding quantity, pid offset, and asset name offset from regions
     A, B, and C, respectively.
   - Read (pid length) bytes from pid offset. assume it points into region D
   - Determine asset name lengths using the difference between the offset and
     the next greater offset (if it exists). If there is no next greater offset,
     use the difference from the end of the rep. (Note: for the special case of
     0 length asset names, this calculation results in 0 because we are
     subtracting the end of the rep from itself.)
   - Read (asset name length) bytes from asset name offset. assume it points
     into region E.
 -}</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679229474"><span class="annot"><a href="#local-6989586621679229474"><span class="hs-identifier hs-type">crypto</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229474"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-493"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229474"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-comment">-- The Nothing case of the return value corresponds to a quantity that is outside</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-comment">-- the bounds of a Word64. x &lt; 0 or x &gt; (2^64 - 1)</span><span>
</span><span id="line-496"></span><span>  </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229474"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span id="to"><span class="annot"><span class="annottext">to :: Value crypto -&gt; Maybe (CompactValue crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var hs-var">to</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679228904"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228904"><span class="hs-identifier hs-var">ada</span></a></span></span><span> </span><span id="local-6989586621679228903"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228903"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228903"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactValue crypto
forall crypto. CompactForm Coin -&gt; CompactValue crypto
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; CompactValue crypto)
-&gt; (Word64 -&gt; CompactForm Coin) -&gt; Word64 -&gt; CompactValue crypto
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; CompactForm Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">CompactCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; CompactValue crypto)
-&gt; Maybe Word64 -&gt; Maybe (CompactValue crypto)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Word64
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">integerToWord64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228904"><span class="hs-identifier hs-var">ada</span></a></span><span>
</span><span id="line-500"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span id="local-6989586621679228901"><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228901"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-501"></span><span>  </span><span id="local-6989586621679228900"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228900"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Word64
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">integerToWord64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228899"><span class="hs-identifier hs-var">ada</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-comment">-- Here we convert the (pid, assetName, quantity) triples into</span><span>
</span><span id="line-503"></span><span>  </span><span class="hs-comment">-- (Int, (Word16,Word16,Word64))</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-comment">-- These represent the index, pid offset, asset name offset, and quantity.</span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-comment">-- If any of the quantities out of bounds, this will produce Nothing.</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-comment">-- The triples are ordered by asset name in descending order.</span><span>
</span><span id="line-507"></span><span>  </span><span id="local-6989586621679228898"><span class="annot"><span class="annottext">[(Int, (Word16, Word16, Word64))]
</span><a href="#local-6989586621679228898"><span class="hs-identifier hs-var">preparedTriples</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-508"></span><span>    </span><span class="annot"><span class="annottext">[Int]
-&gt; [(Word16, Word16, Word64)] -&gt; [(Int, (Word16, Word16, Word64))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([(Word16, Word16, Word64)] -&gt; [(Int, (Word16, Word16, Word64))])
-&gt; ([(Word16, Word16, Word64)] -&gt; [(Word16, Word16, Word64)])
-&gt; [(Word16, Word16, Word64)]
-&gt; [(Int, (Word16, Word16, Word64))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Word16, Word16, Word64) -&gt; Word16)
-&gt; [(Word16, Word16, Word64)] -&gt; [(Word16, Word16, Word64)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sortOn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228897"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228897"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228897"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Word16, Word16, Word64)] -&gt; [(Int, (Word16, Word16, Word64))])
-&gt; Maybe [(Word16, Word16, Word64)]
-&gt; Maybe [(Int, (Word16, Word16, Word64))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((PolicyID crypto, AssetName, Integer)
 -&gt; Maybe (Word16, Word16, Word64))
-&gt; [(PolicyID crypto, AssetName, Integer)]
-&gt; Maybe [(Word16, Word16, Word64)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyID crypto, AssetName, Integer)
-&gt; Maybe (Word16, Word16, Word64)
</span><a href="#local-6989586621679228895"><span class="hs-identifier hs-var">prepare</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228894"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-509"></span><span>  </span><span class="annot"><span class="annottext">CompactValue crypto -&gt; Maybe (CompactValue crypto)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactValue crypto -&gt; Maybe (CompactValue crypto))
-&gt; CompactValue crypto -&gt; Maybe (CompactValue crypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><span class="annottext">CompactForm Coin
-&gt; Word32 -&gt; ShortByteString -&gt; CompactValue crypto
forall crypto.
CompactForm Coin
-&gt; Word32 -&gt; ShortByteString -&gt; CompactValue crypto
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-var">CompactValueMultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; CompactForm Coin
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">CompactCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228900"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228893"><span class="hs-identifier hs-var">numTriples</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; CompactValue crypto)
-&gt; ShortByteString -&gt; CompactValue crypto
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-511"></span><span>      </span><span class="annot"><span class="annottext">(forall s. ST s ShortByteString) -&gt; ShortByteString
forall a. (forall s. ST s a) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">runST</span></a></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s ShortByteString) -&gt; ShortByteString)
-&gt; (forall s. ST s ShortByteString) -&gt; ShortByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-512"></span><span>        </span><span id="local-6989586621679228892"><span class="annot"><span class="annottext">MutableByteArray s
</span><a href="#local-6989586621679228892"><span class="hs-identifier hs-var">byteArray</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MutableByteArray (PrimState (ST s)))
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; m (MutableByteArray (PrimState m))
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.newByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228890"><span class="hs-identifier hs-var">repSize</span></a></span><span>
</span><span id="line-513"></span><span>        </span><span class="annot"><span class="annottext">[(Int, (Word16, Word16, Word64))]
-&gt; ((Int, (Word16, Word16, Word64)) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, (Word16, Word16, Word64))]
</span><a href="#local-6989586621679228898"><span class="hs-identifier hs-var">preparedTriples</span></a></span><span> </span><span class="annot"><span class="annottext">(((Int, (Word16, Word16, Word64)) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((Int, (Word16, Word16, Word64)) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679228889"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228889"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679228888"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228888"><span class="hs-identifier hs-var">pidoff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228887"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228887"><span class="hs-identifier hs-var">anoff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228886"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228886"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-514"></span><span>          </span><span class="hs-keyword">do</span><span>
</span><span id="line-515"></span><span>            </span><span class="hs-comment">-- For each triple, we write the quantity to region A,</span><span>
</span><span id="line-516"></span><span>            </span><span class="hs-comment">-- the pid offset to region B, and the asset name offset to region C.</span><span>
</span><span id="line-517"></span><span>            </span><span class="hs-comment">-- We can calculate the sizes (and therefore the starts) of each region</span><span>
</span><span id="line-518"></span><span>            </span><span class="hs-comment">-- using the number of triples.</span><span>
</span><span id="line-519"></span><span>            </span><span class="hs-comment">-- A:</span><span>
</span><span id="line-520"></span><span>            </span><span class="hs-comment">--   size: (#triples * 8) bytes</span><span>
</span><span id="line-521"></span><span>            </span><span class="hs-comment">--   start: offset 0</span><span>
</span><span id="line-522"></span><span>            </span><span class="hs-comment">-- B:</span><span>
</span><span id="line-523"></span><span>            </span><span class="hs-comment">--   size: (#triples * 2) bytes</span><span>
</span><span id="line-524"></span><span>            </span><span class="hs-comment">--   start: size(A) = #triples * 8</span><span>
</span><span id="line-525"></span><span>            </span><span class="hs-comment">-- C:</span><span>
</span><span id="line-526"></span><span>            </span><span class="hs-comment">--   size: (#triples * 2) bytes</span><span>
</span><span id="line-527"></span><span>            </span><span class="hs-comment">--   start: size(A) + size(B) = #triples * 10</span><span>
</span><span id="line-528"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-529"></span><span>            </span><span class="hs-comment">-- The position argument to writeByteArray is an index in terms of the</span><span>
</span><span id="line-530"></span><span>            </span><span class="hs-comment">-- size of the value being written. So writeByteArray of a Word64 at</span><span>
</span><span id="line-531"></span><span>            </span><span class="hs-comment">-- position 1 writes at offset 8.</span><span>
</span><span id="line-532"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-533"></span><span>            </span><span class="hs-comment">-- For the following, the byte offsets calculated above are converted to</span><span>
</span><span id="line-534"></span><span>            </span><span class="hs-comment">-- ByteArray positions by division.</span><span>
</span><span id="line-535"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-536"></span><span>            </span><span class="hs-comment">-- The byte offset of the ith...</span><span>
</span><span id="line-537"></span><span>            </span><span class="hs-comment">--   quantity: 8i</span><span>
</span><span id="line-538"></span><span>            </span><span class="hs-comment">--   pid offset: 8n + 2i</span><span>
</span><span id="line-539"></span><span>            </span><span class="hs-comment">--   asset name offset: 8n + 2n + 2i</span><span>
</span><span id="line-540"></span><span>            </span><span class="hs-comment">-- Dividing by the respective sizes (8,2,2) yields the indices below.</span><span>
</span><span id="line-541"></span><span>            </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; Int -&gt; Word64 -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679228892"><span class="hs-identifier hs-var">byteArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228889"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228886"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-542"></span><span>            </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; Int -&gt; Word16 -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679228892"><span class="hs-identifier hs-var">byteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228893"><span class="hs-identifier hs-var">numTriples</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228889"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228888"><span class="hs-identifier hs-var">pidoff</span></a></span><span>
</span><span id="line-543"></span><span>            </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; Int -&gt; Word16 -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679228892"><span class="hs-identifier hs-var">byteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228893"><span class="hs-identifier hs-var">numTriples</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228889"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228887"><span class="hs-identifier hs-var">anoff</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><span class="annottext">[(PolicyID crypto, Word16)]
-&gt; ((PolicyID crypto, Word16) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (PolicyID crypto) Word16 -&gt; [(PolicyID crypto, Word16)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) Word16
</span><a href="#local-6989586621679228883"><span class="hs-identifier hs-var">pidOffsetMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((PolicyID crypto, Word16) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((PolicyID crypto, Word16) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-546"></span><span>          </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span id="local-6989586621679228881"><span class="annot"><span class="annottext">Hash (ADDRHASH crypto) EraIndependentScript
</span><a href="#local-6989586621679228881"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228880"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228880"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-547"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228879"><span class="annot"><span class="annottext">pidBytes :: ShortByteString
</span><a href="#local-6989586621679228879"><span class="hs-identifier hs-var hs-var">pidBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash (ADDRHASH crypto) EraIndependentScript -&gt; ShortByteString
forall h a. Hash h a -&gt; ShortByteString
</span><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier hs-var">Hash.hashToBytesShort</span></a></span><span> </span><span class="annot"><span class="annottext">Hash (ADDRHASH crypto) EraIndependentScript
</span><a href="#local-6989586621679228881"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-548"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s))
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; m ()
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.copyByteArray</span></a></span><span>
</span><span id="line-549"></span><span>                  </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679228892"><span class="hs-identifier hs-var">byteArray</span></a></span><span>
</span><span id="line-550"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228880"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228879"><span class="hs-identifier hs-var">pidBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-553"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228875"><span class="hs-identifier hs-var">pidSize</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>        </span><span class="annot"><span class="annottext">[(AssetName, Word16)]
-&gt; ((AssetName, Word16) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map AssetName Word16 -&gt; [(AssetName, Word16)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Word16
</span><a href="#local-6989586621679228874"><span class="hs-identifier hs-var">assetNameOffsetMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((AssetName, Word16) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((AssetName, Word16) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-556"></span><span>          </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span id="local-6989586621679228873"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228873"><span class="hs-identifier hs-var">anameBS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228872"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228872"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-557"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228871"><span class="annot"><span class="annottext">anameBytes :: ShortByteString
</span><a href="#local-6989586621679228871"><span class="hs-identifier hs-var hs-var">anameBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228873"><span class="hs-identifier hs-var">anameBS</span></a></span><span>
</span><span id="line-558"></span><span>                </span><span id="local-6989586621679228870"><span class="annot"><span class="annottext">anameLen :: Int
</span><a href="#local-6989586621679228870"><span class="hs-identifier hs-var hs-var">anameLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228873"><span class="hs-identifier hs-var">anameBS</span></a></span><span>
</span><span id="line-559"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s))
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; m ()
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.copyByteArray</span></a></span><span>
</span><span id="line-560"></span><span>                  </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679228892"><span class="hs-identifier hs-var">byteArray</span></a></span><span>
</span><span id="line-561"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228872"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228871"><span class="hs-identifier hs-var">anameBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-563"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-564"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228870"><span class="hs-identifier hs-var">anameLen</span></a></span><span>
</span><span id="line-565"></span><span>        </span><span class="annot"><span class="annottext">ByteArray -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-var">byteArrayToSbs</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteArray -&gt; ShortByteString)
-&gt; ST s ByteArray -&gt; ST s ShortByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; ST s ByteArray
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m) -&gt; m ByteArray
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.unsafeFreezeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679228892"><span class="hs-identifier hs-var">byteArray</span></a></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679228899"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228899"><span class="hs-identifier hs-var">ada</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228894"><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228894"><span class="hs-identifier hs-var">triples</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value crypto -&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
forall crypto.
Value crypto -&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var">gettriples</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228901"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-568"></span><span>    </span><span id="local-6989586621679228893"><span class="annot"><span class="annottext">numTriples :: Int
</span><a href="#local-6989586621679228893"><span class="hs-identifier hs-var hs-var">numTriples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228894"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-569"></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-comment">-- abcRegionSize is the combined size of regions A, B, and C</span><span>
</span><span id="line-571"></span><span>    </span><span id="local-6989586621679228866"><span class="annot"><span class="annottext">abcRegionSize :: Int
</span><a href="#local-6989586621679228866"><span class="hs-identifier hs-var hs-var">abcRegionSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228893"><span class="hs-identifier hs-var">numTriples</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>    </span><span id="local-6989586621679228875"><span class="annot"><span class="annottext">pidSize :: Int
</span><a href="#local-6989586621679228875"><span class="hs-identifier hs-var hs-var">pidSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ADDRHASH crypto) -&gt; Word
forall h (proxy :: * -&gt; *). HashAlgorithm h =&gt; proxy h -&gt; Word
</span><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier hs-var">Hash.sizeHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ADDRHASH crypto)
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.ADDRHASH</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229474"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-comment">-- pids is the collection of all distinct pids</span><span>
</span><span id="line-576"></span><span>    </span><span id="local-6989586621679228863"><span class="annot"><span class="annottext">pids :: Set (PolicyID crypto)
</span><a href="#local-6989586621679228863"><span class="hs-identifier hs-var hs-var">pids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PolicyID crypto] -&gt; Set (PolicyID crypto)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([PolicyID crypto] -&gt; Set (PolicyID crypto))
-&gt; [PolicyID crypto] -&gt; Set (PolicyID crypto)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679228861"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228861"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228861"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID crypto, AssetName, Integer) -&gt; PolicyID crypto)
-&gt; [(PolicyID crypto, AssetName, Integer)] -&gt; [PolicyID crypto]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228894"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><a href="#local-6989586621679228883"><span class="hs-identifier hs-type">pidOffsetMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229474"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span id="local-6989586621679228883"><span class="annot"><span class="annottext">pidOffsetMap :: Map (PolicyID crypto) Word16
</span><a href="#local-6989586621679228883"><span class="hs-identifier hs-var hs-var">pidOffsetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-580"></span><span>      </span><span class="hs-comment">-- the pid offsets are:</span><span>
</span><span id="line-581"></span><span>      </span><span class="hs-comment">--   X, X + s, X + 2s, X + 3s, ...</span><span>
</span><span id="line-582"></span><span>      </span><span class="hs-comment">-- where X is the start of block D and s is the size of a pid</span><span>
</span><span id="line-583"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228860"><span class="annot"><span class="annottext">offsets :: [Word16]
</span><a href="#local-6989586621679228860"><span class="hs-identifier hs-var hs-var">offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-584"></span><span>            </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; [Word16]
forall a. Enum a =&gt; a -&gt; a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">enumFromThen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228866"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228866"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228875"><span class="hs-identifier hs-var">pidSize</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, Word16)] -&gt; Map (PolicyID crypto) Word16
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PolicyID crypto] -&gt; [Word16] -&gt; [(PolicyID crypto, Word16)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (PolicyID crypto) -&gt; [PolicyID crypto]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set (PolicyID crypto)
</span><a href="#local-6989586621679228863"><span class="hs-identifier hs-var">pids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621679228860"><span class="hs-identifier hs-var">offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span>    </span><span id="local-6989586621679228857"><span class="annot"><span class="annottext">pidOffset :: PolicyID crypto -&gt; Word16
</span><a href="#local-6989586621679228857"><span class="hs-identifier hs-var hs-var">pidOffset</span></a></span></span><span> </span><span id="local-6989586621679228856"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228856"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Word16 -&gt; Word16
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID crypto -&gt; Map (PolicyID crypto) Word16 -&gt; Maybe Word16
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228856"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) Word16
</span><a href="#local-6989586621679228883"><span class="hs-identifier hs-var">pidOffsetMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>    </span><span id="local-6989586621679228854"><span class="annot"><span class="annottext">pidBlockSize :: Int
</span><a href="#local-6989586621679228854"><span class="hs-identifier hs-var hs-var">pidBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (PolicyID crypto) -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set (PolicyID crypto)
</span><a href="#local-6989586621679228863"><span class="hs-identifier hs-var">pids</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228875"><span class="hs-identifier hs-var">pidSize</span></a></span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-comment">-- Putting asset names in descending order ensures that the empty string</span><span>
</span><span id="line-592"></span><span>    </span><span class="hs-comment">-- is last, so the associated offset is pointing to the end of the array</span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621679228852"><span class="annot"><span class="annottext">assetNames :: [AssetName]
</span><a href="#local-6989586621679228852"><span class="hs-identifier hs-var hs-var">assetNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set AssetName -&gt; [AssetName]
forall a. Set a -&gt; [a]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.toDescList</span></a></span><span> </span><span class="annot"><span class="annottext">(Set AssetName -&gt; [AssetName]) -&gt; Set AssetName -&gt; [AssetName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[AssetName] -&gt; Set AssetName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([AssetName] -&gt; Set AssetName) -&gt; [AssetName] -&gt; Set AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID crypto
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228850"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228850"><span class="hs-identifier hs-var">an</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228850"><span class="hs-identifier hs-var">an</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID crypto, AssetName, Integer) -&gt; AssetName)
-&gt; [(PolicyID crypto, AssetName, Integer)] -&gt; [AssetName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228894"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span>    </span><span id="local-6989586621679228849"><span class="annot"><span class="annottext">assetNameLengths :: [Int]
</span><a href="#local-6989586621679228849"><span class="hs-identifier hs-var hs-var">assetNameLengths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (AssetName -&gt; Int) -&gt; AssetName -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Int)
-&gt; (AssetName -&gt; ShortByteString) -&gt; AssetName -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetName"><span class="hs-identifier hs-var hs-var">assetName</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Int) -&gt; [AssetName] -&gt; [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[AssetName]
</span><a href="#local-6989586621679228852"><span class="hs-identifier hs-var">assetNames</span></a></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><a href="#local-6989586621679228874"><span class="hs-identifier hs-type">assetNameOffsetMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span id="local-6989586621679228874"><span class="annot"><span class="annottext">assetNameOffsetMap :: Map AssetName Word16
</span><a href="#local-6989586621679228874"><span class="hs-identifier hs-var hs-var">assetNameOffsetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-599"></span><span>      </span><span class="hs-comment">-- The asset name offsets are the running sum of the asset lengths,</span><span>
</span><span id="line-600"></span><span>      </span><span class="hs-comment">-- but starting with the offset of the start of block E.</span><span>
</span><span id="line-601"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228848"><span class="annot"><span class="annottext">offsets :: [Int]
</span><a href="#local-6989586621679228848"><span class="hs-identifier hs-var hs-var">offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; [Int] -&gt; [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">scanl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(+)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228866"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228854"><span class="hs-identifier hs-var">pidBlockSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679228849"><span class="hs-identifier hs-var">assetNameLengths</span></a></span><span>
</span><span id="line-602"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word16) -&gt; Map AssetName Int -&gt; Map AssetName Word16
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Int)] -&gt; Map AssetName Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AssetName] -&gt; [Int] -&gt; [(AssetName, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[AssetName]
</span><a href="#local-6989586621679228852"><span class="hs-identifier hs-var">assetNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679228848"><span class="hs-identifier hs-var">offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621679228846"><span class="annot"><span class="annottext">assetNameOffset :: AssetName -&gt; Word16
</span><a href="#local-6989586621679228846"><span class="hs-identifier hs-var hs-var">assetNameOffset</span></a></span></span><span> </span><span id="local-6989586621679228845"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228845"><span class="hs-identifier hs-var">aname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Word16 -&gt; Word16
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName -&gt; Map AssetName Word16 -&gt; Maybe Word16
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228845"><span class="hs-identifier hs-var">aname</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Word16
</span><a href="#local-6989586621679228874"><span class="hs-identifier hs-var">assetNameOffsetMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621679228844"><span class="annot"><span class="annottext">anameBlockSize :: Int
</span><a href="#local-6989586621679228844"><span class="hs-identifier hs-var hs-var">anameBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">sum</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679228849"><span class="hs-identifier hs-var">assetNameLengths</span></a></span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-comment">-- size = size(A+B+C)      + size(D)      + size(E)</span><span>
</span><span id="line-609"></span><span>    </span><span id="local-6989586621679228890"><span class="annot"><span class="annottext">repSize :: Int
</span><a href="#local-6989586621679228890"><span class="hs-identifier hs-var hs-var">repSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228866"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228854"><span class="hs-identifier hs-var">pidBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228844"><span class="hs-identifier hs-var">anameBlockSize</span></a></span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>    </span><span id="local-6989586621679228895"><span class="annot"><span class="annottext">prepare :: (PolicyID crypto, AssetName, Integer)
-&gt; Maybe (Word16, Word16, Word64)
</span><a href="#local-6989586621679228895"><span class="hs-identifier hs-var hs-var">prepare</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679228842"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228842"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228841"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228841"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228840"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228840"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-612"></span><span>      </span><span id="local-6989586621679228839"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228839"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Word64
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">integerToWord64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228840"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-613"></span><span>      </span><span class="annot"><span class="annottext">(Word16, Word16, Word64) -&gt; Maybe (Word16, Word16, Word64)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID crypto -&gt; Word16
</span><a href="#local-6989586621679228857"><span class="hs-identifier hs-var">pidOffset</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228842"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; Word16
</span><a href="#local-6989586621679228846"><span class="hs-identifier hs-var">assetNameOffset</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228841"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228839"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier hs-type">representationSize</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679229568"><span class="annot"><a href="#local-6989586621679229568"><span class="hs-identifier hs-type">crypto</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-617"></span><span>  </span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229568"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229568"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-619"></span><span>  </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-620"></span><span id="representationSize"><span class="annot"><span class="annottext">representationSize :: [(PolicyID crypto, AssetName, Integer)] -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier hs-var hs-var">representationSize</span></a></span></span><span> </span><span id="local-6989586621679228838"><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228838"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228837"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228836"><span class="hs-identifier hs-var">pidBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228835"><span class="hs-identifier hs-var">anameBlockSize</span></a></span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-622"></span><span>    </span><span id="local-6989586621679228834"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679228834"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228838"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-623"></span><span>    </span><span id="local-6989586621679228837"><span class="annot"><span class="annottext">abcRegionSize :: Int
</span><a href="#local-6989586621679228837"><span class="hs-identifier hs-var hs-var">abcRegionSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228834"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>    </span><span id="local-6989586621679228833"><span class="annot"><span class="annottext">numPids :: Int
</span><a href="#local-6989586621679228833"><span class="hs-identifier hs-var hs-var">numPids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (PolicyID crypto) -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (PolicyID crypto) -&gt; Int)
-&gt; ([PolicyID crypto] -&gt; Set (PolicyID crypto))
-&gt; [PolicyID crypto]
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[PolicyID crypto] -&gt; Set (PolicyID crypto)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([PolicyID crypto] -&gt; Int) -&gt; [PolicyID crypto] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679228832"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228832"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228832"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID crypto, AssetName, Integer) -&gt; PolicyID crypto)
-&gt; [(PolicyID crypto, AssetName, Integer)] -&gt; [PolicyID crypto]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228838"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-626"></span><span>    </span><span id="local-6989586621679228831"><span class="annot"><span class="annottext">pidSize :: Int
</span><a href="#local-6989586621679228831"><span class="hs-identifier hs-var hs-var">pidSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ADDRHASH crypto) -&gt; Word
forall h (proxy :: * -&gt; *). HashAlgorithm h =&gt; proxy h -&gt; Word
</span><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier hs-var">Hash.sizeHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ADDRHASH crypto)
forall k (t :: k). Proxy t
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.ADDRHASH</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229568"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>    </span><span id="local-6989586621679228836"><span class="annot"><span class="annottext">pidBlockSize :: Int
</span><a href="#local-6989586621679228836"><span class="hs-identifier hs-var hs-var">pidBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228833"><span class="hs-identifier hs-var">numPids</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228831"><span class="hs-identifier hs-var">pidSize</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span>    </span><span id="local-6989586621679228830"><span class="annot"><span class="annottext">assetNames :: Set AssetName
</span><a href="#local-6989586621679228830"><span class="hs-identifier hs-var hs-var">assetNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AssetName] -&gt; Set AssetName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([AssetName] -&gt; Set AssetName) -&gt; [AssetName] -&gt; Set AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID crypto
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228829"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228829"><span class="hs-identifier hs-var">an</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228829"><span class="hs-identifier hs-var">an</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID crypto, AssetName, Integer) -&gt; AssetName)
-&gt; [(PolicyID crypto, AssetName, Integer)] -&gt; [AssetName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228838"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-630"></span><span>    </span><span id="local-6989586621679228835"><span class="annot"><span class="annottext">anameBlockSize :: Int
</span><a href="#local-6989586621679228835"><span class="hs-identifier hs-var hs-var">anameBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-631"></span><span>      </span><span class="annot"><span class="annottext">Sum Int -&gt; Int
forall a. Sum a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">Semigroup.getSum</span></a></span><span> </span><span class="annot"><span class="annottext">(Sum Int -&gt; Int) -&gt; Sum Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Sum Int) -&gt; Set AssetName -&gt; Sum Int
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Sum Int
forall a. a -&gt; Sum a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Semigroup.Sum</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Sum Int) -&gt; (AssetName -&gt; Int) -&gt; AssetName -&gt; Sum Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Int)
-&gt; (AssetName -&gt; ShortByteString) -&gt; AssetName -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetName"><span class="hs-identifier hs-var hs-var">assetName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set AssetName
</span><a href="#local-6989586621679228830"><span class="hs-identifier hs-var">assetNames</span></a></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-type">from</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679229473"><span class="annot"><a href="#local-6989586621679229473"><span class="hs-identifier hs-type">crypto</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.Crypto</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229473"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229473"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229473"><span class="hs-identifier hs-type">crypto</span></a></span><span>
</span><span id="line-634"></span><span id="from"><span class="annot"><span class="annottext">from :: CompactValue crypto -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var hs-var">from</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679228826"><span class="annot"><a href="#local-6989586621679228826"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228826"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-635"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679228825"><span class="annot"><a href="#local-6989586621679228825"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679228824"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679228824"><span class="hs-identifier hs-var">numAssets</span></a></span></span><span> </span><span id="local-6989586621679228823"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228823"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-636"></span><span>  </span><span class="annot"><span class="annottext">Integer -&gt; [(PolicyID crypto, AssetName, Integer)] -&gt; Value crypto
forall era.
Integer -&gt; [(PolicyID era, AssetName, Integer)] -&gt; Value era
</span><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier hs-var">valueFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228825"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228822"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-638"></span><span>    </span><span id="local-6989586621679228821"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679228821"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679228824"><span class="hs-identifier hs-var">numAssets</span></a></span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span>    </span><span id="local-6989586621679228820"><span class="annot"><span class="annottext">ba :: ByteArray
</span><a href="#local-6989586621679228820"><span class="hs-identifier hs-var hs-var">ba</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228823"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><a href="#local-6989586621679228819"><span class="hs-identifier hs-type">getTripleForIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>    </span><span id="local-6989586621679228819"><span class="annot"><span class="annottext">getTripleForIndex :: Int -&gt; (Word16, Word16, Word64)
</span><a href="#local-6989586621679228819"><span class="hs-identifier hs-var hs-var">getTripleForIndex</span></a></span></span><span> </span><span id="local-6989586621679228818"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228818"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-644"></span><span>      </span><span class="hs-comment">-- indexByteArray indices are in terms of the size of the value being indexed</span><span>
</span><span id="line-645"></span><span>      </span><span class="hs-comment">-- rather than byte offsets.</span><span>
</span><span id="line-646"></span><span>      </span><span class="hs-comment">-- The corresponding byte offsets are:</span><span>
</span><span id="line-647"></span><span>      </span><span class="hs-comment">-- q: 0 + 8i</span><span>
</span><span id="line-648"></span><span>      </span><span class="hs-comment">-- pidix: 8n + 2i</span><span>
</span><span id="line-649"></span><span>      </span><span class="hs-comment">-- anameix: 8n + 2n + 2i</span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-comment">-- Dividing by the sized (resp 8,2,2) yields the indices below</span><span>
</span><span id="line-651"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228817"><span class="annot"><span class="annottext">q :: Word64
</span><a href="#local-6989586621679228817"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Word64
forall a. Prim a =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.indexByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621679228820"><span class="hs-identifier hs-var">ba</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228818"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-652"></span><span>          </span><span id="local-6989586621679228815"><span class="annot"><span class="annottext">pidix :: Word16
</span><a href="#local-6989586621679228815"><span class="hs-identifier hs-var hs-var">pidix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Word16
forall a. Prim a =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.indexByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621679228820"><span class="hs-identifier hs-var">ba</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228821"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228818"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-653"></span><span>          </span><span id="local-6989586621679228814"><span class="annot"><span class="annottext">anameix :: Word16
</span><a href="#local-6989586621679228814"><span class="hs-identifier hs-var hs-var">anameix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Word16
forall a. Prim a =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.indexByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621679228820"><span class="hs-identifier hs-var">ba</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228821"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228818"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228815"><span class="hs-identifier hs-var">pidix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228814"><span class="hs-identifier hs-var">anameix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228817"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>    </span><span class="hs-comment">-- raw triples :: [(pid offset, asset name offset, quantity)]</span><span>
</span><span id="line-657"></span><span>    </span><span class="annot"><a href="#local-6989586621679228813"><span class="hs-identifier hs-type">rawTriples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-658"></span><span>    </span><span id="local-6989586621679228813"><span class="annot"><span class="annottext">rawTriples :: [(Word16, Word16, Word64)]
</span><a href="#local-6989586621679228813"><span class="hs-identifier hs-var hs-var">rawTriples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Word16, Word16, Word64))
-&gt; [Int] -&gt; [(Word16, Word16, Word64)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Word16, Word16, Word64)
</span><a href="#local-6989586621679228819"><span class="hs-identifier hs-var">getTripleForIndex</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Int) -&gt; Word32 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679228824"><span class="hs-identifier hs-var">numAssets</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>    </span><span class="annot"><a href="#local-6989586621679228822"><span class="hs-identifier hs-type">triples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229473"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-661"></span><span>    </span><span id="local-6989586621679228822"><span class="annot"><span class="annottext">triples :: [(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228822"><span class="hs-identifier hs-var hs-var">triples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Word16, Word16, Word64) -&gt; (PolicyID crypto, AssetName, Integer))
-&gt; [(Word16, Word16, Word64)]
-&gt; [(PolicyID crypto, AssetName, Integer)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Word16, Word16, Word64) -&gt; (PolicyID crypto, AssetName, Integer)
</span><a href="#local-6989586621679228812"><span class="hs-identifier hs-var">convertTriple</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word16, Word16, Word64)]
</span><a href="#local-6989586621679228813"><span class="hs-identifier hs-var">rawTriples</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span>    </span><span class="hs-comment">-- Asset name length are calculated by subtracting the offset from the</span><span>
</span><span id="line-664"></span><span>    </span><span class="hs-comment">-- next greater offset (or from the end of the rep, if there is none.)</span><span>
</span><span id="line-665"></span><span>    </span><span class="hs-comment">-- For an index pointing to the end of the array, the associated</span><span>
</span><span id="line-666"></span><span>    </span><span class="hs-comment">-- length will be: offset - length(rep) = 0</span><span>
</span><span id="line-667"></span><span>    </span><span id="local-6989586621679228811"><span class="annot"><span class="annottext">assetLens :: Map Word16 Int
</span><a href="#local-6989586621679228811"><span class="hs-identifier hs-var hs-var">assetLens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-comment">-- This assumes that the triples are ordered by nondecreasing asset name offset</span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228810"><span class="annot"><span class="annottext">ixs :: [Word16]
</span><a href="#local-6989586621679228810"><span class="hs-identifier hs-var hs-var">ixs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word16] -&gt; [Word16]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="Cardano.Ledger.Mary.Value.html#nubOrd"><span class="hs-identifier hs-var">nubOrd</span></a></span><span> </span><span class="annot"><span class="annottext">([Word16] -&gt; [Word16]) -&gt; [Word16] -&gt; [Word16]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Word16, Word16, Word64) -&gt; Word16)
-&gt; [(Word16, Word16, Word64)] -&gt; [Word16]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228808"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228808"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228808"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Word16, Word16, Word64)]
</span><a href="#local-6989586621679228813"><span class="hs-identifier hs-var">rawTriples</span></a></span><span>
</span><span id="line-670"></span><span>          </span><span id="local-6989586621679228807"><span class="annot"><span class="annottext">ixPairs :: [(Word16, Word16)]
</span><a href="#local-6989586621679228807"><span class="hs-identifier hs-var hs-var">ixPairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word16] -&gt; [Word16] -&gt; [(Word16, Word16)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621679228810"><span class="hs-identifier hs-var">ixs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Word16] -&gt; [Word16]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621679228810"><span class="hs-identifier hs-var">ixs</span></a></span><span> </span><span class="annot"><span class="annottext">[Word16] -&gt; [Word16] -&gt; [Word16]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word16) -&gt; Int -&gt; Word16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS.length</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228823"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Word16, Int)] -&gt; Map Word16 Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([(Word16, Int)] -&gt; Map Word16 Int)
-&gt; [(Word16, Int)] -&gt; Map Word16 Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679228805"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228805"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228804"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228804"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228805"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Int) -&gt; Word16 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228804"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228805"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Word16, Word16) -&gt; (Word16, Int))
-&gt; [(Word16, Word16)] -&gt; [(Word16, Int)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word16, Word16)]
</span><a href="#local-6989586621679228807"><span class="hs-identifier hs-var">ixPairs</span></a></span><span>
</span><span id="line-672"></span><span>    </span><span class="annot"><a href="#local-6989586621679228803"><span class="hs-identifier hs-type">assetLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621679228803"><span class="annot"><span class="annottext">assetLen :: Word16 -&gt; Int
</span><a href="#local-6989586621679228803"><span class="hs-identifier hs-var hs-var">assetLen</span></a></span></span><span> </span><span id="local-6989586621679228802"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228802"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Map Word16 Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228802"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word16 Int
</span><a href="#local-6989586621679228811"><span class="hs-identifier hs-var">assetLens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><a href="#local-6989586621679228812"><span class="hs-identifier hs-type">convertTriple</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-676"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word16</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Word64</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229473"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>    </span><span id="local-6989586621679228812"><span class="annot"><span class="annottext">convertTriple :: (Word16, Word16, Word64) -&gt; (PolicyID crypto, AssetName, Integer)
</span><a href="#local-6989586621679228812"><span class="hs-identifier hs-var hs-var">convertTriple</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679228801"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228801"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228800"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228800"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228799"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228799"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto -&gt; PolicyID crypto
forall crypto. ScriptHash crypto -&gt; PolicyID crypto
</span><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-var">PolicyID</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash crypto -&gt; PolicyID crypto)
-&gt; ScriptHash crypto -&gt; PolicyID crypto
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-679"></span><span>          </span><span class="annot"><span class="annottext">Hash (ADDRHASH crypto) EraIndependentScript -&gt; ScriptHash crypto
forall crypto.
Hash (ADDRHASH crypto) EraIndependentScript -&gt; ScriptHash crypto
</span><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-var">ScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash (ADDRHASH crypto) EraIndependentScript -&gt; ScriptHash crypto)
-&gt; Hash (ADDRHASH crypto) EraIndependentScript -&gt; ScriptHash crypto
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-680"></span><span>            </span><span class="annot"><span class="annottext">ShortByteString -&gt; Hash (ADDRHASH crypto) EraIndependentScript
forall h a. HashAlgorithm h =&gt; ShortByteString -&gt; Hash h a
</span><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier hs-var">Hash.UnsafeHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Hash (ADDRHASH crypto) EraIndependentScript)
-&gt; ShortByteString -&gt; Hash (ADDRHASH crypto) EraIndependentScript
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-681"></span><span>              </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; Int -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-var">readShortByteString</span></a></span><span>
</span><span id="line-682"></span><span>                </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228823"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-683"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228801"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Int) -&gt; Word -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ADDRHASH crypto] -&gt; Word
forall h (proxy :: * -&gt; *). HashAlgorithm h =&gt; proxy h -&gt; Word
</span><a href="../../../../cardano-crypto-class/html/src"><span class="hs-identifier hs-var">Hash.sizeHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../../../cardano-ledger-core/html/src"><span class="hs-identifier hs-type">CC.ADDRHASH</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229473"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-685"></span><span>        </span><span class="annot"><span class="annottext">ShortByteString -&gt; AssetName
</span><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; AssetName) -&gt; ShortByteString -&gt; AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; Int -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-var">readShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228823"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228800"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
</span><a href="#local-6989586621679228803"><span class="hs-identifier hs-var">assetLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679228800"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-686"></span><span>        </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679228799"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-687"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="hs-comment">-- | Strip out duplicates</span><span>
</span><span id="line-690"></span><span id="local-6989586621679229398"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#nubOrd"><span class="hs-identifier hs-type">nubOrd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229398"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679229398"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679229398"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-691"></span><span id="nubOrd"><span class="annot"><span class="annottext">nubOrd :: [a] -&gt; [a]
</span><a href="Cardano.Ledger.Mary.Value.html#nubOrd"><span class="hs-identifier hs-var hs-var">nubOrd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
forall a. Ord a =&gt; Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679228796"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-694"></span><span>    </span><span id="local-6989586621679228796"><span class="annot"><span class="annottext">loop :: Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679228796"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><a href="#local-6989586621679228796"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621679228795"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679228795"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679228794"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228794"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621679228793"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679228793"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228794"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679228795"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679228796"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679228795"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679228793"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-697"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-698"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228791"><span class="annot"><span class="annottext">s' :: Set a
</span><a href="#local-6989586621679228791"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Set a
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228794"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679228795"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679228791"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">`seq`</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228794"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679228796"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679228791"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679228793"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-type">sbsToByteArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../primitive/html/src"><span class="hs-identifier hs-type">BA.ByteArray</span></a></span><span>
</span><span id="line-701"></span><span id="sbsToByteArray"><span class="annot"><span class="annottext">sbsToByteArray :: ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var hs-var">sbsToByteArray</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">SBS</span></a></span><span> </span><span id="local-6989586621679228789"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679228789"><span class="hs-identifier hs-var">bah</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; ByteArray
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.ByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679228789"><span class="hs-identifier hs-var">bah</span></a></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-type">byteArrayToSbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../primitive/html/src"><span class="hs-identifier hs-type">BA.ByteArray</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span>
</span><span id="line-704"></span><span id="byteArrayToSbs"><span class="annot"><span class="annottext">byteArrayToSbs :: ByteArray -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-var hs-var">byteArrayToSbs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../primitive/html/src"><span class="hs-identifier hs-type">BA.ByteArray</span></a></span><span> </span><span id="local-6989586621679228787"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679228787"><span class="hs-identifier hs-var">bah</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; ShortByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">SBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679228787"><span class="hs-identifier hs-var">bah</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-type">readShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-type">ShortByteString</span></a></span><span>
</span><span id="line-707"></span><span id="readShortByteString"><span class="annot"><span class="annottext">readShortByteString :: ShortByteString -&gt; Int -&gt; Int -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-var hs-var">readShortByteString</span></a></span></span><span> </span><span id="local-6989586621679228786"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228786"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span id="local-6989586621679228785"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228785"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679228784"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228784"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-708"></span><span>  </span><span class="annot"><span class="annottext">ByteArray -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-var">byteArrayToSbs</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteArray -&gt; ShortByteString) -&gt; ByteArray -&gt; ShortByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Int -&gt; ByteArray
</span><a href="../../../../primitive/html/src"><span class="hs-identifier hs-var">BA.cloneByteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679228786"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228785"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679228784"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span class="hs-comment">-- ========================================================================</span><span>
</span><span id="line-711"></span><span class="hs-comment">-- Operations on Values</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="hs-comment">-- | Extract the set of policies in the Value.</span><span>
</span><span id="line-714"></span><span class="hs-comment">--</span><span>
</span><span id="line-715"></span><span class="hs-comment">--   This function is equivalent to computing the support of the value in the</span><span>
</span><span id="line-716"></span><span class="hs-comment">--   spec.</span><span>
</span><span id="line-717"></span><span id="local-6989586621679228782"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#policies"><span class="hs-identifier hs-type">policies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228782"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228782"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-718"></span><span id="policies"><span class="annot"><span class="annottext">policies :: Value crypto -&gt; Set (PolicyID crypto)
</span><a href="Cardano.Ledger.Mary.Value.html#policies"><span class="hs-identifier hs-var hs-var">policies</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679228781"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228781"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Set (PolicyID crypto)
forall k a. Map k a -&gt; Set k
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228781"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span id="local-6989586621679228779"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#lookup"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228779"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228779"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span></span><span>
</span><span id="line-721"></span><span id="lookup"><span class="annot"><span class="annottext">lookup :: PolicyID crypto -&gt; AssetName -&gt; Value crypto -&gt; Integer
</span><a href="Cardano.Ledger.Mary.Value.html#lookup"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679228778"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228778"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621679228777"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228777"><span class="hs-identifier hs-var">aid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679228776"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228776"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-722"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Maybe (Map AssetName Integer)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228778"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228776"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Map AssetName Integer)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-724"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679228775"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228775"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; AssetName -&gt; Map AssetName Integer -&gt; Integer
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.findWithDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228777"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228775"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span class="hs-comment">-- | insert comb policy asset n v,</span><span>
</span><span id="line-727"></span><span class="hs-comment">--   if comb = \ old new -&gt; old, the integer in the Value is prefered over n</span><span>
</span><span id="line-728"></span><span class="hs-comment">--   if comb = \ old new -&gt; new, then n is prefered over the integer in the Value</span><span>
</span><span id="line-729"></span><span class="hs-comment">--   if (comb old new) == 0, then that value should not be stored in the Map part of the Value.</span><span>
</span><span id="line-730"></span><span id="local-6989586621679229361"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#insert"><span class="hs-identifier hs-type">insert</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-732"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229361"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-733"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-734"></span><span>  </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-735"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229361"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-736"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229361"><span class="hs-identifier hs-type">crypto</span></a></span></span><span>
</span><span id="line-737"></span><span id="insert"><span class="annot"><span class="annottext">insert :: (Integer -&gt; Integer -&gt; Integer)
-&gt; PolicyID crypto
-&gt; AssetName
-&gt; Integer
-&gt; Value crypto
-&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#insert"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span id="local-6989586621679228773"><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621679228773"><span class="hs-identifier hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621679228772"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228772"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621679228771"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228771"><span class="hs-identifier hs-var">aid</span></a></span></span><span> </span><span id="local-6989586621679228770"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228770"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679228769"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228769"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span id="local-6989586621679228768"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228768"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; (Map (PolicyID crypto) (Map AssetName Integer),
    Maybe (Map AssetName Integer),
    Map (PolicyID crypto) (Map AssetName Integer))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; (Map k a, Maybe a, Map k a)
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">splitLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228772"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228768"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-739"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679228767"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228767"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679228766"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228766"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228765"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228765"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-740"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AssetName
-&gt; Map AssetName Integer
-&gt; (Map AssetName Integer, Maybe Integer, Map AssetName Integer)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; (Map k a, Maybe a, Map k a)
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">splitLookup</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228771"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228766"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-741"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679228764"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228764"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679228763"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228763"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228762"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228762"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-742"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228761"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-743"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-744"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679228760"><span class="annot"><span class="annottext">m3 :: Map AssetName Integer
</span><a href="#local-6989586621679228760"><span class="hs-identifier hs-var hs-var">m3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a. Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link2</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228764"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228762"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-745"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228760"><span class="hs-identifier hs-var">m3</span></a></span><span>
</span><span id="line-746"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228769"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a. Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link2</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228767"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228765"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228769"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID crypto
-&gt; Map AssetName Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228772"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228760"><span class="hs-identifier hs-var">m3</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228767"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228765"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228769"><span class="hs-identifier hs-var">cn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID crypto
-&gt; Map AssetName Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228772"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName
-&gt; Integer
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228771"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228761"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228764"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228762"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228767"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228765"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-750"></span><span>            </span><span id="local-6989586621679228761"><span class="annot"><span class="annottext">n :: Integer
</span><a href="#local-6989586621679228761"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621679228773"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228763"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228770"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-751"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map AssetName Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-752"></span><span>          </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span>
</span><span id="line-753"></span><span>            </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228769"><span class="hs-identifier hs-var">cn</span></a></span><span>
</span><span id="line-754"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
-&gt; Map AssetName Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link</span></a></span><span>
</span><span id="line-755"></span><span>                </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228772"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-756"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228770"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-757"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228766"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-758"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AssetName
-&gt; Integer -&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228771"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228770"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228766"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-759"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>                </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228767"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-761"></span><span>                </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228765"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-762"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679228758"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228758"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Map AssetName Integer)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228757"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228757"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-764"></span><span>      </span><span class="annot"><span class="annottext">Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span>
</span><span id="line-765"></span><span>        </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228769"><span class="hs-identifier hs-var">cn</span></a></span><span>
</span><span id="line-766"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228770"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-767"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a. Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link2</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228758"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228757"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-768"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
-&gt; Map AssetName Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228772"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName -&gt; Integer -&gt; Map AssetName Integer
forall k a. k -&gt; a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228771"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228770"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228758"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228757"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-769"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="hs-comment">-- ========================================================</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span class="hs-comment">-- | Remove 0 assets from a map</span><span>
</span><span id="line-774"></span><span id="local-6989586621679229523"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#prune"><span class="hs-identifier hs-type">prune</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-775"></span><span>  </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229523"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-776"></span><span>  </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229523"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-777"></span><span id="prune"><span class="annot"><span class="annottext">prune :: Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="Cardano.Ledger.Mary.Value.html#prune"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span> </span><span id="local-6989586621679228755"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228755"><span class="hs-identifier hs-var">assets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-778"></span><span>  </span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Bool)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (Map AssetName Integer -&gt; Bool) -&gt; Map AssetName Integer -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map (PolicyID crypto) (Map AssetName Integer)
 -&gt; Map (PolicyID crypto) (Map AssetName Integer))
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Bool) -&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228755"><span class="hs-identifier hs-var">assets</span></a></span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span class="hs-comment">-- | Rather than using prune to remove 0 assets, when can avoid adding them in the</span><span>
</span><span id="line-781"></span><span class="hs-comment">--   first place by using valueFromList to construct a Value.</span><span>
</span><span id="line-782"></span><span id="local-6989586621679229402"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier hs-type">valueFromList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229402"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229402"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-783"></span><span id="valueFromList"><span class="annot"><span class="annottext">valueFromList :: Integer -&gt; [(PolicyID era, AssetName, Integer)] -&gt; Value era
</span><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier hs-var hs-var">valueFromList</span></a></span></span><span> </span><span id="local-6989586621679228750"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228750"><span class="hs-identifier hs-var">ada</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-784"></span><span>  </span><span class="annot"><span class="annottext">((PolicyID era, AssetName, Integer) -&gt; Value era -&gt; Value era)
-&gt; Value era -&gt; [(PolicyID era, AssetName, Integer)] -&gt; Value era
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span>
</span><span id="line-785"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679228748"><span class="annot"><span class="annottext">PolicyID era
</span><a href="#local-6989586621679228748"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228747"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228747"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228746"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228746"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679228745"><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679228745"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer)
-&gt; PolicyID era -&gt; AssetName -&gt; Integer -&gt; Value era -&gt; Value era
forall crypto.
(Integer -&gt; Integer -&gt; Integer)
-&gt; PolicyID crypto
-&gt; AssetName
-&gt; Integer
-&gt; Value crypto
-&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#insert"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(+)</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID era
</span><a href="#local-6989586621679228748"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228747"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228746"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679228745"><span class="hs-identifier hs-var">ans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Map (PolicyID era) (Map AssetName Integer) -&gt; Value era
forall crypto.
Integer
-&gt; Map (PolicyID crypto) (Map AssetName Integer) -&gt; Value crypto
</span><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-var">Value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228750"><span class="hs-identifier hs-var">ada</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID era) (Map AssetName Integer)
forall k a. Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>
</span><span id="line-788"></span><span class="hs-comment">-- | Display a Value as a String, one token per line</span><span>
</span><span id="line-789"></span><span id="local-6989586621679228743"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#showValue"><span class="hs-identifier hs-type">showValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679228743"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span></span><span>
</span><span id="line-790"></span><span id="showValue"><span class="annot"><span class="annottext">showValue :: Value crypto -&gt; String
</span><a href="Cardano.Ledger.Mary.Value.html#showValue"><span class="hs-identifier hs-var hs-var">showValue</span></a></span></span><span> </span><span id="local-6989586621679228742"><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228742"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228741"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Context -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unlines</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((PolicyID crypto, AssetName, Integer) -&gt; String)
-&gt; [(PolicyID crypto, AssetName, Integer)] -&gt; Context
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyID crypto, AssetName, Integer) -&gt; String
forall a a crypto.
(Show a, Show a) =&gt;
(PolicyID crypto, a, a) -&gt; String
</span><a href="#local-6989586621679228739"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228738"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-791"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-792"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679228741"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228741"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228738"><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228738"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value crypto -&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
forall crypto.
Value crypto -&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var">gettriples</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228742"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-793"></span><span>    </span><span id="local-6989586621679228739"><span class="annot"><span class="annottext">trans :: (PolicyID crypto, a, a) -&gt; String
</span><a href="#local-6989586621679228739"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span id="local-6989586621679228737"><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679228737"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228736"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228736"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228735"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228735"><span class="hs-identifier hs-var">cnt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-794"></span><span>      </span><span class="annot"><span class="annottext">ScriptHash crypto -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash crypto
</span><a href="#local-6989586621679228737"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-795"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,  &quot;</span></span><span>
</span><span id="line-796"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228736"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-797"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,  &quot;</span></span><span>
</span><span id="line-798"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679228735"><span class="hs-identifier hs-var">cnt</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="hs-comment">-- | Turn the nested 'Value' map-of-maps representation into a flat sequence</span><span>
</span><span id="line-801"></span><span class="hs-comment">-- of policyID, asset name and quantity, plus separately the ada quantity.</span><span>
</span><span id="line-802"></span><span id="local-6989586621679229350"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#gettriples%27"><span class="hs-identifier hs-type">gettriples'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229350"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229350"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229350"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-803"></span><span id="gettriples%27"><span class="annot"><span class="annottext">gettriples' :: Value crypto
-&gt; (Integer, [(PolicyID crypto, AssetName, Integer)],
    [PolicyID crypto])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples%27"><span class="hs-identifier hs-var hs-var">gettriples'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621679228734"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228734"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679228733"><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228733"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228734"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228732"><span class="hs-identifier hs-var">triples</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PolicyID crypto]
</span><a href="#local-6989586621679228731"><span class="hs-identifier hs-var">bad</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-805"></span><span>    </span><span id="local-6989586621679228732"><span class="annot"><span class="annottext">triples :: [(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228732"><span class="hs-identifier hs-var hs-var">triples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-806"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228730"><span class="hs-identifier hs-var">policyId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228729"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228728"><span class="hs-identifier hs-var">amount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679228730"><span class="annot"><span class="annottext">PolicyID crypto
</span><a href="#local-6989586621679228730"><span class="hs-identifier hs-var">policyId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228727"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228727"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
-&gt; [(PolicyID crypto, Map AssetName Integer)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">assocs</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228733"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-808"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679228729"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679228729"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228728"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228728"><span class="hs-identifier hs-var">amount</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; [(AssetName, Integer)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">assocs</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679228727"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-809"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-810"></span><span>    </span><span id="local-6989586621679228731"><span class="annot"><span class="annottext">bad :: [PolicyID crypto]
</span><a href="#local-6989586621679228731"><span class="hs-identifier hs-var hs-var">bad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer) -&gt; [PolicyID crypto]
forall k a. Map k a -&gt; [k]
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.keys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Bool)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
-&gt; Map (PolicyID crypto) (Map AssetName Integer)
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.filter</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map (PolicyID crypto) (Map AssetName Integer)
</span><a href="#local-6989586621679228733"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- This is a malformed value, not in cannonical form.</span><span>
</span><span id="line-811"></span><span>
</span><span id="line-812"></span><span id="local-6989586621679229565"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-type">gettriples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229565"><span class="hs-identifier hs-type">crypto</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679229565"><span class="hs-identifier hs-type">crypto</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-813"></span><span id="gettriples"><span class="annot"><span class="annottext">gettriples :: Value crypto -&gt; (Integer, [(PolicyID crypto, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var hs-var">gettriples</span></a></span></span><span> </span><span id="local-6989586621679228725"><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228725"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value crypto
-&gt; (Integer, [(PolicyID crypto, AssetName, Integer)],
    [PolicyID crypto])
forall crypto.
Value crypto
-&gt; (Integer, [(PolicyID crypto, AssetName, Integer)],
    [PolicyID crypto])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples%27"><span class="hs-identifier hs-var">gettriples'</span></a></span><span> </span><span class="annot"><span class="annottext">Value crypto
</span><a href="#local-6989586621679228725"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-814"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679228724"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228724"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679228723"><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228723"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PolicyID crypto]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679228724"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(PolicyID crypto, AssetName, Integer)]
</span><a href="#local-6989586621679228723"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-815"></span></pre></body></html>