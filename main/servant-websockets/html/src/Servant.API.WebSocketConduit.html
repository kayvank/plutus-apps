<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP                   #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts      #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables   #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies          #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Servant.API.WebSocketConduit</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Concurrent</span></a></span><span>                         </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">newEmptyMVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">putMVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">takeMVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../async/html/src"><span class="hs-identifier">Control.Concurrent.Async</span></a></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="../../../../async/html/src"><span class="hs-identifier">race_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>                              </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forever</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&gt;=&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../exceptions/html/src"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../exceptions/html/src"><span class="hs-identifier">handle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">liftIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../monad-control/html/src"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-control/html/src"><span class="hs-identifier">MonadBaseControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">Control.Monad.Trans.Resource</span></a></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier">MonadUnliftIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">ResourceT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier">runResourceT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">FromJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">ToJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">decode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier">encode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span>                       </span><span class="hs-special">(</span><span class="annot"><a href="../../../../bytestring/html/src"><span class="hs-identifier">fromStrict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier">Data.Conduit</span></a></span><span>                               </span><span class="hs-special">(</span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier">ConduitT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier">runConduitRes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier">yieldM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-operator">(.|)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Proxy</span></a></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Data.Text</span></a></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Void</span></a></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../wai-websockets/html/src"><span class="hs-identifier">Network.Wai.Handler.WebSockets</span></a></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="../../../../wai-websockets/html/src"><span class="hs-identifier">websocketsOr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">Network.WebSockets</span></a></span><span>                         </span><span class="hs-special">(</span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">Connection</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">ConnectionException</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">acceptRequest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>                                                   </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">defaultConnectionOptions</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">forkPingThread</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">receiveData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>                                                   </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">receiveDataMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">sendClose</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier">sendTextData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">Servant.Server</span></a></span><span>                             </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">HasServer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">ServerError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">ServerT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">Servant.Server.Internal.Router</span></a></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">leafRouter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">Servant.Server.Internal.RouteResult</span></a></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">RouteResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">Servant.Server.Internal.Delayed</span></a></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier">runDelayed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier">Data.Conduit.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CL</span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- | Endpoint for defining a route to provide a websocket. In contrast</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- to the 'WebSocket' endpoint, 'WebSocketConduit' provides a</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- higher-level interface. The handler function must be of type</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- @Conduit i m o@ with @i@ and @o@ being instances of 'FromJSON' and</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- 'ToJSON' respectively. 'await' reads from the web socket while</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- 'yield' writes to it.</span><span>
</span><span id="line-41"></span><span class="hs-comment">--</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-43"></span><span class="hs-comment">--</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- &gt; import Data.Aeson (Value)</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- &gt; import qualified Data.Conduit.List as CL</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- &gt; type WebSocketApi = &quot;echo&quot; :&gt; WebSocketConduit Value Value</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- &gt; server :: Server WebSocketApi</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- &gt; server = echo</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- &gt;  where</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- &gt;   echo :: Monad m =&gt; ConduitT Value Value m ()</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- &gt;   echo = CL.map id</span><span>
</span><span id="line-55"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-56"></span><span class="hs-comment">--</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- Note that the input format on the web socket is JSON, hence this</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- example only echos valid JSON data.</span><span>
</span><span id="line-59"></span><span class="hs-keyword">data</span><span> </span><span id="WebSocketConduit"><span class="annot"><a href="Servant.API.WebSocketConduit.html#WebSocketConduit"><span class="hs-identifier hs-var">WebSocketConduit</span></a></span></span><span> </span><span id="local-6989586621679108233"><span class="annot"><a href="#local-6989586621679108233"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679108232"><span class="annot"><a href="#local-6989586621679108232"><span class="hs-identifier hs-type">o</span></a></span></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span id="local-6989586621679108229"><span id="local-6989586621679108230"><span id="local-6989586621679108231"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">FromJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108231"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108230"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">HasServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Servant.API.WebSocketConduit.html#WebSocketConduit"><span class="hs-identifier hs-type">WebSocketConduit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108231"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108230"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679108229"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ServerT"><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">ServerT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Servant.API.WebSocketConduit.html#WebSocketConduit"><span class="hs-identifier hs-type">WebSocketConduit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108231"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108230"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679108225"><span class="annot"><a href="#local-6989586621679108225"><span class="hs-identifier hs-type hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier hs-type">ConduitT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108231"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108230"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">

#if MIN_VERSION_servant_server(0,12,0)
</span><span>  </span><span id="local-6989586621679108224"><span class="annot"><span class="annottext">hoistServerWithContext :: Proxy (WebSocketConduit i o)
-&gt; Proxy ctx
-&gt; (forall x. m x -&gt; n x)
-&gt; ServerT (WebSocketConduit i o) m
-&gt; ServerT (WebSocketConduit i o) n
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">hoistServerWithContext</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy (WebSocketConduit i o)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy ctx
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">forall x. m x -&gt; n x
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108222"><span class="annot"><span class="annottext">ServerT (WebSocketConduit i o) m
</span><a href="#local-6989586621679108222"><span class="hs-identifier hs-var">svr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerT (WebSocketConduit i o) m
ServerT (WebSocketConduit i o) n
</span><a href="#local-6989586621679108222"><span class="hs-identifier hs-var">svr</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-69"></span><span>  </span><span id="local-6989586621679108221"><span class="annot"><span class="annottext">route :: Proxy (WebSocketConduit i o)
-&gt; Context ctx
-&gt; Delayed env (Server (WebSocketConduit i o))
-&gt; Router env
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">route</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy (WebSocketConduit i o)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="annot"><span class="annottext">Context ctx
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108218"><span class="annot"><span class="annottext">Delayed env (Server (WebSocketConduit i o))
</span><a href="#local-6989586621679108218"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(env
 -&gt; Request
 -&gt; (RouteResult Response -&gt; IO ResponseReceived)
 -&gt; IO ResponseReceived)
-&gt; Router env
forall env a. (env -&gt; a) -&gt; Router' env a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">leafRouter</span></a></span><span> </span><span class="annot"><span class="annottext">((env
  -&gt; Request
  -&gt; (RouteResult Response -&gt; IO ResponseReceived)
  -&gt; IO ResponseReceived)
 -&gt; Router env)
-&gt; (env
    -&gt; Request
    -&gt; (RouteResult Response -&gt; IO ResponseReceived)
    -&gt; IO ResponseReceived)
-&gt; Router env
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679108217"><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621679108217"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679108216"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108216"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span id="local-6989586621679108215"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108215"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO ResponseReceived -&gt; IO ResponseReceived
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO ResponseReceived -&gt; IO ResponseReceived)
-&gt; ResourceT IO ResponseReceived -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">Delayed env (ConduitT i o (ResourceT IO) ())
-&gt; env
-&gt; Request
-&gt; ResourceT IO (RouteResult (ConduitT i o (ResourceT IO) ()))
forall env a.
Delayed env a -&gt; env -&gt; Request -&gt; ResourceT IO (RouteResult a)
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">runDelayed</span></a></span><span> </span><span class="annot"><span class="annottext">Delayed env (ConduitT i o (ResourceT IO) ())
Delayed env (Server (WebSocketConduit i o))
</span><a href="#local-6989586621679108218"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621679108217"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108216"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (RouteResult (ConduitT i o (ResourceT IO) ()))
-&gt; (RouteResult (ConduitT i o (ResourceT IO) ())
    -&gt; ResourceT IO ResponseReceived)
-&gt; ResourceT IO ResponseReceived
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">IO ResponseReceived -&gt; ResourceT IO ResponseReceived
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ResponseReceived -&gt; ResourceT IO ResponseReceived)
-&gt; (RouteResult (ConduitT i o (ResourceT IO) ())
    -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT i o (ResourceT IO) ())
-&gt; ResourceT IO ResponseReceived
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Request
-&gt; (RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT i o (ResourceT IO) ())
-&gt; IO ResponseReceived
forall b b.
(FromJSON b, ToJSON b) =&gt;
Request
-&gt; (RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT b b (ResourceT IO) ())
-&gt; IO ResponseReceived
</span><a href="#local-6989586621679108213"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108216"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108215"><span class="hs-identifier hs-var">respond</span></a></span><span>
</span><span id="line-71"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679108213"><span class="annot"><span class="annottext">go :: Request
-&gt; (RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT b b (ResourceT IO) ())
-&gt; IO ResponseReceived
</span><a href="#local-6989586621679108213"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679108212"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108212"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span id="local-6989586621679108211"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108211"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Route</span></a></span><span> </span><span id="local-6989586621679108209"><span class="annot"><span class="annottext">ConduitT b b (ResourceT IO) ()
</span><a href="#local-6989586621679108209"><span class="hs-identifier hs-var">cond</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><span class="annottext">ConnectionOptions -&gt; ServerApp -&gt; Application -&gt; Application
</span><a href="../../../../wai-websockets/html/src"><span class="hs-identifier hs-var">websocketsOr</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">defaultConnectionOptions</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConduitT b b (ResourceT IO) () -&gt; ServerApp
forall b b.
(FromJSON b, ToJSON b) =&gt;
ConduitT b b (ResourceT IO) () -&gt; ServerApp
</span><a href="#local-6989586621679108208"><span class="hs-identifier hs-var">runWSApp</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT b b (ResourceT IO) ()
</span><a href="#local-6989586621679108209"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108211"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; RouteResult Response
forall a. ServerError -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Fail</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="Servant.API.WebSocketConduit.html#upgradeRequired"><span class="hs-identifier hs-var">upgradeRequired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108212"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108211"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; (Response -&gt; RouteResult Response)
-&gt; Response
-&gt; IO ResponseReceived
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; RouteResult Response
forall a. a -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Route</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="#local-6989586621679108213"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108205"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108205"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Fail</span></a></span><span> </span><span id="local-6989586621679108204"><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108204"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108205"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; RouteResult Response
forall a. ServerError -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Fail</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108204"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="#local-6989586621679108213"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108203"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108203"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">FailFatal</span></a></span><span> </span><span id="local-6989586621679108201"><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108201"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108203"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; RouteResult Response
forall a. ServerError -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">FailFatal</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108201"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span id="local-6989586621679108208"><span class="annot"><span class="annottext">runWSApp :: ConduitT b b (ResourceT IO) () -&gt; ServerApp
</span><a href="#local-6989586621679108208"><span class="hs-identifier hs-var hs-var">runWSApp</span></a></span></span><span> </span><span id="local-6989586621679108200"><span class="annot"><span class="annottext">ConduitT b b (ResourceT IO) ()
</span><a href="#local-6989586621679108200"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PendingConnection -&gt; IO Connection
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">acceptRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(PendingConnection -&gt; IO Connection)
-&gt; (Connection -&gt; IO ()) -&gt; ServerApp
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679108199"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108199"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ConnectionException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier hs-type">ConnectionException</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>      </span><span id="local-6989586621679108198"><span class="annot"><span class="annottext">MVar ByteString
</span><a href="#local-6989586621679108198"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ByteString)
forall a. IO (MVar a)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">newEmptyMVar</span></a></span><span>
</span><span id="line-83"></span><span>      </span><span class="annot"><span class="annottext">IO Any -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO ()
</span><a href="../../../../async/html/src"><span class="hs-identifier hs-var">race_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO Any
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO Any) -&gt; IO () -&gt; IO Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO ByteString
forall a. WebSocketsData a =&gt; Connection -&gt; IO a
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">receiveData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108199"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; (ByteString -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ByteString -&gt; ByteString -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">putMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ByteString
</span><a href="#local-6989586621679108198"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; ConduitT () Void (ResourceT IO) () -&gt; IO ()
forall (m :: * -&gt; *).
(MonadBaseControl IO m, MonadUnliftIO m) =&gt;
Connection -&gt; ConduitT () Void (ResourceT m) () -&gt; m ()
</span><a href="Servant.API.WebSocketConduit.html#runConduitWebSocket"><span class="hs-identifier hs-var">runConduitWebSocket</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108199"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(ConduitT () Void (ResourceT IO) () -&gt; IO ())
-&gt; ConduitT () Void (ResourceT IO) () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-85"></span><span>          </span><span class="annot"><span class="annottext">ConduitT () ByteString (ResourceT IO) ()
-&gt; ConduitT () ByteString (ResourceT IO) ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceT IO ByteString -&gt; ConduitT () ByteString (ResourceT IO) ()
forall (m :: * -&gt; *) o i. Monad m =&gt; m o -&gt; ConduitT i o m ()
</span><a href="../../../../conduit/html/src"><span class="hs-identifier hs-var">yieldM</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO ByteString
 -&gt; ConduitT () ByteString (ResourceT IO) ())
-&gt; (IO ByteString -&gt; ResourceT IO ByteString)
-&gt; IO ByteString
-&gt; ConduitT () ByteString (ResourceT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO ByteString -&gt; ResourceT IO ByteString
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ByteString -&gt; ConduitT () ByteString (ResourceT IO) ())
-&gt; IO ByteString -&gt; ConduitT () ByteString (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ByteString -&gt; IO ByteString
forall a. MVar a -&gt; IO a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">takeMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ByteString
</span><a href="#local-6989586621679108198"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>          </span><span class="annot"><span class="annottext">ConduitT () ByteString (ResourceT IO) ()
-&gt; ConduitT ByteString Void (ResourceT IO) ()
-&gt; ConduitT () Void (ResourceT IO) ()
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><a href="../../../../conduit/html/src"><span class="hs-operator hs-var">.|</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe b) -&gt; ConduitT ByteString b (ResourceT IO) ()
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; Maybe b) -&gt; ConduitT a b m ()
</span><a href="../../../../conduit/html/src"><span class="hs-identifier hs-var">CL.mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Maybe b
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe b)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; Maybe b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../../../bytestring/html/src"><span class="hs-identifier hs-var">fromStrict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>          </span><span class="annot"><span class="annottext">ConduitT ByteString b (ResourceT IO) ()
-&gt; ConduitT b Void (ResourceT IO) ()
-&gt; ConduitT ByteString Void (ResourceT IO) ()
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><a href="../../../../conduit/html/src"><span class="hs-operator hs-var">.|</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT b b (ResourceT IO) ()
</span><a href="#local-6989586621679108200"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-88"></span><span>          </span><span class="annot"><span class="annottext">ConduitT b b (ResourceT IO) ()
-&gt; ConduitT b Void (ResourceT IO) ()
-&gt; ConduitT b Void (ResourceT IO) ()
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><a href="../../../../conduit/html/src"><span class="hs-operator hs-var">.|</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ResourceT IO ()) -&gt; ConduitT b Void (ResourceT IO) ()
forall (m :: * -&gt; *) a o.
Monad m =&gt;
(a -&gt; m ()) -&gt; ConduitT a o m ()
</span><a href="../../../../conduit/html/src"><span class="hs-identifier hs-var">CL.mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; (b -&gt; IO ()) -&gt; b -&gt; ResourceT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; ByteString -&gt; IO ()
forall a. WebSocketsData a =&gt; Connection -&gt; a -&gt; IO ()
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">sendTextData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108199"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; (b -&gt; ByteString) -&gt; b -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">encode</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-comment">-- | Endpoint for defining a route to provide a websocket. In contrast</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- to the 'WebSocketConduit', this endpoint only produces data. It can</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- be useful when implementing web sockets that simply just send data</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- to clients.</span><span>
</span><span id="line-94"></span><span class="hs-comment">--</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-96"></span><span class="hs-comment">--</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- &gt; import Data.Text (Text)</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- &gt; import qualified Data.Conduit.List as CL</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- &gt; type WebSocketApi = &quot;hello&quot; :&gt; WebSocketSource Text</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- &gt; server :: Server WebSocketApi</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- &gt; server = hello</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- &gt;  where</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- &gt;   hello :: Monad m =&gt; Conduit Text m ()</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- &gt;   hello = yield $ Just &quot;hello&quot;</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-108"></span><span class="hs-comment">--</span><span>
</span><span id="line-109"></span><span class="hs-keyword">data</span><span> </span><span id="WebSocketSource"><span class="annot"><a href="Servant.API.WebSocketConduit.html#WebSocketSource"><span class="hs-identifier hs-var">WebSocketSource</span></a></span></span><span> </span><span id="local-6989586621679108194"><span class="annot"><a href="#local-6989586621679108194"><span class="hs-identifier hs-type">o</span></a></span></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span id="local-6989586621679108192"><span id="local-6989586621679108193"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../aeson/html/src"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108193"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">HasServer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Servant.API.WebSocketConduit.html#WebSocketSource"><span class="hs-identifier hs-type">WebSocketSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108193"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679108192"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ServerT"><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">ServerT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Servant.API.WebSocketConduit.html#WebSocketSource"><span class="hs-identifier hs-type">WebSocketSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108193"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679108189"><span class="annot"><a href="#local-6989586621679108189"><span class="hs-identifier hs-type hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier hs-type">ConduitT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679108193"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">

#if MIN_VERSION_servant_server(0,12,0)
</span><span>  </span><span id="local-6989586621679108188"><span class="annot"><span class="annottext">hoistServerWithContext :: Proxy (WebSocketSource o)
-&gt; Proxy ctx
-&gt; (forall x. m x -&gt; n x)
-&gt; ServerT (WebSocketSource o) m
-&gt; ServerT (WebSocketSource o) n
</span><a href="#local-6989586621679108188"><span class="hs-identifier hs-var hs-var hs-var hs-var">hoistServerWithContext</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy (WebSocketSource o)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy ctx
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">forall x. m x -&gt; n x
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108187"><span class="annot"><span class="annottext">ServerT (WebSocketSource o) m
</span><a href="#local-6989586621679108187"><span class="hs-identifier hs-var">svr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerT (WebSocketSource o) m
ServerT (WebSocketSource o) n
</span><a href="#local-6989586621679108187"><span class="hs-identifier hs-var">svr</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-119"></span><span>  </span><span id="local-6989586621679108186"><span class="annot"><span class="annottext">route :: Proxy (WebSocketSource o)
-&gt; Context ctx
-&gt; Delayed env (Server (WebSocketSource o))
-&gt; Router env
</span><a href="#local-6989586621679108186"><span class="hs-identifier hs-var hs-var hs-var hs-var">route</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy (WebSocketSource o)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="annot"><span class="annottext">Context ctx
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108185"><span class="annot"><span class="annottext">Delayed env (Server (WebSocketSource o))
</span><a href="#local-6989586621679108185"><span class="hs-identifier hs-var">app</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(env
 -&gt; Request
 -&gt; (RouteResult Response -&gt; IO ResponseReceived)
 -&gt; IO ResponseReceived)
-&gt; Router env
forall env a. (env -&gt; a) -&gt; Router' env a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">leafRouter</span></a></span><span> </span><span class="annot"><span class="annottext">((env
  -&gt; Request
  -&gt; (RouteResult Response -&gt; IO ResponseReceived)
  -&gt; IO ResponseReceived)
 -&gt; Router env)
-&gt; (env
    -&gt; Request
    -&gt; (RouteResult Response -&gt; IO ResponseReceived)
    -&gt; IO ResponseReceived)
-&gt; Router env
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679108184"><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621679108184"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679108183"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108183"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span id="local-6989586621679108182"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108182"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResourceT IO ResponseReceived -&gt; IO ResponseReceived
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO ResponseReceived -&gt; IO ResponseReceived)
-&gt; ResourceT IO ResponseReceived -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="annottext">Delayed env (ConduitT () o (ResourceT IO) ())
-&gt; env
-&gt; Request
-&gt; ResourceT IO (RouteResult (ConduitT () o (ResourceT IO) ()))
forall env a.
Delayed env a -&gt; env -&gt; Request -&gt; ResourceT IO (RouteResult a)
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">runDelayed</span></a></span><span> </span><span class="annot"><span class="annottext">Delayed env (ConduitT () o (ResourceT IO) ())
Delayed env (Server (WebSocketSource o))
</span><a href="#local-6989586621679108185"><span class="hs-identifier hs-var">app</span></a></span><span> </span><span class="annot"><span class="annottext">env
</span><a href="#local-6989586621679108184"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108183"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT IO (RouteResult (ConduitT () o (ResourceT IO) ()))
-&gt; (RouteResult (ConduitT () o (ResourceT IO) ())
    -&gt; ResourceT IO ResponseReceived)
-&gt; ResourceT IO ResponseReceived
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">IO ResponseReceived -&gt; ResourceT IO ResponseReceived
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ResponseReceived -&gt; ResourceT IO ResponseReceived)
-&gt; (RouteResult (ConduitT () o (ResourceT IO) ())
    -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT () o (ResourceT IO) ())
-&gt; ResourceT IO ResponseReceived
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Request
-&gt; (RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT () o (ResourceT IO) ())
-&gt; IO ResponseReceived
forall b.
ToJSON b =&gt;
Request
-&gt; (RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT () b (ResourceT IO) ())
-&gt; IO ResponseReceived
</span><a href="#local-6989586621679108181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108183"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108182"><span class="hs-identifier hs-var">respond</span></a></span><span>
</span><span id="line-121"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679108181"><span class="annot"><span class="annottext">go :: Request
-&gt; (RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult (ConduitT () b (ResourceT IO) ())
-&gt; IO ResponseReceived
</span><a href="#local-6989586621679108181"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679108180"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108180"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span id="local-6989586621679108179"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108179"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Route</span></a></span><span> </span><span id="local-6989586621679108178"><span class="annot"><span class="annottext">ConduitT () b (ResourceT IO) ()
</span><a href="#local-6989586621679108178"><span class="hs-identifier hs-var">cond</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">ConnectionOptions -&gt; ServerApp -&gt; Application -&gt; Application
</span><a href="../../../../wai-websockets/html/src"><span class="hs-identifier hs-var">websocketsOr</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">defaultConnectionOptions</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConduitT () b (ResourceT IO) () -&gt; ServerApp
forall b. ToJSON b =&gt; ConduitT () b (ResourceT IO) () -&gt; ServerApp
</span><a href="#local-6989586621679108177"><span class="hs-identifier hs-var">runWSApp</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT () b (ResourceT IO) ()
</span><a href="#local-6989586621679108178"><span class="hs-identifier hs-var">cond</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Response -&gt; IO ResponseReceived
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108179"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; RouteResult Response
forall a. ServerError -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Fail</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="Servant.API.WebSocketConduit.html#upgradeRequired"><span class="hs-identifier hs-var">upgradeRequired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679108180"><span class="hs-identifier hs-var">request</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108179"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; (Response -&gt; RouteResult Response)
-&gt; Response
-&gt; IO ResponseReceived
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Response -&gt; RouteResult Response
forall a. a -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Route</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><a href="#local-6989586621679108181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108176"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108176"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">Fail</span></a></span><span> </span><span id="local-6989586621679108175"><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108175"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108176"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; RouteResult Response
forall a. ServerError -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">Fail</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108175"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><a href="#local-6989586621679108181"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679108174"><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108174"><span class="hs-identifier hs-var">respond</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">FailFatal</span></a></span><span> </span><span id="local-6989586621679108173"><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108173"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RouteResult Response -&gt; IO ResponseReceived
</span><a href="#local-6989586621679108174"><span class="hs-identifier hs-var">respond</span></a></span><span> </span><span class="annot"><span class="annottext">(RouteResult Response -&gt; IO ResponseReceived)
-&gt; RouteResult Response -&gt; IO ResponseReceived
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; RouteResult Response
forall a. ServerError -&gt; RouteResult a
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">FailFatal</span></a></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679108173"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679108177"><span class="annot"><span class="annottext">runWSApp :: ConduitT () b (ResourceT IO) () -&gt; ServerApp
</span><a href="#local-6989586621679108177"><span class="hs-identifier hs-var hs-var">runWSApp</span></a></span></span><span> </span><span id="local-6989586621679108172"><span class="annot"><span class="annottext">ConduitT () b (ResourceT IO) ()
</span><a href="#local-6989586621679108172"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PendingConnection -&gt; IO Connection
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">acceptRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(PendingConnection -&gt; IO Connection)
-&gt; (Connection -&gt; IO ()) -&gt; ServerApp
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679108171"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108171"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ConnectionException -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../../../../exceptions/html/src"><span class="hs-identifier hs-var">handle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier hs-type">ConnectionException</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><span class="annottext">IO Any -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO ()
</span><a href="../../../../async/html/src"><span class="hs-identifier hs-var">race_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; IO Any
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO Any) -&gt; (IO Text -&gt; IO ()) -&gt; IO Text -&gt; IO Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO Text -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Text -&gt; IO Any) -&gt; IO Text -&gt; IO Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; IO Text
forall a. WebSocketsData a =&gt; Connection -&gt; IO a
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">receiveData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108171"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; ConduitT () Void (ResourceT IO) () -&gt; IO ()
forall (m :: * -&gt; *).
(MonadBaseControl IO m, MonadUnliftIO m) =&gt;
Connection -&gt; ConduitT () Void (ResourceT m) () -&gt; m ()
</span><a href="Servant.API.WebSocketConduit.html#runConduitWebSocket"><span class="hs-identifier hs-var">runConduitWebSocket</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108171"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(ConduitT () Void (ResourceT IO) () -&gt; IO ())
-&gt; ConduitT () Void (ResourceT IO) () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT () b (ResourceT IO) ()
</span><a href="#local-6989586621679108172"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT () b (ResourceT IO) ()
-&gt; ConduitT b Void (ResourceT IO) ()
-&gt; ConduitT () Void (ResourceT IO) ()
forall (m :: * -&gt; *) a b c r.
Monad m =&gt;
ConduitT a b m () -&gt; ConduitT b c m r -&gt; ConduitT a c m r
</span><a href="../../../../conduit/html/src"><span class="hs-operator hs-var">.|</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; ResourceT IO ()) -&gt; ConduitT b Void (ResourceT IO) ()
forall (m :: * -&gt; *) a o.
Monad m =&gt;
(a -&gt; m ()) -&gt; ConduitT a o m ()
</span><a href="../../../../conduit/html/src"><span class="hs-identifier hs-var">CL.mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ResourceT IO ()) -&gt; (b -&gt; IO ()) -&gt; b -&gt; ResourceT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; ByteString -&gt; IO ()
forall a. WebSocketsData a =&gt; Connection -&gt; a -&gt; IO ()
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">sendTextData</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108171"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; IO ()) -&gt; (b -&gt; ByteString) -&gt; b -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../../../../aeson/html/src"><span class="hs-identifier hs-var">encode</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span id="local-6989586621679108298"><span class="annot"><a href="Servant.API.WebSocketConduit.html#runConduitWebSocket"><span class="hs-identifier hs-type">runConduitWebSocket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../monad-control/html/src"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108298"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../unliftio-core/html/src"><span class="hs-identifier hs-type">MonadUnliftIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108298"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../websockets/html/src"><span class="hs-identifier hs-type">Connection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../conduit/html/src"><span class="hs-identifier hs-type">ConduitT</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../resourcet/html/src"><span class="hs-identifier hs-type">ResourceT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108298"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108298"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-136"></span><span id="runConduitWebSocket"><span class="annot"><span class="annottext">runConduitWebSocket :: Connection -&gt; ConduitT () Void (ResourceT m) () -&gt; m ()
</span><a href="Servant.API.WebSocketConduit.html#runConduitWebSocket"><span class="hs-identifier hs-var hs-var">runConduitWebSocket</span></a></span></span><span> </span><span id="local-6989586621679108170"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108170"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679108169"><span class="annot"><span class="annottext">ConduitT () Void (ResourceT m) ()
</span><a href="#local-6989586621679108169"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; Int -&gt; IO ()
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">forkPingThread</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108170"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT () Void (ResourceT m) () -&gt; m ()
forall (m :: * -&gt; *) r.
MonadUnliftIO m =&gt;
ConduitT () Void (ResourceT m) r -&gt; m r
</span><a href="../../../../conduit/html/src"><span class="hs-identifier hs-var">runConduitRes</span></a></span><span> </span><span class="annot"><span class="annottext">ConduitT () Void (ResourceT m) ()
</span><a href="#local-6989586621679108169"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Text -&gt; IO ()
forall a. WebSocketsData a =&gt; Connection -&gt; a -&gt; IO ()
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">sendClose</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108170"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Out of data&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../text/html/src"><span class="hs-identifier hs-type">Text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">-- After sending the close message, we keep receiving packages</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-comment">-- (and drop them) until the connection is actually closed,</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-comment">-- which is indicated by an exception.</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">IO DataMessage -&gt; IO ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(IO DataMessage -&gt; IO ()) -&gt; IO DataMessage -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO DataMessage
</span><a href="../../../../websockets/html/src"><span class="hs-identifier hs-var">receiveDataMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679108170"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Servant.API.WebSocketConduit.html#upgradeRequired"><span class="hs-identifier hs-type">upgradeRequired</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">ServerError</span></a></span><span>
</span><span id="line-147"></span><span id="upgradeRequired"><span class="annot"><span class="annottext">upgradeRequired :: ServerError
</span><a href="Servant.API.WebSocketConduit.html#upgradeRequired"><span class="hs-identifier hs-var hs-var">upgradeRequired</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ServerError :: Int -&gt; String -&gt; ByteString -&gt; [Header] -&gt; ServerError
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-type">ServerError</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">errHTTPCode :: Int
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errHTTPCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">426</span></span><span>
</span><span id="line-148"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errReasonPhrase :: String
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errReasonPhrase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Upgrade Required&quot;</span></span><span>
</span><span id="line-149"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errBody :: ByteString
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-150"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">errHeaders :: [Header]
</span><a href="../../../../servant-server/html/src"><span class="hs-identifier hs-var">errHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Header]
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-151"></span><span>                              </span><span class="hs-special">}</span><span>
</span><span id="line-152"></span></pre></body></html>