<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE CPP                   #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs                 #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes            #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables   #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances  #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Streaming.Internal</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-comment">-- * The free monad transformer</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><span class="hs-comment">-- $stream</span></span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Introducing a stream</span></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unfold"><span class="hs-identifier">unfold</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#replicates"><span class="hs-identifier">replicates</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#repeats"><span class="hs-identifier">repeats</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#repeatsM"><span class="hs-identifier">repeatsM</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#effect"><span class="hs-identifier">effect</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#wrap"><span class="hs-identifier">wrap</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#yields"><span class="hs-identifier">yields</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#streamBuild"><span class="hs-identifier">streamBuild</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#cycles"><span class="hs-identifier">cycles</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#delays"><span class="hs-identifier">delays</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#never"><span class="hs-identifier">never</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#untilJust"><span class="hs-identifier">untilJust</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Eliminating a stream</span></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#intercalates"><span class="hs-identifier">intercalates</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#concats"><span class="hs-identifier">concats</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#iterT"><span class="hs-identifier">iterT</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#iterTM"><span class="hs-identifier">iterTM</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#destroy"><span class="hs-identifier">destroy</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#streamFold"><span class="hs-identifier">streamFold</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Inspecting a stream wrap by wrap</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#inspect"><span class="hs-identifier">inspect</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Transforming streams</span></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#maps"><span class="hs-identifier">maps</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsM"><span class="hs-identifier">mapsM</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsPost"><span class="hs-identifier">mapsPost</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsMPost"><span class="hs-identifier">mapsMPost</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#hoistUnexposed"><span class="hs-identifier">hoistUnexposed</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#decompose"><span class="hs-identifier">decompose</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsM_"><span class="hs-identifier">mapsM_</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#run"><span class="hs-identifier">run</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#distribute"><span class="hs-identifier">distribute</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#groups"><span class="hs-identifier">groups</span></a></span><span>
</span><span id="line-51"></span><span class="hs-comment">--    , groupInL</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="hs-comment">-- *  Splitting streams</span></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#chunksOf"><span class="hs-identifier">chunksOf</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#splitsAt"><span class="hs-identifier">splitsAt</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#takes"><span class="hs-identifier">takes</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#cutoff"><span class="hs-identifier">cutoff</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">-- , period</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- , periods</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Zipping and unzipping streams</span></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#zipsWith"><span class="hs-identifier">zipsWith</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-identifier">zipsWith'</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#zips"><span class="hs-identifier">zips</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unzips"><span class="hs-identifier">unzips</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#interleaves"><span class="hs-identifier">interleaves</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#separate"><span class="hs-identifier">separate</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unseparate"><span class="hs-identifier">unseparate</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#expand"><span class="hs-identifier">expand</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#expandPost"><span class="hs-identifier">expandPost</span></a></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Assorted Data.Functor.x help</span></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#switch"><span class="hs-identifier">switch</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-comment">-- *  For use in implementation</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unexposed"><span class="hs-identifier">unexposed</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#hoistExposed"><span class="hs-identifier">hoistExposed</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#hoistExposedPost"><span class="hs-identifier">hoistExposedPost</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsExposed"><span class="hs-identifier">mapsExposed</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsMExposed"><span class="hs-identifier">mapsMExposed</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier">destroyExposed</span></a></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">threadDelay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Error.Class</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad.Fail</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fail</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mmorph/html/src"><span class="hs-identifier">Control.Monad.Morph</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Reader.Class</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.State.Class</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Trans</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">on</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor.Classes</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor.Compose</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor.Sum</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- $setup</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- &gt;&gt;&gt; import Streaming.Prelude as S</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-comment">{- $stream

    The 'Stream' data type is equivalent to @FreeT@ and can represent any effectful
    succession of steps, where the form of the steps or 'commands' is
    specified by the first (functor) parameter.

&gt; data Stream f m r = Step !(f (Stream f m r)) | Effect (m (Stream f m r)) | Return r

    The /producer/ concept uses the simple functor @ (a,_) @ \- or the stricter
    @ Of a _ @. Then the news at each step or layer is just: an individual item of type @a@.
    Since @Stream (Of a) m r@ is equivalent to @Pipe.Producer a m r@, much of
    the @pipes@ @Prelude@ can easily be mirrored in a @streaming@ @Prelude@. Similarly,
    a simple @Consumer a m r@ or @Parser a m r@ concept arises when the base functor is
    @ (a -&gt; _) @ . @Stream ((-&gt;) input) m result@ consumes @input@ until it returns a
    @result@.

    To avoid breaking reasoning principles, the constructors
    should not be used directly. A pattern-match should go by way of 'inspect' \
    \- or, in the producer case, 'Streaming.Prelude.next'
    The constructors are exported by the 'Internal' module.
-}</span><span>
</span><span id="line-127"></span><span class="hs-keyword">data</span><span> </span><span id="Stream"><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-var">Stream</span></a></span></span><span> </span><span id="local-6989586621679063975"><span class="annot"><a href="#local-6989586621679063975"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679063974"><span class="annot"><a href="#local-6989586621679063974"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679063976"><span class="annot"><a href="#local-6989586621679063976"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Step"><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063975"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063975"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063974"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063976"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="Effect"><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063974"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063975"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063974"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063976"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="Return"><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679063976"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &gt;= 710
</span><span>                  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Typeable</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- The most obvious approach would probably be</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- s1 == s2 = eqUnexposed (unexposed s1) (unexposed s2)</span><span>
</span><span id="line-137"></span><span class="hs-comment">--</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- but that seems to actually be rather hard (especially if performance</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- matters even a little bit). Using `inspect` instead</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- is nice and simple. The main downside is the rather weird-looking</span><span>
</span><span id="line-141"></span><span class="hs-comment">-- constraint it imposes. We *could* write</span><span>
</span><span id="line-142"></span><span class="hs-comment">--</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- instance (Monad m, Eq r, Eq1 m, Eq1 f) =&gt; Eq (Stream f m r)</span><span>
</span><span id="line-144"></span><span class="hs-comment">--</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- but there are an awful lot more Eq instances in the wild than</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- Eq1 instances. Maybe some day soon we'll have implication constraints</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- and everything will be beautiful.</span><span>
</span><span id="line-148"></span><span id="local-6989586621679063454"><span id="local-6989586621679063455"><span id="local-6989586621679063456"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063451"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063456"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063456"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063455"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063454"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063454"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063456"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063455"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063454"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063456"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063455"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679063449"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063449"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679063448"><span class="annot"><span class="annottext">== :: Stream f m r -&gt; Stream f m r -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></a></span></span><span> </span><span id="local-6989586621679063447"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063447"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063449"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either r (f (Stream f m r)))
-&gt; m (Either r (f (Stream f m r))) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063447"><span class="hs-identifier hs-var">s2</span></a></span></span></span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- See the notes on Eq.</span><span>
</span><span id="line-153"></span><span id="local-6989586621679063444"><span id="local-6989586621679063445"><span id="local-6989586621679063446"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063434"><span id="local-6989586621679063436"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063446"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063445"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063444"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063444"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063445"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Ord</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063444"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063446"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063445"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679063432"><span class="annot"><span class="annottext">compare :: Stream f m r -&gt; Stream f m r -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either r (f (Stream f m r)))
-&gt; m (Either r (f (Stream f m r))) -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">compare</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (f (Stream f m r)))
 -&gt; m (Either r (f (Stream f m r))) -&gt; Ordering)
-&gt; (Stream f m r -&gt; m (Either r (f (Stream f m r))))
-&gt; Stream f m r
-&gt; Stream f m r
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621679063430"><span class="annot"><span class="annottext">&lt; :: Stream f m r -&gt; Stream f m r -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either r (f (Stream f m r)))
-&gt; m (Either r (f (Stream f m r))) -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">(&lt;)</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (f (Stream f m r)))
 -&gt; m (Either r (f (Stream f m r))) -&gt; Bool)
-&gt; (Stream f m r -&gt; m (Either r (f (Stream f m r))))
-&gt; Stream f m r
-&gt; Stream f m r
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621679063428"><span class="annot"><span class="annottext">&gt; :: Stream f m r -&gt; Stream f m r -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">(&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either r (f (Stream f m r)))
-&gt; m (Either r (f (Stream f m r))) -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">(&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (f (Stream f m r)))
 -&gt; m (Either r (f (Stream f m r))) -&gt; Bool)
-&gt; (Stream f m r -&gt; m (Either r (f (Stream f m r))))
-&gt; Stream f m r
-&gt; Stream f m r
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621679063426"><span class="annot"><span class="annottext">&lt;= :: Stream f m r -&gt; Stream f m r -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;=)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either r (f (Stream f m r)))
-&gt; m (Either r (f (Stream f m r))) -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">(&lt;=)</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (f (Stream f m r)))
 -&gt; m (Either r (f (Stream f m r))) -&gt; Bool)
-&gt; (Stream f m r -&gt; m (Either r (f (Stream f m r))))
-&gt; Stream f m r
-&gt; Stream f m r
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679063424"><span class="annot"><span class="annottext">&gt;= :: Stream f m r -&gt; Stream f m r -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var hs-var hs-var hs-var">(&gt;=)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Either r (f (Stream f m r)))
-&gt; m (Either r (f (Stream f m r))) -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">(&gt;=)</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (f (Stream f m r)))
 -&gt; m (Either r (f (Stream f m r))) -&gt; Bool)
-&gt; (Stream f m r -&gt; m (Either r (f (Stream f m r))))
-&gt; Stream f m r
-&gt; Stream f m r
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span></span></span></span><span class="hs-cpp">

#if MIN_VERSION_base(4,9,0)
</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- We could avoid a Show1 constraint for our Show1 instance by sneakily</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- mapping everything to a single known type, but there's really no way</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- to do that for Eq1 or Ord1.</span><span>
</span><span id="line-166"></span><span id="local-6989586621679063422"><span id="local-6989586621679063423"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063423"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063422"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Eq1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063423"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Eq1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063422"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Eq1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063422"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063423"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621679063419"><span class="annot"><span class="annottext">liftEq :: (a -&gt; b -&gt; Bool) -&gt; Stream f m a -&gt; Stream f m b -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftEq</span></a></span></span><span> </span><span id="local-6989586621679063417"><span class="annot"><span class="annottext">a -&gt; b -&gt; Bool
</span><a href="#local-6989586621679063417"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span id="local-6989586621679063416"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063416"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679063415"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063415"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b -&gt; Bool
</span><a href="#local-6989586621679063414"><span class="hs-identifier hs-var">liftEqExposed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#unexposed"><span class="hs-identifier hs-var">unexposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063416"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#unexposed"><span class="hs-identifier hs-var">unexposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063415"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-169"></span><span>      </span><span id="local-6989586621679063414"><span class="annot"><span class="annottext">liftEqExposed :: Stream f m a -&gt; Stream f m b -&gt; Bool
</span><a href="#local-6989586621679063414"><span class="hs-identifier hs-var hs-var">liftEqExposed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063413"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063413"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063412"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063412"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; Bool
</span><a href="#local-6989586621679063417"><span class="hs-identifier hs-var">eq</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063413"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063412"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><a href="#local-6989586621679063414"><span class="hs-identifier hs-var">liftEqExposed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063411"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063411"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063410"><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063410"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b -&gt; Bool)
-&gt; m (Stream f m a) -&gt; m (Stream f m b) -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b -&gt; Bool
</span><a href="#local-6989586621679063414"><span class="hs-identifier hs-var">liftEqExposed</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063411"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063410"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><a href="#local-6989586621679063414"><span class="hs-identifier hs-var">liftEqExposed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063409"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063409"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063408"><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063408"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b -&gt; Bool)
-&gt; f (Stream f m a) -&gt; f (Stream f m b) -&gt; Bool
forall (f :: * -&gt; *) a b.
Eq1 f =&gt;
(a -&gt; b -&gt; Bool) -&gt; f a -&gt; f b -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftEq</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b -&gt; Bool
</span><a href="#local-6989586621679063414"><span class="hs-identifier hs-var">liftEqExposed</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063409"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063408"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><a href="#local-6989586621679063414"><span class="hs-identifier hs-var">liftEqExposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span></span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span id="local-6989586621679063406"><span id="local-6989586621679063407"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063407"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063406"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Ord1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063407"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Ord1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063406"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Ord1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063406"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063407"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621679063402"><span class="annot"><span class="annottext">liftCompare :: (a -&gt; b -&gt; Ordering) -&gt; Stream f m a -&gt; Stream f m b -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftCompare</span></a></span></span><span> </span><span id="local-6989586621679063400"><span class="annot"><span class="annottext">a -&gt; b -&gt; Ordering
</span><a href="#local-6989586621679063400"><span class="hs-identifier hs-var">cmp</span></a></span></span><span> </span><span id="local-6989586621679063399"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063399"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621679063398"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063398"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b -&gt; Ordering
</span><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#unexposed"><span class="hs-identifier hs-var">unexposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063399"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#unexposed"><span class="hs-identifier hs-var">unexposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063398"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>      </span><span id="local-6989586621679063397"><span class="annot"><span class="annottext">liftCmpExposed :: Stream f m a -&gt; Stream f m b -&gt; Ordering
</span><a href="#local-6989586621679063397"><span class="hs-identifier hs-var hs-var">liftCmpExposed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063396"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063396"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063395"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063395"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; Ordering
</span><a href="#local-6989586621679063400"><span class="hs-identifier hs-var">cmp</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063396"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063395"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span class="annot"><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063394"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063394"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063393"><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063393"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b -&gt; Ordering)
-&gt; m (Stream f m a) -&gt; m (Stream f m b) -&gt; Ordering
forall (f :: * -&gt; *) a b.
Ord1 f =&gt;
(a -&gt; b -&gt; Ordering) -&gt; f a -&gt; f b -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftCompare</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b -&gt; Ordering
</span><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063394"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063393"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-179"></span><span>      </span><span class="annot"><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063392"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063392"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063391"><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063391"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b -&gt; Ordering)
-&gt; f (Stream f m a) -&gt; f (Stream f m b) -&gt; Ordering
forall (f :: * -&gt; *) a b.
Ord1 f =&gt;
(a -&gt; b -&gt; Ordering) -&gt; f a -&gt; f b -&gt; Ordering
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftCompare</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b -&gt; Ordering
</span><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063392"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063391"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">LT</span></a></span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">GT</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><a href="#local-6989586621679063397"><span class="hs-identifier hs-var">liftCmpExposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Ordering
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;liftCmpExposed: stream was exposed!&quot;</span></span></span></span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- We could get a much less scary implementation using Show1, but</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- Show1 instances aren't nearly as common as Show instances.</span><span>
</span><span id="line-188"></span><span class="hs-comment">--</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- How does this</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- funny-looking instance work?</span><span>
</span><span id="line-191"></span><span class="hs-comment">--</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- We 'inspect' the stream to produce @m (Either r (Stream f m r))@.</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- Then we work under @m@ to produce @m ShowSWrapper@. That's almost</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- like producing @m String@, except that a @ShowSWrapper@ can be</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- shown at any precedence. So the 'Show' instance for @m@ can show</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- the contents at the correct precedence.</span><span>
</span><span id="line-197"></span><span id="local-6989586621679063387"><span id="local-6989586621679063388"><span id="local-6989586621679063389"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063382"><span id="local-6989586621679063384"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063389"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063388"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063389"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Streaming.Internal.html#ShowSWrapper"><span class="hs-identifier hs-type">ShowSWrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063387"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063387"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063389"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063388"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063387"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063389"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063388"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621679063380"><span class="annot"><span class="annottext">showsPrec :: Int -&gt; Stream f m r -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">showsPrec</span></a></span></span><span> </span><span id="local-6989586621679063378"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063378"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679063377"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063377"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showParen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063378"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ShowS -&gt; ShowS) -&gt; ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-200"></span><span>                     </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Effect &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; m ShowSWrapper -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showsPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">(m ShowSWrapper -&gt; ShowS) -&gt; m ShowSWrapper -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">((Either r (f (Stream f m r)) -&gt; ShowSWrapper)
 -&gt; m (Either r (f (Stream f m r))) -&gt; m ShowSWrapper)
-&gt; m (Either r (f (Stream f m r)))
-&gt; (Either r (f (Stream f m r)) -&gt; ShowSWrapper)
-&gt; m ShowSWrapper
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Either r (f (Stream f m r)) -&gt; ShowSWrapper)
-&gt; m (Either r (f (Stream f m r))) -&gt; m ShowSWrapper
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063377"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Either r (f (Stream f m r)) -&gt; ShowSWrapper) -&gt; m ShowSWrapper)
-&gt; (Either r (f (Stream f m r)) -&gt; ShowSWrapper) -&gt; m ShowSWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679063372"><span class="annot"><span class="annottext">Either r (f (Stream f m r))
</span><a href="#local-6989586621679063372"><span class="hs-identifier hs-var">front</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><span class="annottext">(Int -&gt; ShowS) -&gt; ShowSWrapper
</span><a href="Streaming.Internal.html#SS"><span class="hs-identifier hs-var">SS</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ShowS) -&gt; ShowSWrapper) -&gt; (Int -&gt; ShowS) -&gt; ShowSWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679063370"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063370"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showParen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063370"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ShowS -&gt; ShowS) -&gt; ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either r (f (Stream f m r))
</span><a href="#local-6989586621679063372"><span class="hs-identifier hs-var">front</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-204"></span><span>          </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span id="local-6989586621679063369"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063369"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Return &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; r -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showsPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063369"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-205"></span><span>          </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679063368"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063368"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Step &quot;</span></span><span>   </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; f (Stream f m r) -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showsPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063368"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span></span></span></span><span class="hs-cpp">

#if MIN_VERSION_base(4,9,0)
</span><span>
</span><span id="line-209"></span><span id="local-6989586621679063366"><span id="local-6989586621679063367"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063363"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063367"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063366"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063367"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Streaming.Internal.html#ShowSWrapper"><span class="hs-identifier hs-type">ShowSWrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063366"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="Streaming.Internal.html#ShowSWrapper"><span class="hs-identifier hs-type">ShowSWrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063366"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063367"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>  </span><span id="local-6989586621679063361"><span class="annot"><span class="annottext">liftShowsPrec :: (Int -&gt; a -&gt; ShowS)
-&gt; ([a] -&gt; ShowS) -&gt; Int -&gt; Stream f m a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftShowsPrec</span></a></span></span><span> </span><span id="local-6989586621679063359"><span class="annot"><span class="annottext">Int -&gt; a -&gt; ShowS
</span><a href="#local-6989586621679063359"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621679063358"><span class="annot"><span class="annottext">[a] -&gt; ShowS
</span><a href="#local-6989586621679063358"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span id="local-6989586621679063357"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063357"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679063356"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063356"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showParen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063357"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ShowS -&gt; ShowS) -&gt; ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-212"></span><span>                     </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Effect &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; m ShowSWrapper -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showsPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">(m ShowSWrapper -&gt; ShowS) -&gt; m ShowSWrapper -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><span class="annottext">((Either a (f (Stream f m a)) -&gt; ShowSWrapper)
 -&gt; m (Either a (f (Stream f m a))) -&gt; m ShowSWrapper)
-&gt; m (Either a (f (Stream f m a)))
-&gt; (Either a (f (Stream f m a)) -&gt; ShowSWrapper)
-&gt; m ShowSWrapper
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a (f (Stream f m a)) -&gt; ShowSWrapper)
-&gt; m (Either a (f (Stream f m a))) -&gt; m ShowSWrapper
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m a -&gt; m (Either a (f (Stream f m a)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063356"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Either a (f (Stream f m a)) -&gt; ShowSWrapper) -&gt; m ShowSWrapper)
-&gt; (Either a (f (Stream f m a)) -&gt; ShowSWrapper) -&gt; m ShowSWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679063355"><span class="annot"><span class="annottext">Either a (f (Stream f m a))
</span><a href="#local-6989586621679063355"><span class="hs-identifier hs-var">front</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="annottext">(Int -&gt; ShowS) -&gt; ShowSWrapper
</span><a href="Streaming.Internal.html#SS"><span class="hs-identifier hs-var">SS</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ShowS) -&gt; ShowSWrapper) -&gt; (Int -&gt; ShowS) -&gt; ShowSWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679063354"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063354"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showParen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063354"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ShowS -&gt; ShowS) -&gt; ShowS -&gt; ShowS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a (f (Stream f m a))
</span><a href="#local-6989586621679063355"><span class="hs-identifier hs-var">front</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>          </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span id="local-6989586621679063353"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063353"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Return &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; ShowS
</span><a href="#local-6989586621679063359"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063353"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-217"></span><span>          </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679063352"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063352"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Step &quot;</span></span><span>   </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-218"></span><span>                     </span><span class="annot"><span class="annottext">Int -&gt; f ShowSWrapper -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">showsPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; ShowSWrapper)
-&gt; f (Stream f m a) -&gt; f ShowSWrapper
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; ShowS) -&gt; ShowSWrapper
</span><a href="Streaming.Internal.html#SS"><span class="hs-identifier hs-var">SS</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; ShowS) -&gt; ShowSWrapper)
-&gt; (Stream f m a -&gt; Int -&gt; ShowS) -&gt; Stream f m a -&gt; ShowSWrapper
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679063351"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063351"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621679063350"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063350"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a -&gt; ShowS)
-&gt; ([a] -&gt; ShowS) -&gt; Int -&gt; Stream f m a -&gt; ShowS
forall (f :: * -&gt; *) a.
Show1 f =&gt;
(Int -&gt; a -&gt; ShowS) -&gt; ([a] -&gt; ShowS) -&gt; Int -&gt; f a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftShowsPrec</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; ShowS
</span><a href="#local-6989586621679063359"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; ShowS
</span><a href="#local-6989586621679063358"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063350"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063351"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063352"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-222"></span><span class="hs-keyword">newtype</span><span> </span><span id="ShowSWrapper"><span class="annot"><a href="Streaming.Internal.html#ShowSWrapper"><span class="hs-identifier hs-var">ShowSWrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SS"><span class="annot"><a href="Streaming.Internal.html#SS"><span class="hs-identifier hs-var">SS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">ShowS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063345"><span id="local-6989586621679063347"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Streaming.Internal.html#ShowSWrapper"><span class="hs-identifier hs-type">ShowSWrapper</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621679063344"><span class="annot"><span class="annottext">showsPrec :: Int -&gt; ShowSWrapper -&gt; ShowS
</span><a href="#local-6989586621679063344"><span class="hs-identifier hs-var hs-var hs-var hs-var">showsPrec</span></a></span></span><span> </span><span id="local-6989586621679063343"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063343"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#SS"><span class="hs-identifier hs-type">SS</span></a></span><span> </span><span id="local-6989586621679063342"><span class="annot"><span class="annottext">Int -&gt; ShowS
</span><a href="#local-6989586621679063342"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShowS
</span><a href="#local-6989586621679063342"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063343"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span class="hs-comment">-- | Operates covariantly on the stream result, not on its elements:</span><span>
</span><span id="line-227"></span><span class="hs-comment">--</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Stream (Of a) m r</span><span>
</span><span id="line-230"></span><span class="hs-comment">--            ^    ^</span><span>
</span><span id="line-231"></span><span class="hs-comment">--            |    `--- This is what `Functor` and `Applicative` use</span><span>
</span><span id="line-232"></span><span class="hs-comment">--            `--- This is what functions like S.map/S.zipWith use</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-234"></span><span id="local-6989586621679063340"><span id="local-6989586621679063341"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063341"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063340"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063341"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063340"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621679063336"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; Stream f m a -&gt; Stream f m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></a></span></span><span> </span><span id="local-6989586621679063335"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679063335"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063334"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621679063334"><span class="annot"><span class="annottext">loop :: Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063334"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063333"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063333"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063333"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063332"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063332"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679063335"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063332"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063331"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063331"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m b) -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span id="local-6989586621679063330"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063330"><span class="hs-identifier hs-var">stream'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063331"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; m (Stream f m b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063334"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063330"><span class="hs-identifier hs-var">stream'</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063329"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063329"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m b) -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b)
-&gt; f (Stream f m a) -&gt; f (Stream f m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063334"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063329"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-pragma hs-type">fmap</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621679063328"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063328"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679063327"><span class="annot"><span class="annottext">&lt;$ :: a -&gt; Stream f m b -&gt; Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;$</span></a></span></span><span> </span><span id="local-6989586621679063325"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063325"><span class="hs-identifier hs-var">stream0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f m a
</span><a href="#local-6989586621679063324"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063325"><span class="hs-identifier hs-var">stream0</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>    </span><span id="local-6989586621679063324"><span class="annot"><span class="annottext">loop :: Stream f m b -&gt; Stream f m a
</span><a href="#local-6989586621679063324"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063323"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063323"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063323"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063328"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063322"><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063322"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m a) -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span id="local-6989586621679063321"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063321"><span class="hs-identifier hs-var">stream'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063322"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; m (Stream f m a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f m a
</span><a href="#local-6989586621679063324"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063321"><span class="hs-identifier hs-var">stream'</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063320"><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063320"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m a) -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m b -&gt; Stream f m a)
-&gt; f (Stream f m b) -&gt; f (Stream f m a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f m a
</span><a href="#local-6989586621679063324"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063320"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;$</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span id="local-6989586621679063318"><span id="local-6989586621679063319"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063319"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063318"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063319"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063318"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621679063312"><span class="annot"><span class="annottext">return :: a -&gt; Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">return</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-pragma hs-type">return</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621679063311"><span class="annot"><span class="annottext">&gt;&gt; :: Stream f m a -&gt; Stream f m b -&gt; Stream f m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">(&gt;&gt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b -&gt; Stream f m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(*&gt;)</span></a></span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&gt;&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-comment">-- (&gt;&gt;=) = _bind</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-comment">-- {-# INLINE (&gt;&gt;=) #-}</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621679063310"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063310"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span id="local-6989586621679063309"><span class="annot"><span class="annottext">&gt;&gt;= :: Stream f m a -&gt; (a -&gt; Stream f m b) -&gt; Stream f m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&gt;&gt;=</span></a></span></span><span> </span><span id="local-6989586621679063308"><span class="annot"><span class="annottext">a -&gt; Stream f m b
</span><a href="#local-6989586621679063308"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063307"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063310"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679063307"><span class="annot"><span class="annottext">loop :: Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063307"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063306"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063306"><span class="hs-identifier hs-var">stream0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063306"><span class="hs-identifier hs-var">stream0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-259"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063305"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063305"><span class="hs-identifier hs-var">fstr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m b) -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b)
-&gt; f (Stream f m a) -&gt; f (Stream f m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063307"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063305"><span class="hs-identifier hs-var">fstr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063304"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063304"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m b) -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b)
-&gt; m (Stream f m a) -&gt; m (Stream f m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063307"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063304"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063303"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063303"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f m b
</span><a href="#local-6989586621679063308"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063303"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&gt;&gt;=</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span></span><span class="hs-cpp">

#if !(MIN_VERSION_base(4,13,0))
</span><span>  </span><span class="hs-identifier">fail</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lift</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Prelude.fail</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">fail</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-269"></span><span id="local-6989586621679063301"><span id="local-6989586621679063302"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063302"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063301"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063302"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063301"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621679063297"><span class="annot"><span class="annottext">fail :: [Char] -&gt; Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">fail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; Stream f m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; Stream f m a) -&gt; ([Char] -&gt; m a) -&gt; [Char] -&gt; Stream f m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Fail.fail</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-pragma hs-type">fail</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- _bind</span><span>
</span><span id="line-274"></span><span class="hs-comment">--     :: (Functor f, Monad m)</span><span>
</span><span id="line-275"></span><span class="hs-comment">--     =&gt; Stream f m r</span><span>
</span><span id="line-276"></span><span class="hs-comment">--     -&gt; (r -&gt; Stream f m s)</span><span>
</span><span id="line-277"></span><span class="hs-comment">--     -&gt; Stream f m s</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- _bind p0 f = go p0 where</span><span>
</span><span id="line-279"></span><span class="hs-comment">--     go p = case p of</span><span>
</span><span id="line-280"></span><span class="hs-comment">--       Step fstr  -&gt; Step (fmap go fstr)</span><span>
</span><span id="line-281"></span><span class="hs-comment">--       Effect m   -&gt; Effect (m &gt;&gt;= \s -&gt; return (go s))</span><span>
</span><span id="line-282"></span><span class="hs-comment">--       Return r  -&gt; f r</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- {-# INLINABLE _bind #-}</span><span>
</span><span id="line-284"></span><span class="hs-comment">--</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- see https://github.com/Gabriel439/Haskell-Pipes-Library/pull/163</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- for a plan to delay inlining and manage interaction with other operations.</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">-- {-# RULES</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-comment">-- &quot;_bind (Step    fstr) f&quot; forall  fstr f .</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-comment">--     _bind (Step fstr) f = Step (fmap (\p -&gt; _bind p f) fstr);</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-comment">-- &quot;_bind (Effect      m) f&quot; forall m    f .</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">--     _bind (Effect   m) f = Effect (m &gt;&gt;= \p -&gt; return (_bind p f));</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">-- &quot;_bind (Return     r) f&quot; forall r    f .</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-comment">--     _bind (Return  r) f = f r;</span><span>
</span><span id="line-295"></span><span class="hs-comment">--  #-}</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span id="local-6989586621679063294"><span id="local-6989586621679063295"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063286"><span id="local-6989586621679063289"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063295"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063294"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063295"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063294"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621679063284"><span class="annot"><span class="annottext">pure :: a -&gt; Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-pragma hs-type">pure</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621679063283"><span class="annot"><span class="annottext">Stream f m (a -&gt; b)
</span><a href="#local-6989586621679063283"><span class="hs-identifier hs-var">streamf</span></a></span></span><span> </span><span id="local-6989586621679063282"><span class="annot"><span class="annottext">&lt;*&gt; :: Stream f m (a -&gt; b) -&gt; Stream f m a -&gt; Stream f m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;*&gt;</span></a></span></span><span> </span><span id="local-6989586621679063281"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063281"><span class="hs-identifier hs-var">streamx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span id="local-6989586621679063280"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679063280"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream f m (a -&gt; b)
</span><a href="#local-6989586621679063283"><span class="hs-identifier hs-var">streamf</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621679063279"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063279"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063281"><span class="hs-identifier hs-var">streamx</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Stream f m b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679063280"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063279"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;*&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679063278"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063278"><span class="hs-identifier hs-var">stream1</span></a></span></span><span> </span><span id="local-6989586621679063277"><span class="annot"><span class="annottext">*&gt; :: Stream f m a -&gt; Stream f m b -&gt; Stream f m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">*&gt;</span></a></span></span><span> </span><span id="local-6989586621679063276"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063276"><span class="hs-identifier hs-var">stream2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063275"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063278"><span class="hs-identifier hs-var">stream1</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-303"></span><span>    </span><span id="local-6989586621679063275"><span class="annot"><span class="annottext">loop :: Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063275"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063274"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063274"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063274"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063276"><span class="hs-identifier hs-var">stream2</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063273"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063273"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m b) -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b)
-&gt; m (Stream f m a) -&gt; m (Stream f m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063275"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063273"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063272"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063272"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m b) -&gt; Stream f m b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m b)
-&gt; f (Stream f m a) -&gt; f (Stream f m b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m b
</span><a href="#local-6989586621679063275"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063272"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>  </span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">*&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-comment">{- | The 'Alternative' instance glues streams together stepwise.

&gt; empty = never
&gt; (&lt;|&gt;) = zipsWith (liftA2 (,))

   See also 'never', 'untilJust' and 'delays'
-}</span><span>
</span><span id="line-317"></span><span id="local-6989586621679063270"><span id="local-6989586621679063271"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063263"><span id="local-6989586621679063265"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063271"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063270"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Alternative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063271"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063270"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-318"></span><span>  </span><span id="local-6989586621679063261"><span class="annot"><span class="annottext">empty :: Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Applicative f) =&gt;
Stream f m r
</span><a href="Streaming.Internal.html#never"><span class="hs-identifier hs-var">never</span></a></span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-pragma hs-type">empty</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>  </span><span id="local-6989586621679063259"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063259"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621679063258"><span class="annot"><span class="annottext">&lt;|&gt; :: Stream f m a -&gt; Stream f m a -&gt; Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;|&gt;</span></a></span></span><span> </span><span id="local-6989586621679063256"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063256"><span class="hs-identifier hs-var">str'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; f y -&gt; f p)
-&gt; Stream f m a -&gt; Stream f m a -&gt; Stream f m a
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) (m :: * -&gt; *) r.
Monad m =&gt;
(forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-identifier hs-var">zipsWith'</span></a></span><span> </span><span class="annot"><span class="annottext">forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; f y -&gt; f p
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftA2</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063259"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063256"><span class="hs-identifier hs-var">str'</span></a></span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;|&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span id="local-6989586621679063252"><span id="local-6989586621679063253"><span id="local-6989586621679063254"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063247"><span id="local-6989586621679063249"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063254"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063253"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063252"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063254"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063253"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063252"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>  </span><span id="local-6989586621679063245"><span class="annot"><span class="annottext">Stream f m w
</span><a href="#local-6989586621679063245"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679063244"><span class="annot"><span class="annottext">&lt;&gt; :: Stream f m w -&gt; Stream f m w -&gt; Stream f m w
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621679063243"><span class="annot"><span class="annottext">Stream f m w
</span><a href="#local-6989586621679063243"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m w
</span><a href="#local-6989586621679063245"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m w -&gt; (w -&gt; Stream f m w) -&gt; Stream f m w
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679063242"><span class="annot"><span class="annottext">w
</span><a href="#local-6989586621679063242"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(w -&gt; w) -&gt; Stream f m w -&gt; Stream f m w
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">w
</span><a href="#local-6989586621679063242"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">w -&gt; w -&gt; w
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stream f m w
</span><a href="#local-6989586621679063243"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span id="local-6989586621679063239"><span id="local-6989586621679063240"><span id="local-6989586621679063241"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063233"><span id="local-6989586621679063235"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063241"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063240"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063239"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063241"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063240"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063239"><span class="hs-identifier hs-type">w</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621679063231"><span class="annot"><span class="annottext">mempty :: Stream f m w
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">w -&gt; Stream f m w
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">w
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-pragma hs-type">mempty</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span class="hs-cpp">
#if !(MIN_VERSION_base(4,11,0))
</span><span>  </span><span class="hs-identifier">mappend</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">w</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">w</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mappend</span><span class="hs-special">`</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">b</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mappend</span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-336"></span><span id="local-6989586621679063229"><span id="local-6989586621679063230"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063230"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063229"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadPlus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063230"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063229"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>  </span><span id="local-6989586621679063223"><span class="annot"><span class="annottext">mzero :: Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mzero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-338"></span><span>  </span><span id="local-6989586621679063221"><span class="annot"><span class="annottext">mplus :: Stream f m a -&gt; Stream f m a -&gt; Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mplus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m a -&gt; Stream f m a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(&lt;|&gt;)</span></a></span></span></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span id="local-6989586621679063219"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063219"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">MonadTrans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063219"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-341"></span><span>  </span><span id="local-6989586621679063216"><span class="annot"><span class="annottext">lift :: m a -&gt; Stream f m a
</span><a href="#local-6989586621679063216"><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m a) -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m a) -&gt; Stream f m a)
-&gt; (m a -&gt; m (Stream f m a)) -&gt; m a -&gt; Stream f m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Stream f m a) -&gt; m a -&gt; m (Stream f m a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-pragma hs-type">lift</span></a></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span id="local-6989586621679063215"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063215"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../mmorph/html/src"><span class="hs-identifier hs-type">MFunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063215"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-345"></span><span>  </span><span id="local-6989586621679063212"><span class="annot"><span class="annottext">hoist :: (forall a. m a -&gt; n a) -&gt; Stream f m b -&gt; Stream f n b
</span><a href="../../../../mmorph/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">hoist</span></a></span></span><span> </span><span id="local-6989586621679063210"><span class="annot"><span class="annottext">forall a. m a -&gt; n a
</span><a href="#local-6989586621679063210"><span class="hs-identifier hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063209"><span class="hs-identifier hs-var">loop</span></a></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679063209"><span class="annot"><span class="annottext">loop :: Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063209"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063208"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063208"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063208"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-347"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063207"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063207"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Stream f n b
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063207"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063206"><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063206"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">n (Stream f n b) -&gt; Stream f n b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Stream f n b) -&gt; n (Stream f n b)
forall a. m a -&gt; n a
</span><a href="#local-6989586621679063210"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m b -&gt; Stream f n b)
-&gt; m (Stream f m b) -&gt; m (Stream f n b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063209"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063206"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063205"><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063205"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f n b) -&gt; Stream f n b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m b -&gt; Stream f n b)
-&gt; f (Stream f m b) -&gt; f (Stream f n b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063209"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063205"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="../../../../mmorph/html/src"><span class="hs-pragma hs-type">hoist</span></a></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span id="local-6989586621679063204"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063204"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../mmorph/html/src"><span class="hs-identifier hs-type">MMonad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063204"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-354"></span><span>  </span><span id="local-6989586621679063199"><span class="annot"><span class="annottext">embed :: (forall a. m a -&gt; Stream f n a) -&gt; Stream f m b -&gt; Stream f n b
</span><a href="../../../../mmorph/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">embed</span></a></span></span><span> </span><span id="local-6989586621679063197"><span class="annot"><span class="annottext">forall a. m a -&gt; Stream f n a
</span><a href="#local-6989586621679063197"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063196"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621679063196"><span class="annot"><span class="annottext">loop :: Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063196"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063195"><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063195"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m b
</span><a href="#local-6989586621679063195"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063194"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063194"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Stream f n b
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063194"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063193"><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063193"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m b) -&gt; Stream f n (Stream f m b)
forall a. m a -&gt; Stream f n a
</span><a href="#local-6989586621679063197"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m b)
</span><a href="#local-6989586621679063193"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f n (Stream f m b)
-&gt; (Stream f m b -&gt; Stream f n b) -&gt; Stream f n b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063196"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063192"><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063192"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f n b) -&gt; Stream f n b
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m b -&gt; Stream f n b)
-&gt; f (Stream f m b) -&gt; f (Stream f n b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m b -&gt; Stream f n b
</span><a href="#local-6989586621679063196"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m b)
</span><a href="#local-6989586621679063192"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>  </span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="../../../../mmorph/html/src"><span class="hs-pragma hs-type">embed</span></a></span><span> </span><span class="hs-pragma">#-}</span></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span id="local-6989586621679063190"><span id="local-6989586621679063191"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063191"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063190"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063190"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063191"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-362"></span><span>  </span><span id="local-6989586621679063186"><span class="annot"><span class="annottext">liftIO :: IO a -&gt; Stream f m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">liftIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m a) -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m a) -&gt; Stream f m a)
-&gt; (IO a -&gt; m (Stream f m a)) -&gt; IO a -&gt; Stream f m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Stream f m a) -&gt; m a -&gt; m (Stream f m a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; m (Stream f m a))
-&gt; (IO a -&gt; m a) -&gt; IO a -&gt; m (Stream f m a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-pragma hs-type">liftIO</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span id="local-6989586621679063182"><span id="local-6989586621679063183"><span id="local-6989586621679063184"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679063177"><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063184"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063183"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063182"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063183"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063184"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063182"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-366"></span><span>  </span><span id="local-6989586621679063175"><span class="annot"><span class="annottext">ask :: Stream f m r
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">ask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m r -&gt; Stream f m r
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">m r
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-pragma hs-type">ask</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-368"></span><span>  </span><span id="local-6989586621679063173"><span class="annot"><span class="annottext">local :: (r -&gt; r) -&gt; Stream f m a -&gt; Stream f m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">local</span></a></span></span><span> </span><span id="local-6989586621679063171"><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621679063171"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; m a) -&gt; Stream f m a -&gt; Stream f m a
forall k (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
</span><a href="../../../../mmorph/html/src"><span class="hs-identifier hs-var">hoist</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(r -&gt; r) -&gt; m a -&gt; m a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; r
</span><a href="#local-6989586621679063171"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-pragma hs-type">local</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span id="local-6989586621679063168"><span id="local-6989586621679063169"><span id="local-6989586621679063170"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063170"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063169"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063169"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063170"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063168"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-372"></span><span>  </span><span id="local-6989586621679063162"><span class="annot"><span class="annottext">get :: Stream f m s
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m s -&gt; Stream f m s
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">m s
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-pragma hs-type">get</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-374"></span><span>  </span><span id="local-6989586621679063160"><span class="annot"><span class="annottext">put :: s -&gt; Stream f m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">put</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; Stream f m ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; Stream f m ()) -&gt; (s -&gt; m ()) -&gt; s -&gt; Stream f m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">put</span></a></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-pragma hs-type">put</span></a></span><span> </span><span class="hs-pragma">#-}</span><span class="hs-cpp">
#if MIN_VERSION_mtl(2,1,1)
</span><span>  </span><span id="local-6989586621679063158"><span class="annot"><span class="annottext">state :: (s -&gt; (a, s)) -&gt; Stream f m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">state</span></a></span></span><span> </span><span id="local-6989586621679063156"><span class="annot"><span class="annottext">s -&gt; (a, s)
</span><a href="#local-6989586621679063156"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; Stream f m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(s -&gt; (a, s)) -&gt; m a
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; (a, s)
</span><a href="#local-6989586621679063156"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-pragma hs-type">state</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-381"></span><span id="local-6989586621679063153"><span id="local-6989586621679063154"><span id="local-6989586621679063155"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063155"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063154"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063153"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier hs-type">MonadError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063154"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063155"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063153"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-382"></span><span>  </span><span id="local-6989586621679063148"><span class="annot"><span class="annottext">throwError :: e -&gt; Stream f m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">throwError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a -&gt; Stream f m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m a -&gt; Stream f m a) -&gt; (e -&gt; m a) -&gt; e -&gt; Stream f m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">throwError</span></a></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-pragma hs-type">throwError</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-384"></span><span>  </span><span id="local-6989586621679063146"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063146"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621679063145"><span class="annot"><span class="annottext">catchError :: Stream f m a -&gt; (e -&gt; Stream f m a) -&gt; Stream f m a
</span><a href="../../../../mtl/html/src"><span class="hs-operator hs-var hs-var hs-var hs-var">`catchError`</span></a></span></span><span> </span><span id="local-6989586621679063143"><span class="annot"><span class="annottext">e -&gt; Stream f m a
</span><a href="#local-6989586621679063143"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m a
</span><a href="#local-6989586621679063142"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063146"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-385"></span><span>    </span><span id="local-6989586621679063142"><span class="annot"><span class="annottext">loop :: Stream f m a -&gt; Stream f m a
</span><a href="#local-6989586621679063142"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063141"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063141"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063141"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-386"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063140"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063140"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063140"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-387"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063139"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063139"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m a) -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m a) -&gt; Stream f m a)
-&gt; m (Stream f m a) -&gt; Stream f m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m a)
-&gt; m (Stream f m a) -&gt; m (Stream f m a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m a
</span><a href="#local-6989586621679063142"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063139"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a) -&gt; (e -&gt; m (Stream f m a)) -&gt; m (Stream f m a)
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-operator hs-var">`catchError`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m a -&gt; m (Stream f m a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m a -&gt; m (Stream f m a))
-&gt; (e -&gt; Stream f m a) -&gt; e -&gt; m (Stream f m a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Stream f m a
</span><a href="#local-6989586621679063143"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063138"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063138"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m a) -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m a)
-&gt; f (Stream f m a) -&gt; f (Stream f m a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f m a
</span><a href="#local-6989586621679063142"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063138"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>  </span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-pragma hs-type">catchError</span></a></span><span> </span><span class="hs-pragma">#-}</span></span></span></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-comment">{-| Map a stream to its church encoding; compare @Data.List.foldr@.
    'destroyExposed' may be more efficient in some cases when
    applicable, but it is less safe.

    @
    destroy s construct eff done
      = eff . iterT (return . construct . fmap eff) . fmap done $ s
    @
-}</span><span>
</span><span id="line-400"></span><span id="local-6989586621679063815"><span id="local-6989586621679063816"><span id="local-6989586621679063817"><span id="local-6989586621679063818"><span class="annot"><a href="Streaming.Internal.html#destroy"><span class="hs-identifier hs-type">destroy</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063818"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063817"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-402"></span><span>     </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063818"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063816"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063818"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063815"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063815"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063817"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063815"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063815"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063816"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063815"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063815"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-403"></span><span id="destroy"><span class="annot"><span class="annottext">destroy :: Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroy"><span class="hs-identifier hs-var hs-var">destroy</span></a></span></span><span> </span><span id="local-6989586621679063137"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063137"><span class="hs-identifier hs-var">stream0</span></a></span></span><span> </span><span id="local-6989586621679063136"><span class="annot"><span class="annottext">f b -&gt; b
</span><a href="#local-6989586621679063136"><span class="hs-identifier hs-var">construct</span></a></span></span><span> </span><span id="local-6989586621679063135"><span class="annot"><span class="annottext">m b -&gt; b
</span><a href="#local-6989586621679063135"><span class="hs-identifier hs-var">theEffect</span></a></span></span><span> </span><span id="local-6989586621679063134"><span class="annot"><span class="annottext">r -&gt; b
</span><a href="#local-6989586621679063134"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m b -&gt; b
</span><a href="#local-6989586621679063135"><span class="hs-identifier hs-var">theEffect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m r -&gt; m b
</span><a href="#local-6989586621679063133"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063137"><span class="hs-identifier hs-var">stream0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-404"></span><span>  </span><span id="local-6989586621679063133"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; m b
</span><a href="#local-6989586621679063133"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063132"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063132"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063132"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063131"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063131"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; b
</span><a href="#local-6989586621679063134"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063131"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063130"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063130"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063130"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; (Stream f m r -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m b
</span><a href="#local-6989586621679063133"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063129"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063129"><span class="hs-identifier hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f b -&gt; b
</span><a href="#local-6989586621679063136"><span class="hs-identifier hs-var">construct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; b) -&gt; f (Stream f m r) -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m b -&gt; b
</span><a href="#local-6989586621679063135"><span class="hs-identifier hs-var">theEffect</span></a></span><span> </span><span class="annot"><span class="annottext">(m b -&gt; b) -&gt; (Stream f m r -&gt; m b) -&gt; Stream f m r -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m b
</span><a href="#local-6989586621679063133"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063129"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#destroy"><span class="hs-pragma hs-type">destroy</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">{-| 'streamFold' reorders the arguments of 'destroy' to be more akin
    to @foldr@  It is more convenient to query in ghci to figure out
    what kind of \'algebra\' you need to write.

&gt;&gt;&gt; :t streamFold return join
(Monad m, Functor f) =&gt;
     (f (m a) -&gt; m a) -&gt; Stream f m a -&gt; m a        -- iterT

&gt;&gt;&gt; :t streamFold return (join . lift)
(Monad m, Monad (t m), Functor f, MonadTrans t) =&gt;
     (f (t m a) -&gt; t m a) -&gt; Stream f m a -&gt; t m a  -- iterTM

&gt;&gt;&gt; :t streamFold return effect
(Monad m, Functor f, Functor g) =&gt;
     (f (Stream g m r) -&gt; Stream g m r) -&gt; Stream f m r -&gt; Stream g m r

&gt;&gt;&gt; :t \f -&gt; streamFold return effect (wrap . f)
(Monad m, Functor f, Functor g) =&gt;
     (f (Stream g m a) -&gt; g (Stream g m a))
     -&gt; Stream f m a -&gt; Stream g m a                 -- maps

&gt;&gt;&gt; :t \f -&gt; streamFold return effect (effect . fmap wrap . f)
(Monad m, Functor f, Functor g) =&gt;
     (f (Stream g m a) -&gt; m (g (Stream g m a)))
     -&gt; Stream f m a -&gt; Stream g m a                 -- mapped

@
    streamFold done eff construct
       = eff . iterT (return . construct . fmap eff) . fmap done
@
-}</span><span>
</span><span id="line-442"></span><span id="local-6989586621679063125"><span id="local-6989586621679063126"><span id="local-6989586621679063127"><span id="local-6989586621679063128"><span class="annot"><a href="Streaming.Internal.html#streamFold"><span class="hs-identifier hs-type">streamFold</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063128"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-444"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063126"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063125"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063127"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063125"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063125"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063128"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063125"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063125"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063128"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063127"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063126"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063125"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-445"></span><span id="streamFold"><span class="annot"><span class="annottext">streamFold :: (r -&gt; b) -&gt; (m b -&gt; b) -&gt; (f b -&gt; b) -&gt; Stream f m r -&gt; b
</span><a href="Streaming.Internal.html#streamFold"><span class="hs-identifier hs-var hs-var">streamFold</span></a></span></span><span> </span><span id="local-6989586621679063124"><span class="annot"><span class="annottext">r -&gt; b
</span><a href="#local-6989586621679063124"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span id="local-6989586621679063123"><span class="annot"><span class="annottext">m b -&gt; b
</span><a href="#local-6989586621679063123"><span class="hs-identifier hs-var">theEffect</span></a></span></span><span> </span><span id="local-6989586621679063122"><span class="annot"><span class="annottext">f b -&gt; b
</span><a href="#local-6989586621679063122"><span class="hs-identifier hs-var">construct</span></a></span></span><span> </span><span id="local-6989586621679063121"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063121"><span class="hs-identifier hs-var">stream</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
forall (f :: * -&gt; *) (m :: * -&gt; *) r b.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroy"><span class="hs-identifier hs-var">destroy</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063121"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="annot"><span class="annottext">f b -&gt; b
</span><a href="#local-6989586621679063122"><span class="hs-identifier hs-var">construct</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; b
</span><a href="#local-6989586621679063123"><span class="hs-identifier hs-var">theEffect</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; b
</span><a href="#local-6989586621679063124"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-446"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#streamFold"><span class="hs-pragma hs-type">streamFold</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="hs-comment">{- | Reflect a church-encoded stream; cp. @GHC.Exts.build@

&gt; streamFold return_ effect_ step_ (streamBuild psi) = psi return_ effect_ step_
-}</span><span>
</span><span id="line-452"></span><span id="local-6989586621679063118"><span id="local-6989586621679063119"><span id="local-6989586621679063120"><span class="annot"><a href="Streaming.Internal.html#streamBuild"><span class="hs-identifier hs-type">streamBuild</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063813"><span class="annot"><a href="#local-6989586621679063813"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063120"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063813"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063119"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063813"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063813"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063118"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063813"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063813"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="#local-6989586621679063813"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063118"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063119"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063120"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-454"></span><span id="streamBuild"><span class="annot"><span class="annottext">streamBuild :: (forall b. (r -&gt; b) -&gt; (m b -&gt; b) -&gt; (f b -&gt; b) -&gt; b)
-&gt; Stream f m r
</span><a href="Streaming.Internal.html#streamBuild"><span class="hs-identifier hs-var hs-var">streamBuild</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679063117"><span class="annot"><span class="annottext">forall b. (r -&gt; b) -&gt; (m b -&gt; b) -&gt; (f b -&gt; b) -&gt; b
</span><a href="#local-6989586621679063117"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(r -&gt; Stream f m r)
-&gt; (m (Stream f m r) -&gt; Stream f m r)
-&gt; (f (Stream f m r) -&gt; Stream f m r)
-&gt; Stream f m r
forall b. (r -&gt; b) -&gt; (m b -&gt; b) -&gt; (f b -&gt; b) -&gt; b
</span><a href="#local-6989586621679063117"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span>
</span><span id="line-455"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#streamBuild"><span class="hs-pragma hs-type">streamBuild</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-comment">{-| Inspect the first stage of a freely layered sequence.
    Compare @Pipes.next@ and the replica @Streaming.Prelude.next@.
    This is the 'uncons' for the general 'unfold'.

&gt; unfold inspect = id
&gt; Streaming.Prelude.unfoldr StreamingPrelude.next = id
-}</span><span>
</span><span id="line-465"></span><span id="local-6989586621679064038"><span id="local-6989586621679064039"><span id="local-6989586621679064040"><span class="annot"><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-type">inspect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064040"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-466"></span><span>     </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064039"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064040"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064038"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679064040"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064038"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679064039"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064039"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064040"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064038"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-467"></span><span id="inspect"><span class="annot"><span class="annottext">inspect :: Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var hs-var">inspect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Either r (f (Stream f m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="#local-6989586621679063116"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-468"></span><span>  </span><span id="local-6989586621679063116"><span class="annot"><span class="annottext">loop :: Stream f m a -&gt; m (Either a (f (Stream f m a)))
</span><a href="#local-6989586621679063116"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063115"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063115"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063115"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063114"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063114"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either a (f (Stream f m a)) -&gt; m (Either a (f (Stream f m a)))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a (f (Stream f m a))
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063114"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063113"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063113"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679063113"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
-&gt; (Stream f m a -&gt; m (Either a (f (Stream f m a))))
-&gt; m (Either a (f (Stream f m a)))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; m (Either a (f (Stream f m a)))
</span><a href="#local-6989586621679063116"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063112"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063112"><span class="hs-identifier hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either a (f (Stream f m a)) -&gt; m (Either a (f (Stream f m a)))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m a) -&gt; Either a (f (Stream f m a))
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679063112"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#inspect"><span class="hs-pragma hs-type">inspect</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="hs-comment">{-| Build a @Stream@ by unfolding steps starting from a seed. See also
    the specialized 'Streaming.Prelude.unfoldr' in the prelude.

&gt; unfold inspect = id -- modulo the quotient we work with
&gt; unfold Pipes.next :: Monad m =&gt; Producer a m r -&gt; Stream ((,) a) m r
&gt; unfold (curry (:&gt;) . Pipes.next) :: Monad m =&gt; Producer a m r -&gt; Stream (Of a) m r

-}</span><span>
</span><span id="line-482"></span><span id="local-6989586621679063108"><span id="local-6989586621679063109"><span id="local-6989586621679063110"><span id="local-6989586621679063111"><span class="annot"><a href="Streaming.Internal.html#unfold"><span class="hs-identifier hs-type">unfold</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063111"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063110"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063109"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063108"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063110"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063109"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063109"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063110"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063108"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-485"></span><span id="unfold"><span class="annot"><span class="annottext">unfold :: (s -&gt; m (Either r (f s))) -&gt; s -&gt; Stream f m r
</span><a href="Streaming.Internal.html#unfold"><span class="hs-identifier hs-var hs-var">unfold</span></a></span></span><span> </span><span id="local-6989586621679063107"><span class="annot"><span class="annottext">s -&gt; m (Either r (f s))
</span><a href="#local-6989586621679063107"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s -&gt; Stream f m r
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-486"></span><span>  </span><span id="local-6989586621679063106"><span class="annot"><span class="annottext">loop :: s -&gt; Stream f m r
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063105"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679063105"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m r) -&gt; Stream f m r)
-&gt; m (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-487"></span><span>    </span><span id="local-6989586621679063104"><span class="annot"><span class="annottext">Either r (f s)
</span><a href="#local-6989586621679063104"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s -&gt; m (Either r (f s))
</span><a href="#local-6989586621679063107"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679063105"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; m (Stream f m r))
-&gt; Stream f m r -&gt; m (Stream f m r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either r (f s)
</span><a href="#local-6989586621679063104"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-489"></span><span>       </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span>  </span><span id="local-6989586621679063103"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063103"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063103"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-490"></span><span>       </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679063102"><span class="annot"><span class="annottext">f s
</span><a href="#local-6989586621679063102"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(s -&gt; Stream f m r) -&gt; f s -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Stream f m r
</span><a href="#local-6989586621679063106"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f s
</span><a href="#local-6989586621679063102"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unfold"><span class="hs-pragma hs-type">unfold</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span>
</span><span id="line-494"></span><span class="hs-comment">{- | Map layers of one functor to another with a transformation. Compare
     hoist, which has a similar effect on the 'monadic' parameter.

&gt; maps id = id
&gt; maps f . maps g = maps (f . g)

-}</span><span>
</span><span id="line-501"></span><span id="local-6989586621679063760"><span id="local-6989586621679063761"><span id="local-6989586621679063762"><span id="local-6989586621679063763"><span class="annot"><a href="Streaming.Internal.html#maps"><span class="hs-identifier hs-type">maps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063763"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063762"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063797"><span class="annot"><a href="#local-6989586621679063797"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679063762"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063797"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063761"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063797"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063762"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063760"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063761"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063763"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063760"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-503"></span><span id="maps"><span class="annot"><span class="annottext">maps :: (forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#maps"><span class="hs-identifier hs-var hs-var">maps</span></a></span></span><span> </span><span id="local-6989586621679063101"><span class="annot"><span class="annottext">forall x. f x -&gt; g x
</span><a href="#local-6989586621679063101"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063100"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-504"></span><span>  </span><span id="local-6989586621679063100"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063100"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063099"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063099"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063099"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063098"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063098"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063098"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063097"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063097"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; m (Stream f m r) -&gt; m (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063100"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063097"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063096"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063096"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">g (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream g m r) -&gt; g (Stream g m r)
forall x. f x -&gt; g x
</span><a href="#local-6989586621679063101"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; f (Stream f m r) -&gt; f (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063100"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063096"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#maps"><span class="hs-pragma hs-type">maps</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-comment">{- | Map layers of one functor to another with a transformation involving the base monad.
     'maps' is more fundamental than @mapsM@, which is best understood as a convenience
     for effecting this frequent composition:

&gt; mapsM phi = decompose . maps (Compose . phi)

     The streaming prelude exports the same function under the better name @mapped@,
     which overlaps with the lens libraries.

-}</span><span>
</span><span id="line-521"></span><span id="local-6989586621679063660"><span id="local-6989586621679063661"><span id="local-6989586621679063662"><span id="local-6989586621679063663"><span class="annot"><a href="Streaming.Internal.html#mapsM"><span class="hs-identifier hs-type">mapsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063663"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063662"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063792"><span class="annot"><a href="#local-6989586621679063792"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679063662"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063792"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063661"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063792"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063662"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063660"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063661"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063663"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063660"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-522"></span><span id="mapsM"><span class="annot"><span class="annottext">mapsM :: (forall x. f x -&gt; m (g x)) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#mapsM"><span class="hs-identifier hs-var hs-var">mapsM</span></a></span></span><span> </span><span id="local-6989586621679063095"><span class="annot"><span class="annottext">forall x. f x -&gt; m (g x)
</span><a href="#local-6989586621679063095"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063094"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-523"></span><span>  </span><span id="local-6989586621679063094"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063094"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063093"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063093"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063093"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-524"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063092"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063092"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063092"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-525"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063091"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063091"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; m (Stream f m r) -&gt; m (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063094"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063091"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063090"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063090"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(g (Stream g m r) -&gt; Stream g m r)
-&gt; m (g (Stream g m r)) -&gt; m (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream g m r) -&gt; m (g (Stream g m r))
forall x. f x -&gt; m (g x)
</span><a href="#local-6989586621679063095"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; f (Stream f m r) -&gt; f (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063094"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063090"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsM"><span class="hs-pragma hs-type">mapsM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span class="hs-comment">{- | Map layers of one functor to another with a transformation. Compare
     hoist, which has a similar effect on the 'monadic' parameter.

&gt; mapsPost id = id
&gt; mapsPost f . mapsPost g = mapsPost (f . g)
&gt; mapsPost f = maps f

     @mapsPost@ is essentially the same as 'maps', but it imposes a 'Functor' constraint on
     its target functor rather than its source functor. It should be preferred if 'fmap'
     is cheaper for the target functor than for the source functor.
-}</span><span>
</span><span id="line-540"></span><span class="annot"><a href="Streaming.Internal.html#mapsPost"><span class="hs-identifier hs-type">mapsPost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063089"><span class="annot"><a href="#local-6989586621679063089"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679063088"><span class="annot"><a href="#local-6989586621679063088"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679063087"><span class="annot"><a href="#local-6989586621679063087"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679063086"><span class="annot"><a href="#local-6989586621679063086"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063089"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063087"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063787"><span class="annot"><a href="#local-6989586621679063787"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679063088"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063787"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063087"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063787"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063088"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063089"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063086"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063087"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063089"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063086"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-543"></span><span id="mapsPost"><span class="annot"><span class="annottext">mapsPost :: (forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#mapsPost"><span class="hs-identifier hs-var hs-var">mapsPost</span></a></span></span><span> </span><span id="local-6989586621679063085"><span class="annot"><span class="annottext">forall x. f x -&gt; g x
</span><a href="#local-6989586621679063085"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063084"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><a href="#local-6989586621679063084"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063088"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063089"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063086"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063087"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063089"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063086"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-545"></span><span>  </span><span id="local-6989586621679063084"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063084"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063083"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063083"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063083"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-546"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063082"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063082"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063082"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-547"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063081"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063081"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; m (Stream f m r) -&gt; m (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063084"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063081"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063080"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063080"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">g (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Stream g m r) -&gt; Stream g m r)
-&gt; g (Stream g m r) -&gt; Stream g m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; g (Stream f m r) -&gt; g (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063084"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Stream f m r) -&gt; g (Stream g m r))
-&gt; g (Stream f m r) -&gt; g (Stream g m r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; g (Stream f m r)
forall x. f x -&gt; g x
</span><a href="#local-6989586621679063085"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063080"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-549"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsPost"><span class="hs-pragma hs-type">mapsPost</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="hs-comment">{- | Map layers of one functor to another with a transformation involving the base monad.
     @mapsMPost@ is essentially the same as 'mapsM', but it imposes a 'Functor' constraint on
     its target functor rather than its source functor. It should be preferred if 'fmap'
     is cheaper for the target functor than for the source functor.

     @mapsPost@ is more fundamental than @mapsMPost@, which is best understood as a convenience
     for effecting this frequent composition:

&gt; mapsMPost phi = decompose . mapsPost (Compose . phi)

     The streaming prelude exports the same function under the better name @mappedPost@,
     which overlaps with the lens libraries.

-}</span><span>
</span><span id="line-565"></span><span class="annot"><a href="Streaming.Internal.html#mapsMPost"><span class="hs-identifier hs-type">mapsMPost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063079"><span class="annot"><a href="#local-6989586621679063079"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679063078"><span class="annot"><a href="#local-6989586621679063078"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679063077"><span class="annot"><a href="#local-6989586621679063077"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679063076"><span class="annot"><a href="#local-6989586621679063076"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063079"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063077"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063782"><span class="annot"><a href="#local-6989586621679063782"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679063078"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063782"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063077"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063782"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063078"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063076"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063077"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063076"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-568"></span><span id="mapsMPost"><span class="annot"><span class="annottext">mapsMPost :: (forall x. f x -&gt; m (g x)) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#mapsMPost"><span class="hs-identifier hs-var hs-var">mapsMPost</span></a></span></span><span> </span><span id="local-6989586621679063075"><span class="annot"><span class="annottext">forall x. f x -&gt; m (g x)
</span><a href="#local-6989586621679063075"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063074"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-569"></span><span>  </span><span class="annot"><a href="#local-6989586621679063074"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063078"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063076"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063077"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063079"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063076"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span id="local-6989586621679063074"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063074"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063073"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063073"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063073"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-571"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063072"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063072"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063072"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-572"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063071"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063071"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; m (Stream f m r) -&gt; m (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063074"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063071"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679063070"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063070"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream g m r) -&gt; Stream g m r)
-&gt; m (Stream g m r) -&gt; Stream g m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Stream f m r) -&gt; Stream g m r)
-&gt; m (g (Stream f m r)) -&gt; m (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">g (Stream g m r) -&gt; Stream g m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Stream g m r) -&gt; Stream g m r)
-&gt; (g (Stream f m r) -&gt; g (Stream g m r))
-&gt; g (Stream f m r)
-&gt; Stream g m r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r)
-&gt; g (Stream f m r) -&gt; g (Stream g m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r
</span><a href="#local-6989586621679063074"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; m (g (Stream f m r))
forall x. f x -&gt; m (g x)
</span><a href="#local-6989586621679063075"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063070"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsMPost"><span class="hs-pragma hs-type">mapsMPost</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="hs-comment">{-| Rearrange a succession of layers of the form @Compose m (f x)@.

   we could as well define @decompose@ by @mapsM@:

&gt; decompose = mapped getCompose

  but @mapped@ is best understood as:

&gt; mapped phi = decompose . maps (Compose . phi)

  since @maps@ and @hoist@ are the really fundamental operations that preserve the
  shape of the stream:

&gt; maps  :: (Monad m, Functor f) =&gt; (forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
&gt; hoist :: (Monad m, Functor f) =&gt; (forall a. m a -&gt; n a) -&gt; Stream f m r -&gt; Stream f n r

-}</span><span>
</span><span id="line-593"></span><span id="local-6989586621679063067"><span id="local-6989586621679063068"><span id="local-6989586621679063069"><span class="annot"><a href="Streaming.Internal.html#decompose"><span class="hs-identifier hs-type">decompose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063069"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063068"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Compose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063069"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063068"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063069"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063067"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063068"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063069"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063067"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-594"></span><span id="decompose"><span class="annot"><span class="annottext">decompose :: Stream (Compose m f) m r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#decompose"><span class="hs-identifier hs-var hs-var">decompose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (Compose m f) m r -&gt; Stream f m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
Stream (Compose m f) m r -&gt; Stream f m r
</span><a href="#local-6989586621679063066"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-595"></span><span>  </span><span id="local-6989586621679063066"><span class="annot"><span class="annottext">loop :: Stream (Compose m f) m r -&gt; Stream f m r
</span><a href="#local-6989586621679063066"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063065"><span class="annot"><span class="annottext">Stream (Compose m f) m r
</span><a href="#local-6989586621679063065"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream (Compose m f) m r
</span><a href="#local-6989586621679063065"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-596"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063064"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063064"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063064"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063063"><span class="annot"><span class="annottext">m (Stream (Compose m f) m r)
</span><a href="#local-6989586621679063063"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream (Compose m f) m r -&gt; Stream f m r)
-&gt; m (Stream (Compose m f) m r) -&gt; m (Stream f m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Compose m f) m r -&gt; Stream f m r
</span><a href="#local-6989586621679063066"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream (Compose m f) m r)
</span><a href="#local-6989586621679063063"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Compose</span></a></span><span> </span><span id="local-6989586621679063061"><span class="annot"><span class="annottext">m (f (Stream (Compose m f) m r))
</span><a href="#local-6989586621679063061"><span class="hs-identifier hs-var">mstr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m r) -&gt; Stream f m r)
-&gt; m (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-599"></span><span>      </span><span id="local-6989586621679063060"><span class="annot"><span class="annottext">f (Stream (Compose m f) m r)
</span><a href="#local-6989586621679063060"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (f (Stream (Compose m f) m r))
</span><a href="#local-6989586621679063061"><span class="hs-identifier hs-var">mstr</span></a></span><span>
</span><span id="line-600"></span><span>      </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream (Compose m f) m r -&gt; Stream f m r)
-&gt; f (Stream (Compose m f) m r) -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Compose m f) m r -&gt; Stream f m r
</span><a href="#local-6989586621679063066"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream (Compose m f) m r)
</span><a href="#local-6989586621679063060"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>
</span><span id="line-603"></span><span class="hs-comment">{-| Run the effects in a stream that merely layers effects.
-}</span><span>
</span><span id="line-605"></span><span id="local-6989586621679063058"><span id="local-6989586621679063059"><span class="annot"><a href="Streaming.Internal.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063058"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063058"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-606"></span><span id="run"><span class="annot"><span class="annottext">run :: Stream m m r -&gt; m r
</span><a href="Streaming.Internal.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream m m r -&gt; m r
forall (m :: * -&gt; *) b. Monad m =&gt; Stream m m b -&gt; m b
</span><a href="#local-6989586621679063057"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-607"></span><span>  </span><span id="local-6989586621679063057"><span class="annot"><span class="annottext">loop :: Stream m m b -&gt; m b
</span><a href="#local-6989586621679063057"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063056"><span class="annot"><span class="annottext">Stream m m b
</span><a href="#local-6989586621679063056"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream m m b
</span><a href="#local-6989586621679063056"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063055"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063055"><span class="hs-identifier hs-var">r</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063055"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span>  </span><span id="local-6989586621679063054"><span class="annot"><span class="annottext">m (Stream m m b)
</span><a href="#local-6989586621679063054"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream m m b)
</span><a href="#local-6989586621679063054"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream m m b) -&gt; (Stream m m b -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream m m b -&gt; m b
</span><a href="#local-6989586621679063057"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-610"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063053"><span class="annot"><span class="annottext">m (Stream m m b)
</span><a href="#local-6989586621679063053"><span class="hs-identifier hs-var">mrest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream m m b)
</span><a href="#local-6989586621679063053"><span class="hs-identifier hs-var">mrest</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream m m b) -&gt; (Stream m m b -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream m m b -&gt; m b
</span><a href="#local-6989586621679063057"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-611"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#run"><span class="hs-pragma hs-type">run</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span class="hs-comment">{-| Map each layer to an effect, and run them all.
-}</span><span>
</span><span id="line-616"></span><span id="local-6989586621679063050"><span id="local-6989586621679063051"><span id="local-6989586621679063052"><span class="annot"><a href="Streaming.Internal.html#mapsM_"><span class="hs-identifier hs-type">mapsM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063052"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063051"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063766"><span class="annot"><a href="#local-6989586621679063766"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679063052"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063766"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063051"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063766"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063052"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063051"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063050"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063051"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063050"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-617"></span><span id="mapsM_"><span class="annot"><span class="annottext">mapsM_ :: (forall x. f x -&gt; m x) -&gt; Stream f m r -&gt; m r
</span><a href="Streaming.Internal.html#mapsM_"><span class="hs-identifier hs-var hs-var">mapsM_</span></a></span></span><span> </span><span id="local-6989586621679063049"><span class="annot"><span class="annottext">forall x. f x -&gt; m x
</span><a href="#local-6989586621679063049"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream m m r -&gt; m r
forall (m :: * -&gt; *) b. Monad m =&gt; Stream m m b -&gt; m b
</span><a href="Streaming.Internal.html#run"><span class="hs-identifier hs-var">run</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream m m r -&gt; m r)
-&gt; (Stream f m r -&gt; Stream m m r) -&gt; Stream f m r -&gt; m r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(forall x. f x -&gt; m x) -&gt; Stream f m r -&gt; Stream m m r
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
(forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#maps"><span class="hs-identifier hs-var">maps</span></a></span><span> </span><span class="annot"><span class="annottext">forall x. f x -&gt; m x
</span><a href="#local-6989586621679063049"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-618"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsM_"><span class="hs-pragma hs-type">mapsM_</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span class="hs-comment">{-| Interpolate a layer at each segment. This specializes to e.g.

&gt; intercalates :: (Monad m, Functor f) =&gt; Stream f m () -&gt; Stream (Stream f m) m r -&gt; Stream f m r
-}</span><span>
</span><span id="line-625"></span><span id="local-6989586621679063045"><span id="local-6989586621679063046"><span id="local-6989586621679063047"><span id="local-6989586621679063048"><span class="annot"><a href="Streaming.Internal.html#intercalates"><span class="hs-identifier hs-type">intercalates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063047"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">MonadTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063047"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-626"></span><span>     </span><span class="annot"><a href="#local-6989586621679063047"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063046"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063047"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063045"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063047"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063048"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063045"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-627"></span><span id="intercalates"><span class="annot"><span class="annottext">intercalates :: t m x -&gt; Stream (t m) m r -&gt; t m r
</span><a href="Streaming.Internal.html#intercalates"><span class="hs-identifier hs-var hs-var">intercalates</span></a></span></span><span> </span><span id="local-6989586621679063044"><span class="annot"><span class="annottext">t m x
</span><a href="#local-6989586621679063044"><span class="hs-identifier hs-var">sep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (t m) m r -&gt; t m r
</span><a href="#local-6989586621679063043"><span class="hs-identifier hs-var">go0</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-629"></span><span>    </span><span id="local-6989586621679063043"><span class="annot"><span class="annottext">go0 :: Stream (t m) m r -&gt; t m r
</span><a href="#local-6989586621679063043"><span class="hs-identifier hs-var hs-var">go0</span></a></span></span><span> </span><span id="local-6989586621679063042"><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063042"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-630"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063041"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063041"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; t m r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063041"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-631"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063040"><span class="annot"><span class="annottext">m (Stream (t m) m r)
</span><a href="#local-6989586621679063040"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream (t m) m r) -&gt; t m (Stream (t m) m r)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream (t m) m r)
</span><a href="#local-6989586621679063040"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">t m (Stream (t m) m r) -&gt; (Stream (t m) m r -&gt; t m r) -&gt; t m r
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (t m) m r -&gt; t m r
</span><a href="#local-6989586621679063043"><span class="hs-identifier hs-var">go0</span></a></span><span>
</span><span id="line-632"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063039"><span class="annot"><span class="annottext">t m (Stream (t m) m r)
</span><a href="#local-6989586621679063039"><span class="hs-identifier hs-var">fstr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>        </span><span id="local-6989586621679063038"><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063038"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t m (Stream (t m) m r)
</span><a href="#local-6989586621679063039"><span class="hs-identifier hs-var">fstr</span></a></span><span>
</span><span id="line-634"></span><span>        </span><span class="annot"><span class="annottext">Stream (t m) m r -&gt; t m r
</span><a href="#local-6989586621679063037"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063038"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-635"></span><span>    </span><span id="local-6989586621679063037"><span class="annot"><span class="annottext">go1 :: Stream (t m) m r -&gt; t m r
</span><a href="#local-6989586621679063037"><span class="hs-identifier hs-var hs-var">go1</span></a></span></span><span> </span><span id="local-6989586621679063036"><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063036"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063036"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-636"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063035"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063035"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; t m r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063035"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-637"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063034"><span class="annot"><span class="annottext">m (Stream (t m) m r)
</span><a href="#local-6989586621679063034"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream (t m) m r) -&gt; t m (Stream (t m) m r)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream (t m) m r)
</span><a href="#local-6989586621679063034"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">t m (Stream (t m) m r) -&gt; (Stream (t m) m r -&gt; t m r) -&gt; t m r
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (t m) m r -&gt; t m r
</span><a href="#local-6989586621679063037"><span class="hs-identifier hs-var">go1</span></a></span><span>
</span><span id="line-638"></span><span>      </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063033"><span class="annot"><span class="annottext">t m (Stream (t m) m r)
</span><a href="#local-6989586621679063033"><span class="hs-identifier hs-var">fstr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-639"></span><span>        </span><span class="annot"><span class="annottext">x
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t m x
</span><a href="#local-6989586621679063044"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-640"></span><span>        </span><span id="local-6989586621679063032"><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063032"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t m (Stream (t m) m r)
</span><a href="#local-6989586621679063033"><span class="hs-identifier hs-var">fstr</span></a></span><span>
</span><span id="line-641"></span><span>        </span><span class="annot"><span class="annottext">Stream (t m) m r -&gt; t m r
</span><a href="#local-6989586621679063037"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (t m) m r
</span><a href="#local-6989586621679063032"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-642"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#intercalates"><span class="hs-pragma hs-type">intercalates</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span class="hs-comment">{-| Specialized fold following the usage of @Control.Monad.Trans.Free@

&gt; iterTM alg = streamFold return (join . lift)
&gt; iterTM alg = iterT alg . hoist lift
-}</span><span>
</span><span id="line-649"></span><span id="local-6989586621679063028"><span id="local-6989586621679063029"><span id="local-6989586621679063030"><span id="local-6989586621679063031"><span class="annot"><a href="Streaming.Internal.html#iterTM"><span class="hs-identifier hs-type">iterTM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063031"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">MonadTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063029"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-651"></span><span>   </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063029"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063031"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063029"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063028"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063029"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063028"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063031"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063028"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063029"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063030"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063028"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-653"></span><span id="iterTM"><span class="annot"><span class="annottext">iterTM :: (f (t m a) -&gt; t m a) -&gt; Stream f m a -&gt; t m a
</span><a href="Streaming.Internal.html#iterTM"><span class="hs-identifier hs-var hs-var">iterTM</span></a></span></span><span> </span><span id="local-6989586621679063027"><span class="annot"><span class="annottext">f (t m a) -&gt; t m a
</span><a href="#local-6989586621679063027"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span id="local-6989586621679063026"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063026"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a
-&gt; (f (t m a) -&gt; t m a)
-&gt; (m (t m a) -&gt; t m a)
-&gt; (a -&gt; t m a)
-&gt; t m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r b.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier hs-var">destroyExposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063026"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="annot"><span class="annottext">f (t m a) -&gt; t m a
</span><a href="#local-6989586621679063027"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t m (t m a) -&gt; t m a
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">(t m (t m a) -&gt; t m a)
-&gt; (m (t m a) -&gt; t m (t m a)) -&gt; m (t m a) -&gt; t m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m (t m a) -&gt; t m (t m a)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; t m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-654"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#iterTM"><span class="hs-pragma hs-type">iterTM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span class="hs-comment">{-| Specialized fold following the usage of @Control.Monad.Trans.Free@

&gt; iterT alg = streamFold return join alg
&gt; iterT alg = runIdentityT . iterTM (IdentityT . alg . fmap runIdentityT)
-}</span><span>
</span><span id="line-661"></span><span id="local-6989586621679063023"><span id="local-6989586621679063024"><span id="local-6989586621679063025"><span class="annot"><a href="Streaming.Internal.html#iterT"><span class="hs-identifier hs-type">iterT</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-662"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063025"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063024"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063025"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063024"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063023"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063024"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063023"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063025"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063024"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063023"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063024"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063023"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-663"></span><span id="iterT"><span class="annot"><span class="annottext">iterT :: (f (m a) -&gt; m a) -&gt; Stream f m a -&gt; m a
</span><a href="Streaming.Internal.html#iterT"><span class="hs-identifier hs-var hs-var">iterT</span></a></span></span><span> </span><span id="local-6989586621679063022"><span class="annot"><span class="annottext">f (m a) -&gt; m a
</span><a href="#local-6989586621679063022"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span id="local-6989586621679063021"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063021"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a
-&gt; (f (m a) -&gt; m a) -&gt; (m (m a) -&gt; m a) -&gt; (a -&gt; m a) -&gt; m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r b.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier hs-var">destroyExposed</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679063021"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="annot"><span class="annottext">f (m a) -&gt; m a
</span><a href="#local-6989586621679063022"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">m (m a) -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-664"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#iterT"><span class="hs-pragma hs-type">iterT</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-comment">{-| Dissolves the segmentation into layers of @Stream f m@ layers.

-}</span><span>
</span><span id="line-669"></span><span id="local-6989586621679063018"><span id="local-6989586621679063019"><span id="local-6989586621679063020"><span class="annot"><a href="Streaming.Internal.html#concats"><span class="hs-identifier hs-type">concats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063020"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063019"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063019"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063020"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063020"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063018"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063019"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063020"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063018"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-670"></span><span id="concats"><span class="annot"><span class="annottext">concats :: Stream (Stream f m) m r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#concats"><span class="hs-identifier hs-var hs-var">concats</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (Stream f m) m r -&gt; Stream f m r
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) b.
(MonadTrans t, Monad m, Monad (t m)) =&gt;
Stream (t m) m b -&gt; t m b
</span><a href="#local-6989586621679063017"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-671"></span><span>  </span><span id="local-6989586621679063017"><span class="annot"><span class="annottext">loop :: Stream (t m) m b -&gt; t m b
</span><a href="#local-6989586621679063017"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679063016"><span class="annot"><span class="annottext">Stream (t m) m b
</span><a href="#local-6989586621679063016"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream (t m) m b
</span><a href="#local-6989586621679063016"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-672"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063015"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063015"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; t m b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679063015"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-673"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063014"><span class="annot"><span class="annottext">m (Stream (t m) m b)
</span><a href="#local-6989586621679063014"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream (t m) m b) -&gt; t m (Stream (t m) m b)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream (t m) m b)
</span><a href="#local-6989586621679063014"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">t m (Stream (t m) m b) -&gt; (Stream (t m) m b -&gt; t m b) -&gt; t m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (t m) m b -&gt; t m b
</span><a href="#local-6989586621679063017"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-674"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063013"><span class="annot"><span class="annottext">t m (Stream (t m) m b)
</span><a href="#local-6989586621679063013"><span class="hs-identifier hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t m (Stream (t m) m b)
</span><a href="#local-6989586621679063013"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">t m (Stream (t m) m b) -&gt; (Stream (t m) m b -&gt; t m b) -&gt; t m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (t m) m b -&gt; t m b
</span><a href="#local-6989586621679063017"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-675"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#concats"><span class="hs-pragma hs-type">concats</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-676"></span><span>
</span><span id="line-677"></span><span class="hs-comment">{-| Split a succession of layers after some number, returning a streaming or
    effectful pair.

&gt;&gt;&gt; rest &lt;- S.print $ S.splitAt 1 $ each [1..3]
1
&gt;&gt;&gt; S.print rest
2
3

&gt; splitAt 0 = return
&gt; splitAt n &gt;=&gt; splitAt m = splitAt (m+n)

    Thus, e.g.

&gt;&gt;&gt; rest &lt;- S.print $ splitsAt 2 &gt;=&gt; splitsAt 2 $ each [1..5]
1
2
3
4
&gt;&gt;&gt; S.print rest
5

-}</span><span>
</span><span id="line-700"></span><span id="local-6989586621679063725"><span id="local-6989586621679063726"><span id="local-6989586621679063727"><span class="annot"><a href="Streaming.Internal.html#splitsAt"><span class="hs-identifier hs-type">splitsAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063727"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063726"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063726"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063727"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063726"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063727"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063726"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063727"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063725"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-701"></span><span id="splitsAt"><span class="annot"><span class="annottext">splitsAt :: Int -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="Streaming.Internal.html#splitsAt"><span class="hs-identifier hs-var hs-var">splitsAt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
forall a (m :: * -&gt; *) (f :: * -&gt; *) r.
(Ord a, Num a, Functor m, Functor f) =&gt;
a -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="#local-6989586621679063012"><span class="hs-identifier hs-var">loop</span></a></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-702"></span><span>  </span><span id="local-6989586621679063012"><span class="annot"><span class="annottext">loop :: a -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="#local-6989586621679063012"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679063011"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063011"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679063010"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063010"><span class="hs-identifier hs-var">stream</span></a></span></span><span>
</span><span id="line-703"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063011"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream f m (Stream f m r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063010"><span class="hs-identifier hs-var">stream</span></a></span><span>
</span><span id="line-704"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679063010"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-705"></span><span>        </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679063009"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063009"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream f m (Stream f m r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679063009"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679063008"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063008"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m (Stream f m r)) -&gt; Stream f m (Stream f m r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream f m (Stream f m r))
-&gt; m (Stream f m r) -&gt; m (Stream f m (Stream f m r))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="#local-6989586621679063012"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063011"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679063008"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-707"></span><span>        </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679063007"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063007"><span class="hs-identifier hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063011"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-708"></span><span>          </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream f m (Stream f m r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063007"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>          </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m (Stream f m r)) -&gt; Stream f m (Stream f m r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream f m (Stream f m r))
-&gt; f (Stream f m r) -&gt; f (Stream f m (Stream f m r))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="#local-6989586621679063012"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679063011"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679063007"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#splitsAt"><span class="hs-pragma hs-type">splitsAt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="hs-comment">{- Functor-general take.

   @takes 3@ can take three individual values

&gt;&gt;&gt; S.print $ takes 3 $ each [1..]
1
2
3


    or three sub-streams

&gt;&gt;&gt; S.print $ mapped S.toList $ takes 3 $ chunksOf 2 $ each [1..]
[1,2]
[3,4]
[5,6]

   Or, using 'Data.ByteString.Streaming.Char' (here called @Q@),
   three byte streams.

&gt;&gt;&gt; Q.stdout $ Q.unlines $ takes 3 $ Q.lines $ Q.chunk &quot;a\nb\nc\nd\ne\nf&quot;
a
b
c

-}</span><span>
</span><span id="line-738"></span><span id="local-6989586621679063004"><span id="local-6989586621679063005"><span id="local-6989586621679063006"><span class="annot"><a href="Streaming.Internal.html#takes"><span class="hs-identifier hs-type">takes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063006"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063005"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063005"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063006"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063004"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063005"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063006"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-739"></span><span id="takes"><span class="annot"><span class="annottext">takes :: Int -&gt; Stream f m r -&gt; Stream f m ()
</span><a href="Streaming.Internal.html#takes"><span class="hs-identifier hs-var hs-var">takes</span></a></span></span><span> </span><span id="local-6989586621679063003"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063003"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m (Stream f m r) -&gt; Stream f m ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m (Stream f m r) -&gt; Stream f m ())
-&gt; (Stream f m r -&gt; Stream f m (Stream f m r))
-&gt; Stream f m r
-&gt; Stream f m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
Int -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="Streaming.Internal.html#splitsAt"><span class="hs-identifier hs-var">splitsAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679063003"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-740"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#takes"><span class="hs-pragma hs-type">takes</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span class="hs-comment">{-| Break a stream into substreams each with n functorial layers.

&gt;&gt;&gt;  S.print $ mapped S.sum $ chunksOf 2 $ each [1,1,1,1,1]
2
2
1
-}</span><span>
</span><span id="line-749"></span><span id="local-6989586621679062999"><span id="local-6989586621679063000"><span id="local-6989586621679063001"><span class="annot"><a href="Streaming.Internal.html#chunksOf"><span class="hs-identifier hs-type">chunksOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063001"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063000"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063000"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063001"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062999"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063000"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063001"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063001"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062999"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-750"></span><span id="chunksOf"><span class="annot"><span class="annottext">chunksOf :: Int -&gt; Stream f m r -&gt; Stream (Stream f m) m r
</span><a href="Streaming.Internal.html#chunksOf"><span class="hs-identifier hs-var hs-var">chunksOf</span></a></span></span><span> </span><span id="local-6989586621679062998"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062998"><span class="hs-identifier hs-var">n0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream (Stream f m) m r
</span><a href="#local-6989586621679062997"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-751"></span><span>  </span><span id="local-6989586621679062997"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream (Stream f m) m r
</span><a href="#local-6989586621679062997"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062996"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062996"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062996"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-752"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062995"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062995"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream (Stream f m) m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062995"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-753"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062994"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062994"><span class="hs-identifier hs-var">m</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream (Stream f m) m r) -&gt; Stream (Stream f m) m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream (Stream f m) m r)
-&gt; m (Stream f m r) -&gt; m (Stream (Stream f m) m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream (Stream f m) m r
</span><a href="#local-6989586621679062997"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062994"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062993"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062993"><span class="hs-identifier hs-var">fs</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream f m (Stream (Stream f m) m r) -&gt; Stream (Stream f m) m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m (Stream (Stream f m) m r))
-&gt; Stream f m (Stream (Stream f m) m r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream f m (Stream (Stream f m) m r))
-&gt; f (Stream f m r) -&gt; f (Stream f m (Stream (Stream f m) m r))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream (Stream f m) m r)
-&gt; Stream f m (Stream f m r)
-&gt; Stream f m (Stream (Stream f m) m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream (Stream f m) m r
</span><a href="#local-6989586621679062997"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m (Stream f m r) -&gt; Stream f m (Stream (Stream f m) m r))
-&gt; (Stream f m r -&gt; Stream f m (Stream f m r))
-&gt; Stream f m r
-&gt; Stream f m (Stream (Stream f m) m r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
Int -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="Streaming.Internal.html#splitsAt"><span class="hs-identifier hs-var">splitsAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062998"><span class="hs-identifier hs-var">n0</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062993"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#chunksOf"><span class="hs-pragma hs-type">chunksOf</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="hs-comment">{- | Make it possible to \'run\' the underlying transformed monad.
-}</span><span>
</span><span id="line-759"></span><span id="local-6989586621679062989"><span id="local-6989586621679062990"><span id="local-6989586621679062991"><span id="local-6989586621679062992"><span class="annot"><a href="Streaming.Internal.html#distribute"><span class="hs-identifier hs-type">distribute</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062992"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062991"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">MonadTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062990"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../mmorph/html/src"><span class="hs-identifier hs-type">MFunctor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062990"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062990"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062991"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062992"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062991"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062990"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062992"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062989"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062990"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062991"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062992"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062989"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-761"></span><span id="distribute"><span class="annot"><span class="annottext">distribute :: Stream f (t m) r -&gt; t (Stream f m) r
</span><a href="Streaming.Internal.html#distribute"><span class="hs-identifier hs-var hs-var">distribute</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f (t m) r -&gt; t (Stream f m) r
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) (f :: * -&gt; *) a.
(MonadTrans t, MFunctor t, Monad (t (Stream f m)), Monad m,
 Functor f) =&gt;
Stream f (t m) a -&gt; t (Stream f m) a
</span><a href="#local-6989586621679062988"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-762"></span><span>  </span><span id="local-6989586621679062988"><span class="annot"><span class="annottext">loop :: Stream f (t m) a -&gt; t (Stream f m) a
</span><a href="#local-6989586621679062988"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062987"><span class="annot"><span class="annottext">Stream f (t m) a
</span><a href="#local-6989586621679062987"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f (t m) a
</span><a href="#local-6989586621679062987"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-763"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062986"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062986"><span class="hs-identifier hs-var">r</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; t (Stream f m) a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Stream f m a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062986"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062985"><span class="annot"><span class="annottext">t m (Stream f (t m) a)
</span><a href="#local-6989586621679062985"><span class="hs-identifier hs-var">tmstr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Stream f m a)
-&gt; t m (Stream f (t m) a) -&gt; t (Stream f m) (Stream f (t m) a)
forall k (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
</span><a href="../../../../mmorph/html/src"><span class="hs-identifier hs-var">hoist</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Stream f m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">t m (Stream f (t m) a)
</span><a href="#local-6989586621679062985"><span class="hs-identifier hs-var">tmstr</span></a></span><span> </span><span class="annot"><span class="annottext">t (Stream f m) (Stream f (t m) a)
-&gt; (Stream f (t m) a -&gt; t (Stream f m) a) -&gt; t (Stream f m) a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f (t m) a -&gt; t (Stream f m) a
</span><a href="#local-6989586621679062988"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-765"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062984"><span class="annot"><span class="annottext">f (Stream f (t m) a)
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">fstr</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t (Stream f m) (t (Stream f m) a) -&gt; t (Stream f m) a
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m (t (Stream f m) a) -&gt; t (Stream f m) (t (Stream f m) a)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m (t (Stream f m) a)) -&gt; Stream f m (t (Stream f m) a)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f (t m) a -&gt; Stream f m (t (Stream f m) a))
-&gt; f (Stream f (t m) a) -&gt; f (Stream f m (t (Stream f m) a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t (Stream f m) a -&gt; Stream f m (t (Stream f m) a)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(t (Stream f m) a -&gt; Stream f m (t (Stream f m) a))
-&gt; (Stream f (t m) a -&gt; t (Stream f m) a)
-&gt; Stream f (t m) a
-&gt; Stream f m (t (Stream f m) a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f (t m) a -&gt; t (Stream f m) a
</span><a href="#local-6989586621679062988"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f (t m) a)
</span><a href="#local-6989586621679062984"><span class="hs-identifier hs-var">fstr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#distribute"><span class="hs-pragma hs-type">distribute</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span class="hs-comment">-- | Repeat a functorial layer (a \&quot;command\&quot; or \&quot;instruction\&quot;) forever.</span><span>
</span><span id="line-769"></span><span id="local-6989586621679063703"><span id="local-6989586621679063704"><span id="local-6989586621679063705"><span class="annot"><a href="Streaming.Internal.html#repeats"><span class="hs-identifier hs-type">repeats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063705"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063704"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063704"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063704"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063705"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063703"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-770"></span><span id="repeats"><span class="annot"><span class="annottext">repeats :: f () -&gt; Stream f m r
</span><a href="Streaming.Internal.html#repeats"><span class="hs-identifier hs-var hs-var">repeats</span></a></span></span><span> </span><span id="local-6989586621679062983"><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679062983"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062982"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-771"></span><span>  </span><span id="local-6989586621679062982"><span class="annot"><span class="annottext">loop :: Stream f m r
</span><a href="#local-6989586621679062982"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062982"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; f () -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679062983"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span class="hs-comment">-- | Repeat an effect containing a functorial layer, command or instruction forever.</span><span>
</span><span id="line-774"></span><span id="local-6989586621679062979"><span id="local-6989586621679062980"><span id="local-6989586621679062981"><span class="annot"><a href="Streaming.Internal.html#repeatsM"><span class="hs-identifier hs-type">repeatsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062981"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062980"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062981"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062980"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062980"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062981"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062979"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-775"></span><span id="repeatsM"><span class="annot"><span class="annottext">repeatsM :: m (f ()) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#repeatsM"><span class="hs-identifier hs-var hs-var">repeatsM</span></a></span></span><span> </span><span id="local-6989586621679062978"><span class="annot"><span class="annottext">m (f ())
</span><a href="#local-6989586621679062978"><span class="hs-identifier hs-var">mf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062977"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-776"></span><span>  </span><span id="local-6989586621679062977"><span class="annot"><span class="annottext">loop :: Stream f m r
</span><a href="#local-6989586621679062977"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m r) -&gt; Stream f m r)
-&gt; m (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-777"></span><span>     </span><span id="local-6989586621679062976"><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679062976"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (f ())
</span><a href="#local-6989586621679062978"><span class="hs-identifier hs-var">mf</span></a></span><span>
</span><span id="line-778"></span><span>     </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; m (Stream f m r))
-&gt; Stream f m r -&gt; m (Stream f m r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(f (Stream f m r) -&gt; Stream f m r)
-&gt; f (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062977"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; f () -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679062976"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-779"></span><span>
</span><span id="line-780"></span><span class="hs-comment">{- | Repeat a functorial layer, command or instruction a fixed number of times.

&gt; replicates n = takes n . repeats
-}</span><span>
</span><span id="line-784"></span><span id="local-6989586621679062974"><span id="local-6989586621679062975"><span class="annot"><a href="Streaming.Internal.html#replicates"><span class="hs-identifier hs-type">replicates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062975"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062974"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062974"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062974"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062975"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-785"></span><span id="replicates"><span class="annot"><span class="annottext">replicates :: Int -&gt; f () -&gt; Stream f m ()
</span><a href="Streaming.Internal.html#replicates"><span class="hs-identifier hs-var hs-var">replicates</span></a></span></span><span> </span><span id="local-6989586621679062973"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062973"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679062972"><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679062972"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream f m Any -&gt; Stream f m (Stream f m Any)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
Int -&gt; Stream f m r -&gt; Stream f m (Stream f m r)
</span><a href="Streaming.Internal.html#splitsAt"><span class="hs-identifier hs-var">splitsAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062973"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f () -&gt; Stream f m Any
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f () -&gt; Stream f m r
</span><a href="Streaming.Internal.html#repeats"><span class="hs-identifier hs-var">repeats</span></a></span><span> </span><span class="annot"><span class="annottext">f ()
</span><a href="#local-6989586621679062972"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stream f m (Stream f m Any) -&gt; Stream f m () -&gt; Stream f m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Stream f m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span class="hs-comment">{-| Construct an infinite stream by cycling a finite one

&gt; cycles = forever

&gt;&gt;&gt;
-}</span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span id="local-6989586621679062969"><span id="local-6989586621679062970"><span id="local-6989586621679062971"><span class="annot"><a href="Streaming.Internal.html#cycles"><span class="hs-identifier hs-type">cycles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062971"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062970"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062970"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062971"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062970"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062971"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062969"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-795"></span><span id="cycles"><span class="annot"><span class="annottext">cycles :: Stream f m () -&gt; Stream f m r
</span><a href="Streaming.Internal.html#cycles"><span class="hs-identifier hs-var hs-var">cycles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m () -&gt; Stream f m r
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="hs-comment">-- | A less-efficient version of 'hoist' that works properly even when its</span><span>
</span><span id="line-798"></span><span class="hs-comment">-- argument is not a monad morphism.</span><span>
</span><span id="line-799"></span><span class="hs-comment">--</span><span>
</span><span id="line-800"></span><span class="hs-comment">-- &gt; hoistUnexposed = hoist . unexposed</span><span>
</span><span id="line-801"></span><span id="local-6989586621679062964"><span id="local-6989586621679062965"><span id="local-6989586621679062966"><span id="local-6989586621679062967"><span class="annot"><a href="Streaming.Internal.html#hoistUnexposed"><span class="hs-identifier hs-type">hoistUnexposed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062967"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062966"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>               </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063695"><span class="annot"><a href="#local-6989586621679063695"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679062967"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063695"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062965"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063695"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-803"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062966"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062967"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062964"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062966"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062965"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062964"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-804"></span><span id="hoistUnexposed"><span class="annot"><span class="annottext">hoistUnexposed :: (forall a. m a -&gt; n a) -&gt; Stream f m r -&gt; Stream f n r
</span><a href="Streaming.Internal.html#hoistUnexposed"><span class="hs-identifier hs-var hs-var">hoistUnexposed</span></a></span></span><span> </span><span id="local-6989586621679062963"><span class="annot"><span class="annottext">forall a. m a -&gt; n a
</span><a href="#local-6989586621679062963"><span class="hs-identifier hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream f n r
</span><a href="#local-6989586621679062962"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-805"></span><span>  </span><span id="local-6989586621679062962"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream f n r
</span><a href="#local-6989586621679062962"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n (Stream f n r) -&gt; Stream f n r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(n (Stream f n r) -&gt; Stream f n r)
-&gt; (Stream f m r -&gt; n (Stream f n r))
-&gt; Stream f m r
-&gt; Stream f n r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f n r) -&gt; n (Stream f n r)
forall a. m a -&gt; n a
</span><a href="#local-6989586621679062963"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f n r) -&gt; n (Stream f n r))
-&gt; (Stream f m r -&gt; m (Stream f n r))
-&gt; Stream f m r
-&gt; n (Stream f n r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(r -&gt; m (Stream f n r))
-&gt; (f (Stream f m r) -&gt; m (Stream f n r))
-&gt; Stream f m r
-&gt; m (Stream f n r)
forall (m :: * -&gt; *) r a (f :: * -&gt; *).
Monad m =&gt;
(r -&gt; m a) -&gt; (f (Stream f m r) -&gt; m a) -&gt; Stream f m r -&gt; m a
</span><a href="Streaming.Internal.html#inspectC"><span class="hs-identifier hs-var">inspectC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f n r -&gt; m (Stream f n r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f n r -&gt; m (Stream f n r))
-&gt; (r -&gt; Stream f n r) -&gt; r -&gt; m (Stream f n r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream f n r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f n r -&gt; m (Stream f n r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f n r -&gt; m (Stream f n r))
-&gt; (f (Stream f m r) -&gt; Stream f n r)
-&gt; f (Stream f m r)
-&gt; m (Stream f n r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f n r) -&gt; Stream f n r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(f (Stream f n r) -&gt; Stream f n r)
-&gt; (f (Stream f m r) -&gt; f (Stream f n r))
-&gt; f (Stream f m r)
-&gt; Stream f n r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream f n r)
-&gt; f (Stream f m r) -&gt; f (Stream f n r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream f n r
</span><a href="#local-6989586621679062962"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-806"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#hoistUnexposed"><span class="hs-pragma hs-type">hoistUnexposed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-807"></span><span>
</span><span id="line-808"></span><span class="hs-comment">-- A version of 'inspect' that takes explicit continuations.</span><span>
</span><span id="line-809"></span><span id="local-6989586621679063688"><span id="local-6989586621679063689"><span id="local-6989586621679063690"><span id="local-6989586621679063691"><span class="annot"><a href="Streaming.Internal.html#inspectC"><span class="hs-identifier hs-type">inspectC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063690"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063689"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063688"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063688"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063690"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063689"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063688"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063690"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063691"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063689"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-810"></span><span id="inspectC"><span class="annot"><span class="annottext">inspectC :: (r -&gt; m a) -&gt; (f (Stream f m r) -&gt; m a) -&gt; Stream f m r -&gt; m a
</span><a href="Streaming.Internal.html#inspectC"><span class="hs-identifier hs-var hs-var">inspectC</span></a></span></span><span> </span><span id="local-6989586621679062960"><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679062960"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679062959"><span class="annot"><span class="annottext">f (Stream f m r) -&gt; m a
</span><a href="#local-6989586621679062959"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m a
</span><a href="#local-6989586621679062958"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-811"></span><span>  </span><span id="local-6989586621679062958"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; m a
</span><a href="#local-6989586621679062958"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062957"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062957"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679062960"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062957"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-812"></span><span>  </span><span class="annot"><a href="#local-6989586621679062958"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062956"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062956"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; m a
</span><a href="#local-6989586621679062959"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062956"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-813"></span><span>  </span><span class="annot"><a href="#local-6989586621679062958"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062955"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062955"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062955"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; (Stream f m r -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m a
</span><a href="#local-6989586621679062958"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-814"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#inspectC"><span class="hs-pragma hs-type">inspectC</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-815"></span><span>
</span><span id="line-816"></span><span class="hs-comment">-- | The same as 'hoist', but explicitly named to indicate that it</span><span>
</span><span id="line-817"></span><span class="hs-comment">-- is not entirely safe. In particular, its argument must be a monad</span><span>
</span><span id="line-818"></span><span class="hs-comment">-- morphism.</span><span>
</span><span id="line-819"></span><span id="local-6989586621679062951"><span id="local-6989586621679062952"><span id="local-6989586621679062953"><span id="local-6989586621679062954"><span class="annot"><a href="Streaming.Internal.html#hoistExposed"><span class="hs-identifier hs-type">hoistExposed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062954"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062953"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063682"><span class="annot"><a href="#local-6989586621679063682"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679062954"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063682"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062952"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063682"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062953"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062954"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062951"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062953"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062952"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062951"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-820"></span><span id="hoistExposed"><span class="annot"><span class="annottext">hoistExposed :: (forall b. m b -&gt; n b) -&gt; Stream f m a -&gt; Stream f n a
</span><a href="Streaming.Internal.html#hoistExposed"><span class="hs-identifier hs-var hs-var">hoistExposed</span></a></span></span><span> </span><span id="local-6989586621679062950"><span class="annot"><span class="annottext">forall b. m b -&gt; n b
</span><a href="#local-6989586621679062950"><span class="hs-identifier hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062949"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-821"></span><span>  </span><span id="local-6989586621679062949"><span class="annot"><span class="annottext">loop :: Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062949"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062948"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679062948"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679062948"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062947"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062947"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f n a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062947"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062946"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679062946"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">n (Stream f n a) -&gt; Stream f n a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Stream f n a) -&gt; n (Stream f n a)
forall b. m b -&gt; n b
</span><a href="#local-6989586621679062950"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f n a)
-&gt; m (Stream f m a) -&gt; m (Stream f n a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062949"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679062946"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062945"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679062945"><span class="hs-identifier hs-var">f</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f n a) -&gt; Stream f n a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f n a)
-&gt; f (Stream f m a) -&gt; f (Stream f n a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062949"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679062945"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#hoistExposed"><span class="hs-pragma hs-type">hoistExposed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="hs-comment">-- | The same as 'hoistExposed', but with a 'Functor' constraint on</span><span>
</span><span id="line-828"></span><span class="hs-comment">-- the target rather than the source. This must be used only with</span><span>
</span><span id="line-829"></span><span class="hs-comment">-- a monad morphism.</span><span>
</span><span id="line-830"></span><span id="local-6989586621679062941"><span id="local-6989586621679062942"><span id="local-6989586621679062943"><span id="local-6989586621679062944"><span class="annot"><a href="Streaming.Internal.html#hoistExposedPost"><span class="hs-identifier hs-type">hoistExposedPost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062944"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062943"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063677"><span class="annot"><a href="#local-6989586621679063677"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679062942"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063677"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062944"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063677"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062943"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062942"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062941"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062943"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062944"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062941"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-831"></span><span id="hoistExposedPost"><span class="annot"><span class="annottext">hoistExposedPost :: (forall b. m b -&gt; n b) -&gt; Stream f m a -&gt; Stream f n a
</span><a href="Streaming.Internal.html#hoistExposedPost"><span class="hs-identifier hs-var hs-var">hoistExposedPost</span></a></span></span><span> </span><span id="local-6989586621679062940"><span class="annot"><span class="annottext">forall b. m b -&gt; n b
</span><a href="#local-6989586621679062940"><span class="hs-identifier hs-var">trans</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062939"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-832"></span><span>  </span><span id="local-6989586621679062939"><span class="annot"><span class="annottext">loop :: Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062939"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062938"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679062938"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679062938"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-833"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062937"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062937"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Stream f n a
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062937"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-834"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062936"><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679062936"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">n (Stream f n a) -&gt; Stream f n a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f n a)
-&gt; n (Stream f m a) -&gt; n (Stream f n a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062939"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Stream f m a) -&gt; n (Stream f m a)
forall b. m b -&gt; n b
</span><a href="#local-6989586621679062940"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m a)
</span><a href="#local-6989586621679062936"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679062935"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679062935"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f n a) -&gt; Stream f n a
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f n a)
-&gt; f (Stream f m a) -&gt; f (Stream f n a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; Stream f n a
</span><a href="#local-6989586621679062939"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679062935"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#hoistExposedPost"><span class="hs-pragma hs-type">hoistExposedPost</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">mapsExposed</span><span> </span><span class="hs-pragma">&quot;Use maps instead.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-839"></span><span id="local-6989586621679062931"><span id="local-6989586621679062932"><span id="local-6989586621679062933"><span id="local-6989586621679062934"><span class="annot"><a href="Streaming.Internal.html#mapsExposed"><span class="hs-identifier hs-type">mapsExposed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062934"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062933"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063672"><span class="annot"><a href="#local-6989586621679063672"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679062933"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063672"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062932"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063672"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062933"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062934"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062931"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062932"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062934"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062931"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-841"></span><span id="mapsExposed"><span class="annot"><span class="annottext">mapsExposed :: (forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#mapsExposed"><span class="hs-identifier hs-var hs-var">mapsExposed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
(forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#maps"><span class="hs-identifier hs-var">maps</span></a></span><span>
</span><span id="line-842"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsExposed"><span class="hs-pragma hs-type">mapsExposed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-843"></span><span>
</span><span id="line-844"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">mapsMExposed</span><span> </span><span class="hs-pragma">&quot;Use mapsM instead.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-845"></span><span id="local-6989586621679062927"><span id="local-6989586621679062928"><span id="local-6989586621679062929"><span id="local-6989586621679062930"><span class="annot"><a href="Streaming.Internal.html#mapsMExposed"><span class="hs-identifier hs-type">mapsMExposed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062930"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062929"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063667"><span class="annot"><a href="#local-6989586621679063667"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679062929"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063667"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062928"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063667"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062929"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062927"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062928"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062930"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062927"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-847"></span><span id="mapsMExposed"><span class="annot"><span class="annottext">mapsMExposed :: (forall x. f x -&gt; m (g x)) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#mapsMExposed"><span class="hs-identifier hs-var hs-var">mapsMExposed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x. f x -&gt; m (g x)) -&gt; Stream f m r -&gt; Stream g m r
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
(forall x. f x -&gt; m (g x)) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#mapsM"><span class="hs-identifier hs-var">mapsM</span></a></span><span>
</span><span id="line-848"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#mapsMExposed"><span class="hs-pragma hs-type">mapsMExposed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span class="hs-comment">{-| Map a stream directly to its church encoding; compare @Data.List.foldr@
    It permits distinctions that should be hidden, as can be seen from
    e.g.

    @isPure stream = destroyExposed (const True) (const False) (const True)@

    and similar nonsense.  The crucial
    constraint is that the @m x -&gt; x@ argument is an /Eilenberg-Moore algebra/.
    See Atkey, &quot;Reasoning about Stream Processing with Effects&quot;

    When in doubt, use 'destroy' instead.
-}</span><span>
</span><span id="line-862"></span><span id="local-6989586621679062923"><span id="local-6989586621679062924"><span id="local-6989586621679062925"><span id="local-6989586621679062926"><span class="annot"><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier hs-type">destroyExposed</span></a></span><span>
</span><span id="line-863"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062926"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062925"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-864"></span><span>     </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062926"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062925"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062924"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062926"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062923"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062923"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062925"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062923"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062923"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062924"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062923"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062923"><span class="hs-identifier hs-type">b</span></a></span></span></span></span></span><span>
</span><span id="line-865"></span><span id="destroyExposed"><span class="annot"><span class="annottext">destroyExposed :: Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier hs-var hs-var">destroyExposed</span></a></span></span><span> </span><span id="local-6989586621679062922"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062922"><span class="hs-identifier hs-var">stream0</span></a></span></span><span> </span><span id="local-6989586621679062921"><span class="annot"><span class="annottext">f b -&gt; b
</span><a href="#local-6989586621679062921"><span class="hs-identifier hs-var">construct</span></a></span></span><span> </span><span id="local-6989586621679062920"><span class="annot"><span class="annottext">m b -&gt; b
</span><a href="#local-6989586621679062920"><span class="hs-identifier hs-var">theEffect</span></a></span></span><span> </span><span id="local-6989586621679062919"><span class="annot"><span class="annottext">r -&gt; b
</span><a href="#local-6989586621679062919"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; b
</span><a href="#local-6989586621679062918"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062922"><span class="hs-identifier hs-var">stream0</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-866"></span><span>  </span><span id="local-6989586621679062918"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; b
</span><a href="#local-6989586621679062918"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062917"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062917"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062917"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-867"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062916"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062916"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; b
</span><a href="#local-6989586621679062919"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062916"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-868"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062915"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062915"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m b -&gt; b
</span><a href="#local-6989586621679062920"><span class="hs-identifier hs-var">theEffect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; b) -&gt; m (Stream f m r) -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; b
</span><a href="#local-6989586621679062918"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062915"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062914"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062914"><span class="hs-identifier hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f b -&gt; b
</span><a href="#local-6989586621679062921"><span class="hs-identifier hs-var">construct</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; b) -&gt; f (Stream f m r) -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; b
</span><a href="#local-6989586621679062918"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062914"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#destroyExposed"><span class="hs-pragma hs-type">destroyExposed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span class="hs-comment">{-| This is akin to the @observe@ of @Pipes.Internal@ . It reeffects the layering
    in instances of @Stream f m r@ so that it replicates that of
    @FreeT@.

-}</span><span>
</span><span id="line-878"></span><span id="local-6989586621679064020"><span id="local-6989586621679064021"><span id="local-6989586621679064022"><span class="annot"><a href="Streaming.Internal.html#unexposed"><span class="hs-identifier hs-type">unexposed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064022"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064021"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064022"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064021"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064020"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064022"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064021"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064020"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-879"></span><span id="unexposed"><span class="annot"><span class="annottext">unexposed :: Stream f m r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#unexposed"><span class="hs-identifier hs-var hs-var">unexposed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m r) -&gt; Stream f m r)
-&gt; (Stream f m r -&gt; m (Stream f m r))
-&gt; Stream f m r
-&gt; Stream f m r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
Stream f m r -&gt; m (Stream f m r)
</span><a href="#local-6989586621679062913"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-880"></span><span>  </span><span id="local-6989586621679062913"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; m (Stream f m r)
</span><a href="#local-6989586621679062913"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062912"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062912"><span class="hs-identifier hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062912"><span class="hs-identifier hs-var">stream</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-881"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062911"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062911"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062911"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062910"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062910"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062910"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
-&gt; (Stream f m r -&gt; m (Stream f m r)) -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
</span><a href="#local-6989586621679062913"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span>   </span><span id="local-6989586621679062909"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062909"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream f m r)
-&gt; f (Stream f m r) -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m r) -&gt; Stream f m r)
-&gt; (Stream f m r -&gt; m (Stream f m r))
-&gt; Stream f m r
-&gt; Stream f m r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
</span><a href="#local-6989586621679062913"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062909"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unexposed"><span class="hs-pragma hs-type">unexposed</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span class="hs-comment">{-| Wrap a new layer of a stream. So, e.g.

&gt; S.cons :: Monad m =&gt; a -&gt; Stream (Of a) m r -&gt; Stream (Of a) m r
&gt; S.cons a str = wrap (a :&gt; str)

   and, recursively:

&gt; S.each :: (Monad m, Foldable t) =&gt; t a -&gt; Stream (Of a) m ()
&gt; S.each = foldr (\a b -&gt; wrap (a :&gt; b)) (return ())

   The two operations

&gt; wrap :: (Monad m, Functor f )   =&gt; f (Stream f m r) -&gt; Stream f m r
&gt; effect :: (Monad m, Functor f ) =&gt; m (Stream f m r) -&gt; Stream f m r

   are fundamental. We can define the parallel operations @yields@ and @lift@ in
   terms of them

&gt; yields :: (Monad m, Functor f )  =&gt; f r -&gt; Stream f m r
&gt; yields = wrap . fmap return
&gt; lift ::  (Monad m, Functor f )   =&gt; m r -&gt; Stream f m r
&gt; lift = effect . fmap return

-}</span><span>
</span><span id="line-911"></span><span id="local-6989586621679063591"><span id="local-6989586621679063592"><span id="local-6989586621679063593"><span class="annot"><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-type">wrap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063593"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063592"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063592"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063592"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063593"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063591"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063592"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063593"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063591"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-912"></span><span id="wrap"><span class="annot"><span class="annottext">wrap :: f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span>
</span><span id="line-913"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#wrap"><span class="hs-pragma hs-type">wrap</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span class="hs-comment">{- | Wrap an effect that returns a stream

&gt; effect = join . lift

-}</span><span>
</span><span id="line-921"></span><span id="local-6989586621679063588"><span id="local-6989586621679063589"><span id="local-6989586621679063590"><span class="annot"><a href="Streaming.Internal.html#effect"><span class="hs-identifier hs-type">effect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063590"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063589"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063590"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063589"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063590"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063588"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063589"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063590"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063588"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-922"></span><span id="effect"><span class="annot"><span class="annottext">effect :: m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#effect"><span class="hs-identifier hs-var hs-var">effect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span>
</span><span id="line-923"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#effect"><span class="hs-pragma hs-type">effect</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span class="hs-comment">{-| @yields@ is like @lift@ for items in the streamed functor.
    It makes a singleton or one-layer succession.

&gt; lift :: (Monad m, Functor f)    =&gt; m r -&gt; Stream f m r
&gt; yields ::  (Monad m, Functor f) =&gt; f r -&gt; Stream f m r

    Viewed in another light, it is like a functor-general version of @yield@:

&gt; S.yield a = yields (a :&gt; ())

-}</span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span id="local-6989586621679063585"><span id="local-6989586621679063586"><span id="local-6989586621679063587"><span class="annot"><a href="Streaming.Internal.html#yields"><span class="hs-identifier hs-type">yields</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063587"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063586"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063586"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063585"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063586"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063587"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063585"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-939"></span><span id="yields"><span class="annot"><span class="annottext">yields :: f r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#yields"><span class="hs-identifier hs-var hs-var">yields</span></a></span></span><span> </span><span id="local-6989586621679062908"><span class="annot"><span class="annottext">f r
</span><a href="#local-6989586621679062908"><span class="hs-identifier hs-var">fr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(r -&gt; Stream f m r) -&gt; f r -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">f r
</span><a href="#local-6989586621679062908"><span class="hs-identifier hs-var">fr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-940"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#yields"><span class="hs-pragma hs-type">yields</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span class="hs-comment">{-
Note that if the first stream produces Return, we don't inspect
(and potentially run effects from) the second stream. We used to
do that. Aside from being (arguably) a bit strange, this also runs
into a bit of trouble with MonadPlus laws. Most MonadPlus instances
try to satisfy either left distribution or left catch. Let's first
consider left distribution:

(x &lt;|&gt; y) &gt;&gt;= k = (x &gt;&gt;= k) &lt;|&gt; (y &gt;&gt;= k)

[xy_1, xy_2, xy_3, ..., xy_o | r_xy] &gt;&gt;= k
=
[x_1,  x_2,  x_3, ..., x_m | r_x] &gt;&gt;= k
&lt;|&gt;
[y_1,  y_2,  y_3, ..., y_n | r_y] &gt;&gt;= k

x and y may have different lengths, and k may produce an utterly
arbitrary stream from each result, so left distribution seems
quite hopeless.

Now let's consider left catch:

zipsWith' liftA2 (return a) b = return a

To satisfy this, we can't run any effects from the second stream
if the first is finished.
-}</span><span>
</span><span id="line-969"></span><span>
</span><span id="line-970"></span><span class="hs-comment">-- | Zip two streams together. The 'zipsWith'' function should generally</span><span>
</span><span id="line-971"></span><span class="hs-comment">-- be preferred for efficiency.</span><span>
</span><span id="line-972"></span><span class="annot"><a href="Streaming.Internal.html#zipsWith"><span class="hs-identifier hs-type">zipsWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679062907"><span class="annot"><a href="#local-6989586621679062907"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679062906"><span class="annot"><a href="#local-6989586621679062906"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679062905"><span class="annot"><a href="#local-6989586621679062905"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679062904"><span class="annot"><a href="#local-6989586621679062904"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679062903"><span class="annot"><a href="#local-6989586621679062903"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062904"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062905"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063639"><span class="annot"><a href="#local-6989586621679063639"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621679063637"><span class="annot"><a href="#local-6989586621679063637"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679062907"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063639"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062906"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063637"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062905"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063639"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679063637"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-974"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062907"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062903"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062906"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062903"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062905"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062904"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062903"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-975"></span><span id="zipsWith"><span class="annot"><span class="annottext">zipsWith :: (forall x y. f x -&gt; g y -&gt; h (x, y))
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="Streaming.Internal.html#zipsWith"><span class="hs-identifier hs-var hs-var">zipsWith</span></a></span></span><span> </span><span id="local-6989586621679062902"><span class="annot"><span class="annottext">forall x y. f x -&gt; g y -&gt; h (x, y)
</span><a href="#local-6989586621679062902"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) (m :: * -&gt; *) r.
Monad m =&gt;
(forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-identifier hs-var">zipsWith'</span></a></span><span> </span><span class="annot"><span class="annottext">((forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
 -&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r)
-&gt; (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
-&gt; Stream f m r
-&gt; Stream g m r
-&gt; Stream h m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679062901"><span class="annot"><span class="annottext">x -&gt; y -&gt; p
</span><a href="#local-6989586621679062901"><span class="hs-identifier hs-var">xyp</span></a></span></span><span> </span><span id="local-6989586621679062900"><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679062900"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679062899"><span class="annot"><span class="annottext">g y
</span><a href="#local-6989586621679062899"><span class="hs-identifier hs-var">gy</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679062898"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679062898"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679062897"><span class="annot"><span class="annottext">y
</span><a href="#local-6989586621679062897"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; y -&gt; p
</span><a href="#local-6989586621679062901"><span class="hs-identifier hs-var">xyp</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621679062898"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">y
</span><a href="#local-6989586621679062897"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((x, y) -&gt; p) -&gt; h (x, y) -&gt; h p
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">f x -&gt; g y -&gt; h (x, y)
forall x y. f x -&gt; g y -&gt; h (x, y)
</span><a href="#local-6989586621679062902"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="annot"><span class="annottext">f x
</span><a href="#local-6989586621679062900"><span class="hs-identifier hs-var">fx</span></a></span><span> </span><span class="annot"><span class="annottext">g y
</span><a href="#local-6989586621679062899"><span class="hs-identifier hs-var">gy</span></a></span><span>
</span><span id="line-976"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#zipsWith"><span class="hs-pragma hs-type">zipsWith</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-977"></span><span class="hs-comment">-- Somewhat surprisingly, GHC is *much* more willing to specialize</span><span>
</span><span id="line-978"></span><span class="hs-comment">-- zipsWith if it's defined in terms of zipsWith'. Fortunately, zipsWith'</span><span>
</span><span id="line-979"></span><span class="hs-comment">-- seems like a better function anyway, so I guess that's not a big problem.</span><span>
</span><span id="line-980"></span><span>
</span><span id="line-981"></span><span class="hs-comment">-- | Zip two streams together.</span><span>
</span><span id="line-982"></span><span class="annot"><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-identifier hs-type">zipsWith'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063908"><span class="annot"><a href="#local-6989586621679063908"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679063907"><span class="annot"><a href="#local-6989586621679063907"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679063906"><span class="annot"><a href="#local-6989586621679063906"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679063909"><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679063905"><span class="annot"><a href="#local-6989586621679063905"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-983"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063912"><span class="annot"><a href="#local-6989586621679063912"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621679063911"><span class="annot"><a href="#local-6989586621679063911"><span class="hs-identifier hs-type">y</span></a></span></span><span> </span><span id="local-6989586621679063910"><span class="annot"><a href="#local-6989586621679063910"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679063912"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063911"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063910"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063908"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063912"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063907"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063911"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063906"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063910"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063908"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063905"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063907"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063905"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063906"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063905"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-985"></span><span id="zipsWith%27"><span class="annot"><span class="annottext">zipsWith' :: (forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-identifier hs-var hs-var">zipsWith'</span></a></span></span><span> </span><span id="local-6989586621679062895"><span class="annot"><span class="annottext">forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p
</span><a href="#local-6989586621679062895"><span class="hs-identifier hs-var">phi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="#local-6989586621679062894"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-986"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-987"></span><span>    </span><span class="annot"><a href="#local-6989586621679062894"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063908"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063905"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063907"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063905"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063906"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063909"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063905"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-988"></span><span>    </span><span id="local-6989586621679062894"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="#local-6989586621679062894"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062893"><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062893"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679062892"><span class="annot"><span class="annottext">Stream g m r
</span><a href="#local-6989586621679062892"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062893"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-989"></span><span>       </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062891"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062891"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream h m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062891"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-990"></span><span>       </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062890"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062890"><span class="hs-identifier hs-var">fs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stream g m r
</span><a href="#local-6989586621679062892"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-991"></span><span>         </span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062889"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062889"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream h m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062889"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-992"></span><span>         </span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062888"><span class="annot"><span class="annottext">g (Stream g m r)
</span><a href="#local-6989586621679062888"><span class="hs-identifier hs-var">gs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">h (Stream h m r) -&gt; Stream h m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(h (Stream h m r) -&gt; Stream h m r)
-&gt; h (Stream h m r) -&gt; Stream h m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r -&gt; Stream h m r)
-&gt; f (Stream f m r) -&gt; g (Stream g m r) -&gt; h (Stream h m r)
forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p
</span><a href="#local-6989586621679062895"><span class="hs-identifier hs-var">phi</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="#local-6989586621679062894"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062890"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream g m r)
</span><a href="#local-6989586621679062888"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-993"></span><span>         </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062887"><span class="annot"><span class="annottext">m (Stream g m r)
</span><a href="#local-6989586621679062887"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream h m r) -&gt; Stream h m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream h m r) -&gt; Stream h m r)
-&gt; m (Stream h m r) -&gt; Stream h m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g m r -&gt; Stream h m r)
-&gt; m (Stream g m r) -&gt; m (Stream h m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="#local-6989586621679062894"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062893"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Stream g m r)
</span><a href="#local-6989586621679062887"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-994"></span><span>       </span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062886"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062886"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Stream h m r) -&gt; Stream h m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream h m r) -&gt; Stream h m r)
-&gt; m (Stream h m r) -&gt; Stream h m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream h m r)
-&gt; m (Stream f m r) -&gt; m (Stream h m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g m r -&gt; Stream h m r)
-&gt; Stream g m r -&gt; Stream f m r -&gt; Stream h m r
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="#local-6989586621679062894"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Stream g m r
</span><a href="#local-6989586621679062892"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062886"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-995"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-pragma hs-type">zipsWith'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span id="local-6989586621679062882"><span id="local-6989586621679062883"><span id="local-6989586621679062884"><span id="local-6989586621679062885"><span class="annot"><a href="Streaming.Internal.html#zips"><span class="hs-identifier hs-type">zips</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062885"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062884"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062883"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>     </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062884"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062885"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062882"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062883"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062885"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062882"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Compose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062884"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062883"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062885"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062882"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-999"></span><span id="zips"><span class="annot"><span class="annottext">zips :: Stream f m r -&gt; Stream g m r -&gt; Stream (Compose f g) m r
</span><a href="Streaming.Internal.html#zips"><span class="hs-identifier hs-var hs-var">zips</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; Compose f g p)
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream (Compose f g) m r
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) (m :: * -&gt; *) r.
Monad m =&gt;
(forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-identifier hs-var">zipsWith'</span></a></span><span> </span><span class="annot"><span class="annottext">forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; Compose f g p
forall (f :: * -&gt; *) (g :: * -&gt; *) t t a.
(Functor f, Functor g) =&gt;
(t -&gt; t -&gt; a) -&gt; f t -&gt; g t -&gt; Compose f g a
</span><a href="#local-6989586621679062881"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1000"></span><span>  </span><span id="local-6989586621679062881"><span class="annot"><span class="annottext">go :: (t -&gt; t -&gt; a) -&gt; f t -&gt; g t -&gt; Compose f g a
</span><a href="#local-6989586621679062881"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679062880"><span class="annot"><span class="annottext">t -&gt; t -&gt; a
</span><a href="#local-6989586621679062880"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679062879"><span class="annot"><span class="annottext">f t
</span><a href="#local-6989586621679062879"><span class="hs-identifier hs-var">fx</span></a></span></span><span> </span><span id="local-6989586621679062878"><span class="annot"><span class="annottext">g t
</span><a href="#local-6989586621679062878"><span class="hs-identifier hs-var">gy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f (g a) -&gt; Compose f g a
forall k k1 (f :: k -&gt; *) (g :: k1 -&gt; k) (a :: k1).
f (g a) -&gt; Compose f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Compose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(t -&gt; g a) -&gt; f t -&gt; f (g a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679062877"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679062877"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(t -&gt; a) -&gt; g t -&gt; g a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679062876"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679062876"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; a
</span><a href="#local-6989586621679062880"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679062877"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679062876"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">g t
</span><a href="#local-6989586621679062878"><span class="hs-identifier hs-var">gy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f t
</span><a href="#local-6989586621679062879"><span class="hs-identifier hs-var">fx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1001"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#zips"><span class="hs-pragma hs-type">zips</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span class="hs-comment">{-| Interleave functor layers, with the effects of the first preceding
    the effects of the second. When the first stream runs out, any remaining
    effects in the second are ignored.

&gt; interleaves = zipsWith (liftA2 (,))

&gt;&gt;&gt; let paste = \a b -&gt; interleaves (Q.lines a) (maps (Q.cons' '\t') (Q.lines b))
&gt;&gt;&gt; Q.stdout $ Q.unlines $ paste &quot;hello\nworld\n&quot; &quot;goodbye\nworld\n&quot;
hello	goodbye
world	world

-}</span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span id="local-6989586621679062873"><span id="local-6989586621679062874"><span id="local-6989586621679062875"><span class="annot"><a href="Streaming.Internal.html#interleaves"><span class="hs-identifier hs-type">interleaves</span></a></span><span>
</span><span id="line-1019"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062875"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062874"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1020"></span><span>     </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062874"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062873"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062874"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062873"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062874"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062873"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-1021"></span><span id="interleaves"><span class="annot"><span class="annottext">interleaves :: Stream h m r -&gt; Stream h m r -&gt; Stream h m r
</span><a href="Streaming.Internal.html#interleaves"><span class="hs-identifier hs-var hs-var">interleaves</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall x y p. (x -&gt; y -&gt; p) -&gt; h x -&gt; h y -&gt; h p)
-&gt; Stream h m r -&gt; Stream h m r -&gt; Stream h m r
forall (f :: * -&gt; *) (g :: * -&gt; *) (h :: * -&gt; *) (m :: * -&gt; *) r.
Monad m =&gt;
(forall x y p. (x -&gt; y -&gt; p) -&gt; f x -&gt; g y -&gt; h p)
-&gt; Stream f m r -&gt; Stream g m r -&gt; Stream h m r
</span><a href="Streaming.Internal.html#zipsWith%27"><span class="hs-identifier hs-var">zipsWith'</span></a></span><span> </span><span class="annot"><span class="annottext">forall x y p. (x -&gt; y -&gt; p) -&gt; h x -&gt; h y -&gt; h p
forall (f :: * -&gt; *) a b c.
Applicative f =&gt;
(a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftA2</span></a></span><span>
</span><span id="line-1022"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#interleaves"><span class="hs-pragma hs-type">interleaves</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span class="hs-comment">{-| Swap the order of functors in a sum of functors.

&gt;&gt;&gt; S.toList $ S.print $ separate $ maps S.switch $ maps (S.distinguish (=='a')) $ S.each &quot;banana&quot;
'a'
'a'
'a'
&quot;bnn&quot; :&gt; ()
&gt;&gt;&gt; S.toList $ S.print $ separate $ maps (S.distinguish (=='a')) $ S.each &quot;banana&quot;
'b'
'n'
'n'
&quot;aaa&quot; :&gt; ()
-}</span><span>
</span><span id="line-1038"></span><span id="local-6989586621679062870"><span id="local-6989586621679062871"><span id="local-6989586621679062872"><span class="annot"><a href="Streaming.Internal.html#switch"><span class="hs-identifier hs-type">switch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062872"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062871"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062870"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062871"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062872"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062870"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-1039"></span><span id="switch"><span class="annot"><span class="annottext">switch :: Sum f g r -&gt; Sum g f r
</span><a href="Streaming.Internal.html#switch"><span class="hs-identifier hs-var hs-var">switch</span></a></span></span><span> </span><span id="local-6989586621679062869"><span class="annot"><span class="annottext">Sum f g r
</span><a href="#local-6989586621679062869"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Sum f g r
</span><a href="#local-6989586621679062869"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InL</span></a></span><span> </span><span id="local-6989586621679062867"><span class="annot"><span class="annottext">f r
</span><a href="#local-6989586621679062867"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f r -&gt; Sum g f r
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). g a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InR</span></a></span><span> </span><span class="annot"><span class="annottext">f r
</span><a href="#local-6989586621679062867"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InR</span></a></span><span> </span><span id="local-6989586621679062865"><span class="annot"><span class="annottext">g r
</span><a href="#local-6989586621679062865"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">g r -&gt; Sum g f r
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). f a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InL</span></a></span><span> </span><span class="annot"><span class="annottext">g r
</span><a href="#local-6989586621679062865"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1040"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#switch"><span class="hs-pragma hs-type">switch</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1041"></span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span>
</span><span id="line-1044"></span><span class="hs-comment">{-| Given a stream on a sum of functors, make it a stream on the left functor,
    with the streaming on the other functor as the governing monad. This is
    useful for acting on one or the other functor with a fold, leaving the
    other material for another treatment. It generalizes
    'Data.Either.partitionEithers', but actually streams properly.

&gt;&gt;&gt; let odd_even = S.maps (S.distinguish even) $ S.each [1..10::Int]
&gt;&gt;&gt; :t separate odd_even
separate odd_even
  :: Monad m =&gt; Stream (Of Int) (Stream (Of Int) m) ()

    Now, for example, it is convenient to fold on the left and right values separately:

&gt;&gt;&gt; S.toList $ S.toList $ separate odd_even
[2,4,6,8,10] :&gt; ([1,3,5,7,9] :&gt; ())


   Or we can write them to separate files or whatever:

&gt;&gt;&gt; S.writeFile &quot;even.txt&quot; . S.show $ S.writeFile &quot;odd.txt&quot; . S.show $ S.separate odd_even
&gt;&gt;&gt; :! cat even.txt
2
4
6
8
10
&gt;&gt;&gt; :! cat odd.txt
1
3
5
7
9

   Of course, in the special case of @Stream (Of a) m r@, we can achieve the above
   effects more simply by using 'Streaming.Prelude.copy'

&gt;&gt;&gt; S.toList . S.filter even $ S.toList . S.filter odd $ S.copy $ each [1..10::Int]
[2,4,6,8,10] :&gt; ([1,3,5,7,9] :&gt; ())


    But 'separate' and 'unseparate' are functor-general.

-}</span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span id="local-6989586621679062861"><span id="local-6989586621679062862"><span id="local-6989586621679062863"><span id="local-6989586621679062864"><span class="annot"><a href="Streaming.Internal.html#separate"><span class="hs-identifier hs-type">separate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062864"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062863"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062862"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062863"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062862"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062864"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062861"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062863"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062862"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062864"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062861"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-1089"></span><span id="separate"><span class="annot"><span class="annottext">separate :: Stream (Sum f g) m r -&gt; Stream f (Stream g m) r
</span><a href="Streaming.Internal.html#separate"><span class="hs-identifier hs-var hs-var">separate</span></a></span></span><span> </span><span id="local-6989586621679062860"><span class="annot"><span class="annottext">Stream (Sum f g) m r
</span><a href="#local-6989586621679062860"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r
-&gt; (Sum f g (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r)
-&gt; (m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r)
-&gt; (r -&gt; Stream f (Stream g m) r)
-&gt; Stream f (Stream g m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r b.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier hs-var">destroyExposed</span></a></span><span>
</span><span id="line-1090"></span><span>  </span><span class="annot"><span class="annottext">Stream (Sum f g) m r
</span><a href="#local-6989586621679062860"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1091"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679062859"><span class="annot"><span class="annottext">Sum f g (Stream f (Stream g m) r)
</span><a href="#local-6989586621679062859"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Sum f g (Stream f (Stream g m) r)
</span><a href="#local-6989586621679062859"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InL</span></a></span><span> </span><span id="local-6989586621679062858"><span class="annot"><span class="annottext">f (Stream f (Stream g m) r)
</span><a href="#local-6989586621679062858"><span class="hs-identifier hs-var">fss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f (Stream g m) r)
</span><a href="#local-6989586621679062858"><span class="hs-identifier hs-var">fss</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InR</span></a></span><span> </span><span id="local-6989586621679062857"><span class="annot"><span class="annottext">g (Stream f (Stream g m) r)
</span><a href="#local-6989586621679062857"><span class="hs-identifier hs-var">gss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream g m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#effect"><span class="hs-identifier hs-var">effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">g (Stream f (Stream g m) r) -&gt; Stream g m (Stream f (Stream g m) r)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#yields"><span class="hs-identifier hs-var">yields</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream f (Stream g m) r)
</span><a href="#local-6989586621679062857"><span class="hs-identifier hs-var">gss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1092"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream g m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#effect"><span class="hs-identifier hs-var">effect</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r)
-&gt; (m (Stream f (Stream g m) r)
    -&gt; Stream g m (Stream f (Stream g m) r))
-&gt; m (Stream f (Stream g m) r)
-&gt; Stream f (Stream g m) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f (Stream g m) r) -&gt; Stream g m (Stream f (Stream g m) r)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1093"></span><span>  </span><span class="annot"><span class="annottext">r -&gt; Stream f (Stream g m) r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-1094"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#separate"><span class="hs-pragma hs-type">separate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1095"></span><span>
</span><span id="line-1096"></span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span id="local-6989586621679062853"><span id="local-6989586621679062854"><span id="local-6989586621679062855"><span id="local-6989586621679062856"><span class="annot"><a href="Streaming.Internal.html#unseparate"><span class="hs-identifier hs-type">unseparate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062856"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062855"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062854"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062855"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062854"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062856"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062853"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062855"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062854"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062856"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062853"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-1099"></span><span id="unseparate"><span class="annot"><span class="annottext">unseparate :: Stream f (Stream g m) r -&gt; Stream (Sum f g) m r
</span><a href="Streaming.Internal.html#unseparate"><span class="hs-identifier hs-var hs-var">unseparate</span></a></span></span><span> </span><span id="local-6989586621679062852"><span class="annot"><span class="annottext">Stream f (Stream g m) r
</span><a href="#local-6989586621679062852"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f (Stream g m) r
-&gt; (f (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r)
-&gt; (Stream g m (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r)
-&gt; (r -&gt; Stream (Sum f g) m r)
-&gt; Stream (Sum f g) m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r b.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier hs-var">destroyExposed</span></a></span><span>
</span><span id="line-1100"></span><span>  </span><span class="annot"><span class="annottext">Stream f (Stream g m) r
</span><a href="#local-6989586621679062852"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1101"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sum f g (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(Sum f g (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r)
-&gt; (f (Stream (Sum f g) m r) -&gt; Sum f g (Stream (Sum f g) m r))
-&gt; f (Stream (Sum f g) m r)
-&gt; Stream (Sum f g) m r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream (Sum f g) m r) -&gt; Sum f g (Stream (Sum f g) m r)
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). f a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream (Sum f g) m (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream (Sum f g) m (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r)
-&gt; (Stream g m (Stream (Sum f g) m r)
    -&gt; Stream (Sum f g) m (Stream (Sum f g) m r))
-&gt; Stream g m (Stream (Sum f g) m r)
-&gt; Stream (Sum f g) m r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(forall x. g x -&gt; Sum f g x)
-&gt; Stream g m (Stream (Sum f g) m r)
-&gt; Stream (Sum f g) m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
(forall x. f x -&gt; g x) -&gt; Stream f m r -&gt; Stream g m r
</span><a href="Streaming.Internal.html#maps"><span class="hs-identifier hs-var">maps</span></a></span><span> </span><span class="annot"><span class="annottext">forall x. g x -&gt; Sum f g x
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). g a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>  </span><span class="annot"><span class="annottext">r -&gt; Stream (Sum f g) m r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-1104"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unseparate"><span class="hs-pragma hs-type">unseparate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1105"></span><span>
</span><span id="line-1106"></span><span class="hs-comment">-- | If 'Of' had a @Comonad@ instance, then we'd have</span><span>
</span><span id="line-1107"></span><span class="hs-comment">--</span><span>
</span><span id="line-1108"></span><span class="hs-comment">-- @copy = expand extend@</span><span>
</span><span id="line-1109"></span><span class="hs-comment">--</span><span>
</span><span id="line-1110"></span><span class="hs-comment">-- See 'expandPost' for a version that requires a @Functor g@</span><span>
</span><span id="line-1111"></span><span class="hs-comment">-- instance instead.</span><span>
</span><span id="line-1112"></span><span id="local-6989586621679062847"><span id="local-6989586621679062848"><span id="local-6989586621679062849"><span id="local-6989586621679062850"><span id="local-6989586621679062851"><span class="annot"><a href="Streaming.Internal.html#expand"><span class="hs-identifier hs-type">expand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062851"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062850"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1113"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063579"><span class="annot"><a href="#local-6989586621679063579"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679063578"><span class="annot"><a href="#local-6989586621679063578"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062849"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063579"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063578"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062850"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063579"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062848"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063578"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062850"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062851"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062847"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062849"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062848"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062851"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062847"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span></span><span>
</span><span id="line-1115"></span><span id="expand"><span class="annot"><span class="annottext">expand :: (forall a b. (g a -&gt; b) -&gt; f a -&gt; h b)
-&gt; Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="Streaming.Internal.html#expand"><span class="hs-identifier hs-var hs-var">expand</span></a></span></span><span> </span><span id="local-6989586621679062846"><span class="annot"><span class="annottext">forall a b. (g a -&gt; b) -&gt; f a -&gt; h b
</span><a href="#local-6989586621679062846"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062845"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1116"></span><span>  </span><span id="local-6989586621679062845"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062845"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062844"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062844"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062844"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1117"></span><span>  </span><span class="annot"><a href="#local-6989586621679062845"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062843"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062843"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r)
-&gt; Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">h (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(h (Stream h m (Stream g (Stream h m) r))
 -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; h (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Stream g (Stream h m) r)
 -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; f (Stream g (Stream h m) r)
-&gt; h (Stream h m (Stream g (Stream h m) r))
forall a b. (g a -&gt; b) -&gt; f a -&gt; h b
</span><a href="#local-6989586621679062846"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; (g (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r)
-&gt; g (Stream g (Stream h m) r)
-&gt; Stream h m (Stream g (Stream h m) r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g (Stream h m) r)
-&gt; f (Stream f m r) -&gt; f (Stream g (Stream h m) r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062845"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062843"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>  </span><span class="annot"><a href="#local-6989586621679062845"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062842"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062842"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r)
-&gt; Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream h m (Stream g (Stream h m) r))
 -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; m (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; m (Stream f m r) -&gt; m (Stream h m (Stream g (Stream h m) r))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; (Stream f m r -&gt; Stream g (Stream h m) r)
-&gt; Stream f m r
-&gt; Stream h m (Stream g (Stream h m) r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062845"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062842"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1119"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#expand"><span class="hs-pragma hs-type">expand</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1120"></span><span>
</span><span id="line-1121"></span><span class="hs-comment">-- | If 'Of' had a @Comonad@ instance, then we'd have</span><span>
</span><span id="line-1122"></span><span class="hs-comment">--</span><span>
</span><span id="line-1123"></span><span class="hs-comment">-- @copy = expandPost extend@</span><span>
</span><span id="line-1124"></span><span class="hs-comment">--</span><span>
</span><span id="line-1125"></span><span class="hs-comment">-- See 'expand' for a version that requires a @Functor f@ instance</span><span>
</span><span id="line-1126"></span><span class="hs-comment">-- instead.</span><span>
</span><span id="line-1127"></span><span id="local-6989586621679062837"><span id="local-6989586621679062838"><span id="local-6989586621679062839"><span id="local-6989586621679062840"><span id="local-6989586621679062841"><span class="annot"><a href="Streaming.Internal.html#expandPost"><span class="hs-identifier hs-type">expandPost</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062841"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062840"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679063572"><span class="annot"><a href="#local-6989586621679063572"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679063571"><span class="annot"><a href="#local-6989586621679063571"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679062840"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063572"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679063571"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062839"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063572"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062838"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063571"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1129"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062839"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062841"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062837"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062840"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062838"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062841"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062837"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span></span><span>
</span><span id="line-1130"></span><span id="expandPost"><span class="annot"><span class="annottext">expandPost :: (forall a b. (g a -&gt; b) -&gt; f a -&gt; h b)
-&gt; Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="Streaming.Internal.html#expandPost"><span class="hs-identifier hs-var hs-var">expandPost</span></a></span></span><span> </span><span id="local-6989586621679062836"><span class="annot"><span class="annottext">forall a b. (g a -&gt; b) -&gt; f a -&gt; h b
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062835"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1131"></span><span>  </span><span id="local-6989586621679062835"><span class="annot"><span class="annottext">loop :: Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062835"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-type">Return</span></a></span><span> </span><span id="local-6989586621679062834"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062834"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062834"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1132"></span><span>  </span><span class="annot"><a href="#local-6989586621679062835"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span id="local-6989586621679062833"><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062833"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r)
-&gt; Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">h (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(h (Stream h m (Stream g (Stream h m) r))
 -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; h (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Stream f m r) -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; f (Stream f m r) -&gt; h (Stream h m (Stream g (Stream h m) r))
forall a b. (g a -&gt; b) -&gt; f a -&gt; h b
</span><a href="#local-6989586621679062836"><span class="hs-identifier hs-var">ext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; (g (Stream f m r) -&gt; Stream g (Stream h m) r)
-&gt; g (Stream f m r)
-&gt; Stream h m (Stream g (Stream h m) r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(g (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r)
-&gt; (g (Stream f m r) -&gt; g (Stream g (Stream h m) r))
-&gt; g (Stream f m r)
-&gt; Stream g (Stream h m) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream g (Stream h m) r)
-&gt; g (Stream f m r) -&gt; g (Stream g (Stream h m) r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062835"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r)
</span><a href="#local-6989586621679062833"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1133"></span><span>  </span><span class="annot"><a href="#local-6989586621679062835"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-type">Effect</span></a></span><span> </span><span id="local-6989586621679062832"><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062832"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r)
-&gt; Stream h m (Stream g (Stream h m) r) -&gt; Stream g (Stream h m) r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream h m (Stream g (Stream h m) r))
 -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; m (Stream h m (Stream g (Stream h m) r))
-&gt; Stream h m (Stream g (Stream h m) r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; m (Stream f m r) -&gt; m (Stream h m (Stream g (Stream h m) r))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r)
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g (Stream h m) r -&gt; Stream h m (Stream g (Stream h m) r))
-&gt; (Stream f m r -&gt; Stream g (Stream h m) r)
-&gt; Stream f m r
-&gt; Stream h m (Stream g (Stream h m) r)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; Stream g (Stream h m) r
</span><a href="#local-6989586621679062835"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r)
</span><a href="#local-6989586621679062832"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1134"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#expandPost"><span class="hs-pragma hs-type">expandPost</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span id="local-6989586621679062828"><span id="local-6989586621679062829"><span id="local-6989586621679062830"><span id="local-6989586621679062831"><span class="annot"><a href="Streaming.Internal.html#unzips"><span class="hs-identifier hs-type">unzips</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062829"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1137"></span><span>   </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Compose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062829"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062828"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062830"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062829"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062831"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062828"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-1138"></span><span id="unzips"><span class="annot"><span class="annottext">unzips :: Stream (Compose f g) m r -&gt; Stream f (Stream g m) r
</span><a href="Streaming.Internal.html#unzips"><span class="hs-identifier hs-var hs-var">unzips</span></a></span></span><span> </span><span id="local-6989586621679062827"><span class="annot"><span class="annottext">Stream (Compose f g) m r
</span><a href="#local-6989586621679062827"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (Compose f g) m r
-&gt; (Compose f g (Stream f (Stream g m) r)
    -&gt; Stream f (Stream g m) r)
-&gt; (m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r)
-&gt; (r -&gt; Stream f (Stream g m) r)
-&gt; Stream f (Stream g m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r b.
(Functor f, Monad m) =&gt;
Stream f m r -&gt; (f b -&gt; b) -&gt; (m b -&gt; b) -&gt; (r -&gt; b) -&gt; b
</span><a href="Streaming.Internal.html#destroyExposed"><span class="hs-identifier hs-var">destroyExposed</span></a></span><span>
</span><span id="line-1139"></span><span>  </span><span class="annot"><span class="annottext">Stream (Compose f g) m r
</span><a href="#local-6989586621679062827"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Compose</span></a></span><span> </span><span id="local-6989586621679062826"><span class="annot"><span class="annottext">f (g (Stream f (Stream g m) r))
</span><a href="#local-6989586621679062826"><span class="hs-identifier hs-var">fgstr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(g (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r)
-&gt; f (g (Stream f (Stream g m) r)) -&gt; f (Stream f (Stream g m) r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream g m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r)
-&gt; (g (Stream f (Stream g m) r)
    -&gt; Stream g m (Stream f (Stream g m) r))
-&gt; g (Stream f (Stream g m) r)
-&gt; Stream f (Stream g m) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream f (Stream g m) r) -&gt; Stream g m (Stream f (Stream g m) r)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#yields"><span class="hs-identifier hs-var">yields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (g (Stream f (Stream g m) r))
</span><a href="#local-6989586621679062826"><span class="hs-identifier hs-var">fgstr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1141"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream g m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream g m (Stream f (Stream g m) r) -&gt; Stream f (Stream g m) r)
-&gt; (m (Stream f (Stream g m) r)
    -&gt; Stream g m (Stream f (Stream g m) r))
-&gt; m (Stream f (Stream g m) r)
-&gt; Stream f (Stream g m) r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m (Stream f (Stream g m) r) -&gt; Stream g m (Stream f (Stream g m) r)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span>  </span><span class="annot"><span class="annottext">r -&gt; Stream f (Stream g m) r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-1143"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#unzips"><span class="hs-pragma hs-type">unzips</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1144"></span><span>
</span><span id="line-1145"></span><span class="hs-comment">{-| Group layers in an alternating stream into adjoining sub-streams
    of one type or another.
-}</span><span>
</span><span id="line-1148"></span><span id="local-6989586621679062822"><span id="local-6989586621679062823"><span id="local-6989586621679062824"><span id="local-6989586621679062825"><span class="annot"><a href="Streaming.Internal.html#groups"><span class="hs-identifier hs-type">groups</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062824"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062823"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1149"></span><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062824"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062823"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062822"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-1150"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062824"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062823"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679062825"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062822"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-1151"></span><span id="groups"><span class="annot"><span class="annottext">groups :: Stream (Sum f g) m r -&gt; Stream (Sum (Stream f m) (Stream g m)) m r
</span><a href="Streaming.Internal.html#groups"><span class="hs-identifier hs-var hs-var">groups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream (Sum (Stream f m) (Stream g m)) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f, Functor g) =&gt;
Stream (Sum f g) m r -&gt; Stream (Sum (Stream f m) (Stream g m)) m r
</span><a href="#local-6989586621679062821"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1152"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1153"></span><span>  </span><span id="local-6989586621679062821"><span class="annot"><span class="annottext">loop :: Stream (Sum f g) m r -&gt; Stream (Sum (Stream f m) (Stream g m)) m r
</span><a href="#local-6989586621679062821"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679062820"><span class="annot"><span class="annottext">Stream (Sum f g) m r
</span><a href="#local-6989586621679062820"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1154"></span><span>    </span><span id="local-6989586621679062819"><span class="annot"><span class="annottext">Either r (Sum f g (Stream (Sum f g) m r))
</span><a href="#local-6989586621679062819"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either r (Sum f g (Stream (Sum f g) m r)))
-&gt; Stream
     (Sum (Stream f m) (Stream g m))
     m
     (Either r (Sum f g (Stream (Sum f g) m r)))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (Sum f g (Stream (Sum f g) m r)))
 -&gt; Stream
      (Sum (Stream f m) (Stream g m))
      m
      (Either r (Sum f g (Stream (Sum f g) m r))))
-&gt; m (Either r (Sum f g (Stream (Sum f g) m r)))
-&gt; Stream
     (Sum (Stream f m) (Stream g m))
     m
     (Either r (Sum f g (Stream (Sum f g) m r)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r
-&gt; m (Either r (Sum f g (Stream (Sum f g) m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r
</span><a href="#local-6989586621679062820"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1155"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either r (Sum f g (Stream (Sum f g) m r))
</span><a href="#local-6989586621679062819"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1156"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679062818"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062818"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream (Sum (Stream f m) (Stream g m)) m r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062818"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-1157"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679062817"><span class="annot"><span class="annottext">Sum f g (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062817"><span class="hs-identifier hs-var">ostr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Sum f g (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062817"><span class="hs-identifier hs-var">ostr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1158"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InR</span></a></span><span> </span><span id="local-6989586621679062816"><span class="annot"><span class="annottext">g (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062816"><span class="hs-identifier hs-var">gstr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sum
  (Stream f m)
  (Stream g m)
  (Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Stream (Sum (Stream f m) (Stream g m)) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(Sum
   (Stream f m)
   (Stream g m)
   (Stream (Sum (Stream f m) (Stream g m)) m r)
 -&gt; Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Sum
     (Stream f m)
     (Stream g m)
     (Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Stream (Sum (Stream f m) (Stream g m)) m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream g m (Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Sum
     (Stream f m)
     (Stream g m)
     (Stream (Sum (Stream f m) (Stream g m)) m r)
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). g a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream (Sum f g) m r
 -&gt; Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Stream g m (Stream (Sum f g) m r)
-&gt; Stream g m (Stream (Sum (Stream f m) (Stream g m)) m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream (Sum (Stream f m) (Stream g m)) m r
</span><a href="#local-6989586621679062821"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream g m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f, Functor g) =&gt;
Stream (Sum f g) m r -&gt; Stream g m (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062815"><span class="hs-identifier hs-var">cleanR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sum f g (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">g (Stream (Sum f g) m r) -&gt; Sum f g (Stream (Sum f g) m r)
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). g a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InR</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062816"><span class="hs-identifier hs-var">gstr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InL</span></a></span><span> </span><span id="local-6989586621679062814"><span class="annot"><span class="annottext">f (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062814"><span class="hs-identifier hs-var">fstr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Sum
  (Stream f m)
  (Stream g m)
  (Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Stream (Sum (Stream f m) (Stream g m)) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(Sum
   (Stream f m)
   (Stream g m)
   (Stream (Sum (Stream f m) (Stream g m)) m r)
 -&gt; Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Sum
     (Stream f m)
     (Stream g m)
     (Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Stream (Sum (Stream f m) (Stream g m)) m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m (Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Sum
     (Stream f m)
     (Stream g m)
     (Stream (Sum (Stream f m) (Stream g m)) m r)
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). f a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream (Sum f g) m r
 -&gt; Stream (Sum (Stream f m) (Stream g m)) m r)
-&gt; Stream f m (Stream (Sum f g) m r)
-&gt; Stream f m (Stream (Sum (Stream f m) (Stream g m)) m r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream (Sum (Stream f m) (Stream g m)) m r
</span><a href="#local-6989586621679062821"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f, Functor g) =&gt;
Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062813"><span class="hs-identifier hs-var">cleanL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sum f g (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream (Sum f g) m r) -&gt; Sum f g (Stream (Sum f g) m r)
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). f a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InL</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062814"><span class="hs-identifier hs-var">fstr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1160"></span><span>
</span><span id="line-1161"></span><span>  </span><span id="local-6989586621679063547"><span id="local-6989586621679063548"><span id="local-6989586621679063549"><span id="local-6989586621679063550"><span class="annot"><a href="#local-6989586621679062813"><span class="hs-identifier hs-type">cleanL</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063550"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063549"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063548"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1162"></span><span>       </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063549"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063548"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063550"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063547"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063549"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063550"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063549"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063548"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063550"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063547"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1163"></span><span>  </span><span id="local-6989586621679062813"><span class="annot"><span class="annottext">cleanL :: Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062813"><span class="hs-identifier hs-var hs-var">cleanL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) (g :: * -&gt; *) r.
(Monad m, Functor f, Functor g) =&gt;
Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062812"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1164"></span><span>    </span><span id="local-6989586621679062812"><span class="annot"><span class="annottext">go :: Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062812"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679062811"><span class="annot"><span class="annottext">Stream (Sum f g) m r
</span><a href="#local-6989586621679062811"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1165"></span><span>     </span><span id="local-6989586621679062810"><span class="annot"><span class="annottext">Either r (Sum f g (Stream (Sum f g) m r))
</span><a href="#local-6989586621679062810"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either r (Sum f g (Stream (Sum f g) m r)))
-&gt; Stream f m (Either r (Sum f g (Stream (Sum f g) m r)))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (Sum f g (Stream (Sum f g) m r)))
 -&gt; Stream f m (Either r (Sum f g (Stream (Sum f g) m r))))
-&gt; m (Either r (Sum f g (Stream (Sum f g) m r)))
-&gt; Stream f m (Either r (Sum f g (Stream (Sum f g) m r)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r
-&gt; m (Either r (Sum f g (Stream (Sum f g) m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r
</span><a href="#local-6989586621679062811"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1166"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either r (Sum f g (Stream (Sum f g) m r))
</span><a href="#local-6989586621679062810"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1167"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679062809"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062809"><span class="hs-identifier hs-var">r</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Stream (Sum f g) m r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062809"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InL</span></a></span><span> </span><span id="local-6989586621679062808"><span class="annot"><span class="annottext">f (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062808"><span class="hs-identifier hs-var">fstr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m (Stream (Sum f g) m r))
-&gt; Stream f m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r))
-&gt; f (Stream (Sum f g) m r)
-&gt; f (Stream f m (Stream (Sum f g) m r))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062812"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062808"><span class="hs-identifier hs-var">fstr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InR</span></a></span><span> </span><span id="local-6989586621679062807"><span class="annot"><span class="annottext">g (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062807"><span class="hs-identifier hs-var">gstr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sum f g (Stream (Sum f g) m r) -&gt; Stream (Sum f g) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">g (Stream (Sum f g) m r) -&gt; Sum f g (Stream (Sum f g) m r)
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). g a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InR</span></a></span><span> </span><span class="annot"><span class="annottext">g (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062807"><span class="hs-identifier hs-var">gstr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span>  </span><span id="local-6989586621679063551"><span id="local-6989586621679063552"><span id="local-6989586621679063553"><span id="local-6989586621679063554"><span class="annot"><a href="#local-6989586621679062815"><span class="hs-identifier hs-type">cleanR</span></a></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063554"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063553"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063552"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1172"></span><span>       </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063553"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063552"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063554"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063551"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063552"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063554"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Sum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063553"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063552"><span class="hs-identifier hs-type">g</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679063554"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063551"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1173"></span><span>  </span><span id="local-6989586621679062815"><span class="annot"><span class="annottext">cleanR :: Stream (Sum f g) m r -&gt; Stream g m (Stream (Sum f g) m r)
</span><a href="#local-6989586621679062815"><span class="hs-identifier hs-var hs-var">cleanR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f g) m r -&gt; Stream g m (Stream (Sum f g) m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f, Functor f) =&gt;
Stream (Sum f f) m r -&gt; Stream f m (Stream (Sum f f) m r)
</span><a href="#local-6989586621679062806"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1174"></span><span>    </span><span id="local-6989586621679062806"><span class="annot"><span class="annottext">go :: Stream (Sum f f) m r -&gt; Stream f m (Stream (Sum f f) m r)
</span><a href="#local-6989586621679062806"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679062805"><span class="annot"><span class="annottext">Stream (Sum f f) m r
</span><a href="#local-6989586621679062805"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1175"></span><span>     </span><span id="local-6989586621679062804"><span class="annot"><span class="annottext">Either r (Sum f f (Stream (Sum f f) m r))
</span><a href="#local-6989586621679062804"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either r (Sum f f (Stream (Sum f f) m r)))
-&gt; Stream f m (Either r (Sum f f (Stream (Sum f f) m r)))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either r (Sum f f (Stream (Sum f f) m r)))
 -&gt; Stream f m (Either r (Sum f f (Stream (Sum f f) m r))))
-&gt; m (Either r (Sum f f (Stream (Sum f f) m r)))
-&gt; Stream f m (Either r (Sum f f (Stream (Sum f f) m r)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f f) m r
-&gt; m (Either r (Sum f f (Stream (Sum f f) m r)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f f) m r
</span><a href="#local-6989586621679062805"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1176"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either r (Sum f f (Stream (Sum f f) m r))
</span><a href="#local-6989586621679062804"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1177"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679062803"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062803"><span class="hs-identifier hs-var">r</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f f) m r -&gt; Stream f m (Stream (Sum f f) m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Stream (Sum f f) m r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062803"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1178"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InL</span></a></span><span> </span><span id="local-6989586621679062802"><span class="annot"><span class="annottext">f (Stream (Sum f f) m r)
</span><a href="#local-6989586621679062802"><span class="hs-identifier hs-var">fstr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Stream (Sum f f) m r -&gt; Stream f m (Stream (Sum f f) m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sum f f (Stream (Sum f f) m r) -&gt; Stream (Sum f f) m r
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream (Sum f f) m r) -&gt; Sum f f (Stream (Sum f f) m r)
forall k (f :: k -&gt; *) (g :: k -&gt; *) (a :: k). f a -&gt; Sum f g a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">InL</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream (Sum f f) m r)
</span><a href="#local-6989586621679062802"><span class="hs-identifier hs-var">fstr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1179"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">InR</span></a></span><span> </span><span id="local-6989586621679062801"><span class="annot"><span class="annottext">f (Stream (Sum f f) m r)
</span><a href="#local-6989586621679062801"><span class="hs-identifier hs-var">gstr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m (Stream (Sum f f) m r))
-&gt; Stream f m (Stream (Sum f f) m r)
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
(Monad m, Functor f) =&gt;
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#wrap"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Stream (Sum f f) m r -&gt; Stream f m (Stream (Sum f f) m r))
-&gt; f (Stream (Sum f f) m r)
-&gt; f (Stream f m (Stream (Sum f f) m r))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Stream (Sum f f) m r -&gt; Stream f m (Stream (Sum f f) m r)
</span><a href="#local-6989586621679062806"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">f (Stream (Sum f f) m r)
</span><a href="#local-6989586621679062801"><span class="hs-identifier hs-var">gstr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1180"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#groups"><span class="hs-pragma hs-type">groups</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1181"></span><span>
</span><span id="line-1182"></span><span class="hs-comment">-- groupInL :: (Monad m, Functor f, Functor g)</span><span>
</span><span id="line-1183"></span><span class="hs-comment">--                      =&gt; Stream (Sum f g) m r</span><span>
</span><span id="line-1184"></span><span class="hs-comment">--                      -&gt; Stream (Sum (Stream f m) g) m r</span><span>
</span><span id="line-1185"></span><span class="hs-comment">-- groupInL = loop</span><span>
</span><span id="line-1186"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-1187"></span><span class="hs-comment">--   loop str = do</span><span>
</span><span id="line-1188"></span><span class="hs-comment">--     e &lt;- lift $ inspect str</span><span>
</span><span id="line-1189"></span><span class="hs-comment">--     case e of</span><span>
</span><span id="line-1190"></span><span class="hs-comment">--       Left r -&gt; return r</span><span>
</span><span id="line-1191"></span><span class="hs-comment">--       Right ostr -&gt; case ostr of</span><span>
</span><span id="line-1192"></span><span class="hs-comment">--         InR gstr -&gt; wrap $ InR (fmap loop gstr)</span><span>
</span><span id="line-1193"></span><span class="hs-comment">--         InL fstr -&gt; wrap $ InL (fmap loop (cleanL (wrap (InL fstr))))</span><span>
</span><span id="line-1194"></span><span class="hs-comment">--   cleanL  :: (Monad m, Functor f, Functor g) =&gt;</span><span>
</span><span id="line-1195"></span><span class="hs-comment">--        Stream (Sum f g) m r -&gt; Stream f m (Stream (Sum f g) m r)</span><span>
</span><span id="line-1196"></span><span class="hs-comment">--   cleanL = loop where</span><span>
</span><span id="line-1197"></span><span class="hs-comment">--     loop s = dos</span><span>
</span><span id="line-1198"></span><span class="hs-comment">--      e &lt;- lift $ inspect s</span><span>
</span><span id="line-1199"></span><span class="hs-comment">--      case e of</span><span>
</span><span id="line-1200"></span><span class="hs-comment">--       Left r           -&gt; return (return r)</span><span>
</span><span id="line-1201"></span><span class="hs-comment">--       Right (InL fstr) -&gt; wrap (fmap loop fstr)</span><span>
</span><span id="line-1202"></span><span class="hs-comment">--       Right (InR gstr) -&gt; return (wrap (InR gstr))</span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span class="hs-comment">{- | 'never' interleaves the pure applicative action with the return of the monad forever.
     It is the 'empty' of the 'Alternative' instance, thus

&gt; never &lt;|&gt; a = a
&gt; a &lt;|&gt; never = a

     and so on. If w is a monoid then @never :: Stream (Of w) m r@ is
     the infinite sequence of 'mempty', and
     @str1 \&lt;|\&gt; str2@ appends the elements monoidally until one of streams ends.
     Thus we have, e.g.

&gt;&gt;&gt; S.stdoutLn $ S.take 2 $ S.stdinLn &lt;|&gt; S.repeat &quot; &quot; &lt;|&gt; S.stdinLn  &lt;|&gt; S.repeat &quot; &quot; &lt;|&gt; S.stdinLn
1&lt;Enter&gt;
2&lt;Enter&gt;
3&lt;Enter&gt;
1 2 3
4&lt;Enter&gt;
5&lt;Enter&gt;
6&lt;Enter&gt;
4 5 6

    This is equivalent to

&gt;&gt;&gt; S.stdoutLn $ S.take 2 $ foldr (&lt;|&gt;) never [S.stdinLn, S.repeat &quot; &quot;, S.stdinLn, S.repeat &quot; &quot;, S.stdinLn ]

     Where 'f' is a monad, @(\&lt;|\&gt;)@ sequences the conjoined streams stepwise. See the
     definition of @paste@ &lt;https://gist.github.com/michaelt/6c6843e6dd8030e95d58 here&gt;,
     where the separate steps are bytestreams corresponding to the lines of a file.

     Given, say,

&gt; data Branch r = Branch r r deriving Functor  -- add obvious applicative instance

    then @never :: Stream Branch Identity r@  is the pure infinite binary tree with
    (inaccessible) @r@s in its leaves. Given two binary trees, @tree1 \&lt;|\&gt; tree2@
    intersects them, preserving the leaves that came first,
    so @tree1 \&lt;|\&gt; never = tree1@

    @Stream Identity m r@ is an action in @m@ that is indefinitely delayed. Such an
    action can be constructed with e.g. 'untilJust'.

&gt; untilJust :: (Monad m, Applicative f) =&gt; m (Maybe r) -&gt; Stream f m r

    Given two such items, @\&lt;|\&gt;@ instance races them.
    It is thus the iterative monad transformer specially defined in
    &lt;https://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Trans-Iter.html Control.Monad.Trans.Iter&gt;

    So, for example, we might write

&gt;&gt;&gt; let justFour str = if length str == 4 then Just str else Nothing
&gt;&gt;&gt; let four = untilJust (fmap justFour getLine)
&gt;&gt;&gt; run four
one&lt;Enter&gt;
two&lt;Enter&gt;
three&lt;Enter&gt;
four&lt;Enter&gt;
&quot;four&quot;


    The 'Alternative' instance in
    &lt;https://hackage.haskell.org/package/free-4.12.1/docs/Control-Monad-Trans-Free.html Control.Monad.Trans.Free&gt;
    is avowedly wrong, though no explanation is given for this.


-}</span><span>
</span><span id="line-1269"></span><span id="local-6989586621679063914"><span id="local-6989586621679063915"><span id="local-6989586621679063916"><span class="annot"><a href="Streaming.Internal.html#never"><span class="hs-identifier hs-type">never</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063916"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063915"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063915"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063916"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679063914"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-1270"></span><span class="hs-comment">-- The Monad m constraint should really be an Applicative one,</span><span>
</span><span id="line-1271"></span><span class="hs-comment">-- but we still support old versions of base.</span><span>
</span><span id="line-1272"></span><span id="never"><span class="annot"><span class="annottext">never :: Stream f m r
</span><a href="Streaming.Internal.html#never"><span class="hs-identifier hs-var hs-var">never</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679062800"><span class="annot"><span class="annottext">loop :: Stream f m r
</span><a href="#local-6989586621679062800"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(f (Stream f m r) -&gt; Stream f m r)
-&gt; f (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062800"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Stream f m r
forall r. Stream f m r
</span><a href="#local-6989586621679062800"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1273"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#never"><span class="hs-pragma hs-type">never</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>
</span><span id="line-1276"></span><span id="local-6989586621679062797"><span id="local-6989586621679062798"><span id="local-6989586621679062799"><span class="annot"><a href="Streaming.Internal.html#delays"><span class="hs-identifier hs-type">delays</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062799"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062798"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062798"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062799"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062797"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-1277"></span><span id="delays"><span class="annot"><span class="annottext">delays :: Double -&gt; Stream f m r
</span><a href="Streaming.Internal.html#delays"><span class="hs-identifier hs-var hs-var">delays</span></a></span></span><span> </span><span id="local-6989586621679062796"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679062796"><span class="hs-identifier hs-var">seconds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062795"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1278"></span><span>  </span><span id="local-6989586621679062795"><span class="annot"><span class="annottext">loop :: Stream f m r
</span><a href="#local-6989586621679062795"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m r) -&gt; Stream f m r)
-&gt; m (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679062794"><span class="hs-identifier hs-var">delay</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (Stream f m r) -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream f m r -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062795"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1279"></span><span>  </span><span id="local-6989586621679062794"><span class="annot"><span class="annottext">delay :: Int
</span><a href="#local-6989586621679062794"><span class="hs-identifier hs-var hs-var">delay</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Integer
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">truncate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1000000</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679062796"><span class="hs-identifier hs-var">seconds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Streaming.Internal.html#delays"><span class="hs-pragma hs-type">delays</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1281"></span><span>
</span><span id="line-1282"></span><span class="hs-comment">-- {-| Permit streamed actions to proceed unless the clock has run out.</span><span>
</span><span id="line-1283"></span><span class="hs-comment">--</span><span>
</span><span id="line-1284"></span><span class="hs-comment">-- -}</span><span>
</span><span id="line-1285"></span><span class="hs-comment">-- period :: (MonadIO m, Functor f) =&gt; Double -&gt; Stream f m r -&gt; Stream f m (Stream f m r)</span><span>
</span><span id="line-1286"></span><span class="hs-comment">-- period seconds str = do</span><span>
</span><span id="line-1287"></span><span class="hs-comment">--     utc &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1288"></span><span class="hs-comment">--     let loop s = do</span><span>
</span><span id="line-1289"></span><span class="hs-comment">--           utc' &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1290"></span><span class="hs-comment">--           if diffUTCTime utc' utc &gt; (cutoff / 1000000000)</span><span>
</span><span id="line-1291"></span><span class="hs-comment">--             then return s</span><span>
</span><span id="line-1292"></span><span class="hs-comment">--             else case s of</span><span>
</span><span id="line-1293"></span><span class="hs-comment">--               Return r -&gt; Return (Return r)</span><span>
</span><span id="line-1294"></span><span class="hs-comment">--               Effect m -&gt; Effect (fmap loop m)</span><span>
</span><span id="line-1295"></span><span class="hs-comment">--               Step f   -&gt; Step (fmap loop f)</span><span>
</span><span id="line-1296"></span><span class="hs-comment">--     loop str</span><span>
</span><span id="line-1297"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-1298"></span><span class="hs-comment">--   cutoff = fromInteger (truncate (1000000000 * seconds))</span><span>
</span><span id="line-1299"></span><span class="hs-comment">-- {-# INLINABLE period #-}</span><span>
</span><span id="line-1300"></span><span class="hs-comment">--</span><span>
</span><span id="line-1301"></span><span class="hs-comment">--</span><span>
</span><span id="line-1302"></span><span class="hs-comment">-- {-| Divide a succession of phases according to a specified time interval. If time runs out</span><span>
</span><span id="line-1303"></span><span class="hs-comment">--     while an action is proceeding, it is allowed to run to completion. The clock is only then</span><span>
</span><span id="line-1304"></span><span class="hs-comment">--     restarted.</span><span>
</span><span id="line-1305"></span><span class="hs-comment">-- -}</span><span>
</span><span id="line-1306"></span><span class="hs-comment">-- periods :: (MonadIO m, Functor f) =&gt; Double -&gt; Stream f m r -&gt; Stream (Stream f m) m r</span><span>
</span><span id="line-1307"></span><span class="hs-comment">-- periods seconds s = do</span><span>
</span><span id="line-1308"></span><span class="hs-comment">--   utc &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1309"></span><span class="hs-comment">--   loop (addUTCTime cutoff utc) s</span><span>
</span><span id="line-1310"></span><span class="hs-comment">--</span><span>
</span><span id="line-1311"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-1312"></span><span class="hs-comment">--   cutoff = fromInteger (truncate (1000000000 * seconds)) / 1000000000</span><span>
</span><span id="line-1313"></span><span class="hs-comment">--   loop final stream = do</span><span>
</span><span id="line-1314"></span><span class="hs-comment">--     utc &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1315"></span><span class="hs-comment">--     if utc &gt; final</span><span>
</span><span id="line-1316"></span><span class="hs-comment">--       then loop (addUTCTime cutoff utc) stream</span><span>
</span><span id="line-1317"></span><span class="hs-comment">--       else case stream of</span><span>
</span><span id="line-1318"></span><span class="hs-comment">--         Return r  -&gt; Return r</span><span>
</span><span id="line-1319"></span><span class="hs-comment">--         Effect m  -&gt; Effect $ fmap (loop final) m</span><span>
</span><span id="line-1320"></span><span class="hs-comment">--         Step fstr -&gt; Step $ fmap (periods seconds) (cutoff_ final (Step fstr))</span><span>
</span><span id="line-1321"></span><span class="hs-comment">--</span><span>
</span><span id="line-1322"></span><span class="hs-comment">--         -- do</span><span>
</span><span id="line-1323"></span><span class="hs-comment">--         --   let sloop s = do</span><span>
</span><span id="line-1324"></span><span class="hs-comment">--         --         utc' &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1325"></span><span class="hs-comment">--         --         if final &lt; utc'</span><span>
</span><span id="line-1326"></span><span class="hs-comment">--         --           then return s</span><span>
</span><span id="line-1327"></span><span class="hs-comment">--         --           else case s of</span><span>
</span><span id="line-1328"></span><span class="hs-comment">--         --             Return r -&gt; Return (Return r)</span><span>
</span><span id="line-1329"></span><span class="hs-comment">--         --             Effect m -&gt; Effect (fmap sloop m)</span><span>
</span><span id="line-1330"></span><span class="hs-comment">--         --             Step f   -&gt; Step (fmap sloop f)</span><span>
</span><span id="line-1331"></span><span class="hs-comment">--         --   Step (Step (fmap (fmap (periods seconds) . sloop) fstr))</span><span>
</span><span id="line-1332"></span><span class="hs-comment">--           -- str &lt;- m</span><span>
</span><span id="line-1333"></span><span class="hs-comment">--           -- utc' &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1334"></span><span class="hs-comment">--           -- if diffUTCTime utc' utc &gt; (cutoff / 1000000000)</span><span>
</span><span id="line-1335"></span><span class="hs-comment">--           --   then return (loop utc' str)</span><span>
</span><span id="line-1336"></span><span class="hs-comment">--           --   else return (loop utc str)</span><span>
</span><span id="line-1337"></span><span class="hs-comment">--         -- Step fs   -&gt; do</span><span>
</span><span id="line-1338"></span><span class="hs-comment">--         --   let check str = do</span><span>
</span><span id="line-1339"></span><span class="hs-comment">--         --         utc' &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1340"></span><span class="hs-comment">--         --         loop utc' str</span><span>
</span><span id="line-1341"></span><span class="hs-comment">--         --</span><span>
</span><span id="line-1342"></span><span class="hs-comment">-- {-# INLINABLE periods #-}</span><span>
</span><span id="line-1343"></span><span class="hs-comment">--</span><span>
</span><span id="line-1344"></span><span class="hs-comment">-- cutoff_ final str = do</span><span>
</span><span id="line-1345"></span><span class="hs-comment">--     let loop s = do</span><span>
</span><span id="line-1346"></span><span class="hs-comment">--           utc' &lt;- liftIO getCurrentTime</span><span>
</span><span id="line-1347"></span><span class="hs-comment">--           if utc' &gt; final</span><span>
</span><span id="line-1348"></span><span class="hs-comment">--             then Return s</span><span>
</span><span id="line-1349"></span><span class="hs-comment">--             else case s of</span><span>
</span><span id="line-1350"></span><span class="hs-comment">--               Return r -&gt; Return (Return r)</span><span>
</span><span id="line-1351"></span><span class="hs-comment">--               Effect m -&gt; Effect (fmap loop m)</span><span>
</span><span id="line-1352"></span><span class="hs-comment">--               Step f   -&gt; Step (fmap loop f)</span><span>
</span><span id="line-1353"></span><span class="hs-comment">--     loop str</span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span class="hs-comment">{- | Repeat a

-}</span><span>
</span><span id="line-1358"></span><span>
</span><span id="line-1359"></span><span id="local-6989586621679062789"><span id="local-6989586621679062790"><span id="local-6989586621679062791"><span class="annot"><a href="Streaming.Internal.html#untilJust"><span class="hs-identifier hs-type">untilJust</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062791"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Applicative</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062790"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679062791"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062789"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062790"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062791"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062789"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-1360"></span><span id="untilJust"><span class="annot"><span class="annottext">untilJust :: m (Maybe r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#untilJust"><span class="hs-identifier hs-var hs-var">untilJust</span></a></span></span><span> </span><span id="local-6989586621679062788"><span class="annot"><span class="annottext">m (Maybe r)
</span><a href="#local-6989586621679062788"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062787"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1361"></span><span>  </span><span id="local-6989586621679062787"><span class="annot"><span class="annottext">loop :: Stream f m r
</span><a href="#local-6989586621679062787"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
m (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Effect"><span class="hs-identifier hs-var">Effect</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Stream f m r) -&gt; Stream f m r)
-&gt; m (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1362"></span><span>    </span><span id="local-6989586621679062786"><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621679062786"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe r)
</span><a href="#local-6989586621679062788"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-1363"></span><span>    </span><span class="annot"><span class="annottext">Stream f m r -&gt; m (Stream f m r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m r -&gt; m (Stream f m r))
-&gt; Stream f m r -&gt; m (Stream f m r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621679062786"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1364"></span><span>      </span><span class="annot"><span class="annottext">Maybe r
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m r) -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(f (Stream f m r) -&gt; Stream f m r)
-&gt; f (Stream f m r) -&gt; Stream f m r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r -&gt; f (Stream f m r)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m r
</span><a href="#local-6989586621679062787"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1365"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679062785"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062785"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Stream f m r
forall (f :: * -&gt; *) (m :: * -&gt; *) r. r -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Return"><span class="hs-identifier hs-var">Return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679062785"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span>
</span><span id="line-1368"></span><span id="local-6989586621679062782"><span id="local-6989586621679062783"><span id="local-6989586621679062784"><span class="annot"><a href="Streaming.Internal.html#cutoff"><span class="hs-identifier hs-type">cutoff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062784"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062783"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062783"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062784"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062782"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062783"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062784"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679062782"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1369"></span><span id="cutoff"><span class="annot"><span class="annottext">cutoff :: Int -&gt; Stream f m r -&gt; Stream f m (Maybe r)
</span><a href="Streaming.Internal.html#cutoff"><span class="hs-identifier hs-var hs-var">cutoff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Stream f m r -&gt; Stream f m (Maybe r)
forall t (m :: * -&gt; *) (f :: * -&gt; *) a.
(Eq t, Num t, Monad m, Functor f) =&gt;
t -&gt; Stream f m a -&gt; Stream f m (Maybe a)
</span><a href="#local-6989586621679062781"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1370"></span><span>  </span><span id="local-6989586621679062781"><span class="annot"><span class="annottext">loop :: t -&gt; Stream f m a -&gt; Stream f m (Maybe a)
</span><a href="#local-6989586621679062781"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Stream f m (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1371"></span><span>  </span><span class="annot"><a href="#local-6989586621679062781"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621679062780"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679062780"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679062779"><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679062779"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1372"></span><span>      </span><span id="local-6989586621679062778"><span class="annot"><span class="annottext">Either a (f (Stream f m a))
</span><a href="#local-6989586621679062778"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Either a (f (Stream f m a)))
-&gt; Stream f m (Either a (f (Stream f m a)))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either a (f (Stream f m a)))
 -&gt; Stream f m (Either a (f (Stream f m a))))
-&gt; m (Either a (f (Stream f m a)))
-&gt; Stream f m (Either a (f (Stream f m a)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a -&gt; m (Either a (f (Stream f m a)))
forall (m :: * -&gt; *) (f :: * -&gt; *) r.
Monad m =&gt;
Stream f m r -&gt; m (Either r (f (Stream f m r)))
</span><a href="Streaming.Internal.html#inspect"><span class="hs-identifier hs-var">inspect</span></a></span><span> </span><span class="annot"><span class="annottext">Stream f m a
</span><a href="#local-6989586621679062779"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1373"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a (f (Stream f m a))
</span><a href="#local-6989586621679062778"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1374"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679062777"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062777"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Stream f m (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679062777"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1375"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679062776"><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679062776"><span class="hs-identifier hs-var">frest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">f (Stream f m (Maybe a)) -&gt; Stream f m (Maybe a)
forall (f :: * -&gt; *) (m :: * -&gt; *) r.
f (Stream f m r) -&gt; Stream f m r
</span><a href="Streaming.Internal.html#Step"><span class="hs-identifier hs-var">Step</span></a></span><span> </span><span class="annot"><span class="annottext">(f (Stream f m (Maybe a)) -&gt; Stream f m (Maybe a))
-&gt; f (Stream f m (Maybe a)) -&gt; Stream f m (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Stream f m a -&gt; Stream f m (Maybe a))
-&gt; f (Stream f m a) -&gt; f (Stream f m (Maybe a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Stream f m a -&gt; Stream f m (Maybe a)
</span><a href="#local-6989586621679062781"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679062780"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-glyph hs-var">-</span></a></span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Stream f m a)
</span><a href="#local-6989586621679062776"><span class="hs-identifier hs-var">frest</span></a></span><span>
</span><span id="line-1376"></span></pre></body></html>